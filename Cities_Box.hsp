/*--------------------------------------------------------------------------------------------------

									    Cities Box Ver.1.7.1
									 	  (2018.03 Recode)

									  (C) YotioSoft 2017-2019

--------------------------------------------------------------------------------------------------*/

/*---------------------------------------èµ·å‹•æº–å‚™-------------------------------------------------*/
*startup
	directory = dirinfo(0)

	/*------------------------------------packoptç™»éŒ²---------------------------------------------*/
	#packopt name "Cities_Box"
	#packopt icon "img/logo.ico"

	/*------------------------------------uselibç™»éŒ²----------------------------------------------*/
	#uselib "user32.dll"
		#func FindWindow "FindWindowA" str, int
		#func GetWindowRect "GetWindowRect" int, int
		#func DrawText "DrawTextW" int,wstr,int,int,int

		#func ClientToScreen "ClientToScreen" int, int

		#func GetWindowLong "GetWindowLongA" int,int
		#func SetWindowLong "SetWindowLongA" int,int,int

		#define WM_SIZE	0x00005	//ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºå¤‰æ›´
		#define WS_MAXIMIZEBOX	0x10000	//æœ€å¤§åŒ–ã?ã‚¿ãƒ³
		#define WS_THICKFRAME	0x40000	//ã‚µã‚¤ã‚ºå¤‰æ›´å¯èƒ½

		#func SetTimer  "SetTimer"  int,int,int,int
		#func KillTimer "KillTimer" int,int
		#define WM_TIMER    0x0113
		#define TIMER_ID    1    ; ã‚¿ã‚¤ãƒã?ID

	/*----------------------------------------include---------------------------------------------*/
	#include "hspinet.as"
	#include "hspext.as"

	/*----------------------------------------defineç™»éŒ²------------------------------------------*/
	; ãƒãƒƒãƒ—ã‚µã‚¤ã‚ºã®æŒ?®?
	#define CHIP_SIZE				64

	; ã‚¢ãƒ‰ã‚ªãƒ³ç”¨ãƒãƒƒãƒ•ã‚¡IDã®æœ€å°å€¤
	#define BEGIN_ADDON_BUFFER_ID	100

	; ã‚¢ãƒ‰ã‚ªãƒ³ä»¥å¤–ã?ç”»åƒã?ãƒãƒƒãƒ•ã‚¡ç·æ•°
	#define BUFFER_IMAGES_TOTAL		81

	; ãƒãƒƒãƒ—ã‚µã‚¤ã‚º
	#define MAPSIZE_X				100
	#define MAPSIZE_Y				100
	#define MAPSIZE_Z				1

	/*---------------------------------------moduleç™»éŒ²-------------------------------------------*/
	#include "module.hsp"

	/*---------------------------------about.txtã®èª­ã¿è¾¼ã¿----------------------------------------*/
	exist "data/about.txt"
	if strsize = -1 {
		error "F01 : about.txtãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\ndataãƒ•ã‚©ãƒ«ãƒ€å†?«about.txtãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€?"
	}

	notesel about_txt
	noteload "data/about.txt"

	noteget about_title, 0
	noteget about_version, 1
	noteget about_release_number, 2

	split about_title, " : ", not_use, about_title
	split about_version, " : ", not_use, about_version
	split about_release_number, " : ", not_use, about_release_number

	title about_title

	/*---------------------------------config.datã®èª­ã¿è¾¼ã¿---------------------------------------*/
	exist "data/config.dat"
	if strsize = -1 {
		error "F02 : è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\ndataãƒ•ã‚©ãƒ«ãƒ€å†?«config.datãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€?"
	}

	notesel config
	noteload "data/config.dat"

	config_SystemFont = get_chapter(config, "SystemFont", " = \"", "\"")
	config_Set_Play_BGM = int( get_chapter(config, "Set_Play_BGM", " = ", ";") )
	config_Ignore_Update = int( get_chapter(config, "Ignore_Update", " = ", ";") )
	config_Get_Dev_Version = int( get_chapter(config, "Get_Dev_Version", " = ", ";") )

	config_OS = get_chapter(config, "OS", " = \"", "\"")

	config_Adjustment_Interval = int( get_chapter(config, "Adjustment_Interval", " = ", ";") )
	config_Drow_Interval = int( get_chapter(config, "Drow_Interval", " = ", ";") )

	config_WindowSize_X = int( get_chapter(config, "Config_WindowSize_X", " = ", ";") )
	config_WindowSize_Y = int( get_chapter(config, "Config_WindowSize_Y", " = ", ";") )

	config_Auto_Save = int( get_chapter(config, "Auto_Save", " = ", ";") )


	windowx=Config_WindowSize_X : windowy=Config_WindowSize_Y

	/*-------------------------------ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºã®å¯å¤‰åŒ–-------------------------------------*/
	screen 0, ginfo_dispx, ginfo_dispy : width windowx, windowy

	GetWindowLong hwnd, -16
	SetWindowLong hwnd, -16, stat | WS_THICKFRAME | WS_MAXIMIZEBOX

	color 0, 0, 0 : boxf

	/*---------------------------------ã‚¢ãƒ??ãƒ??ãƒˆã?ç¢ºèª?-----------------------------------------*/
	//æ—¢ã«ã‚¢ãƒ??ãƒ??ã‚¿ãƒ¼ãŒã‚ã‚Œã?å‰Šé™¤
	exist "Cities_Box_UD.exe"
	if strsize != -1 {
		delete "Cities_Box_UD.exe"
	}

	exist "Cities_Box_UD_Dev.exe"
	if strsize != -1 {
		delete "Cities_Box_UD_Dev.exe"
	}

	//ã‚¢ãƒ??ãƒ??ãƒˆé€šçŸ¥ã‚’å—ã‘å–ã‚‰ãªã?¨­å®šãªã‚?*menuã¸
	if config_Ignore_Update = 1 {
		goto *buffering
	}

	//é€šå¸¸ã®ã‚¢ãƒ??ãƒ??ãƒˆã?ç¢ºèª?
	download "http://joogle.web.fc2.com/datacenter/cities_box/", "datacenter_url.txt", "data/datacenter_url.txt"

	notesel datacenter_url
	noteload "data/datacenter_url.txt"

	if instr(datacenter_url, 0, "http://") = -1 {
		datacenter_url = "http://yotiosoft.com/dc/cities_box/"
	}

	download datacenter_url, "latest_version.txt", "data/latest_version.txt"

	notesel latest_version
	noteload "data/latest_version.txt"

	if instr(latest_version, 0, "<!DOCTYPE html>") != -1 {
		goto *buffering
	}

	latest_version__Release_number = int(get_chapter(latest_version, "Release Number", " : ", ";"))
	latest_version__Title = get_chapter(latest_version, "Title", " : ", ";")
	latest_version__Version = get_chapter(latest_version, "Version", " : ", ";")
	latest_version__About = get_chapter(latest_version, "About", " : ", ";")
	latest_version__OS = get_chapter(latest_version, "OS", " : ", ";")

	if latest_version__Release_number > about_release_number and instr(latest_version__OS, 0, config_OS) != -1 {
		normalUpdate = 1

		goto *buffering
	}

	//é–‹ç™ºç‰ˆã?ã‚¢ãƒ??ãƒ??ãƒˆã?ç¢ºèª?
	if config_get_Dev_Version = 1 {
		if instr(datacenter_url, 0, "http://") = -1 {
			datacenter_url = "http://yotiosoft.com/dc/cities_box/"
		}

		download datacenter_url, "Dev_latest_version.txt", "data/Dev_latest_version.txt"

		notesel Dev_latest_version
		noteload "data/Dev_latest_version.txt"

		if instr(Dev_latest_version, 0, "<!DOCTYPE html>") != -1 {
			goto *buffering
		}

		Dev_latest_version__Release_number = int(get_chapter(Dev_latest_version, "Release Number", " : ", ";"))
		Dev_latest_version__Title = get_chapter(Dev_latest_version, "Title", " : ", ";")
		Dev_latest_version__Version = get_chapter(Dev_latest_version, "Version", " : ", ";")
		Dev_latest_version__About = get_chapter(Dev_latest_version, "About", " : ", ";")
		Dev_latest_version__OS = get_chapter(latest_version, "OS", " : ", ";")

		if Dev_latest_version__Release_number > about_release_number and instr(Dev_latest_version__OS, 0, config_OS) != -1 {
			devUpdate = 1

			goto *buffering
		}
	}

*buffering
	/*------------------------------------ä½¿ç”¨ã™ã‚‹ç”»åƒã?èª­ã¿è¾¼ã¿----------------------------------*/
	color 255, 201, 14 : boxf 0, windowy-5, windowx/2, windowy

	notesel bufferings

	repeat BUFFER_IMAGES_TOTAL+1
		noteadd " ", cnt
	loop

	//ãƒ­ã‚´ã€èƒŒæ™¯ç”»åƒï¼?buffer 1ã¯è¨­å®šã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ä½¿ã?Ÿã‚ä½¿ç”¨ä¸å¯??
		if instr(about_title, 0, "Dev") != -1 {
			noteadd "img/logo_Dev.png", 2, 1								; ãƒ­ã‚´
			noteadd "img/logo2_Dev.png", 62, 1								; ãƒ­ã‚´2?ˆã‚¿ã‚¤ãƒˆãƒ«??
		} else {
			noteadd "img/logo.png", 2, 1									; ãƒ­ã‚´
			noteadd "img/logo2.png", 62, 1									; ãƒ­ã‚´2?ˆã‚¿ã‚¤ãƒˆãƒ«??
		}

		noteadd "img/logo2_Mac.png", 75, 1									; ãƒ­ã‚´2??macOSå‘ã‘??
		noteadd "img/title_background.png", 15, 1							; ã‚¿ã‚¤ãƒˆãƒ«èƒŒæ™¯ç”»åƒ?

	//è¨­å®šã§ä½¿ã?‚¢ã‚¤ã‚³ãƒ³
		noteadd "img/menu_icons/setting/check.png", 14, 1					; ãƒã‚§ãƒ?‚¯ãƒœã‚¿ãƒ³
		noteadd "img/menu_icons/setting/refer.png", 16, 1					; å‚ç?ãƒœã‚¿ãƒ³

	//çŠ¯ç½ªç?€åœ°ä¾¡ã®çµ±è¨ˆã§ä½¿ã?‚¿ã‚¤ãƒ«
		noteadd "img/quarter/+3.png", 34, 1									; åœ°ä¾¡/çŠ¯ç½ªç?/æ•™è‚²åº¦ : æœ€è‰¯
		noteadd "img/quarter/+2.png", 35, 1									; åœ°ä¾¡/çŠ¯ç½ªç?/æ•™è‚²åº¦ : è‰¯
		noteadd "img/quarter/+1.png", 36, 1									; åœ°ä¾¡/çŠ¯ç½ªç?/æ•™è‚²åº¦ : æ¦‚ã?è‰¯
		noteadd "img/quarter/0.png" , 48, 1									; åœ°ä¾¡/çŠ¯ç½ªç?/æ•™è‚²åº¦ : 0
		noteadd "img/quarter/-1.png", 37, 1									; åœ°ä¾¡/çŠ¯ç½ªç?/æ•™è‚²åº¦ : å°‘ã—ä½ã„/æ‚ªã?
		noteadd "img/quarter/-2.png", 38, 1									; åœ°ä¾¡/çŠ¯ç½ªç?/æ•™è‚²åº¦ : ä½ã„/æ‚ªã?
		noteadd "img/quarter/-3.png", 39, 1									; åœ°ä¾¡/çŠ¯ç½ªç?/æ•™è‚²åº¦ : æœ€ä½?/æœ€æ‚ª

	//ã‚¨ãƒªã‚¢è¨­å®šã§ä½¿ã?‚¢ã‚¤ã‚³ãƒ³
		noteadd "img/area/residential.png", 40, 1							; ã‚¨ãƒªã‚¢ : ä½å±?œ°åŒº
		noteadd "img/area/commercial.png", 41, 1							; ã‚¨ãƒªã‚¢ : å•?¥­åœ°åŒº
		noteadd "img/area/office.png", 42, 1								; ã‚¨ãƒªã‚¢ : ã‚ªãƒ•ã‚£ã‚¹åœ°åŒº
		noteadd "img/area/industrial.png", 43, 1							; ã‚¨ãƒªã‚¢ : å·¥æ¥­åœ°åŒº
		noteadd "img/area/farm.png", 58, 1									; ã‚¨ãƒªã‚¢ : è¾²æ¥­åœ°åŒº

	//ãƒã‚¤ãƒ³ã‚¿ãƒ¼
		noteadd "img/pointer/blue.png", 17, 1								; é’ã„ãƒã‚¤ãƒ³ã‚¿ãƒ¼
		noteadd "img/pointer/red.png", 18, 1								; èµ¤ã??ã‚¤ãƒ³ã‚¿ãƒ¼

	//åœ°åŒºã‚’ç¤ºã™ã‚¿ã‚¤ãƒ«
		noteadd "img/quarter/residential.png", 22, 1						; ä½å±?œ°åŒº
		noteadd "img/quarter/commercial.png", 23, 1							; å•?¥­åœ°åŒº
		noteadd "img/quarter/office.png", 24, 1								; ã‚ªãƒ•ã‚£ã‚¹åœ°åŒº
		noteadd "img/quarter/industrial.png", 25, 1							; å·¥æ¥­åœ°åŒº
		noteadd "img/quarter/farm.png", 59, 1								; è¾²æ¥­åœ°åŒº
		noteadd "img/quarter/public.png", 26, 1								; å…¬å…±æ–½è¨­
		noteadd "img/quarter/h_residential.png", 44, 1						; é«˜å¯?º¦ä½å±?œ°åŒº
		noteadd "img/quarter/h_commercial.png", 45, 1						; é«˜å¯?º¦å•?¥­åœ°åŒº
		noteadd "img/quarter/h_office.png", 46, 1							; é«˜å¯?º¦ã‚ªãƒ•ã‚£ã‚¹åœ°åŒº

	//æœ€åˆã?ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ã®ãƒœã‚¿ãƒ³
		noteadd "img/start_menu/new.png", 27, 1								; æ–°ãƒãƒƒãƒ?
		noteadd "img/start_menu/load.png", 28, 1							; éƒ½å¸?

		noteadd "img/start_menu/setting.png", 65, 1							; è¨­å®?
		noteadd "img/start_menu/addon_maker.png", 72, 1						; Addon Maker

	//èª­ã¿è¾¼ã¿ä¸­ã‚¢ã‚¤ã‚³ãƒ³
		noteadd "img/loading/124856y.png", 53, 1							; èª­ã¿è¾¼ã¿ä¸­ã‚¢ã‚¤ã‚³ãƒ³1
		noteadd "img/loading/124856y-2.png", 54, 1							; èª­ã¿è¾¼ã¿ä¸­ã‚¢ã‚¤ã‚³ãƒ³2
		noteadd "img/loading/124856y-3.png", 55, 1							; èª­ã¿è¾¼ã¿ä¸­ã‚¢ã‚¤ã‚³ãƒ³3
		noteadd "img/loading/124856y-4.png", 56, 1							; èª­ã¿è¾¼ã¿ä¸­ã‚¢ã‚¤ã‚³ãƒ³4

	//é€Ÿã•
		noteadd "img/speed/slow.png", 73, 1									; é?„
		noteadd "img/speed/normal.png", 68, 1								; æ™®é€?
		noteadd "img/speed/fast.png", 69, 1									; é€Ÿã„
		noteadd "img/speed/very_fast.png", 74, 1							; ã¨ã¦ã‚‚æ—©ã?
		noteadd "img/speed/pause.png", 70, 1								; ä¸€æ™‚åœæ­¢

	//å»ºç‰©è©³ç´°ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
		noteadd "img/show_detail/change_name.png", 71, 1					; å»ºç‰©åã?å¤‰æ›´

	//å»ºç‰©ã®æ–¹å‘ã‚’ç¤ºã™çŸ¢å°
		noteadd "img/arrows/arrows.png", 77									; çŸ¢å°

	//ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®è¨­å®šç”»é¢ã§ä½¿ã?‚¢ã‚¤ã‚³ãƒ³
		noteadd "img/menu_setting/general.png", 60, 1						; ä¸€èˆ¬è¨­å®?
		noteadd "img/menu_setting/information.png", 61, 1					; æƒ??±
		noteadd "img/menu_setting/bug.png", 63, 1							; ãƒã‚°ãƒ»ã”è¦æœ›ã®é€ä¿¡
		noteadd "img/menu_setting/update.png", 78, 1						; æ›´æ–°

		noteadd "img/menu_setting/text.png", 64, 1							; ãƒ?‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¤ã‚³ãƒ³

	//ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã‚¢ã‚¤ã‚³ãƒ³
		noteadd "img/menu_icons/menu/cursor.png", 3, 1						; æ¨™æº–ã‚«ãƒ¼ã‚½ãƒ«
		noteadd "img/menu_icons/menu/road.png", 4, 1						; ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³?ˆé“è·¯æ•·è¨­??
		noteadd "img/menu_icons/menu/railroad.png", 50, 1					; ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³?ˆç·šè·¯å»ºè¨­??
		noteadd "img/menu_icons/menu/low_density_residential.png", 5, 1		; ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³?ˆä½å±?œ°åŒºå»ºè¨­??
		noteadd "img/menu_icons/menu/commercial.png", 12, 1					; ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³?ˆå•†æ¥­åœ°åŒºå»ºè¨­??
		noteadd "img/menu_icons/menu/office.png", 6, 1						; ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³?ˆã‚ªãƒ•ã‚£ã‚¹å»ºè¨­??
		noteadd "img/menu_icons/menu/industrial.png", 19, 1					; ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³?ˆå·¥æ¥­åœ°åŒºå»ºè¨­??
		noteadd "img/menu_icons/menu/farm.png", 57, 1						; ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³?ˆè¾²æ¥­åœ°åŒºå»ºè¨­??
		noteadd "img/menu_icons/menu/public.png", 7, 1						; ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³?ˆéƒµä¾¿å±€å»ºè¨­??
		noteadd "img/menu_icons/menu/park.png", 29, 1						; ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³?ˆå?åœ’å»ºè¨­??
		noteadd "img/menu_icons/menu/waterway.png", 76, 1					; ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³?ˆæ°´è·¯å»ºè¨­??
		noteadd "img/menu_icons/menu/airport.png", 79, 1					; ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³?ˆç©ºæ¸¯å»ºè¨­??
		noteadd "img/menu_icons/menu/tile.png", 80, 1						; ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³?ˆã‚¿ã‚¤ãƒ«æ•·è¨­??

		noteadd "img/menu_icons/menu/bulldozer.png", 10, 1					; æ’¤å»ãƒœã‚¿ãƒ³
		noteadd "img/menu_icons/save/save.png", 11, 1						; ä¿å­˜ã?ã‚¿ãƒ³
		noteadd "img/menu_icons/setting/setting.png", 13, 1					; è¨­å®šã?ã‚¿ãƒ³
		noteadd "img/menu_icons/stat/stat.png", 30, 1						; çµ±è¨ˆã?ã‚¿ãƒ³
		noteadd "img/menu_icons/budget/budget.png", 49, 1					; äºˆç®—ã?ã‚¿ãƒ³
		noteadd "img/menu_icons/information/information.png", 52, 1			; æƒ??±ãƒœã‚¿ãƒ³

	//çµ±è¨ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ä½¿ã?‚¢ã‚¤ã‚³ãƒ³
		noteadd "img/menu_icons/stat/type.png", 31, 1						; å»ºç¯‰ç‰©ã®ç¨®é¡?
		noteadd "img/menu_icons/stat/land_price.png", 32, 1					; åœ°ä¾¡
		noteadd "img/menu_icons/stat/crime_rate.png", 33, 1					; çŠ¯ç½ªç?
		noteadd "img/menu_icons/stat/education_rate.png", 47, 1				; æ•™è‚²åº¦
		noteadd "img/menu_icons/stat/happiness.png", 51, 1					; å¹¸ç¦åº¦
		noteadd "img/menu_icons/stat/noise.png", 81, 1						; é¨’éŸ³

	//å°ã‚µã‚¤ã‚ºã®ã‚¢ã‚¤ã‚³ãƒ³
		noteadd "img/menu_icons/mini/low_density_residential.png", 8, 1		; ä½å¯?º¦ä½å±?œ°åŒº
		noteadd "img/menu_icons/mini/high_density_residential.png", 9, 1	; é«˜å¯?º¦ä½å±?œ°åŒº
		noteadd "img/menu_icons/mini/low_density_commercial.png", 20, 1		; ä½å¯?º¦å•?¥­åœ°åŒº
		noteadd "img/menu_icons/mini/high_density_commercial.png", 21, 1	; é«˜å¯?º¦å•?¥­åœ°åŒº

		noteadd "img/menu_icons/mini/roadway.png", 66, 1					; è»Šé“
		noteadd "img/menu_icons/mini/promenade.png", 67, 1					; æ­©é? / è‡ªè»¢è»Šé“

	; èª­ã¿è¾¼ã¿
	a_statbar_block = windowx/2 / BUFFER_IMAGES_TOTAL

	repeat BUFFER_IMAGES_TOTAL+1
		noteget load_img, cnt
		exist load_img

		if load_img != " " {
			if strsize = -1 {
				error "F03 : ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\nå¿?¦ãªç”»åƒãƒ•ã‚¡ã‚¤ãƒ« "+load_img+" ãŒæ¬?ã‘ã¦ã?¾ã™ã€?"
			}
			
			celload load_img, cnt
		}

		color 255, 201, 14 : boxf 0, windowy-5, windowx/2+(a_statbar_block*(cnt+3)), windowy
	loop

	bufferings = ""

/*-----------------------------------ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ã¨è¨­å®šç”»é¢---------------------------------------*/
*menu
	/*-----------------------------------ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢---------------------------------------------*/
	onexit *exit
	onclick gosub *menu_onclick

	return_from_exit = "menu"

	if (devUpdate = 1 or normalUpdate = 1) and update_button = 0 and config_Ignore_Update = 0 {
		objsize 150, 20
		pos windowx-150-20, windowy-titlebar_h-65+5 : button gosub "æ›´æ–°ã™ã‚‹", *update
		pos windowx-150-20, windowy-titlebar_h-65+30 : button "æ›´æ–°é€šçŸ¥ã‚’å—ã‘å–ã‚‰ãªã?", *set_ignore_update
		update_button = 1
	}

	now_loading = 0

	repeat
		redraw 0

		//ç¾åœ¨ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºã‚’å–å¾?
		windowx = ginfo_sizex
		windowy = ginfo_sizey

		//ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å·¦æ?ã®æ¨ªå¹?¨ã‚¿ã‚¤ãƒˆãƒ«ãƒã?ã®é«˜ã•ã‚’å–å¾?
		dim rc, 2
		rc(0) = 0
		rc(1) = 0
		ClientToScreen hwnd, varptr(rc)

		window_left_breadth = rc(0) - ginfo_wx1
		titlebar_h = rc(1) - ginfo_wy1

		//èƒŒæ™¯ç”»åƒ?
		pos 0, 0 : gzoom windowx, windowy-titlebar_h, 15, 0, 0, 948, 635 : gblur 2

		//ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢è¡¨ç¤º
		color 0, 0, 0
		sboxf 128, 0, 0, windowx, windowy

		pos windowx/2-55, double(50./300)*(windowy-titlebar_h) : gmode 0 : gcopy 2, 0, 0, 110, 110

		font config_SystemFont, 14

		color 0, 162, 232

		if click_range(windowx/2-50-20-10, double(300./483)*(windowy-titlebar_h), windowx/2-50-20+50+10, double(300./483)*(windowy-titlebar_h)+50+2+20) = 1 {
			sboxf 200, windowx/2-50-20-10, double(300./483)*(windowy-titlebar_h), windowx/2-50-20+50+10, double(300./483)*(windowy-titlebar_h)+50+2+20
		}
		if click_range(windowx/2+20-10, double(300./483)*(windowy-titlebar_h), windowx/2+20+50+10, double(300./483)*(windowy-titlebar_h)+50+2+20) = 1 {
			sboxf 200, windowx/2+20-10, double(300./483)*(windowy-titlebar_h), windowx/2+20+50+10, double(300./483)*(windowy-titlebar_h)+50+2+20
		}

		if click_range(8, 25, 8+32, 25+32) = 1 {
			sboxf 200, 8, 25, 8+32, 25+32
		}
		if click_range(45, 25, 45+32, 25+32) = 1 {
			sboxf 200, 45, 25, 45+32, 25+32
		}

		//ãƒãƒƒãƒ—ä½œæ?ãƒ»èª­ã¿è¾¼ã¿ãƒœã‚¿ãƒ³
			color 255, 255, 255

			gmode 2
			pos windowx/2-50-20, double(300./483)*(windowy-titlebar_h) : gcopy 27, 0, 0, 50, 50
				cmes "æ–°ã—ã„ãƒãƒƒãƒ?", windowx/2-50-20-50, double(300./483)*(windowy-titlebar_h)+50+2, windowx/2-50-20+50+50, double(300./483)*(windowy-titlebar_h)+50+2+20, 1

			pos windowx/2+20, double(300./483)*(windowy-titlebar_h) : gcopy 28, 0, 0, 50, 50
				cmes "èª­ã¿è¾¼ã¿", windowx/2+20-50, double(300./483)*(windowy-titlebar_h)+50+2, windowx/2+20+50+50, double(300./483)*(windowy-titlebar_h)+50+2+20, 1

		//å·¦ä¸Šã?ãƒ¡ãƒ‹ãƒ¥ãƒ¼?ˆè¨­å®šã?ã‚¿ãƒ³ãªã©??
			color 255, 255, 255 : font config_SystemFont, 14
			pos 8, 5 : mes about_title+" ver."+about_version+" r"+about_release_number+""

			gmode 2
			pos 8, 25  : gcopy 65, 0, 0, 32, 32
			pos 45, 25 : gcopy 72, 0, 0, 32, 32

			if config_OS = "macOS" {
				pos 82, 25 : gcopy 64, 0, 0, 32, 32
			}

			if click_range(8, 25, 8+32, 25+32) = 1 {
				font config_SystemFont, 10

				color 255, 255, 255 : sboxf 200, 8, 25+32, 8+50, 25+32+18
				color 0, 0, 0
				pos 8+2, 25+32+2 : mes "è¨­å®?"
			}
			if click_range(45, 25, 45+32, 25+32) = 1 {
				font config_SystemFont, 10

				color 255, 255, 255 : sboxf 200, 45, 25+32, 45+70, 25+32+18
				color 0, 0, 0
				pos 45+2, 25+32+2 : mes "Addon Maker"
			}

			if config_OS = "macOS" {
				if click_range(82, 25, 82+32, 25+32) = 1 {
					font config_SystemFont, 10

					color 255, 255, 255 : sboxf 200, 82, 25+32, 82+70, 25+32+18
					color 0, 0, 0
					pos 82+2, 25+32+2 : mes "ReadMe.txt"
				}
			}


		//ã‚¢ãƒ??ãƒ??ãƒˆãŒã‚ã£ãŸå?´å?
			if (devUpdate = 1 or normalUpdate = 1) and config_Ignore_Update = 0 {
				color 0, 162, 232 : sboxf 128, windowx-500-10, windowy-titlebar_h-70+5-10, windowx-10, windowy-titlebar_h-10
				color 255, 255, 255

				if latest_version__Release_number > about_release_number {
					font config_SystemFont, 14 : pos windowx-500, windowy-titlebar_h-70+3 : mes "ã‚¢ãƒ??ãƒ??ãƒˆãŒã‚ã‚Šã¾ã™ï¼æ›´æ–°ã—ã¾ã™ã‹??"
					font config_SystemFont, 11 : pos windowx-500, windowy-titlebar_h-50+3 : mes "ver."+latest_version__Version+" r"+latest_version__Release_number+"\n"+latest_version__About+""
				} else : if Dev_latest_version__Release_number > about_release_number {
					font config_SystemFont, 14 : pos windowx-500, windowy-titlebar_h-70+3 : mes "é–‹ç™ºç‰ˆã«ã‚¢ãƒ??ãƒ??ãƒˆãŒã‚ã‚Šã¾ã™ï¼æ›´æ–°ã—ã¾ã™ã‹??"
					font config_SystemFont, 11 : pos windowx-500, windowy-titlebar_h-50+3 : mes "ver."+Dev_latest_version__Version+"(Dev) r"+Dev_latest_version__Release_number+"\n"+Dev_latest_version__About+""
				}
			}

		wait 10
		redraw 1
	loop

*menu_onclick
	/*-------------------------ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ã§ã‚¯ãƒªãƒ?‚¯ã•ã‚ŒãŸã¨ãã?å‹•ä½?-----------------------------*/
	if click_range(windowx/2-80, double(300./483)*(windowy-titlebar_h), windowx/2-50-20+50+10, double(300./483)*(windowy-titlebar_h)+50+2+20) = 1 {
		gosub *map_dimensions
		goto *new_map
	}
	if click_range(windowx/2+10, double(300./483)*(windowy-titlebar_h), windowx/2+20+50+10, double(300./483)*(windowy-titlebar_h)+50+2+20) = 1 {
		gosub *map_dimensions
		goto *load_map
	}

	if click_range(8, 25, 8+32, 25+32) = 1 {
		goto *menu_setting
	}
	if click_range(45, 25, 45+32, 25+32) = 1 {
		gosub *menu_addon_maker
	}

	if OS = "macOS" {
		if click_range(82, 25, 82+32, 25+32) = 1 {
			exist "ReadMe.txt"
			if strsize = -1 {
				error "F04 : ReadMe.txtãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\nReadMe.txtãŒè¦‹ã¤ã‹ã‚‰ãªã?Ÿã‚ã€?–‹ãã“ã¨ãŒã§ãã¾ã›ã‚“ã€?"
			}

			exec "ReadMe.txt", 16
		}
	}

	return

*set_ignore_update
	config_Ignore_Update = 1
	goto *menu

*menu_setting
	/*-------------------------------------è¨­å®šç”»é¢-----------------------------------------------*/
	screen 1, 500, 300

	menu_setting__page = "general"

	if config_OS = "macOS" {
		os_num = 1
	} else {
		os_num = 0
	}

*menu_setting_2
	gsel 1, 2
	title "è¨­å®?"

	onclick *menu_setting_onclick

	color 50, 50, 50 : boxf 0, 0, 64, 300
	color 75, 75, 75 : boxf 64, 0, 500, 28
	color 90, 90, 90 : boxf 64, 28, 500, 300

	from_menu_setting = 1

	//è¨­å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼
		gmode 2

		pos 16, 28 + 0 + 16   : gcopy 60, 0, 0, 48, 48
		pos 16, 28 + 64 + 16  : gcopy 63, 0, 0, 48, 48
		pos 16, 28 + 128 + 16 : gcopy 78, 0, 0, 48, 48
		pos 16, 28 + 192 + 16 : gcopy 61, 0, 0, 48, 48

	//è¨­å®šç”»é¢

		; ä¸€èˆ¬è¨­å®?
			if menu_setting__page = "general" {
				color 0, 162, 232 : boxf 60, 0+28, 64, 64+28

				font config_SystemFont, 16 : color 255, 255, 255
				pos 70, 3 : mes "ä¸€èˆ¬è¨­å®?"

				font config_SystemFont, 14 : color 255, 255, 255

				; BGMã®å†ç”Ÿ(Set_Play_BGM)
					pos 90, 40 : mes "BGMã‚’å?ç”Ÿã™ã‚?"
					if config_Set_Play_BGM = 0 {
						pos 350, 40 : gcopy 14, 0, 0, 16, 16
					} else {
						pos 350, 40 : gcopy 14, 0, 16, 16, 16
					}

				; ã‚¢ãƒ??ãƒ??ãƒˆé€šçŸ¥ã®ON/OFF??Ignore_Update??
					pos 90, 70 : mes "ã‚¢ãƒ??ãƒ??ãƒˆã‚’é€šçŸ¥ã™ã‚‹"
					if config_Ignore_Update = 1 {
						pos 350, 70 : gcopy 14, 0, 0, 16, 16
					} else {
						pos 350, 70 : gcopy 14, 0, 16, 16, 16
					}

				; é–‹ç™ºç‰ˆã?ã‚¢ãƒ??ãƒ??ãƒˆã‚’å—ã‘å–ã‚‹??Get_Dev_Version??
					pos 90, 100 : mes "é–‹ç™ºç‰ˆã?ã‚¢ãƒ??ãƒ??ãƒˆã‚’å—ã‘å–ã‚‹"
					if config_Get_Dev_Version = 0 {
						pos 350, 100 : gcopy 14, 0, 0, 16, 16
					} else {
						pos 350, 100 : gcopy 14, 0, 16, 16, 16
					}

				; ã‚ªãƒ¼ãƒˆã‚»ãƒ¼ãƒ–ã?ON/OFF??config_Auto_Save??
					pos 90, 130 : mes "ã‚ªãƒ¼ãƒˆã‚»ãƒ¼ãƒ?"
					if config_Auto_Save = 0 {
						pos 350, 130 : gcopy 14, 0, 0, 16, 16
					} else {
						pos 350, 130 : gcopy 14, 0, 16, 16, 16
					}

				; ãƒ•ã‚©ãƒ³ãƒˆè¨­å®?(SystemFont)
					pos 90, 160 : mes "ãƒ•ã‚©ãƒ³ãƒ?"

					gtmp = ginfo(14)

					pos 90+gtmp+100, 160 : objsize 150, 20 : input config_SystemFont : SyetmFont__stat = stat
					pos 90+gtmp+250, 160 : objsize 50, 20  : button gosub "å‚ç?", *refer_fonts

				; å‹•ä½œãƒ¢ãƒ¼ãƒ‰è¨­å®?(OS)
					pos 90, 190 : mes "å‹•ä½œãƒ¢ãƒ¼ãƒ?"

					pos 90+gtmp+200, 190 : objsize 100, 20 : combox os_num, 100, "Windows\nmacOS"

				; æå?é–“éš”??Drow_Interval??
					pos 90, 220 : mes "æå?é–“éš”?ˆæ•°å€¤ãŒä½ã„ã»ã©é–“éš”ãŒçŸ­ã?¼?"

					pos 90+gtmp+250, 220 : objsize 50, 20 : input config_Drow_Interval : DIinpStat = stat


				repeat
					if os_num != os_num_before and os_num = 0 {
						config_OS = "Windows"

						config_Adjustment_Interval = 2
						config_Drow_Interval = 4

						objprm DIinpStat, config_Drow_Interval
					} else : if os_num != os_num_before and os_num = 1 {
						config_OS = "macOS"

						config_Adjustment_Interval = 2
						config_Drow_Interval = 2

						objprm DIinpStat, config_Drow_Interval
					}

					os_num_before = os_num

					wait 100
				loop
			}

		; ãƒã‚°ãƒ»ã”è¦æœ›ã®é€ä¿¡
			if menu_setting__page = "bug" {
				clrobj

				color 0, 162, 232 : boxf 60, 64+28, 64, 128+28

				font config_SystemFont, 16 : color 255, 255, 255
				pos 70, 3 : mes "ãƒã‚°ãƒ»ã”è¦æœ›ã®é€ä¿¡"

				font config_SystemFont, 14 : color 255, 255, 255
				pos 90, 50 : mes "ç¾åœ¨ç¢ºèªã•ã‚Œã¦ã?‚‹ãƒã‚°ã«ã¤ã?¦ã¯ã€\nReadMe.txtã®ã€?15.ãƒã‚°ã‚?•é¡Œç‚¹ã€ä»Šå¾Œã?äºˆå®šã€ã‚’ã”è¦§ãã ã•ã„ã€?"
				pos ((500-64)/2)-16, 100 : gcopy 64, 0, 0, 32, 32
				pos ((500-64)/2)-16+45, 105 : mes "ReadMe.txtã‚’é–‹ã?"

				ginfo_tmp__bug_ReadMe = ginfo(14)

				pos 90, 150 : mes "ã“ã?ä»–ã«ãƒã‚°ã‚?”è¦æœ›ç­‰ãŒã”ã–ã?¾ã—ãŸã‚‰ã€\nãŠæ°—è»½ã«YotioSoft ã‚³ãƒ³ã‚¿ã‚¯ãƒˆãƒ•ã‚©ãƒ¼ãƒ?ã¾ã§ã”ä¸€å ±ãã ã•ã„ã€?"
				pos ((500-64)/2)-16-40, 200 : gcopy 63, 0, 0, 32, 32
				pos ((500-64)/2)-16-40+45, 205 : mes "ã‚³ãƒ³ã‚¿ã‚¯ãƒˆãƒ•ã‚©ãƒ¼ãƒ?ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã"

				ginfo_tmp__bug_Send = ginfo(14)


			}

		; æ›´æ–°
			if menu_setting__page = "update" {
				clrobj

				color 0, 162, 232 : boxf 60, 128+28, 64, 192+28

				font config_SystemFont, 16 : color 255, 255, 255
				pos 70, 3 : mes "æ›´æ–°"

				if devUpdate = 1 and normalUpdate = 0 and config_Get_Dev_Version = 1 {
					pos 100, 40 : mes "é–‹ç™ºç‰ˆã«æ›´æ–°ãŒã‚ã‚Šã¾ã™ï¼?"
					font config_SystemFont, 14, 1
					color 163, 73, 164
					pos 110, 65 : mes "ver."+Dev_latest_version__Version+"(Dev) r"+Dev_latest_version__Release_number+""

					Dev_latest_version__About_tmp = Dev_latest_version__About
					strrep Dev_latest_version__About_tmp, " / ", "\n"
					pos 110, 90 : mesbox Dev_latest_version__About_tmp, 340, 150

					objsize 100, 20
					pos 350, 250 : button "æ›´æ–°ã™ã‚‹", *update
					//pos 350, 250 : button "ãƒã?ã‚¸ãƒ§ãƒ³ã®é¸æŠ?", *choose_version

				} else : if normalUpdate = 1 {
					pos 100, 40 : mes "æ›´æ–°ãŒã‚ã‚Šã¾ã™ï¼?"
					font config_SystemFont, 14, 1
					color 255, 127, 39
					pos 110, 65 : mes "ver."+latest_version__Version+" r"+latest_version__Release_number+""

					latest_version__About_tmp = latest_version__About
					strrep latest_version__About_tmp, " / ", "\n"
					pos 110, 90 : mesbox latest_version__About_tmp, 340, 150

					objsize 100, 20
					pos 350, 250 : button "æ›´æ–°ã™ã‚‹", *update
					//pos 350, 250 : button "ãƒã?ã‚¸ãƒ§ãƒ³ã®é¸æŠ?", *choose_version

				} else {
					pos 100, 40 : mes "ãŠä½¿ã??ãƒã?ã‚¸ãƒ§ãƒ³ã¯æœ€æ–°ç‰ˆã§ã?"
				}
			}
			/*
			if menu_setting__page = "choose_version" {
				clrobj

				color 0, 162, 232 : boxf 60, 128+28, 64, 192+28

				font config_SystemFont, 16 : color 255, 255, 255
				pos 70, 3 : mes "ãŠå¾?¡ä¸‹ã•ã?..."

				//ä¸€è¦§ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ?
				download datacenter_url, "release_files_log.dat", "data/release_files_log.dat"

				exist "data/release_files_log.dat"
				if strsize = -1 {
					pos 100, 40 : mes "æ›´æ–°å¯èƒ½ãƒã?ã‚¸ãƒ§ãƒ³ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€?"
					stop
				}
				notesel files
				noteload "data/release_files_log.dat"

				if instr(files, 0, "<!DOCTYPE html>") != -1 {
					pos 100, 40 : mes "æ›´æ–°å¯èƒ½ãƒã?ã‚¸ãƒ§ãƒ³ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€?"
					stop
				}

				//æ›´æ–°å¯èƒ½ãƒã?ã‚¸ãƒ§ãƒ³ä¸€è¦§ã‚’å–å¾?
				notesel files
				sdim versions, 8, notemax/4
				dim release_numbers, notemax/4
				next_number = 0

				repeat notemax
					noteget a_line, cnt
					if instr(a_line, 0, "{") != -1 {
						split a_line, "]", a_version, a_release_number

						if int(a_release_number) > about_release_number {
							versions(next_number) = a_version
							release_numbers(next_number) = int(a_release_number)
							next_number ++
						}
					}
				loop

				versions_list = ""
				notesel versions_list
				repeat next_number
					noteadd ""+strmid(versions(cnt), 1, strlen(versions(cnt)))+" r"+release_numbers(cnt)+""
				loop

				version_number_in_list = 0

				color 75, 75, 75 : boxf 64, 0, 500, 28
				font config_SystemFont, 16 : color 255, 255, 255
				pos 70, 3 : mes "æ›´æ–°ã™ã‚‹ãƒã?ã‚¸ãƒ§ãƒ³ã®é¸æŠ?"

				pos 100, 40 : mes "æ›´æ–°ã‚’é©ç”¨ã™ã‚‹ãƒã?ã‚¸ãƒ§ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„ã€?"

				objsize 340, 100
				pos 110, 65 : listbox version_number_in_list, 100, versions_list

				objsize 150, 20
				pos 300, 250 : button "ã“ã?ãƒã?ã‚¸ãƒ§ãƒ³ã«æ›´æ–°", *update_selected_version
			}*/

		; æƒ??±
			if menu_setting__page = "information" {
				clrobj

				color 0, 162, 232 : boxf 60, 192+28, 64, 256+28

				font config_SystemFont, 16 : color 255, 255, 255
				pos 70, 3 : mes "æƒ??±"

				pos 100, 40     : gcopy 2, 0, 0, 110, 110

				if config_OS = "Windows" {
					pos 120+110, 40 : gcopy 62, 0, 0, 230, 110
				} else : config_OS = "macOS" {
					pos 120+110, 40 : gcopy 75, 0, 0, 230, 110
				}

				font config_SystemFont, 14 : color 255, 255, 255
				pos 100, 170 : mes ""+about_title+"\nVersion : "+about_version+"\nRelease Number : "+about_release_number+"\nDevelopment Language : HSP 3.5"
				font config_SystemFont, 10 : color 255, 255, 255
				pos 100, 270 : mes "Copyright(C) YotioSoft 2017-2019 All Rights Reserved."
			}

	stop

*menu_setting_onclick
	//è¨­å®šä¸Šã§ã‚¯ãƒªãƒ?‚¯ã•ã‚ŒãŸã¨ãã?å‹•ä½?

	//è¨­å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼
		if click_range(0, 28, 64, 28+64) = 1 {
			menu_setting__page = "general"
		}
		if click_range(0, 28+64, 64, 28+128) = 1 {
			menu_setting__page = "bug"
		}
		if click_range(0, 28+128, 64, 28+192) = 1 {
			menu_setting__page = "update"
		}
		if click_range(0, 28+192, 64, 28+256) = 1 {
			menu_setting__page = "information"
		}

	//ä¸€èˆ¬è¨­å®?
		if menu_setting__page = "general" {
			if click_range(350, 40, 350+16, 40+16) = 1 {
				if config_Set_Play_BGM = 0 {
					config_Set_Play_BGM = 1
				} else {
					config_Set_Play_BGM = 0
				}
			}
			if click_range(350, 70, 350+16, 70+16) = 1 {
				if config_Ignore_Update = 0 {
					config_Ignore_Update = 1
				} else {
					config_Ignore_Update = 0
				}
			}
			if click_range(350, 100, 350+16, 100+16) = 1 {
				if config_Get_Dev_Version = 0 {
					config_Get_Dev_Version = 1
				} else {
					config_Get_Dev_Version = 0
				}
			}
			if click_range(350, 130, 350+16, 130+16) = 1 {
				if config_Auto_Save = 0 {
					config_Auto_Save = 1
				} else {
					config_Auto_Save = 0
				}
			}
		}

	//ãƒã‚°ãƒ»ã”è¦æœ›ã®é€ä¿¡
		if menu_setting__page = "bug" {
			; ReadMe.txtã‚’é–‹ã?
				if click_range(((500-64)/2)-16, 100, ((500-64)/2)-16+45+ginfo_tmp__bug_ReadMe, 100+32) = 1{
					exist "ReadMe.txt"
					if strsize = -1 {
						error "F04 : ReadMe.txtãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\nReadMe.txtãŒè¦‹ã¤ã‹ã‚‰ãªã?Ÿã‚ã€?–‹ãã“ã¨ãŒã§ãã¾ã›ã‚“ã€?"
					}

					exec "ReadMe.txt", 16
				}

			; ã‚³ãƒ³ã‚¿ã‚¯ãƒˆãƒ•ã‚©ãƒ¼ãƒ?ã‚’é–‹ã?
				if click_range(((500-64)/2)-16-40, 200, ((500-64)/2)-16-40+45+ginfo_tmp__bug_Send, 200+32) = 1{
					exec "http://yotiosoft.com/contact-form/", 16
				}
		}

	clrobj
	goto *menu_setting_2
/*
*choose_version
	menu_setting__page = "choose_version"
	goto *menu_setting_2

*update_selected_version
	tmp = str(int(release_numbers(version_number_in_list)))
	notesel tmp
	notesave "data/set_update_release_number.txt"
	gsel 0
	goto *update
*/
*menu_addon_maker
	/*-------------------------------------Addon Makerã‚’é–‹ã?--------------------------------------*/
	exist "Addon_Maker/Cities_Box_Addon_Maker.exe"

	if strsize = -1 {
		error "F05 : Cities_Box_Addon_Maker.exeãŒã‚ã‚Šã¾ã›ã‚“\nåˆ¥é€”ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„"
	} else {
		exec "Addon_Maker/Cities_Box_Addon_Maker.exe"
	}

	return
/*----------------------------------ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã®ä½œæ?ãƒ»èª­ã¿è¾¼ã¿----------------------------------*/
*map_dimensions
	/*-------------------------------ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã®é…å?ã®ç¢ºä¿?-------------------------------------*/

	dim map, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z, 4					//å?º§æ¨™ã?ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·
	sdim name, 32, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z, 4			//å?º§æ¨™ã?ã‚¢ãƒ‰ã‚ªãƒ³å?
	sdim category, 32, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z, 6		//å??ã‚¹ã«ç½®ã‹ã‚Œã¦ã?‚‹ã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚«ãƒ?‚´ãƒªãƒ¼??road, residentialãªã©??
	dim obj_type, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z, 4			//åº§æ¨™ä¸Šã«ã‚ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã?ã‚¿ã‚¤ãƒ?
	dim obj_dire, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z, 4			//åº§æ¨™ä¸Šã«ã‚ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã?å‘ã
	dim obj_serial_num, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z			//ã²ã¨ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¤?•°ã®ã‚¿ã‚¤ãƒ«ã‚’è¦ã™ã‚‹ã¨ãã?ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã?é€šã—ç•ªå·??1ãƒã‚¹ã®å ´åˆã?0??
	dim obj_use_tiles, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z, 4		//ã²ã¨ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¤?•°ã®ã‚¿ã‚¤ãƒ«ã‚’è¦ã™ã‚‹ã¨ãã?ã€å¿?¦ãªã‚¿ã‚¤ãƒ«æ•°
	dim obj_tiles, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z, 4			//ã²ã¨ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¤?•°ã®ã‚¿ã‚¤ãƒ«ã‚’è¦ã™ã‚‹ã¨ãã?ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¨­ç½®ã—ãŸå ´æ‰€ã‹ã‚‰ã‚¿ã‚¤ãƒ«ã®æ•°

	dim residents, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z				//å?»ºç¯‰ç‰©ã®ä½æ°‘ã?æ•°?ˆä½å®?œ°ã®ã¿??
	dim workers, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z				//å•?¥­åœ°åŒºã®å¾“æ¥­å“¡æ•°
	dim students, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z				//å?­¦æ ¡ã®ç”Ÿå¾’ã?å­¦ç”Ÿæ•°

	dim land_price, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z				//åœ°ä¾¡?ˆä¸?§/ãƒã‚¹??
	dim crime_rate, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z				//çŠ¯ç½ªç?
	dim education_rate, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z			//æ•™è‚²åº¦
	dim happiness, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z				//å¹¸ç¦åº¦
	dim noise, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z					//é¨’éŸ³

	sdim crop, 32, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z				//ç”Ÿç”£ç‰©
	dim crop_amount, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z			//ç”Ÿç”£é‡?

	sdim age, 32, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z				//ä½äººã®å¹´é½¢
	sdim gender, 32, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z			//ä½äººã®æ€§åˆ¥
	sdim workplace, 32, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z			//ä½äººãŒé€šã†ã®è·å ´ã®ä½ç½®
	sdim school, 32, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z			//ä½äººãŒé€šã†å­¦æ ¡ã®ä½ç½®

	sdim reservation, 32, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z		//åœ°åŒºã®äºˆç´?¼ˆåœ°åŸŸè¨­å®šã•ã‚ŒãŸãŒã¾ã?å»ºç‰©ãŒç«‹ã£ã¦ã?ªã?ŒºåŸŸï¼?

	sdim original_name, 64, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z		//å»ºç‰©åï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã¤ã‘ãŸåå‰??

	map_City_Name = ""
	map_Mayor_Name = ""
	map_Set_Change_Weather = 1

	return

*load_map
	/*----------------------------------ãƒãƒƒãƒ—ã?èª­ã¿è¾¼ã¿------------------------------------------*/
	dialog "cbd;*.cbx", 16, "Cities Box ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿"

	if stat != 1 {
		goto *menu
	}

	clrobj

	load_mapdata_name = refstr
	map_Total_Population = 0
	map_total_Residential = 0 : map_total_Commercial = 0 : map_total_Office = 0 : map_total_Industrial = 0 : map_total_Farm = 0
	map_total_Police_Stations = 0 : map_total_Fire_Depertments = 0 : map_total_Post_Offices = 0 : map_total_Education = 0

	chdir directory

	//ãƒãƒƒãƒ—èª­ã¿è¾¼ã¿é–‹å§?
	notesel load_mapdata
	noteload load_mapdata_name

	//ä¿å­˜ãƒãƒ¼ã‚¸ãƒ§ãƒ³(Version)ã‚’èª­ã¿è¾¼ã¿
		map_Saved_Version = int(get_chapter(load_mapdata, "Version", " = ", ";"))

	//ã‚¢ãƒ‰ã‚ªãƒ³ã‚»ãƒ?ƒˆ(Addons_Set)ã‚’èª­ã¿è¾¼ã¿
		map_Addons_Set = get_chapter(load_mapdata, "Addons_Set", " = \"", "\";")

		if map_Addons_Set = "" : map_Addons_Set = "Normal"

	//éƒ½å¸‚å(City_Name)ã‚’èª­ã¿è¾¼ã¿
		map_City_Name = get_chapter(load_mapdata, "City_Name", " = \"", "\"")

	//å¸‚é•·å?(Mayor_Name)ã‚’èª­ã¿è¾¼ã¿
		map_Mayor_Name = get_chapter(load_mapdata, "Mayor_Name", " = \"", "\"")

	//æ—¥æ™?
		map_time_Year = int(get_chapter(load_mapdata, "time_Year", " = ", ";"))			; ã‚²ãƒ¼ãƒ?å†??æ™‚é–“ã®å¹´
		map_time_Month = int(get_chapter(load_mapdata, "time_Month", " = ", ";"))		; ã‚²ãƒ¼ãƒ?å†??æ™‚é–“ã®æœ?
		map_time_Date = int(get_chapter(load_mapdata, "time_Date", " = ", ";"))			; ã‚²ãƒ¼ãƒ?å†??æ™‚é–“ã®æ—¥
		map_time_Hour = int(get_chapter(load_mapdata, "time_Hour", " = ", ";"))			; ã‚²ãƒ¼ãƒ?å†??æ™‚é–“ã®æ™?
		map_time_Minutes = int(get_chapter(load_mapdata, "time_Minutes", " = ", ";"))	; ã‚²ãƒ¼ãƒ?å†??æ™‚é–“ã®åˆ?

		if map_time_Year = 0 {
			map_time_Year = gettime(0)
		}
		if map_time_Month = 0 {
			map_time_Month = gettime(1)
		}
		if map_time_Date = 0 {
			map_time_Date = gettime(3)
		}

	//éœ€è¦åº¦(demand_â—‹â—‹)ã‚’èª­ã¿è¾¼ã¿
		map_demand_Residential = int( get_chapter(load_mapdata, "demand_Residential", " = ", ";") )
		map_demand_Commercial = int( get_chapter(load_mapdata, "demand_Commercial", " = ", ";") )
		map_demand_Office = int( get_chapter(load_mapdata, "demand_Office", " = ", ";") )
		map_demand_Industrial = int( get_chapter(load_mapdata, "demand_Industrial", " = ", ";") )
		map_demand_Farm = int( get_chapter(load_mapdata, "demand_Farm", " = ", ";") )

		if instr(load_mapdata, 0, "demand_Residential") = -1 {
			map_demand_Residential = 100
		}
		if instr(load_mapdata, 0, "demand_Commercial") = -1 {
			map_demand_Commercial = 0
		}
		if instr(load_mapdata, 0, "demand_Office") = -1 {
			map_demand_Office = 0
		}
		if instr(load_mapdata, 0, "demand_Industrial") = -1 {
			map_demand_Industrial = 0
		}
		if instr(load_mapdata, 0, "demand_Farm") = -1 {
			map_demand_Farm = 0
		}

	//è³?ß(Money)ã‚’èª­ã¿è¾¼ã¿
		map_Money = int( get_chapter(load_mapdata, "Money", " = ", ";") )

		if instr(load_mapdata, 0, "Money") = -1 {
			map_Money = 50000
		}

	//è¨­å®šèª­ã¿è¾¼ã¿
		//å¤©å€™ã?å¤‰åŒ–(Set_Change_Weather)
			map_Set_Change_Weather = int( get_chapter(load_mapdata, "Set_Change_Weather", " = ", ";") )

		//æ°—æ¸©(temperature)
			map_temperature = int( get_chapter(load_mapdata, "Temperature", " = ", ";") )

		//å¤œé–“ã¯æš—ãã™ã‚‹(Set_Dark_on_Night)
			map_Set_Dark_on_Night = int( get_chapter(load_mapdata, "Set_Dark_on_Night", " = ", ";") )

		//äºˆç®—ã?èª­ã¿è¾¼ã¿
			if instr(load_mapdata, 0, "budget_of_Police") != -1 {
				map_budget_of_Police = int( get_chapter(load_mapdata, "budget_of_Police", " = ", ";") )
			} else {
				map_budget_of_Police = 100
			}

			if instr(load_mapdata, 0, "budget_of_Fire_Depertment") != -1 {
				map_budget_of_Fire_Depertment = int( get_chapter(load_mapdata, "budget_of_Fire_Depertment", " = ", ";") )
			} else {
				map_budget_of_Fire_Depertment = 100
			}

			if instr(load_mapdata, 0, "budget_of_Post_Office") != -1 {
				map_budget_of_Post_Office = int( get_chapter(load_mapdata, "budget_of_Post_Office", " = ", ";") )
			} else {
				map_budget_of_Post_Office = 100
			}

			if instr(load_mapdata, 0, "budget_of_Education") != -1 {
				map_budget_of_Education = int( get_chapter(load_mapdata, "budget_of_Education", " = ", ";") )
			} else {
				map_budget_of_Education = 100
			}


			if instr(load_mapdata, 0, "tax_of_Residential") != -1 {
				map_tax_of_Residential = int( get_chapter(load_mapdata, "tax_of_Residential", " = ", ";") )
			} else {
				map_tax_of_Residential = 100
			}

			if instr(load_mapdata, 0, "tax_of_Commercial") != -1 {
				map_tax_of_Commercial = int( get_chapter(load_mapdata, "tax_of_Commercial", " = ", ";") )
			} else {
				map_tax_of_Commercial = 100
			}

			if instr(load_mapdata, 0, "tax_of_Office") != -1 {
				map_tax_of_Office = int( get_chapter(load_mapdata, "tax_of_Office", " = ", ";") )
			} else {
				map_tax_of_Office = 100
			}

			if instr(load_mapdata, 0, "tax_of_Industrial") != -1 {
				map_tax_of_Industrial = int( get_chapter(load_mapdata, "tax_of_Industrial", " = ", ";") )
			} else {
				map_tax_of_Industrial = 100
			}

			if instr(load_mapdata, 0, "tax_of_Farm") != -1 {
				map_tax_of_Farm = int( get_chapter(load_mapdata, "tax_of_Farm", " = ", ";") )
			} else {
				map_tax_of_Farm = 100
			}

	// éƒ½å¸‚ãƒ‡ãƒ¼ã‚¿å±¥æ­´ã®èª­ã¿è¾¼ã¿
		if instr(load_mapdata, 0, "statistics") != -1 {
			statisticsTemp = get_chapter(load_mapdata, "statistics", " {", "}")

			notesel statisticsTemp : statisticsLines = notemax
			repeat statisticsLines - 1
				notesel statisticsTemp	: noteget statisticsTempALine, cnt+1
				notesel statistics		: noteadd statisticsTempALine, cnt
			loop
		} else {
			statistics = ""
		}

	//ã“ã“ã§ã‚¢ãƒ‰ã‚ªãƒ³ã‚’èª­ã¿è¾¼ã‚€
		gosub *load_addons

	//é…å?ã‚’ç”¨ã?‚‹ãƒ??ã‚¿ã®èª­ã¿è¾¼ã¿
		name_buf				= get_chapter(load_mapdata, "name(x,y)", " {", "}")
		name2_buf				= get_chapter(load_mapdata, "name2(x,y)", " {", "}")

		category_buf			= get_chapter(load_mapdata, "category(x,y)", " {", "}")
		category_2_buf			= get_chapter(load_mapdata, "category_2(x,y)", " {", "}")
		category_3_buf			= get_chapter(load_mapdata, "category_3(x,y)", " {", "}")

		obj_type_buf			= get_chapter(load_mapdata, "obj_type(x,y)", " {", "}")
		obj_type2_buf			= get_chapter(load_mapdata, "obj_type2(x,y)", " {", "}")
		obj_dire_buf			= get_chapter(load_mapdata, "obj_dire(x,y)", " {", "}")
		obj_dire2_buf			= get_chapter(load_mapdata, "obj_dire2(x,y)", " {", "}")

		obj_serial_num_buf		= get_chapter(load_mapdata, "obj_serial_num(x,y)", " {", "}")

		obj_use_tiles_x_buf		= get_chapter(load_mapdata, "obj_use_tiles_x(x,y)", " {", "}")
		obj_use_tiles_y_buf		= get_chapter(load_mapdata, "obj_use_tiles_y(x,y)", " {", "}")

		obj_tiles_x_buf			= get_chapter(load_mapdata, "obj_tiles_x(x,y)", " {", "}")
		obj_tiles_y_buf			= get_chapter(load_mapdata, "obj_tiles_y(x,y)", " {", "}")

		residents_buf			= get_chapter(load_mapdata, "residents(x,y)", " {", "}")

		workers_Commercial_buf	= get_chapter(load_mapdata, "workers_Commercial(x,y)", " {", "}")
		workers_Office_buf		= get_chapter(load_mapdata, "workers_Office(x,y)", " {", "}")
		workers_Industrial_buf	= get_chapter(load_mapdata, "workers_Industrial(x,y)", " {", "}")
		workers_Farm_buf		= get_chapter(load_mapdata, "workers_Farm(x,y)", " {", "}")
		workers_Public_buf		= get_chapter(load_mapdata, "workers_Public(x,y)", " {", "}")

		students_buf			= get_chapter(load_mapdata, "students(x,y)", " {", "}")

		land_price_buf			= get_chapter(load_mapdata, "land_price(x,y)", " {", "}")
		crime_rate_buf			= get_chapter(load_mapdata, "crime_rate(x,y)", " {", "}")
		education_rate_buf		= get_chapter(load_mapdata, "education_rate(x,y)", " {", "}")
		happiness_buf			= get_chapter(load_mapdata, "happiness(x,y)", " {", "}")
		noise_buf				= get_chapter(load_mapdata, "noise(x,y)", " {", "}")

		crop_buf				= get_chapter(load_mapdata, "crop(x,y)", " {", "}")
		crop_amount_buf			= get_chapter(load_mapdata, "crop_amount(x,y)", " {", "}")

		age_buf					= get_chapter(load_mapdata, "age(x,y)", " {", "}")
		gender_buf				= get_chapter(load_mapdata, "gender(x,y)", " {", "}")

		workplace_buf			= get_chapter(load_mapdata, "workplace(x,y)", " {", "}")
		school_buf				= get_chapter(load_mapdata, "school(x,y)", " {", "}")

		reservation_buf			= get_chapter(load_mapdata, "reservation(x,y)", " {", "}")

		original_name_buf		= get_chapter(load_mapdata, "original_name(x,y)", " {", "}")

		if name_buf = "" {
			error "M01 : ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ãŒæ•…éšœã—ã¦ã?¾ã™\nã‚»ãƒ¼ãƒ–ãƒ•ã‚¡ã‚¤ãƒ«ã«name(x,y)ãŒã‚ã‚Šã¾ã›ã‚“ã€?"
		}

		z = 0
		next_obj_serial_num = 0

		repeat MAPSIZE_Y
			y = cnt

			; name(x,y)
			notesel name_buf
			noteget name_buf_a_line, (y+1)

			split name_buf_a_line, ", ", name_buf_a_tile

			; name2(x,y)
			notesel name2_buf
			noteget name2_buf_a_line, (y+1)

			split name2_buf_a_line, ", ", name2_buf_a_tile

			; category(x,y)
			notesel category_buf
			noteget category_buf_a_line, (y+1)

			split category_buf_a_line, ", ", category_buf_a_tile

			; category_2(x,y)
			notesel category_2_buf
			noteget category_2_buf_a_line, (y+1)

			split category_2_buf_a_line, ", ", category_2_buf_a_tile

			; category_3(x,y)
			notesel category_3_buf
			noteget category_3_buf_a_line, (y+1)

			split category_3_buf_a_line, ", ", category_3_buf_a_tile

			; obj_type(x,y)
			notesel obj_type_buf
			noteget obj_type_buf_a_line, (y+1)

			split obj_type_buf_a_line, ", ", obj_type_buf_a_tile

			; obj_type2(x,y)
			notesel obj_type2_buf
			noteget obj_type2_buf_a_line, (y+1)

			split obj_type2_buf_a_line, ", ", obj_type2_buf_a_tile

			; obj_dire(x,y)
			notesel obj_dire_buf
			noteget obj_dire_buf_a_line, (y+1)

			split obj_dire_buf_a_line, ", ", obj_dire_buf_a_tile

			; obj_dire2(x,y)
			notesel obj_dire2_buf
			noteget obj_dire2_buf_a_line, (y+1)

			split obj_dire2_buf_a_line, ", ", obj_dire2_buf_a_tile

			; obj_serial_num(x,y)
			notesel obj_serial_num_buf
			noteget obj_serial_num_buf_a_line, (y+1)

			split obj_serial_num_buf_a_line, ", ", obj_serial_num_buf_a_tile

			; obj_use_tiles_x(x,y)
			notesel obj_use_tiles_x_buf
			noteget obj_use_tiles_x_buf_a_line, (y+1)

			split obj_use_tiles_x_buf_a_line, ", ", obj_use_tiles_x_buf_a_tile

			; obj_use_tiles_y(x,y)
			notesel obj_use_tiles_y_buf
			noteget obj_use_tiles_y_buf_a_line, (y+1)

			split obj_use_tiles_y_buf_a_line, ", ", obj_use_tiles_y_buf_a_tile

			; obj_tiles_x(x,y)
			notesel obj_tiles_x_buf
			noteget obj_tiles_x_buf_a_line, (y+1)

			split obj_tiles_x_buf_a_line, ", ", obj_tiles_x_buf_a_tile

			; obj_tiles_y(x,y)
			notesel obj_tiles_y_buf
			noteget obj_tiles_y_buf_a_line, (y+1)

			split obj_tiles_y_buf_a_line, ", ", obj_tiles_y_buf_a_tile

			; residents(x,y)
			notesel residents_buf
			noteget residents_buf_a_line, (y+1)

			split residents_buf_a_line, ", ", residents_buf_a_tile

			; workers_Commercial(x,y)
			notesel workers_Commercial_buf
			noteget Workers_Commercial_buf_a_line, (y+1)

			split workers_Commercial_buf_a_line, ", ", workers_Commercial_buf_a_tile

			; workers_Office(x,y)
			notesel workers_Office_buf
			noteget Workers_Office_buf_a_line, (y+1)

			split workers_Office_buf_a_line, ", ", workers_Office_buf_a_tile

			; workers_Industrial(x,y)
			notesel workers_Industrial_buf
			noteget Workers_Industrial_buf_a_line, (y+1)

			split workers_Industrial_buf_a_line, ", ", workers_Industrial_buf_a_tile

			; workers_Farm(x,y)
			notesel workers_Farm_buf
			noteget Workers_Farm_buf_a_line, (y+1)

			split workers_Farm_buf_a_line, ", ", workers_Farm_buf_a_tile

			; workers_Public(x,y)
			notesel workers_Public_buf
			noteget Workers_Public_buf_a_line, (y+1)

			split workers_Public_buf_a_line, ", ", workers_Public_buf_a_tile

			; students(x,y)
			notesel students_buf
			noteget students_buf_a_line, (y+1)

			split students_buf_a_line, ", ", students_buf_a_tile

			; land_price(x,y)
			notesel land_price_buf
			noteget land_price_buf_a_line, (y+1)

			split land_price_buf_a_line, ", ", land_price_buf_a_tile

			; crime_rate(x,y)
			notesel crime_rate_buf
			noteget crime_rate_buf_a_line, (y+1)

			split crime_rate_buf_a_line, ", ", crime_rate_buf_a_tile

			; education_rate(x,y)
			notesel education_rate_buf
			noteget education_rate_buf_a_line, (y+1)

			split education_rate_buf_a_line, ", ", education_rate_buf_a_tile

			; happiness(x,y)
			notesel happiness_buf
			noteget happiness_buf_a_line, (y+1)

			split happiness_buf_a_line, ", ", happiness_buf_a_tile

			; noise(x,y)
			notesel noise_buf
			noteget noise_buf_a_line, (y+1)

			split noise_buf_a_line, ", ", noise_buf_a_tile

			; crop(x,y)
			notesel crop_buf
			noteget crop_buf_a_line, (y+1)

			split crop_buf_a_line, ", ", crop_buf_a_tile

			; crop_amount(x,y)
			notesel crop_amount_buf
			noteget crop_amount_buf_a_line, (y+1)

			split crop_amount_buf_a_line, ", ", crop_amount_buf_a_tile

			; students(x,y)
			notesel students_buf
			noteget students_buf_a_line, (y+1)

			split students_buf_a_line, ", ", students_buf_a_tile

			; age(x,y)
			notesel age_buf
			noteget age_buf_a_line, (y+1)

			split age_buf_a_line, ", ", age_buf_a_tile

			; gender(x,y)
			notesel gender_buf
			noteget gender_buf_a_line, (y+1)

			split gender_buf_a_line, ", ", gender_buf_a_tile

				; ç”·å¥³åˆ¥äººå£ã®å–å¾?
				split gender_buf_a_line, "m", tmp : map_gender_M += stat - 1
				split gender_buf_a_line, "f", tmp : map_gender_F += stat - 1

			; workplace(x,y)
			notesel workplace_buf
			noteget workplace_buf_a_line, (y+1)

			split workplace_buf_a_line, ", ", workplace_buf_a_tile

			; school(x,y)
			notesel school_buf
			noteget school_buf_a_line, (y+1)

			split school_buf_a_line, ", ", school_buf_a_tile

			; reservation(x,y)
			notesel reservation_buf
			noteget reservation_buf_a_line, (y+1)

			split reservation_buf_a_line, ", ", reservation_buf_a_tile

			; original_name(x,y)
			notesel original_name_buf
			noteget original_name_buf_a_line, (y+1)

			split original_name_buf_a_line, ", ", original_name_buf_a_tile

			; é…å?ã«ä»£å…¥
			repeat MAPSIZE_X
				x = cnt

				; name(x,y)??map(x,y)
				name(x,y,z,0) = name_buf_a_tile(x)
				name(x,y,z,2) = name(x,y,z,0)
				notesel addons_list
				map(x,y,z,0) = notefind(name(x,y,z,0), 0)
				map(x,y,z,2) = map(x,y,z,0)

					; å?¨®ã®åœ°åŒºã®åå®¹å¯èƒ½äººæ•°ã«åŠ?ç®?
					if sdnl(addon_type, map(x,y,z,0), 0) = "low_density_residential" or sdnl(addon_type, map(x,y,z,0), 0) = "high_density_residential" {
						map_total_Residential_maximum_capacity += int(sdnl(addon_maximum_capacity, map(x,y,z,0), 0))
					}
					if sdnl(addon_type, map(x,y,z,0), 0) = "low_density_commercial" or sdnl(addon_type, map(x,y,z,0), 0) = "high_density_commercial" {
						map_total_Commercial_maximum_capacity += int(sdnl(addon_maximum_capacity, map(x,y,z,0), 0))
					}
					if sdnl(addon_type, map(x,y,z,0), 0) = "office" {
						map_total_Office_maximum_capacity += int(sdnl(addon_maximum_capacity, map(x,y,z,0), 0))
					}
					if sdnl(addon_type, map(x,y,z,0), 0) = "industrial" {
						map_total_Industrial_maximum_capacity += int(sdnl(addon_maximum_capacity, map(x,y,z,0), 0))
					}
					if sdnl(addon_type, map(x,y,z,0), 0) = "farm" {
						map_total_Farm_maximum_capacity += int(sdnl(addon_maximum_capacity, map(x,y,z,0), 0))
					}
					if sdnl(addon_type, map(x,y,z,0), 0) = "public" {
						map_total_Public_maximum_capacity += int(sdnl(addon_maximum_capacity, map(x,y,z,0), 0))
					}

				; name2(x,y)??map2(x,y)
				name(x,y,z,1) = name2_buf_a_tile(x)
				if name(x,y,z,1) != "" {
					sdnsearch addon_name, ""+name2_buf_a_tile(x)+"", search_addon_number, tmp
					map(x,y,z,1) = notefind(name(x,y,z,1), 0)
					map(x,y,z,3) = map(x,y,z,1)
				} else {
					map(x,y,z,1) = -1
					map(x,y,z,3) = -1
				}

				; category(x,y)
				category(x,y,z,0) = category_buf_a_tile(x)
				category(x,y,z,3) = category(x,y,z,0)

				; category_2(x,y)
				category(x,y,z,1) = category_2_buf_a_tile(x)
				category(x,y,z,4) = category(x,y,z,0)

					; å»ºç‰©ã®ç·æ•°ã‚’å–å¾?
					if category(x,y,z,1) = "police_station"  : map_total_Police_Stations ++
					if category(x,y,z,1) = "fire_depertment" : map_total_Fire_Depertments ++
					if category(x,y,z,1) = "post_office"     : map_total_Post_Offices ++
					if category(x,y,z,1) = "education"       : map_total_Education ++

					if category(x,y,z,0) = "residential"     : map_total_Residential ++
					if category(x,y,z,0) = "commercial"      : map_total_Commercial ++
					if category(x,y,z,0) = "office"          : map_total_Office ++
					if category(x,y,z,0) = "industrial"      : map_total_Industrial ++
					if category(x,y,z,0) = "farm"            : map_total_Farm ++

				; category_3(x,y)
				category(x,y,z,2) = category_3_buf_a_tile(x)
				category(x,y,z,5) = category(x,y,z,2)

				; obj_type(x,y)
				obj_type(x,y,z,0) = int(obj_type_buf_a_tile(x))
				obj_type(x,y,z,2) = obj_type(x,y,z,0)

				; obj_type2(x,y)
				if obj_type2_buf_a_tile(x) != "" {
					obj_type(x,y,z,1) = int(obj_type2_buf_a_tile(x))
					obj_type(x,y,z,3) = obj_type(x,y,z,1)
				}

				; obj_dire(x,y)
				obj_dire(x,y,z,0) = int(obj_dire_buf_a_tile(x))
				obj_dire(x,y,z,2) = obj_dire(x,y,z,0)

				; obj_dire2(x,y)
				if obj_dire2_buf_a_tile(x) != "" {
					obj_dire(x,y,z,1) = int(obj_dire2_buf_a_tile(x))
					obj_dire(x,y,z,3) = obj_dire(x,y,z,1)
				}

				; obj_serial_num(x,y)
				obj_serial_num(x,y,z) = int(obj_serial_num_buf_a_tile(x))

					; æœ€å¤§å€¤èª­ã¿è¾¼ã¿
					if obj_serial_num(x,y,z) > next_obj_serial_num : next_obj_serial_num = obj_serial_num(x,y,z)

				; obj_use_tiles_x(x,y)
				obj_use_tiles(x,y,z,0) = int(obj_use_tiles_x_buf_a_tile(x))
				obj_use_tiles(x,y,z,2) = obj_use_tiles(x,y,z,0)

				; obj_use_tiles_y(x,y)
				obj_use_tiles(x,y,z,1) = int(obj_use_tiles_y_buf_a_tile(x))
				obj_use_tiles(x,y,z,3) = obj_use_tiles(x,y,z,1)

				; obj_tiles_x(x,y)
				obj_tiles(x,y,z,0) = int(obj_tiles_x_buf_a_tile(x))
				obj_tiles(x,y,z,2) = obj_tiles(x,y,z,0)

				; obj_tiles_y(x,y)
				obj_tiles(x,y,z,1) = int(obj_tiles_y_buf_a_tile(x))
				obj_tiles(x,y,z,3) = obj_tiles(x,y,z,1)

				; residents(x,y)
				residents(x,y,z) = int(residents_buf_a_tile(x)) : map_Total_Population += residents(x,y,z)

				; workers_Commercial(x,y)
				workers(x,y,z) = int(workers_Commercial_buf_a_tile(x)) : map_Total_workers_Commercial += int(workers_Commercial_buf_a_tile(x))

				; workers_Office(x,y)
				workers(x,y,z) += int(workers_Office_buf_a_tile(x)) : map_Total_workers_Office += int(workers_Office_buf_a_tile(x))

				; workers_Industrial(x,y)
				workers(x,y,z) += int(workers_Industrial_buf_a_tile(x)) : map_Total_workers_Industrial += int(workers_Industrial_buf_a_tile(x))

				; workers_Farm(x,y)
				workers(x,y,z) += int(workers_Farm_buf_a_tile(x)) : map_Total_workers_Farm += int(workers_Farm_buf_a_tile(x))

				; workers_Public(x,y)
				workers(x,y,z) += int(workers_Public_buf_a_tile(x)) : map_Total_workers_Public += int(workers_Public_buf_a_tile(x))

				; students(x,y,z)
				students(x,y,z) = int(students_buf_a_tile(x))

				; land_price(x,y,z)
				land_price(x,y,z) = int(land_price_buf_a_tile(x))

				; crime_rate(x,y,z)
				crime_rate(x,y,z) = int(crime_rate_buf_a_tile(x))

				; education_rate(x,y,z)
				education_rate(x,y,z) = int(education_rate_buf_a_tile(x))

				; happiness(x,y,z)
				happiness(x,y,z) = int(happiness_buf_a_tile(x))

				; noise(x,y,z)
				if noise_buf != "" {
					noise(x,y,z) = int(noise_buf_a_tile(x))
				} else {
					noise(x,y,z) = 0		; ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã«noiseé…å?ãŒãªã‘ã‚Œã°noiseã¯0ã«è¨­å®?
				}

				; crop(x,y,z)
				crop(x,y,z) = crop_buf_a_tile(x)

				; crop_amount(x,y,z)
				crop_amount(x,y,z) = int(crop_amount_buf_a_tile(x))

				; age(x,y,z)
				age(x,y,z) = age_buf_a_tile(x)

				; gender(x,y,z)
				gender(x,y,z) = gender_buf_a_tile(x)

				; workplace(x,y,z)
				workplace(x,y,z) = workplace_buf_a_tile(x)

				; school(x,y,z)
				school(x,y,z) = school_buf_a_tile(x)

				; reservation(x,y,z)
				reservation(x,y,z) = reservation_buf_a_tile(x)

				; original_name(x,y,z)
				original_name(x,y,z) = original_name_buf_a_tile(x)

				; å¹¸ç¦åº¦ã®å¹³å?€¤ã‚’å?ã™ãŸã‚ã€happiness_tmpã«happiness(x,y,z)ã‚’åŠ ç®?
				happiness_tmp += happiness(x,y,z)

			loop

			await 1
		loop

		before_map_Total_Population = map_Total_Population

		happiness_ave = happiness_tmp / (mapsize_x*MAPSIZE_Y)
		map_approval_rate = happiness_ave

	chdir directory
	goto *initialization

/*-------------------------------------------ã‚¢ãƒ‰ã‚ªãƒ³ã®èª­ã¿è¾¼ã¿-----------------------------------*/
*load_addons
	//ã‚¢ãƒ‰ã‚ªãƒ³ã®ãƒªã‚¹ãƒˆã‚’å–å¾?
	chdir "addons"

	//adatãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¹ãƒˆã‚’å–å¾?
	dirlist2h 1, ','
	dirlist2 countOfAddonFiles, "*.adat*", 1, '\\'

	sdim addonFileslist, countOfAddonFiles
	dirlist2r addonFilesList

	notesel addonFilesList
	countOfTotalAddonFiles = notemax
	loadedAddonFiles = 0

	//adonãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¹ãƒˆã‚’å–å¾?
	dirlist2 countOfAdonFiles, "*.adon*", 1, '\\'

	sdim adonFileslist, countOfAdonFiles
	dirlist2r adonFilesList

	notesel adonFilesList
	countOfTotalAdonFiles = notemax
	sdim adonAdatFiles, 512, countOfTotalAdonFiles
	sdim adonImageFiles, 512, countOfTotalAdonFiles, 10
	sdim adonImageFilesName, 128, countOfTotalAdonFiles, 10
	sdim adonIconFiles, 512, countOfTotalAdonFiles
	sdim adonIconFilesName, 128, countOfTotalAdonFiles
	dim  countOfAdonImageFiles, countOfTotalAdonFiles

	notesel addonFilesList
	addonFilesList += adonFilesList
	countOfTotalAddonFiles += countOfTotalAdonFiles

	//é…å?ãªã©ã‚’å?æœŸåŒ–
	dim correct_addons_set, countOfTotalAddonFiles + countOfTotalAdonFiles
	dim fromAdonFile, countOfAddonFiles

	maxCountOfImages = 0

	//adonãƒ•ã‚¡ã‚¤ãƒ«ã®å§‹ç‚¹/çµ‚ç«¯ã‚¿ã‚°ã‚’è¨­å®?
	countOfImagesTagStart = "<i|"
	countOfImagesTagEnd = ">"

	versionTagStart = "<v|"
	versionTagEnd = ">"

	indexTagStart = "<id|"
	indexTagEnd = ">"
	
	adatFileStartTag = "<f|a:"
	adatFileEndTag = ">"

	imageFileStartTag = "<f|im:"
	imageFileEndTag = ">"

	iconFileStartTag = "<f|ic:"
	iconFileEndTag = ">"

	endOfFileTag = "<ENDADON>"

	//ã‚¢ãƒ‰ã‚ªãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿
	countOfAdonFiles = 0
	repeat countOfTotalAddonFiles
		addon_number = cnt

		chdir ""+directory+"\\addons"

		; ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã‹ã‚‰èª­ã¿è¾¼ã‚€adatãƒ•ã‚¡ã‚¤ãƒ«åã‚’å–å¾?
		notesel addonFilesList
		noteget addonFileName, addon_number

		addon_path = getpath(addonFileName, 32)

		; addonFileNameã®æ‹¡å¼µå­ãŒ.adonãªã‚‰å±•é–‹
		loadingAdatFile = 1
		if getpath(addonFileName, 2) = ".adon" {
			loadingAdatFile = 0
			gosub *getAddonDataFromAdonFile
		}

		; èª­ã¿è¾¼ã‚€adatãƒ•ã‚¡ã‚¤ãƒ«ã®å†?®¹ã‚’adat_tmpã«ä»£å…¥
		if loadingAdatFile = 1 {
			notesel adat_tmp
			noteload addonFileName
			fromAdonFile(addon_number) = 0
		} else {
			adat_tmp = adonAdatFiles(countOfAdonFiles)
			
			fromAdonFile(addon_number) = 1

			countOfAdonFiles ++
		}

		; belong_addons_set_name?ˆæ‰€å±ã™ã‚‹ã‚¢ãƒ‰ã‚ªãƒ³ã‚»ãƒ?ƒˆã®åå‰??
		belong_addons_set_name = get_chapter(adat_tmp, "belong_addons_set_name", " = \"", "\"")

		if (belong_addons_set_name = "" and map_Addons_Set = "Normal") or belong_addons_set_name = map_Addons_Set {
			total_addons ++
			correct_addons_set(cnt) = 1
		} else {
			correct_addons_set(cnt) = 0
		}
	loop

	addon_number = 0
	countOfLoadedAdonFiles = 0

	//ã‚¢ãƒ‰ã‚ªãƒ³ç”¨ã®ç–‘ä¼¼é…å?ã®å®£è¨€
	tmp = ""

	sdns addon_name, 0, 0, tmp, total_addons, 2							; ã‚¢ãƒ‰ã‚ªãƒ³åï¼ˆè‹±èªå(x,0), æ—¥æœ¬èªå(x,1)??
	sdns addon_author, 0, 0, tmp, total_addons, 1						; ã‚¢ãƒ‰ã‚ªãƒ³ã®ä½œè€?
	sdns addon_summary, 0, 0, tmp, total_addons, 1						; ã‚¢ãƒ‰ã‚ªãƒ³ã®èª¬æ˜?
	sdns addon_type, 0, 0, tmp, total_addons, 3							; ã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¿ã‚¤ãƒ?
	sdns addon_maker_version, 0, 0, tmp, total_addons, 1				; ã‚¢ãƒ‰ã‚ªãƒ³ã‚’ä½œæ?ã—ãŸAddon Makerã®ã‚¢ãƒ‰ã‚ªãƒ³ãƒã?ã‚¸ãƒ§ãƒ³
	sdns addon_maximum_capacity, 0, 0, tmp, total_addons, 1				; ã‚¢ãƒ‰ã‚ªãƒ³ã®åå®¹äººæ•°
	sdns addon_land_price_influence, 0, 0, tmp, total_addons, 2			; ã‚¢ãƒ‰ã‚ªãƒ³ãŒåœ°ä¾¡ã«åŠã¼ã™å½±éŸ¿
	sdns addon_crime_rate_influence, 0, 0, tmp, total_addons, 2			; ã‚¢ãƒ‰ã‚ªãƒ³ã®çŠ¯ç½ªç?«åŠã¼ã™å½±éŸ¿
	sdns addon_education_rate_influence, 0, 0, tmp, total_addons, 2		; ã‚¢ãƒ‰ã‚ªãƒ³ã®æ•™è‚²åº¦ã«åŠã¼ã™å½±éŸ¿
	sdns addon_noise_influence, 0, 0, tmp, total_addons, 2				; ã‚¢ãƒ‰ã‚ªãƒ³ãŒå?ã™é¨’éŸ³ã®å½±éŸ¿
	sdns addon_crop, 0, 0, tmp, total_addons, 2							; ã‚¢ãƒ‰ã‚ªãƒ³ãŒç”Ÿç”£ã™ã‚‹ç”Ÿç”£ç‰©
	sdns addon_use_type_names, 0, 0, tmp, total_addons, 12				; ã‚¢ãƒ‰ã‚ªãƒ³å†??ã‚¿ã‚¤ãƒ—ã?åå‰
	sdns addon_build_limit, 0, 0, tmp, total_addons, 0					; ã‚¢ãƒ‰ã‚ªãƒ³ã®å»ºè¨­å¯èƒ½å›æ•°
	sdns addon_icon_number, 0, 0, tmp, total_addons, 1					; ã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ã‚¤ã‚³ãƒ³ã®ãƒãƒƒãƒ•ã‚¡ç•ªå·
	sdns3 addon_image, 0, 0, 0,tmp, total_addons, 12, 2					; ã‚¢ãƒ‰ã‚ªãƒ³ã§ä½¿ã?”»åƒ?
	sdns3 addon_night_mask_image, 0, 0, 0, tmp, total_addons, 12, 2		; ã‚¢ãƒ‰ã‚ªãƒ³ã§ä½¿ã?¤œé–“ã®ãƒã‚¹ã‚¯ç”»åƒ?
	sdns3 addon_image_size, 0, 0, 0, tmp, total_addons, 12, 2			; ã‚¢ãƒ‰ã‚ªãƒ³ã§ä½¿ã?”»åƒã?å…¨ä½“ã?ã‚µã‚¤ã‚º
	sdns3 addon_dire_names, 0, 0, 0, tmp, total_addons, 12, 4			; ã‚¢ãƒ‰ã‚ªãƒ³ã®ãã‚Œãã‚Œã®ã‚¿ã‚¤ãƒ—å?ã®å‘ãã®åå‰
	sdns3 addon_size_x, 0, 0, 0, tmp, total_addons, 12, 4				; ã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚µã‚¤ã‚ºx
	sdns3 addon_size_y, 0, 0, 0, tmp, total_addons, 12, 4				; ã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚µã‚¤ã‚ºy
	sdns3 addon_chip_x, 0, 0, 0, tmp, total_addons, 12, 4				; ã‚¢ãƒ‰ã‚ªãƒ³ãŒå°‚æœ‰ã™ã‚‹ãƒã‚¹ã®æ•°x
	sdns3 addon_chip_y, 0, 0, 0, tmp, total_addons, 12, 4				; ã‚¢ãƒ‰ã‚ªãƒ³ãŒå°‚æœ‰ã™ã‚‹ãƒã‚¹ã®æ•°y
	sdns3 addon_top_left_x, 0, 0, 0, tmp, total_addons, 12, 4			; ã‚¢ãƒ‰ã‚ªãƒ³ã®çµµãŒæå†™ã•ã‚Œã¦ã?‚‹å·¦ä¸Šã?åº§æ¨™x
	sdns3 addon_top_left_y, 0, 0, 0, tmp, total_addons, 12, 4			; ã‚¢ãƒ‰ã‚ªãƒ³ã®çµµãŒæå†™ã•ã‚Œã¦ã?‚‹å·¦ä¸Šã?åº§æ¨™y
	sdns3 addon_bottom_right_x, 0, 0, 0, tmp, total_addons, 12, 4		; ã‚¢ãƒ‰ã‚ªãƒ³ã®çµµãŒæå†™ã•ã‚Œã¦ã?‚‹å³ä¸‹ã?åº§æ¨™x
	sdns3 addon_bottom_right_y, 0, 0, 0, tmp, total_addons, 12, 4		; ã‚¢ãƒ‰ã‚ªãƒ³ã®çµµãŒæå†™ã•ã‚Œã¦ã?‚‹å³ä¸‹ã?åº§æ¨™y
	sdns3 addon_base, 0, 0, 0, tmp, total_addons, 12, 4					; ã‚¢ãƒ‰ã‚ªãƒ³ã®ä¸‹åœ°ã«ç”¨ã?‚‹ã‚¢ãƒ‰ã‚ªãƒ³å?
	//sdns addon_total_directions, 0, 0, tmp, total_addons, 12			; ã‚¢ãƒ‰ã‚ªãƒ³ã®å?‚¿ã‚¤ãƒ—å?ã®å‘ãã®æ•°

	//adat?ˆã‚¢ãƒ‰ã‚ªãƒ³ãƒ??ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«?‰ã¨ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿

	next_image_num = BEGIN_ADDON_BUFFER_ID

	repeat countOfTotalAddonFiles
		if correct_addons_set(cnt) = 0 {
			continue
		}

		totalAddonNumber = cnt

		chdir ""+directory+"\\addons"

		; ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã‹ã‚‰èª­ã¿è¾¼ã‚€adatãƒ•ã‚¡ã‚¤ãƒ«åã‚’å–å¾?
		notesel addonFilesList
		noteget addonFileName, cnt

		; èª­ã¿è¾¼ã‚€adatãƒ•ã‚¡ã‚¤ãƒ«ã®å†?®¹ã‚’adat_tmpã«ä»£å…¥
		if fromAdonFile(cnt) = 1 {
			adat_tmp = adonAdatFiles(countOfLoadedAdonFiles)
		} else {
			notesel adat_tmp
			noteload addonFileName
		}

		; adatãƒ•ã‚¡ã‚¤ãƒ«?ˆã‚¢ãƒ‰ã‚ªãƒ³ã®ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«å«ã‚€?‰ãŒã‚ã‚‹ãƒ?‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å–å¾?
		addon_path = getpath(addonFileName, 32)

		; ãƒ?‚£ãƒ¬ã‚¯ãƒˆãƒªå¤‰æ›´?ˆã‚ã¨ã§ç”»åƒã‚’èª­ã¿è¾¼ã‚€ãŸã‚??
		chdir addon_path

		/*-------------------------------adatãƒ•ã‚¡ã‚¤ãƒ«ã®å†?®¹èª­ã¿è¾¼ã¿-------------------------------*/
		; addon_name?ˆã‚¢ãƒ‰ã‚ªãƒ³åï¼?
			; è‹±èªå
			addon_name_tmp = get_chapter(adat_tmp, "addon_name", " = \"", "\"")
			sdns addon_name, addon_number, 0, addon_name_tmp

			; addons_listã«æ›¸ãè¾¼ã¿
			notesel addons_list
			noteadd addon_name_tmp, addon_number, 1

			; æ—¥æœ¬èªå
			addon_name_jp_tmp = get_chapter(adat_tmp, "addon_jp_name", " = \"", "\"")
			nkfcnv addon_name_jp_tmp, addon_name_jp_tmp, "w"
			sdns addon_name, addon_number, 1, addon_name_jp_tmp

		; addon_author?ˆã‚¢ãƒ‰ã‚ªãƒ³ã®ä½œè€???
			tmp = get_chapter(adat_tmp, "addon_author", " = \"", "\"")
			nkfcnv tmp, tmp, "w"
			sdns addon_author, addon_number, 0,tmp

		; addon_summary?ˆã‚¢ãƒ‰ã‚ªãƒ³ã®èª¬æ˜ï¼?
			tmp = get_chapter(adat_tmp, "addon_summary", " = \"", "\"")
			nkfcnv tmp, tmp, "w"
			sdns addon_summary, addon_number, 0, tmp

		; addon_icon_number?ˆã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒã?ãƒãƒƒãƒ•ã‚¡ç•ªå·??
			tmp = get_chapter(adat_tmp, "addon_icon", " = \"", "\"")

			; ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒèª­ã¿è¾¼ã¿
				if fromAdonFile(cnt) = 1 {
					buffer next_image_num
						memfile adonIconFiles(countOfLoadedAdonFiles)
						if getpath(adonIconFilesName(countOfLoadedAdonFiles), 2) = ".png" {
							picload "MEM:.png"
						} else {
							picload "MEM:"
						}
					gsel 0
				} else {
					celload tmp, next_image_num
				}
				next_image_icon_num_str = str(next_image_num)
				sdns addon_icon_number, addon_number, 0, next_image_icon_num_str

				next_image_num ++

		; addon_type?ˆã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¿ã‚¤ãƒ—ï¼?
			tmp1 = get_chapter(adat_tmp, "addon_type", " = \"", "\"")
			sdns addon_type, addon_number, 0, tmp1
			tmp2 = get_chapter(adat_tmp, "addon_type_2", " = \"", "\"")
			sdns addon_type, addon_number, 1, tmp2
			tmp3 = get_chapter(adat_tmp, "addon_type_3", " = \"", "\"")
			sdns addon_type, addon_number, 2, tmp3

			; ã‚«ãƒ?‚´ãƒªåˆ?‘
			ct_done = 0

			if tmp1 = "Two_lane_road" or tmp1 = "Two_lane_Road" {
				notesel type_Two_lane_road : noteadd addon_name_tmp, -1
				notesel type_number_Two_lane_road : noteadd str(addon_number), -1
				ct_done = 1
			}
			if tmp1 = "Promenade" or tmp1 = "promenade" {
				notesel type_Promenade : noteadd addon_name_tmp, -1
				notesel type_number_Promenade : noteadd str(addon_number), -1
				ct_done = 1
			}
			if tmp1 = "Two_lane_railroad" or tmp1 = "Two_lane_Railroad" or tmp1 = "station" or tmp1 = "Station" {
				notesel type_Two_lane_railroad : noteadd addon_name_tmp, -1
				notesel type_number_Two_lane_railroad : noteadd str(addon_number), -1
				ct_done = 1
			}
			if tmp1 = "low_density_residential" or tmp1 = "low_density_Residential" or tmp1 = "Low_density_Residential" {
				notesel type_low_density_residential : noteadd addon_name_tmp, -1
				notesel type_number_low_density_residential : noteadd str(addon_number), -1
				ct_done = 1
			}
			if tmp1 = "high_density_residential" or tmp1 = "high_density_Residential" or tmp1 = "High_density_Residential" {
				notesel type_high_density_residential : noteadd addon_name_tmp, -1
				notesel type_number_high_density_residential : noteadd str(addon_number), -1
				ct_done = 1
			}
			if tmp1 = "low_density_commercial" or tmp1 = "low_density_Commercial" or tmp1 = "Low_density_Commercial" {
				notesel type_low_density_commercial : noteadd addon_name_tmp, -1
				notesel type_number_low_density_commercial : noteadd str(addon_number), -1
				ct_done = 1
			}
			if tmp1 = "high_density_commercial" or tmp1 = "high_density_Commercial" or tmp1 = "High_density_Commercial" {
				notesel type_high_density_commercial : noteadd addon_name_tmp, -1
				notesel type_number_high_density_commercial : noteadd str(addon_number), -1
				ct_done = 1
			}
			if tmp1 = "office" or tmp1 = "Office" {
				notesel type_office : noteadd addon_name_tmp, -1
				notesel type_number_office : noteadd str(addon_number), -1
				ct_done = 1
			}
			if tmp1 = "industrial" or tmp1 = "Industrial" {
				notesel type_industrial : noteadd addon_name_tmp, -1
				notesel type_number_industrial : noteadd str(addon_number), -1
				ct_done = 1
			}
			if tmp1 = "farm" or tmp1 = "Farm" {
				notesel type_farm : noteadd addon_name_tmp, -1
				notesel type_number_farm : noteadd str(addon_number), -1
				ct_done = 1
			}
			if tmp1 = "public" or tmp1 = "Public" {
				notesel type_public : noteadd addon_name_tmp, -1
				notesel type_number_public : noteadd str(addon_number), -1
				ct_done = 1
			}
			if tmp1 = "park" or tmp1 = "Park" {
				notesel type_park : noteadd addon_name_tmp, -1
				notesel type_number_park : noteadd str(addon_number), -1
				ct_done = 1
			}
			if tmp1 = "waterway" or tmp1 = "Waterway" or tmp1 = "port" or tmp1 = "Port" {
				notesel type_waterway : noteadd addon_name_tmp, -1
				notesel type_number_waterway : noteadd str(addon_number), -1
				ct_done = 1
			}
			if tmp1 = "airport" or tmp1 = "Airport" {
				notesel type_airport : noteadd addon_name_tmp, -1
				notesel type_number_airport : noteadd str(addon_number), -1
				ct_done = 1
			}
			if tmp1 = "tile" or tmp1 = "Tile" {
				notesel type_tile : noteadd addon_name_tmp, -1
				notesel type_number_tile : noteadd str(addon_number), -1

				if addon_name_tmp = "tile_greenfield" {
					tile_addon_number = addon_number
				}
				ct_done = 1
			}

			if ct_done = 0 {
				error "A01 : ã‚¢ãƒ‰ã‚ªãƒ³ã‚’ã‚«ãƒ?‚´ãƒªåˆ?‘ã§ãã¾ã›ã‚“\n"+addon_name(addon_number)+"ã‚’è¦å®šã?ã‚«ãƒ?‚´ãƒªãƒ¼ã«åŒºåˆ¥ã§ããªã?Ÿã‚ã€ã“ã®ã‚¢ãƒ‰ã‚ªãƒ³ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“ã€?\nã‚¢ãƒ‰ã‚ªãƒ³ãƒ•ã‚¡ã‚¤ãƒ«(*.adat)ã®addon_typeè¦ç´?ã‚’ã”ç¢ºèªãã?ã•ã„ã€?"
			}

		; addon_maker_version?ˆã‚¢ãƒ‰ã‚ªãƒ³ã‚’ä½œæ?ã—ãŸAddon Makerã®ãƒã?ã‚¸ãƒ§ãƒ³??
			tmp = get_chapter(adat_tmp, "addon_maker_version", " = \"", "\"")
			sdns addon_maker_version, addon_number, 0, tmp

		; addon_maximum_capacity?ˆã‚¢ãƒ‰ã‚ªãƒ³ã®åå®¹äººæ•°??
			tmp = get_chapter(adat_tmp, "maximum_capacity", " = \"", "\"")
			sdns addon_maximum_capacity, addon_number, 0, tmp

		; addon_land_price_influence?ˆã‚¢ãƒ‰ã‚ªãƒ³ãŒåœ°ä¾¡ã«åŠã¼ã™å½±éŸ¿??
			tmp = get_chapter(adat_tmp, "land_price_influence", " = \"", "\"")
			sdns addon_land_price_influence, addon_number, 0, tmp

		; addon_land_price_influence_grid?ˆã‚¢ãƒ‰ã‚ªãƒ³ã®è¨­ç½®ã«ã‚ˆã‚Šåœ°ä¾¡ãŒå½±éŸ¿ã™ã‚‹ç¯?›²??
			tmp = get_chapter(adat_tmp, "land_price_influence_grid", " = \"", "\"")
			sdns addon_land_price_influence, addon_number, 1, tmp

		; addon_crime_rate_influence?ˆã‚¢ãƒ‰ã‚ªãƒ³ãŒçŠ¯ç½ªç?«åŠã¼ã™å½±éŸ¿??
			tmp = get_chapter(adat_tmp, "crime_rate_influence", " = \"", "\"")
			sdns addon_crime_rate_influence, addon_number, 0, tmp

		; addon_crime_rate_influence_grid?ˆã‚¢ãƒ‰ã‚ªãƒ³ã®è¨­ç½®ã«ã‚ˆã‚ŠçŠ¯ç½ªç?Œå½±éŸ¿ã™ã‚‹ç¯?›²??
			tmp = get_chapter(adat_tmp, "crime_rate_influence_grid", " = \"", "\"")
			sdns addon_crime_rate_influence, addon_number, 1, tmp

		; addon_education_rate_influence?ˆã‚¢ãƒ‰ã‚ªãƒ³ãŒæ•™è‚²åº¦ã«åŠã¼ã™å½±éŸ¿??
			tmp = get_chapter(adat_tmp, "education_rate_influence", " = \"", "\"")
			sdns addon_education_rate_influence, addon_number, 0, tmp

		; addon_education_rate_influence_grid?ˆã‚¢ãƒ‰ã‚ªãƒ³ã®è¨­ç½®ã«ã‚ˆã‚Šæ•™è‚²åº¦ãŒå½±éŸ¿ã™ã‚‹ç¯?›²??
			tmp = get_chapter(adat_tmp, "education_rate_influence_grid", " = \"", "\"")
			sdns addon_education_rate_influence, addon_number, 1, tmp

		; addon_noise_influence?ˆã‚¢ãƒ‰ã‚ªãƒ³ãŒå?ã™é¨’éŸ³??
			tmp = get_chapter(adat_tmp, "noise_influence", " = \"", "\"")
			sdns addon_noise_influence, addon_number, 0, tmp

		; addon_education_rate_influence_grid?ˆã‚¢ãƒ‰ã‚ªãƒ³ãŒå?ã™é¨’éŸ³ãŒå½±éŸ¿ã™ã‚‹ç¯?›²??
			tmp = get_chapter(adat_tmp, "noise_influence_grid", " = \"", "\"")
			sdns addon_noise_influence, addon_number, 1, tmp

		; addon_crop?ˆã‚¢ãƒ‰ã‚ªãƒ³ãŒç”Ÿç”£ã™ã‚‹ç”Ÿç”£ç‰©åï¼?
			tmp = get_chapter(adat_tmp, "addon_crop", " = \"", "\"")
			sdns addon_crop, addon_number, 0, tmp
			tmp = get_chapter(adat_tmp, "addon_crop_amount", " = \"", "\"")
			sdns addon_crop, addon_number, 1, tmp

		; addon_use_type_names?ˆã‚¢ãƒ‰ã‚ªãƒ³å†??ã‚¿ã‚¤ãƒ—ã?åå‰??
			tmp = get_chapter(adat_tmp, "use_types", " = \"", "\"")

			sdim tmps, 32, 12
			split tmp, ", ", tmps : stat_tmp = stat

			i = 0

			repeat stat_tmp
				sdns addon_use_types_name, addon_number, cnt, tmps(cnt), total_addons, 12

				if i > 12 {
					break
				}
			loop

		; addon_crop?ˆã‚¢ãƒ‰ã‚ªãƒ³ãŒç”Ÿç”£ã™ã‚‹ç”Ÿç”£ç‰©åï¼?
			tmp = get_chapter(adat_tmp, "build_limit", " = \"", "\"")
			sdns addon_build_limit, addon_number, 0, tmp

		; å?‚¿ã‚¤ãƒ—ã?å†?®¹ã‚’å?ã‚ŠæŠœã?
			total_types = sdnsize(addon_use_types_name, addon_number)

			repeat total_types
				searching_type_name = sdnl(addon_use_types_name, addon_number, cnt)
				addon_a_type_tmp = get_chapter(adat_tmp, searching_type_name, " {", "};")

				tcnt = cnt

				; addon_dire_names?ˆã‚¢ãƒ‰ã‚ªãƒ³ã®ãã‚Œãã‚Œã®ã‚¿ã‚¤ãƒ—å?ã®å‘ãã®åå‰??&å?–¹å‘ã?å†?®¹ã‚’å?ã‚ŠæŠœã?
					addon_direction_tmp = get_chapter(addon_a_type_tmp, "direction", " = \"", "\"")
					split addon_direction_tmp, ", ", addon_directions
					split_stat = stat// : sdns addon_total_directions, addon_number, tcnt, str(split_stat)

					repeat split_stat
						sdns3 addon_dire_names, addon_number, tcnt, cnt, addon_directions(cnt), total_addons, 12, 4

						addon_a_direction_tmp = get_chapter(addon_a_type_tmp, ""+addon_directions(cnt)+" ", "{", "}")

						; addon_size_x, addon_size_y?ˆã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚µã‚¤ã‚º??
							addon_size_tmp = get_chapter(addon_a_direction_tmp, "size_x", " = \"", "\"")
							sdns3 addon_size_x, addon_number, tcnt, cnt, addon_size_tmp, total_addons, 12, 4

							addon_size_tmp = get_chapter(addon_a_direction_tmp, "size_y", " = \"", "\"")
							sdns3 addon_size_y, addon_number, tcnt, cnt, addon_size_tmp, total_addons, 12, 4

						; addon_chip_x, addon_chip_y?ˆã‚¢ãƒ‰ã‚ªãƒ³ãŒå°‚æœ‰ã™ã‚‹ãƒã‚¹ã®æ•°??
							addon_chip_tmp = get_chapter(addon_a_direction_tmp, "chip_x", " = \"", "\"")
							sdns3 addon_chip_x, addon_number, tcnt, cnt, addon_chip_tmp, total_addons, 12, 4

							addon_chip_tmp = get_chapter(addon_a_direction_tmp, "chip_y", " = \"", "\"")
							sdns3 addon_chip_y, addon_number, tcnt, cnt, addon_chip_tmp, total_addons, 12, 4

						; addon_top_left_x, addon_top_left_y?ˆã‚¢ãƒ‰ã‚ªãƒ³ã®çµµãŒæå†™ã•ã‚Œã¦ã?‚‹å·¦ä¸Šã?åº§æ¨™ï¼?
							addon_top_left_tmp = get_chapter(addon_a_direction_tmp, "top_left_x", " = \"", "\"")
							sdns3 addon_top_left_x, addon_number, tcnt, cnt, addon_top_left_tmp, total_addons, 12, 4

							addon_top_left_tmp = get_chapter(addon_a_direction_tmp, "top_left_y", " = \"", "\"")
							sdns3 addon_top_left_y, addon_number, tcnt, cnt, addon_top_left_tmp, total_addons, 12, 4

						; addon_bottom_right_x, addon_bottom_right_y?ˆã‚¢ãƒ‰ã‚ªãƒ³ã®çµµãŒæå†™ã•ã‚Œã¦ã?‚‹å³ä¸‹ã?åº§æ¨™ï¼?
							addon_bottom_right_tmp = get_chapter(addon_a_direction_tmp, "bottom_right_x", " = \"", "\"")
							sdns3 addon_bottom_right_x, addon_number, tcnt, cnt, addon_bottom_right_tmp, total_addons, 12, 4

							addon_bottom_right_tmp = get_chapter(addon_a_direction_tmp, "bottom_right_y", " = \"", "\"")
							sdns3 addon_bottom_right_y, addon_number, tcnt, cnt, addon_bottom_right_tmp, total_addons, 12, 4
					loop

				; addon_image?ˆã‚¢ãƒ‰ã‚ªãƒ³ã§ä½¿ã?”»åƒï¼?
					load_image = get_chapter(addon_a_type_tmp, "image", " = \"", "\"")
					sdns3 addon_image, addon_number, tcnt, 0, load_image, total_addons, 12, 2

				; addon_night_mask_image?ˆã‚¢ãƒ‰ã‚ªãƒ³ã§ä½¿ã?¤œé–“ã®ãƒã‚¹ã‚¯ç”»åƒï¼?
					load_night_mask_image = get_chapter(addon_a_type_tmp, "night_mask", " = \"", "\"")
					sdns3 addon_night_mask_image, addon_number, tcnt, 0, load_image, total_addons, 12, 2

				; addon_base?ˆã‚¢ãƒ‰ã‚ªãƒ³ã®ä¸‹åœ°ã«ç”¨ã?‚‹ã‚¢ãƒ‰ã‚ªãƒ³åï¼?
					load_base = get_chapter(addon_a_type_tmp, "base", " = \"", "\"")
					split load_base, ", ", load_base_addon_name, load_base_addon_type, load_base_addon_dire
					sdns3 addon_base, addon_number, tcnt, 0, load_base_addon_name, total_addons, 12, 3
					sdns3 addon_base, addon_number, tcnt, 1, load_base_addon_type, total_addons, 12, 3
					sdns3 addon_base, addon_number, tcnt, 2, load_base_addon_dire, total_addons, 12, 3
					
				/*-----------------------------ã‚¢ãƒ‰ã‚ªãƒ³ç”»åƒã?èª­ã¿è¾¼ã¿-----------------------------*/
				; é€šå¸¸æ™?
					exist load_image

					if strsize = -1 and fromAdonFile(totalAddonNumber) = 0 {
						error "A02 : ã‚¢ãƒ‰ã‚ªãƒ³ã®ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\n"+fromAdonFile(cnt) = 0+" "+sdnl(addon_name, addon_number, 0)+"ã§åˆ©ç”¨ã™ã‚‹"+load_image+"ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€?\nã‚¢ãƒ‰ã‚ªãƒ³ãƒ•ã‚¡ã‚¤ãƒ«(*.adat)ã¨åŒã˜å ´æ‰€ã«ç”»åƒãŒã‚ã‚‹ã“ã¨ã‚’ã”ç¢ºèªãã?ã•ã„ã€?"
					}

					if fromAdonFile(totalAddonNumber) = 1 {
						repeat countOfAdonImageFiles(countOfLoadedAdonFiles)
							if adonImageFilesName(countOfLoadedAdonFiles, cnt) = load_image {
								buffer next_image_num
									memfile adonImageFiles(countOfLoadedAdonFiles, cnt)
									if getpath(adonImageFilesName(countOfLoadedAdonFiles, cnt), 2) = ".png" {
										picload "MEM:.png"
									} else {
										picload "MEM:"
									}
								gsel 0

								break
							}
						loop
					} else {
						celload load_image, next_image_num
					}
					
					next_image_num_str = str(next_image_num)
					sdns3 addon_image, addon_number, tcnt, 1, next_image_num_str, total_addons, 12, 2

					; ç”»åƒå?ä½“ã?ã‚µã‚¤ã‚ºã‚’å–å¾—ã—ã¦addon_image_sizeã«ä¿å­?
					gsel next_image_num
					imgx = ginfo(12) : imgy = ginfo(13)

					imgx_str = str(imgx)
					imgy_str = str(imgy)

					sdns3 addon_image_size, addon_number, tcnt, 0, imgx_str, total_addons, 12, 2
					sdns3 addon_image_size, addon_number, tcnt, 1, imgy_str, total_addons, 12, 2

					next_image_num ++

				; å¤œé–“ãƒã?ã‚¸ãƒ§ãƒ³
					if load_night_mask_image != "" {
						exist load_night_mask_image

						if strsize = -1 and fromAdonFile(totalAddonNumber) = 0 {
							error "A03 : ã‚¢ãƒ‰ã‚ªãƒ³ã®å¤œé–“ãƒã‚¹ã‚¯ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\n"+sdnl(addon_name, addon_number, 0)+"ã§åˆ©ç”¨ã™ã‚‹"+load_night_mask_image+"ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€?\nã‚¢ãƒ‰ã‚ªãƒ³ãƒ•ã‚¡ã‚¤ãƒ«(*.adat)ã¨åŒã˜å ´æ‰€ã«ç”»åƒãŒã‚ã‚‹ã“ã¨ã‚’ã”ç¢ºèªãã?ã•ã„ã€?"
						}

						if fromAdonFile(totalAddonNumber) = 1 {
							repeat countOfAdonImageFiles(countOfLoadedAdonFiles)
								if adonImageFilesName(countOfLoadedAdonFiles, cnt) = load_night_mask_image {
									buffer 99
										memfile adonImageFiles(countOfLoadedAdonFiles, cnt)
										if getpath(adonImageFilesName(countOfLoadedAdonFiles, cnt), 2) = ".png" {
											picload "MEM:.png"
										} else {
											picload "MEM:"
										}
									gsel 0
	
									break
								}
							loop
						} else {
							celload load_night_mask_image, 99
						}
					}

					buffer next_image_num, imgx, imgy
						pos 0, 0 : gcopy next_image_num-1, 0, 0, imgx, imgy

						color 0, 0, 0 : sboxf 200, 0, 0, imgx, imgy

						if load_night_mask_image != "" {
							gmode 2
							pos 0, 0 : gcopy 99, 0, 0, imgx, imgy
						}

					next_image_num_str = str(next_image_num)
					sdns3 addon_night_mask_image, addon_number, tcnt, 1, next_image_num_str, total_addons, 12, 2

					next_image_num ++

				; å¤•æ–¹ãƒã?ã‚¸ãƒ§ãƒ³
					buffer next_image_num, imgx, imgy
						pos 0, 0 : gcopy next_image_num-2, 0, 0, imgx, imgy

						color 0, 0, 0 : sboxf 128, 0, 0, imgx, imgy

						if load_night_mask_image != "" and rnd(2) = 1 {
							gmode 2
							pos 0, 0 : gcopy 99, 0, 0, imgx, imgy
						}

					next_image_num ++

				; åœé›»ãƒã?ã‚¸ãƒ§ãƒ³
					buffer next_image_num, imgx, imgy
						pos 0, 0 : gcopy next_image_num-3, 0, 0, imgx, imgy

						color 0, 0, 0 : sboxf 200, 0, 0, imgx, imgy

					next_image_num ++

				gsel 0

			loop

		; adonãƒ•ã‚¡ã‚¤ãƒ«ãªã‚‰countOfLoadedAdonFiles ++
		if fromAdonFile(cnt) = 1 {
			countOfLoadedAdonFiles ++
		}
		
		addon_number ++
	loop

	return

*getAddonDataFromAdonFile	// adonãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã‚€
	; ãƒ•ã‚¡ã‚¤ãƒ«åæŒ‡å®?
	addonFilePath = getpath(addonFileName, 8)

	; unpacker.hspå†??*unpackingã§adonãƒ•ã‚¡ã‚¤ãƒ«å±•é–‹
	gosub *unpacking

	if maxCountOfImages > countOfImages {
		maxCountOfImages = countOfImages
	}

	countOfAdonImageFiles(countOfAdonFiles) = countOfImages
	
	; å±•é–‹ã—ãŸãƒã‚¤ãƒŠãƒªãƒ??ã‚¿ã‚’å„å¤‰æ•°ã«ä»£å…¥
	/*
	adatFlieData = adatFileBinary

	sdim imageFilesData, countOfImages
	repeat countOfImages
		imageFilesData = imageFilesBinary(cnt)
	loop

	iconFileData = iconFileBinary

	total_addons ++

	dialog ""+adatFileData+""
	*/
	return

*unpacking		// adonãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ?‰²
	/*-------------------------------èª­ã¿è¾¼ã¿---------------------------------*/
	// ã‚¢ãƒ‰ã‚ªãƒ³ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
	chdir addon_path
	exist addonFilePath : addonFileSize = strsize

	if addonFileSize = -1 {
		error "A04 : adonãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\n\n"+dirinfo(0)+"/"+addonFileName+""
	}

	sdim blAddonFile, addonFileSize+(addonFileSize/4*4+4)
	bload addonFilePath, blAddonFile
	
	// ã‚¢ãƒ‰ã‚ªãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã©ã?‹ç¢ºèª?
	if instr(blAddonFile, 0, ".ADON") = -1 {
		error "A05 : æ‹¡å¼µå­adonã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¢ãƒ‰ã‚ªãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ã‚ã‚Šã¾ã›ã‚“\n\n"+dirinfo(0)+"/"+addonFileName+""
	}

	// ã‚¢ãƒ‰ã‚ªãƒ³ã«ä½¿ã?”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾?
	countOfImages = 0

	countOfImagesTagIndex = binarySearch(blAddonFile, 0, countOfImagesTagStart, addonFileSize)
	countOfImages = int(binaryCut(blAddonFile, countOfImagesTagIndex+strlen(countOfImagesTagStart), binarySearch(blAddonFile, countOfImagesTagIndex, countOfImagesTagEnd, addonFileSize), addonFileSize))

	// ãƒã?ã‚¸ãƒ§ãƒ³ã‚’å–å¾?
	if instr(blAddonFile, 0, "<v|2>") != -1 {
		adonFileVersion = 2
	} else {
		adonFileVersion = 1
	}
	
	// ãã‚Œãã‚Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å§‹ç‚¹ã‚¤ãƒ³ãƒ?ƒƒã‚¯ã‚¹ã¨ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å–å¾?
	searchedImages = 0
	dim endOfTagForImageFileIndex, countOfImages, 8
	//sdim imageFilesName, 32, countOfImages
	dim startOfImageFilesIndex, countOfImages

	startOfAdatFileIndex = -1
	repeat countOfImages
		startOfImageFilesIndex(cnt) = -1
	loop
	startOfIconFileIndex = -1

	if adonFileVersion = 1 {
		repeat addonFileSize
			// adatãƒ•ã‚¡ã‚¤ãƒ«
			if startOfAdatFileIndex = -1 {
				temp = binaryCut(blAddonFile, cnt, cnt+strlen(adatFileStartTag), addonFileSize)
				if instr(temp, 0, adatFileStartTag) = 0 {
					endOfTagForAdatFileIndex = binarySearch(blAddonFile, cnt, adatFileEndTag, addonFileSize)
					//adatFileName = binaryCut(blAddonFile, cnt+strlen(adatFileStartTag), endOfTagForAdatFileIndex, addonFileSize)
		
					startOfAdatFileIndex = endOfTagForAdatFileIndex+strlen(adatFileEndTag)
				}
			}
	
			// ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«
			if countOfImages > searchedImages {
				temp = binaryCut(blAddonFile, cnt, cnt+strlen(imageFileStartTag), addonFileSize)
				if instr(temp, 0, imageFileStartTag) = 0 {
					endOfTagForImageFileIndex(searchedImages) = binarySearch(blAddonFile, cnt, imageFileEndTag, addonFileSize)
					adonImageFilesName(countOfAdonFiles, searchedImages) = binaryCut(blAddonFile, cnt+strlen(imageFileStartTag), endOfTagForImageFileIndex(searchedImages), addonFileSize)
	
					startOfImageFilesIndex(searchedImages) = endOfTagForImageFileIndex(searchedImages)+strlen(imageFileEndTag)
					
					searchedImages ++
				}
			}
	
			// ã‚¢ã‚¤ã‚³ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«
			if startOfIconFileIndex = -1 {
				temp = binaryCut(blAddonFile, cnt, cnt+strlen(iconFileStartTag), addonFileSize)
				if instr(temp, 0, iconFileStartTag) = 0 {
					endOfTagForIconFileIndex = binarySearch(blAddonFile, cnt, iconFileEndTag, addonFileSize)
					adonIconFilesName(countOfAdonFiles) = binaryCut(blAddonFile, cnt+strlen(iconFileStartTag), endOfTagForIconFileIndex, addonFileSize)
		
					startOfIconFileIndex = endOfTagForIconFileIndex+strlen(iconFileEndTag)
					break
				}
			}
	
			await 0.1
		loop
	}
	if adonFileVersion = 2 {
		indexTagIndex = binarySearch(blAddonFile, 0, indexTagStart, addonFileSize)
		indexTag = binaryCut(blAddonFile, indexTagIndex+strlen(indexTagStart), binarySearch(blAddonFile, indexTagIndex, indexTagEnd, addonFileSize), addonFileSize)

		sdim splitIndexTags, 8, countOfImages+2
		split indexTag, ",", splitIndexTags : splitStat = stat

		dim imageFilesSize,					countOfImages
		dim startOfTagForImageFilesIndex,	countOfImages

		repeat splitStat
			if strmid(splitIndexTags(cnt), 0, 2) = "a:" {
				temp = strmid(splitIndexTags(cnt), 2, strlen(splitIndexTags(cnt)))
				split temp, "/", startOfTagForAdatFileIndexStr, adatFileSizeStr
				
				startOfTagForAdatFileIndex	= int(startOfTagForAdatFileIndexStr)
				adatFileSize				= int(adatFileSizeStr)

				endOfTagForAdatFileIndex	= int(binarySearch(blAddonFile, startOfTagForAdatFileIndex, adatFileEndTag, addonFileSize))
				startOfAdatFileIndex		= endOfTagForAdatFileIndex + strlen(adatFileEndTag)
			}

			if strmid(splitIndexTags(cnt), 0, 3) = "im:" {
				temp = strmid(splitIndexTags(cnt), 3, strlen(splitIndexTags(cnt)))
				split temp, "/", startOfTagForImageFileIndexStr, imageFileSizeStr
				
				startOfTagForImageFilesIndex(searchedImages)	= int(startOfTagForImageFileIndexStr)
				imageFilesSize(searchedImages)					= int(imageFileSizeStr)

				endOfTagForImageFileIndex(searchedImages)				= binarySearch(blAddonFile, startOfTagForImageFilesIndex(searchedImages), imageFileEndTag, addonFileSize)
				adonImageFilesName(countOfAdonFiles, searchedImages)	= binaryCut(blAddonFile, startOfTagForImageFilesIndex(searchedImages)+strlen(imageFileStartTag), endOfTagForImageFileIndex(searchedImages), addonFileSize)

				startOfImageFilesIndex(searchedImages) = endOfTagForImageFileIndex(searchedImages) + strlen(imageFileEndTag)

				searchedImages ++
			}

			if strmid(splitIndexTags(cnt), 0, 3) = "ic:" {
				temp = strmid(splitIndexTags(cnt), 3, strlen(splitIndexTags(cnt)))
				split temp, "/", startOfTagForIconFileIndexStr, iconFileSizeStr
				
				startOfTagForIconFileIndex = int(startOfTagForIconFileIndexStr)
				iconFileSize = int(iconFileSizeStr)

				endOfTagForIconFileIndex = binarySearch(blAddonFile, startOfTagForIconFileIndex, iconFileEndTag, addonFileSize)
				adonIconFilesName(countOfAdonFiles) = binaryCut(blAddonFile, startOfTagForIconFileIndex+strlen(iconFileStartTag), endOfTagForIconFileIndex, addonFileSize)

				startOfIconFileIndex = endOfTagForIconFileIndex + strlen(iconFileEndTag)
			}
		loop
	}

	// ãã‚Œãã‚Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã®çµ‚ç«¯ã‚¤ãƒ³ãƒ?ƒƒã‚¯ã‚¹ã‚’å–å¾?
	// adatãƒ•ã‚¡ã‚¤ãƒ«
	if adonFileVersion = 1 {
		endOfAdatFileIndex = binarySearch(blAddonFile, startOfAdatFileIndex, imageFileStartTag, addonFileSize) - 1
	}
	if adonFileVersion = 2 {
		endOfAdatFileIndex = startOfTagForAdatFileIndex+adatFileSize-1
	}

	// ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«
	dim endOfImageFilesIndex, countOfImages

	repeat countOfImages
		if adonFileVersion = 1 {
			if cnt = countOfImages - 1 {
				endOfImageFilesIndex(cnt) = binarySearch(blAddonFile, startOfImageFilesIndex(cnt), iconFileStartTag, addonFileSize) - 1
			} else {
				endOfImageFilesIndex(cnt) = binarySearch(blAddonFile, startOfImageFilesIndex(cnt), imageFileStartTag, addonFileSize) - 1
			}
		}
		if adonFileVersion = 2 {
			endOfImageFilesIndex(cnt) = startOfTagForImageFilesIndex(cnt)+imageFilesSize(cnt)-1
		}
	loop

	// ã‚¢ã‚¤ã‚³ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«
	if adonFileVersion = 1 {
		endOfIconFileIndex = binarySearch(blAddonFile, startOfIconFileIndex, endOfFileTag, addonFileSize) - 1
	}
	if adonFileVersion = 2 {
		endOfIconFileIndex = startOfTagForIconFileIndex+iconFileSize-1
	}

	// ãƒ•ã‚¡ã‚¤ãƒ«åˆ?‰²
	// adatãƒ•ã‚¡ã‚¤ãƒ«
	adonAdatFiles(countOfAdonFiles) = binaryCut(blAddonFile, startOfAdatFileIndex, endOfAdatFileIndex+1, addonFileSize)

	// ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«
	sdim imageFilesBinary, 128, countOfImages
	repeat countOfImages
		imageNum = cnt
		adonImageFiles(countOfAdonFiles, imageNum) = binaryCut(blAddonFile, startOfImageFilesIndex(cnt), endOfImageFilesIndex(cnt)+1, addonFileSize)
		repeat endOfImageFilesIndex(cnt)-startOfImageFilesIndex(imageNum)
			oldBinaryPeekTemp = peek(blAddonFile, startOfImageFilesIndex(imageNum)+cnt)
			newBinaryPeekTemp = peek(adonImageFiles(countOfAdonFiles, imageNum), cnt)
			
			if oldBinaryPeekTemp = 0 and newBinaryPeekTemp = 1 {
				poke adonImageFiles(countOfAdonFiles, imageNum), cnt, 0
			}
		loop
	loop

	// ã‚¢ã‚¤ã‚³ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«
	sdim iconFileBinary, endOfIconFileIndex-startOfIconFileIndex
	adonIconFiles(countOfAdonFiles) = binaryCut(blAddonFile, startOfIconFileIndex, endOfIconFileIndex+1, addonFileSize)

	repeat endOfIconFileIndex-startOfIconFileIndex
		oldBinaryPeekTemp = peek(blAddonFile, startOfIconFileIndex+cnt)
		newBinaryPeekTemp = peek(adonIconFiles(countOfAdonFiles), cnt)
		
		if oldBinaryPeekTemp = 0 and newBinaryPeekTemp = 1 {
			poke adonIconFiles(countOfAdonFiles), cnt, 0
		}
	loop

	return

*new_map
	/*----------------------------------æ–°ã—ã„ãƒãƒƒãƒ—ã?ä½œæ?----------------------------------------*/
	//ãƒãƒƒãƒ—è¨­å®?
	screen 1, 400, 300

	gsel 1
	title "æ–°è¦ã?ãƒ??ä½œæ?"

	onclick gosub *new_map_setting_onclick

	color 95, 95, 95 : boxf

	//ã‚¢ãƒ‰ã‚ªãƒ³ã‚»ãƒ?ƒˆä¸€è¦§ã‚’å–å¾?
	dirlist2h 1, ','
	dirlist2 tempAdatFiles, "*.adset*", 1, '\\'

	sdim filelist, tempAdatFiles
	dirlist2r filelist

	notesel filelist
	total_addon_sets = notemax

	sdim addon_sets_EN_name, 64, total_addons_sets
	sdim addon_sets_JP_name, 64, total_addons_sets

	addon_sets_names = ""

	repeat total_addon_sets
		notesel filelist
		noteget about_addon_set, cnt

		notesel addon_set_about_file
		noteload about_addon_set

		addon_sets_EN_name(cnt) = get_chapter(addon_set_about_file, "EN_Name", " = \"", "\"")
		addon_sets_JP_name(cnt) = get_chapter(addon_set_about_file, "JP_Name", " = \"", "\"")

		addon_sets_names += addon_sets_JP_name(cnt)

		if cnt < total_addon_sets-1 {
			addon_sets_names += "\n"
		}

		if addon_sets_EN_name(cnt) = "Normal" : addon_set_num = cnt
	loop

	if total_addon_sets = 0 {
		addon_sets_EN_name(0) = "Normal"
		addon_sets_JP_name(0) = "æ¨™æº–ã‚¢ãƒ‰ã‚ªãƒ³ã‚»ãƒ?ƒˆ?ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼?"
		addon_sets_names = addon_sets_EN_name(0)
		addon_set_num = 0
	}


	color 255, 255, 255
	font config_SystemFont, 16

	//éƒ½å¸‚å(City_Name)
		pos 10, 10 : mes "éƒ½å¸‚å"

		objsize 280, 20
		pos 80, 10 : input map_City_Name

	//å¸‚é•·å?(Mayor_Name)
		pos 10, 40 : mes "å¸‚é•·å?"

		objsize 280, 20
		pos 80, 40 : input map_Mayor_Name

	//å¤©å€™ã?å¤‰åŒ–(Set_Change_Weather)
		if map_Set_Change_Weather = 0 {
			pos 10, 73 : gcopy 14, 0, 0, 16, 16
		} else {
			pos 10, 73 : gcopy 14, 0, 16, 16, 16
		}

		pos 35, 70 : mes "å¤©å€™ã?å¤‰åŒ–"

	//ã‚¢ãƒ‰ã‚ªãƒ³ã‚»ãƒ?ƒˆ(Addon_Set)
		pos 10, 100 : mes "ã‚¢ãƒ‰ã‚ªãƒ³ã‚»ãƒ?ƒˆ"
		objsize 260, 20
		pos 100, 100 : combox addon_set_num, , addon_sets_names

	//OKãƒœã‚¿ãƒ³
		color 255, 255, 255 : boxf 150, 260, 250, 290
		color 95, 95, 95 : boxf 151, 261, 249, 289

		color 255, 255, 255 : font config_SystemFont, 20
		cmes "OK", 150, 260, 250, 290

	stop

*new_map_setting_onclick
	gsel 1

	from_setting_onclick = 1

	//å¤©å€™ã?å¤‰åŒ–(Set_Change_Weather)
		//ãƒã‚§ãƒ?‚¯ãƒœãƒƒã‚¯ã‚¹
			if click_range(10, 73, 10+16, 73+16) = 1 {
				if map_Set_Change_Weather = 0 {
					map_Set_Change_Weather = 1
				} else {
					map_Set_Change_Weather = 0
				}
			}

	//OKãƒœã‚¿ãƒ³
		if click_range(150, 260, 250, 290) = 1 {

		// ãƒãƒƒãƒ—ä½œæ?æ™‚ã?åˆæœŸè¨­å®?
			gsel 1, -1
			gsel 0

			onclick 0

			goto *new_map_preparation
		}

	clrobj

	goto *new_map

*new_map_preparation
	//ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ?
	map_Saved_Version = about_release_number

	map_Addons_Set = addon_sets_EN_name(addon_set_num)

	map_time_Year = gettime(0)
	map_time_Month = gettime(1)
	map_time_Date = gettime(3)
	map_time_Hour = 0
	map_time_Minutes = 0

	map_demand_Residential = 100
	map_demand_Commercial = 0
	map_demand_Office = 0
	map_demand_Industrial = 0
	map_demand_Farm = 0

	map_Money = 50000

	map_temperature = 0
	map_Set_Dark_on_Night = 1

	map_budget_of_Police = 100
	map_budget_of_Fire_Depertment = 100
	map_budget_of_Post_Office = 100
	map_budget_of_Education = 100

	map_tax_of_Residential = 100
	map_tax_of_Commercial = 100
	map_tax_of_Office = 100
	map_tax_of_Industrial = 100
	map_tax_of_Farm = 100

	not_displayed_news_new_map = 1

	z = 0

	gosub *load_addons

	notesel addons_list
	tile_addon_number = notefind ("tile_greenfield", 0)

	repeat MAPSIZE_X
		x = cnt

		repeat MAPSIZE_Y
			y = cnt

			name(x,y,z,0) = "tile_greenfield"
			name(x,y,z,1) = ""

			map(x,y,z,0) = tile_addon_number
			map(x,y,z,1) = -1

			category(x,y,z,0) = "tile"
			category(x,y,z,1) = ""
			category(x,y,z,2) = ""

			obj_type(x,y,z,0) = 0
			obj_type(x,y,z,1) = 0

			obj_dire(x,y,z,0) = 0
			obj_dire(x,y,z,1) = 0

			obj_serial_num(x,y,z) = 0

			obj_use_tiles(x,y,z,0) = 0
			obj_use_tiles(x,y,z,1) = 0

			obj_tiles(x,y,z,0) = 0
			obj_tiles(x,y,z,1) = 0

			residents(x,y,z) = 0
			workers(x,y,z) = 0
			students(x,y,z) = 0

			land_price(x,y,z) = 20
			crime_rate(x,y,z) = 0
			education_rate(x,y,z) = 0
			happiness(x,y,z) = 0
			noise(x,y,z) = 0

			crop(x,y,z) = ""
			crop_amount(x,y,z) = 0

			age(x,y,z) = ""
			gender(x,y,z) = ""

			workplace(x,y,z) = ""
			school(x,y,z) = ""

			reservation(x,y,z) = "none"

			original_name(x,y,z) = ""
		loop
	loop

	chdir directory
	goto *initialization


*initialization
	/*-----------------------------------å?¤‰æ•°ã®åˆæœŸåŒ?-------------------------------------------*/
	camx=-300 : camy=-150				; ã‚«ãƒ¡ãƒ©ã®ä½ç½®
	menu_line_y = 400					; ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¨ã®å¢?•Œç·?
	cursor_mode = "normal"				; ã‚«ãƒ¼ã‚½ãƒ«ã®ãƒ¢ãƒ¼ãƒ?
	pointer_icon = -1					; ãƒã‚¤ãƒ³ã‚¿ã®ã‚¢ã‚¤ã‚³ãƒ³??-1ã§å››è§’å½¢??
	before_mousex = -1
	before_mousey = -1
	before_camx = 0
	before_camy = 0
	put_addon_name = "tile_greenfield"
	stat_mode = ""
	nx = 0
	ny = 0
	showing_detail_x = -1
	showing_detail_y = -1
	speed = 2
	pause = 0
	before_windowx = -1
	before_windowy = -1
	opening_menu = ""

	; åˆæœŸã‚«ãƒ¡ãƒ©ä½ç½®
	intial_camx = camx
	intial_camy = camy

	; é›¨ç²’ã?åˆæœŸä½ç½®
	randomize
	repeat 50
		rain(cnt) = 0
		rain_x(cnt) = rnd(windowx) : rain_y(cnt) = -rnd(windowy)
	loop

	gosub *get_coordinates
	goto *get_addon_drow_position

*get_coordinates
	//è¡¨ç¤ºç¯?›²ã®åº§æ¨™ã‚’å–å¾?

	; MAPSIZE_X, MAPSIZE_Yã®ã?¡å¤§ãã„æ–¹ã®å€¤
		if MAPSIZE_X >= MAPSIZE_Y {
			mapsize_max = MAPSIZE_X
		} else {
			mapsize_max = MAPSIZE_Y
		}

	; ç”»é¢ä¸­å¤®ã®åº§æ¨?
		x_=(windowx/2)+camx-chip_size/2
		y_=(windowy/2)+camy
		middle_x=(y_+x_/2)/(chip_size/2)
		middle_y=(-x_+y_*2)/chip_size

	; ç”»é¢ä¸­å¤®ã‚’ä¸­å¿?¨ã—ãŸæå?ç¯?›²
		if windowx != before_windowx or windowy != before_windowy {
			draw_area = (sqrt(powf(windowx, 2)+powf(windowy, 2))/sqrt(powf(CHIP_SIZE/2, 2)+powf(CHIP_SIZE/4, 2)))
		}

		before_windowx = windowx
		before_windowy = windowy

	; åˆæœŸå€¤x, y, z
		intial_x = middle_x-int(draw_area)/2 - 3
		intial_y = middle_y-int(draw_area)/2 - 3
		intial_z = 0

		if intial_x < 0 {
			intial_x = 0
		}
		if intial_y < 0 {
			intial_y = 0
		}
		if intial_z < 0 {
			intial_z = 0
		}

	; åˆæœŸå€¤mx, my, mz?ˆã‚«ãƒ¼ã‚½ãƒ«ä½ç½®??
		mx = intial_x
		my = intial_y
		mz = intial_z

	return

*get_addon_drow_position
	//å??ã‚¹ã®ã‚¢ãƒ‰ã‚ªãƒ³ã®åˆæœŸã‚«ãƒ¡ãƒ©ä½ç½®ã§ã®è¡¨ç¤ºä½ç½®ã‚’å–å¾?
	dim addons_drow_position_x, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z, 2
	dim addons_drow_position_y, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z, 2

	dim addons_top_left_x, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z, 2
	dim addons_top_left_y, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z, 2

	dim addons_size_x, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z, 2
	dim addons_size_y, MAPSIZE_X, MAPSIZE_Y, MAPSIZE_Z, 2

	sz = 0

	repeat MAPSIZE_X
		sx = cnt

		repeat MAPSIZE_Y
			sy = cnt

			*get_addon_drow_position_new

			if map(sx,sy,sz,1) = -1 : rmax = 1 : else : rmax = 2
			repeat rmax
				; ã‚¢ãƒ‰ã‚ªãƒ³ç”»åƒã?å·¦ä¸Šã?åº§æ¨?
				top_left_x = int(sdnl3(addon_top_left_x, map(sx,sy,sz,cnt), obj_type(sx,sy,sz,cnt), obj_dire(sx,sy,sz,cnt)))
				top_left_y = int(sdnl3(addon_top_left_y, map(sx,sy,sz,cnt), obj_type(sx,sy,sz,cnt), obj_dire(sx,sy,sz,cnt)))

				; ã‚¢ãƒ‰ã‚ªãƒ³ç”»åƒã?å³ä¸‹ã?åº§æ¨?
				bottom_right_x = int(sdnl3(addon_bottom_right_x, map(sx,sy,sz,cnt), obj_type(sx,sy,sz,cnt), obj_dire(sx,sy,sz,cnt)))
				bottom_right_y = int(sdnl3(addon_bottom_right_y, map(sx,sy,sz,cnt), obj_type(sx,sy,sz,cnt), obj_dire(sx,sy,sz,cnt)))

				; ã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚µã‚¤ã‚º
				size_x = int(sdnl3(addon_size_x, map(sx,sy,sz,cnt), obj_type(sx,sy,sz,cnt), obj_dire(sx,sy,sz,cnt)))
				size_y = int(sdnl3(addon_size_y, map(sx,sy,sz,cnt), obj_type(sx,sy,sz,cnt), obj_dire(sx,sy,sz,cnt)))

				; ã‚¢ãƒ‰ã‚ªãƒ³ãŒå æœ‰ã™ã‚‹ã?ã‚¹ã®æ•°
				chip_x = int(sdnl3(addon_chip_x, map(sx,sy,sz,cnt), obj_type(sx,sy,sz,cnt), obj_dire(sx,sy,sz,cnt)))
				chip_y = int(sdnl3(addon_chip_y, map(sx,sy,sz,cnt), obj_type(sx,sy,sz,cnt), obj_dire(sx,sy,sz,cnt)))

				; ç›¸å¯¾çš?ªåº§æ¨™ã?ç®—å?
				position_x = sx * CHIP_SIZE/2 - sy * CHIP_SIZE/2 - intial_camx
				position_y = sy * CHIP_SIZE/4 + sx * CHIP_SIZE/4 - intial_camy

				; ã‚¢ãƒ‰ã‚ªãƒ³ã‚’è¡¨ç¤ºã™ã‚‹åº§æ¨™ã‚„ã‚µã‚¤ã‚ºãªã©ã‚’ç®—å?
				obj_tiles_x = obj_tiles(sx,sy,sz,0)
				obj_tiles_y = obj_tiles(sx,sy,sz,1)
				if (chip_x > 1 or chip_y > 1) and obj_dire(sx,sy,sz,cnt) = 2 {
					obj_tiles_y += obj_use_tiles(sx,sy,sz,1) - 1
					if obj_use_tiles(sx,sy,sz,1) = 0 : obj_tiles_y += 1
				}
				if (chip_x > 1 or chip_y > 1) and obj_dire(sx,sy,sz,cnt) = 3 {
					obj_tiles_x += obj_use_tiles(sx,sy,sz,0) - 1
					if obj_use_tiles(sx,sy,sz,0) = 0 : obj_tiles_x += 1
				}
				
				addons_drow_position_x(sx,sy,sz,cnt) = position_x
				addons_drow_position_y(sx,sy,sz,cnt) = position_y - (size_y-CHIP_SIZE/2) + (chip_x-1)*CHIP_SIZE/4 - obj_tiles_x * CHIP_SIZE/4 + CHIP_SIZE/2

				addons_top_left_x(sx,sy,sz,cnt) = top_left_x
				addons_top_left_y(sx,sy,sz,cnt) = top_left_y

				if chip_x > 1 or chip_y > 1 {
					addons_top_left_x(sx,sy,sz,cnt) += obj_tiles_x * CHIP_SIZE/2

					if obj_use_tiles(sx,sy,sz,1) != 0 and obj_tiles_y != obj_use_tiles(sx,sy,sz,1)-1 {
						addons_drow_position_x(sx,sy,sz,cnt) = -100
						addons_drow_position_y(sx,sy,sz,cnt) = -100
					}
				}

				addons_size_x(sx,sy,sz,cnt) = size_x
				addons_size_y(sx,sy,sz,cnt) = size_y

				if chip_x > 1 or chip_y > 1 {
					addons_size_x(sx,sy,sz,cnt) = size_x - CHIP_SIZE/2 * obj_tiles_x
				}

				; ã‚¿ã‚¤ãƒ«ã®ã¨ãã ã‘ä¾‹å¤–å?ç?
				if category(sx,sy,sz,cnt) = "tile" {
					if map_time_Month = 12 or (map_time_Month >= 1 and map_time_Month <= 2) : addons_top_left_y(sx,sy,sz,cnt) = int(sdnl3(addon_top_left_y, map(sx,sy,sz,cnt), element2(map(sx,sy,sz,cnt),addon_use_types_name,"snow"), 0))
					if map_time_Month >= 3 and map_time_Month <= 9 : addons_top_left_y(sx,sy,sz,cnt) = int(sdnl3(addon_top_left_y, map(sx,sy,sz,cnt), element2(map(sx,sy,sz,cnt),addon_use_types_name,"null"), 0))
					if map_time_Month >= 10 and map_time_Month <= 11 : addons_top_left_y(sx,sy,sz,cnt) = int(sdnl3(addon_top_left_y, map(sx,sy,sz,cnt), element2(map(sx,sy,sz,cnt),addon_use_types_name,"autumn"), 0))
				}
				
			loop
			if from_build = 1 {
				from_build = 0
				return
			}
		loop
	loop

/*-----------------------------------------æå?å‡¦ç?-----------------------------------------------*/
*main
	gsel 0

	return_from_exit = "main"

	repeat
		; ã‚«ãƒ¡ãƒ©æ“ä½?
		if ginfo(2) = 0 {
			before_camx = camx
			before_camy = camy

			getkey key_left, 37
			if key_left = 1 {
				camx -= 20
			}

			getkey key_up, 38
			if key_up = 1 {
				camy -= 10
			}

			getkey key_right, 39
			if key_right = 1 {
				camx += 20
			}

			getkey key_down, 40
			if key_down = 1 {
				camy += 10
			}
		}

		; ã‚«ãƒ¡ãƒ©ãŒæ“ä½œã•ã‚ŒãŸã‚‰æå†™ç¯?›²ã®è¨ˆç®—ã‚’ã™ã‚‹
		if camx != before_camx or camy != before_camy {
			gosub *get_coordinates
		}

		; mx,myã«ãƒã‚¦ã‚¹åº§æ¨™å–å¾?
		if mousex != before_mousex or mousey != before_mousey or camx != before_camx or camy != before_camy {
			mousex_ = mousex+camx-(CHIP_SIZE/2)
			mousey_ = mousey+camy
			mx = (mousey_+mousex_/2)/(CHIP_SIZE/2) - 1
			my = (-mousex_+mousey_*2)/CHIP_SIZE - 1

			if mx < 0 {
				mx = 0
			}
			if my < 0 {
				my = 0
			}
			if mx >= MAPSIZE_X {
				mx = MAPSIZE_X - 1
			}
			if my >= MAPSIZE_Y {
				my = MAPSIZE_Y - 1
			}

			before_mousex = mousex
			before_mousey = mousey
		}

		; å¤œé–“/å¤•æ–¹ãªã‚‰ãƒŠã‚¤ãƒˆã?ã‚¹ã‚¯ä»˜ãã‚¢ãƒ‰ã‚ªãƒ³ã®è¡¨ç¤ºæº–å‚™
		if map_set_Dark_on_Night = 1 {
			if map_time_Hour = 6 or (map_time_Hour >= 16 and map_time_Hour <= 17) {
				night_mask_drow = 2
			} else : if (map_time_Hour >= 18) or (map_time_Hour >= 0 and map_time_Hour <= 5) {
				night_mask_drow = 1
			} else {
				night_mask_drow = 0
			}
		} else {
			night_mask_drow = 0
		}

		; æå???œ°åŒºè¨­å®šã•ã‚ŒãŸåœ°åŒºã«å»ºè¨­
		redraw 0
		color 0, 0, 0 : boxf

		x = intial_x
		z = intial_z

		repeat draw_area + 5
			y = intial_y

			if x >= MAPSIZE_X {
				break
			}

			repeat draw_area + 5
				if y >= MAPSIZE_Y {
					break
				}

				; ã‚¢ãƒ‰ã‚ªãƒ³ã®æå???yã®å€¤ã?-100ä»¥ä¸‹ãªã‚‰è¡¨ç¤ºã—ãªã?¼?
				; ä¸‹åœ°
				if addons_drow_position_y(x,y,z,1) > -100 and map(x,y,z,1) != -1 {
					pos addons_drow_position_x(x,y,z,1)+intial_camx-camx, addons_drow_position_y(x,y,z,1)+intial_camy-camy
					gmode 2 : gcopy int(sdnl3(addon_image, map(x,y,z,1), obj_type(x,y,z,1), 1))+night_mask_drow, addons_top_left_x(x,y,z,1), addons_top_left_y(x,y,z,1), addons_size_x(x,y,z,1), addons_size_y(x,y,z,1)
				}
				; ä¸Šåœ°
				if addons_drow_position_y(x,y,z,0) > -100 {
					pos addons_drow_position_x(x,y,z,0)+intial_camx-camx, addons_drow_position_y(x,y,z,0)+intial_camy-camy
					gmode 2 : gcopy int(sdnl3(addon_image, map(x,y,z,0), obj_type(x,y,z,0), 1))+night_mask_drow, addons_top_left_x(x,y,z,0), addons_top_left_y(x,y,z,0), addons_size_x(x,y,z,0), addons_size_y(x,y,z,0)
				}

				; çµ±è¨ˆãƒ¢ãƒ¼ãƒ‰ãŒé¸æŠã•ã‚Œã¦ã?‚‹å ´å?
				if stat_mode != "" {
					; ç›¸å¯¾çš?ªåº§æ¨™ã?ç®—å?
					position_x = x * CHIP_SIZE/2 - y * CHIP_SIZE/2 - camx
					position_y = y * CHIP_SIZE/4 + x * CHIP_SIZE/4 - camy
					pos position_x, position_y+32
					gmode 4,,,128

					; è‰²ã‚¿ã‚¤ãƒ«ã®è¡¨ç¤º
						; å»ºç‰©ã®ç¨®é¡?
						if stat_mode = "type" {
							if category(x,y,z,0) = "residential" or instr(reservation(x,y,z), 0, "residential") != -1 {
								gcopy 22, 0, 0, 64, 32
							} else : if category(x,y,z,0) = "commercial" or instr(reservation(x,y,z), 0, "commercial") != -1 {
								gcopy 23, 0, 0, 64, 32
							} else : if category(x,y,z,0) = "office" or reservation(x,y,z) = "office" {
								gcopy 24, 0, 0, 64, 32
							} else : if category(x,y,z,0) = "industrial" or reservation(x,y,z) = "industrial" {
								gcopy 25, 0, 0, 64, 32
							} else : if category(x,y,z,0) = "farm" or reservation(x,y,z) = "farm" {
								gcopy 59, 0, 0, 64, 32
							} else : if category(x,y,z,0) = "public" {
								gcopy 26, 0, 0, 64, 32
							}
						}

						; åœ°ä¾¡
						if stat_mode = "land_price" {
							if land_price(x,y,z) > 200 {
								gcopy 34, 0, 0, 64, 32
							} else : if land_price(x,y,z) > 150 {
								gcopy 35, 0, 0, 64, 32
							} else : if land_price(x,y,z) > 80 {
								gcopy 36, 0, 0, 64, 32
							} else : if land_price(x,y,z) = 50 {
								gcopy 48, 0, 0, 64, 32
							} else : if land_price(x,y,z) > 30 {
								gcopy 37, 0, 0, 64, 32
							} else : if land_price(x,y,z) > 15 {
								gcopy 38, 0, 0, 64, 32
							} else {
								gcopy 39, 0, 0, 64, 32
							}
						}

						; çŠ¯ç½ªç?
						if stat_mode = "crime_rate" {
							if crime_rate(x,y,z) <= -100 {
								gcopy 34, 0, 0, 64, 32
							} else : if crime_rate(x,y,z) <= -50 {
								gcopy 35, 0, 0, 64, 32
							} else : if crime_rate(x,y,z) = 0 {
								gcopy 48, 0, 0, 64, 32
							} else : if crime_rate(x,y,z) < 0 {
								gcopy 36, 0, 0, 64, 32
							} else : if crime_rate(x,y,z) <= 30 {
								gcopy 37, 0, 0, 64, 32
							} else : if crime_rate(x,y,z) <= 60 {
								gcopy 38, 0, 0, 64, 32
							} else {
								gcopy 39, 0, 0, 64, 32
							}
						}

						; æ•™è‚²åº¦
						if stat_mode = "education_rate" {
							if education_rate(x,y,z) <= 0 {
								gcopy 39, 0, 0, 64, 32
							} else : if education_rate(x,y,z) <= 15 {
								gcopy 38, 0, 0, 64, 32
							} else : if education_rate(x,y,z) <= 30 {
								gcopy 48, 0, 0, 64, 32
							} else : if education_rate(x,y,z) <= 45 {
								gcopy 37, 0, 0, 64, 32
							} else : if education_rate(x,y,z) <= 60 {
								gcopy 36, 0, 0, 64, 32
							} else : if education_rate(x,y,z) <= 75 {
								gcopy 35, 0, 0, 64, 32
							} else {
								gcopy 34, 0, 0, 64, 32
							}
						}

						; å¹¸ç¦åº¦
						if stat_mode = "happiness" {
							if happiness(x,y,z) <= 15 {
								gcopy 39, 0, 0, 64, 32
							} else : if happiness(x,y,z) <= 30 {
								gcopy 38, 0, 0, 64, 32
							} else : if happiness(x,y,z) <= 45 {
								gcopy 48, 0, 0, 64, 32
							} else : if happiness(x,y,z) <= 60 {
								gcopy 37, 0, 0, 64, 32
							} else : if happiness(x,y,z) <= 75 {
								gcopy 36, 0, 0, 64, 32
							} else : if happiness(x,y,z) <= 90 {
								gcopy 35, 0, 0, 64, 32
							} else {
								gcopy 34, 0, 0, 64, 32
							}
						}

						; é¨’éŸ³
						if stat_mode = "noise" {
							if noise(x,y,z) <= -50 {
								gcopy 35, 0, 0, 64, 32
							} else : if noise(x,y,z) = 0 {
								gcopy 48, 0, 0, 64, 32
							} else : if noise(x,y,z) < 0 {
								gcopy 36, 0, 0, 64, 32
							} else : if noise(x,y,z) <= 30 {
								gcopy 37, 0, 0, 64, 32
							} else : if noise(x,y,z) <= 60 {
								gcopy 38, 0, 0, 64, 32
							} else {
								gcopy 39, 0, 0, 64, 32
							}
						}
				}

				; åœ°åŒºè¨­å®šã•ã‚ŒãŸåœ°åŒºã«å»ºç‰©ã‚’å»ºè¨­
				if cursor_mode = "normal" or cursor_mode = "delete" {
					if reservation(x,y,z) != "none" and rnd(100) = 99 {
						gosub *build_on_reserved_area
					}
				}

				; å¹¸ç¦åº¦ã«åæ˜ 
				happiness(x,y,z) = (int(((double(land_price(x,y,z))/200)*100)*0.50) - int((double(crime_rate(x,y,z)/50)*0.30)) + int(((double(education_rate(x,y,z))/60)*100)*0.20)) - int((double(noise(x,y,z))*0.20))

				y++
			loop
			x++

			await 1
		loop

		; ãƒã‚¦ã‚¹åº§æ¨™ã«ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã‚’è¡¨ç¤º
		mx_position = (mx+1) * CHIP_SIZE/2 - (my+1) * CHIP_SIZE/2 - camx
		my_position = (my+1) * CHIP_SIZE/4 + (mx+1) * CHIP_SIZE/4 - camy

		if cursor_mode = "delete" : cursor_icon = 18 : else : cursor_icon = 17

		color 0, 0, 0 : gmode 4, CHIP_SIZE, CHIP_SIZE/2, 128
		pos mx_position, my_position : gcopy cursor_icon, 0, 0, CHIP_SIZE, CHIP_SIZE/2

		; å»ºè¨­ã—ã‚ˆã?¨ã—ã¦ã?‚‹å»ºç‰©ã®å‘ãã‚’çŸ¢å°ã§è¡¨ç¤º??‘ãã‚’æ“ä½?
		if selected_addon_number >= 0 and (cursor_mode = "put_Residential" or cursor_mode = "put_Commercial" or cursor_mode = "put_Office" or cursor_mode = "put_Industrial" or cursor_mode = "put_Farm" or cursor_mode = "put_Public" or cursor_mode = "put_Park" or cursor_mode = "put_Airport") {
			; ã‚¹ãƒšã?ã‚¹ã‚­ãƒ¼ã§å‘ãã‚’å¤‰ãˆã‚?
			onkey gosub *main_onkey

			prebuilding = 1
			gosub *prebuild

			gmode 2
			if build_direction_number = 0 {
				if street_corner_addon = 0 {
					pos mx_position-32,my_position-48 : gcopy 77, 0, 0, 64, 64
				} else {
					pos mx_position,my_position-64 : gcopy 77, 0, 128, 64, 64
				}
			}
			if build_direction_number = 1 {
				if street_corner_addon = 0 {
					pos mx_position+32,my_position-48 : gcopy 77, 64, 0, 64, 64
				} else {
					pos mx_position+64,my_position-32 : gcopy 77, 64, 128, 64, 64
				}
			}
			if build_direction_number = 2 {
				if street_corner_addon = 0 {
					pos mx_position-32,my_position-16 : gcopy 77, 0, 64, 64, 64
				} else {
					pos mx_position-64,my_position-32 : gcopy 77, 0, 128+64, 64, 64
				}
			}
			if build_direction_number = 3 {
				if street_corner_addon = 0 {
					pos mx_position+32,my_position-16 : gcopy 77, 64, 64, 64, 64
				} else {
					pos mx_position,my_position : gcopy 77, 64, 128+64, 64, 64
				}
			}
		} else {
			change_direction = 0
			onkey 0
		}

		; å¤©å€™ã?å¤‰å‹•
		gosub *climate

		; å?¨®ãƒœã‚¿ãƒ³è¡¨ç¤º
		color 0, 0, 0 : sboxf 200, 0, windowy-70-titlebar_h, windowx, windowy

			; ä½•ã‚‰ã‹ã?ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé–‹ã‹ã‚Œã¦ã?‚‹å ´åˆã?ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®èƒŒæ™¯è‰²ã‚’è¡¨ç¤º
			if cursor_mode != "normal" and cursor_mode != "delete" {
				color 0, 162, 232 : sboxf 200, 0, windowy-70-titlebar_h-32-40, windowx, windowy-70-titlebar_h
			}

			gmode 2

			; æ¨™æº–ã‚«ãƒ¼ã‚½ãƒ«ãƒœã‚¿ãƒ³
			if cursor_mode = "normal" {
				pos 20, windowy-70-titlebar_h : gcopy 3, 0, 32, 32, 32
			} else {
				pos 20, windowy-70-titlebar_h : gcopy 3, 0, 0, 32, 32
			}

			; é“è·¯ãƒœã‚¿ãƒ³
			if cursor_mode = "put_Road" {
				pos 60, windowy-70-titlebar_h : gcopy 4, 0, 32, 32, 32
			} else {
				pos 60, windowy-70-titlebar_h : gcopy 4, 0, 0, 32, 32
			}

			; ç·šè·¯ãƒœã‚¿ãƒ³
			if cursor_mode = "put_Railroad" {
				pos 92, windowy-70-titlebar_h : gcopy 50, 0, 32, 32, 32
			} else {
				pos 92, windowy-70-titlebar_h : gcopy 50, 0, 0, 32, 32
			}

			; å»ºç‰©?ˆä½å±?œ°åŒº?‰ã?ã‚¿ãƒ³
			if cursor_mode = "put_Residential" {
				pos 124, windowy-70-titlebar_h : gcopy 5, 0, 32, 32, 32
			} else {
				pos 124, windowy-70-titlebar_h : gcopy 5, 0, 0, 32, 32
			}

			; å»ºç‰©?ˆå•†æ¥­åœ°åŒº?‰ã?ã‚¿ãƒ³
			if cursor_mode = "put_Commercial" {
				pos 156, windowy-70-titlebar_h : gcopy 12, 0, 32, 32, 32
			} else {
				pos 156, windowy-70-titlebar_h : gcopy 12, 0, 0, 32, 32
			}

			; å»ºç‰©?ˆã‚ªãƒ•ã‚£ã‚¹?‰ã?ã‚¿ãƒ³
			if cursor_mode = "put_Office" {
				pos 188, windowy-70-titlebar_h : gcopy 6, 0, 32, 32, 32
			} else {
				pos 188, windowy-70-titlebar_h : gcopy 6, 0, 0, 32, 32
			}

			; å»ºç‰©?ˆå·¥æ¥­åœ°åŒº?‰ã?ã‚¿ãƒ³
			if cursor_mode = "put_Industrial" {
				pos 220, windowy-70-titlebar_h : gcopy 19, 0, 32, 32, 32
			} else {
				pos 220, windowy-70-titlebar_h : gcopy 19, 0, 0, 32, 32
			}

			; å»ºç‰©?ˆè¾²æ¥­åœ°åŒº?‰ã?ã‚¿ãƒ³
			if cursor_mode = "put_Farm" {
				pos 252, windowy-70-titlebar_h : gcopy 57, 0, 32, 32, 32
			} else {
				pos 252, windowy-70-titlebar_h : gcopy 57, 0, 0, 32, 32
			}

			; å»ºç‰©?ˆå?å…±æ–½è¨­?‰ã?ã‚¿ãƒ³
			if cursor_mode = "put_Public" {
				pos 284, windowy-70-titlebar_h : gcopy 7, 0, 32, 32, 32
			} else {
				pos 284, windowy-70-titlebar_h : gcopy 7, 0, 0, 32, 32
			}

			; å…¬åœ’ã?ã‚¿ãƒ³
			if cursor_mode = "put_Park" {
				pos 316, windowy-70-titlebar_h : gcopy 29, 0, 32, 32, 32
			} else {
				pos 316, windowy-70-titlebar_h : gcopy 29, 0, 0, 32, 32
			}

			; æ°´è·¯ãƒœã‚¿ãƒ³
			if cursor_mode = "put_Waterway" {
				pos 348, windowy-70-titlebar_h : gcopy 76, 0, 32, 32, 32
			} else {
				pos 348, windowy-70-titlebar_h : gcopy 76, 0, 0, 32, 32
			}

			; ç©ºæ¸¯ãƒœã‚¿ãƒ³
			if cursor_mode = "put_Airport" {
				pos 380, windowy-70-titlebar_h : gcopy 79, 0, 32, 32, 32
			} else {
				pos 380, windowy-70-titlebar_h : gcopy 79, 0, 0, 32, 32
			}

			; ã‚¿ã‚¤ãƒ«ãƒœã‚¿ãƒ³
			if cursor_mode = "put_Tile" {
				pos 412, windowy-70-titlebar_h : gcopy 80, 0, 32, 32, 32
			} else {
				pos 412, windowy-70-titlebar_h : gcopy 80, 0, 0, 32, 32
			}

			; æƒ??±ãƒœã‚¿ãƒ³
			pos windowx-54-64, windowy-70-titlebar_h : gcopy 52, 0, 0, 32, 32

			; äºˆç®—ã?ã‚¿ãƒ³
			pos windowx-54-64, windowy-40-titlebar_h : gcopy 49, 0, 0, 32, 32

			; æ’¤å»ãƒœã‚¿ãƒ³
			if cursor_mode = "delete" {
				pos windowx-54, windowy-70-titlebar_h : gcopy 10, 0, 32, 32, 32
			} else {
				pos windowx-54, windowy-70-titlebar_h : gcopy 10, 0, 0, 32, 32
			}

			; è¨­å®šã?ã‚¿ãƒ³
			pos windowx-54-32, windowy-40-titlebar_h : gcopy 13, 0, 0, 32, 32

			; ä¿å­˜ã?ã‚¿ãƒ³
			pos windowx-54, windowy-40-titlebar_h : gcopy 11, 0, 0, 32, 32

			; çµ±è¨ˆã?ã‚¿ãƒ³
			pos windowx-54-32, windowy-70-titlebar_h : gcopy 30, 0, 0, 32, 32

			; çµ±è¨ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼??oepn_stat_menu = 1ã®ã¨ãï¼?
			if open_stat_menu = 1 {
				sboxf 128, windowx-112-32-1, windowy-70-titlebar_h-20-1, windowx-112-32-1+(20*6)+1, windowy-70-titlebar_h
				gmode 2
				if stat_mode = "type" {
					pos windowx-112-32, windowy-70-titlebar_h-20 : gcopy 31, 0, 20, 20, 20
				} else {
					pos windowx-112-32, windowy-70-titlebar_h-20 : gcopy 31, 0, 0, 20, 20
				}
				if stat_mode = "land_price" {
					pos windowx-112-32+20, windowy-70-titlebar_h-20 : gcopy 32, 0, 20, 20, 20
				} else {
					pos windowx-112-32+20, windowy-70-titlebar_h-20 : gcopy 32, 0, 0, 20, 20
				}
				if stat_mode = "crime_rate" {
					pos windowx-112-32+40, windowy-70-titlebar_h-20 : gcopy 33, 0, 20, 20, 20
				} else {
					pos windowx-112-32+40, windowy-70-titlebar_h-20 : gcopy 33, 0, 0, 20, 20
				}
				if stat_mode = "education_rate" {
					pos windowx-112-32+60, windowy-70-titlebar_h-20 : gcopy 47, 0, 20, 20, 20
				} else {
					pos windowx-112-32+60, windowy-70-titlebar_h-20 : gcopy 47, 0, 0, 20, 20
				}
				if stat_mode = "happiness" {
					pos windowx-112-32+80, windowy-70-titlebar_h-20 : gcopy 51, 0, 20, 20, 20
				} else {
					pos windowx-112-32+80, windowy-70-titlebar_h-20 : gcopy 51, 0, 0, 20, 20
				}
				if stat_mode = "noise" {
					pos windowx-112-32+100, windowy-70-titlebar_h-20 : gcopy 81, 0, 20, 20, 20
				} else {
					pos windowx-112-32+100, windowy-70-titlebar_h-20 : gcopy 81, 0, 0, 20, 20
				}
			}

			; é€Ÿã•
			gmode 2
			pos 20, windowy-45-titlebar_h+10
			if speed = 1 : gcopy 73, 0, 0, 32, 32	; é?„
			if speed = 2 : gcopy 68, 0, 0, 32, 32	; æ™®é€?
			if speed = 3 : gcopy 69, 0, 0, 32, 32	; æ—©ã?
			if speed = 4 : gcopy 74, 0, 0, 32, 32	; ã¨ã¦ã‚‚æ—©ã?

			pos 52, windowy-45-titlebar_h+10
			if pause = 1 : gcopy 70, 0, 32, 32, 32 : else : gcopy 70, 0, 0, 32, 32		; ä¸€æ™‚åœæ­¢ãƒœã‚¿ãƒ³

			; äººå£ã€æ—¥ä»˜ã?æ°—æ¸©ã‚’è¡¨ç¤º
			color 255, 255, 255 : font config_SystemFont, 11
			pos 90, windowy-45-titlebar_h+10 : mes ""+map_time_Year+"å¹´"+map_time_Month+"æœ?"+map_time_Date+"æ—¥ "+strf("%02d",map_time_Hour)+":"+strf("%02d",map_time_Minutes)+"   äººå£ "+map_Total_Population+"äºº   Â§ "+map_Money+"   æ°—æ¸© "+map_temperature+"â„?"

			color 255, 255, 255 : font "Yu Gothic UI", 10
			pos 90, windowy-30-titlebar_h+10 : mes "News : "+news_content+""

			; RCOIéœ€è¦ãƒ¡ãƒ¼ã‚¿
			if map_demand_Residential < 0 : map_demand_Residential = 1
			if map_demand_Commercial < 0  : map_demand_Commercial = 1
			if map_demand_Office < 0      : map_demand_Office = 1
			if map_demand_Industrial < 0  : map_demand_Industrial = 1
			if map_demand_Farm < 0        : map_demand_Farm = 1

			font config_SystemFont, 10
				; R - ä½å±?Œºç”»
				color 34, 177, 76 : boxf windowx-180, windowy-titlebar_h-20-(map_demand_Residential/3), windowx-180+10, windowy-titlebar_h-20
				cmes "R", windowx-180, windowy-titlebar_h-20, windowx-180+10, windowy-titlebar_h-10, 1
				; C - å•?¥­åŒºç”»
				color 63, 72, 204 : boxf windowx-170, windowy-titlebar_h-20-(map_demand_Commercial/3), windowx-170+10, windowy-titlebar_h-20
				cmes "C", windowx-170, windowy-titlebar_h-20, windowx-170+10, windowy-titlebar_h-10, 1
				; O - ã‚ªãƒ•ã‚£ã‚¹åŒºç”»
				color 0, 162, 232 : boxf windowx-160, windowy-titlebar_h-20-(map_demand_Office/3), windowx-160+10, windowy-titlebar_h-20
				cmes "O", windowx-160, windowy-titlebar_h-20, windowx-160+10, windowy-titlebar_h-10, 1
				; I - å·¥æ¥­åŒºç”»
				color 255, 242, 0 : boxf windowx-150, windowy-titlebar_h-20-(map_demand_Industrial/3), windowx-150+10, windowy-titlebar_h-20
				cmes "I", windowx-150, windowy-titlebar_h-20, windowx-150+10, windowy-titlebar_h-10, 1
				; F - è¾²æ¥­åŒºç”»
				color 185, 122, 87 : boxf windowx-140, windowy-titlebar_h-20-(map_demand_Farm/3), windowx-140+10, windowy-titlebar_h-20
				cmes "F", windowx-140, windowy-titlebar_h-20, windowx-140+10, windowy-titlebar_h-10, 1

		if ginfo(2) = 0 {
			; å·¦ã‚¯ãƒªãƒ?‚¯ã•ã‚Œã¦ã‚‹ãªã‚?*main_mouse_left_clickingã¸??*main_onclickã¨ã¯åˆ¥ã§ã€æŠ¼ã—ç¶šã‘ã¦ã?‚‹ã¨ãã?å‡¦ç?¼?
			getkey mouse_left, 1
				; å·¦ã‚¯ãƒªãƒ?‚¯ãŒé›¢ã•ã‚ŒãŸã¨ãã?å‡¦ç?
					if mouse_left = 0 and before_mouse_left_clicking = 1 : gosub *main_mouse_left_release

			if mouse_left = 1 : gosub *main_mouse_left_clicking

			; ã‚¯ãƒªãƒ?‚¯ã•ã‚ŒãŸã‚‰*main_onclickã¸??*main_mouse_left_clickingã¨ã¯åˆ¥ã§ã€ä¸€ç¬ã?ã‘æŠ¼ã•ã‚ŒãŸã¨ãã?å‡¦ç?¼?
			onclick gosub *main_onclick
		}

		; æ™‚é–“ã®å¤‰å‹•
			; Speed=2ã®ã¨ãã€?1å›ã?ãƒ«ãƒ¼ãƒ—ã§1åˆ?¨ã™ã‚‹
			if pause = 0 {
				if speed = 1 {
					if cnt \ 4 = 0 : map_time_Minutes += 1
				} else {
					map_time_Minutes += speed - 1
				}
			}

			; map_time_Minutes=60ã§1æ™‚é–“ã¨ã™ã‚‹
			if map_time_Minutes > 59 {
				map_time_Minutes = 0
				map_time_Hour ++
			}

			; map_time_Hour=24ã§1æ—¥ã¨ã™ã‚‹
			if map_time_Hour= 24 {
				map_time_Date ++
				map_time_Hour = 0 : map_time_Minutes = 0

				if map_time_Date > 28 and map_time_Month = 2 and map_time_Year\4 != 0 {
					map_time_Date = 1
					map_time_Month ++
				}
				if map_time_Date > 29 and map_time_Month = 2 and map_time_Year\4 = 0 {
					map_time_Date = 1
					map_time_Month ++
				}
				if map_time_Date > 30 and (map_time_Month = 4 or map_time_Month = 6 or map_time_Month = 9 or map_time_Month = 11) {
					map_time_Date = 1
					map_time_Month ++
				}
				if map_time_Date > 31 and (map_time_Month = 1 or map_time_Month = 3 or map_time_Month = 5 or map_time_Month = 7 or map_time_Month = 8 or map_time_Month = 10 or map_time_Month = 12) {
					map_time_Date = 1
					map_time_Month ++
				}
				if map_time_Month > 12 {
					map_time_Year ++
					map_time_Month = 1
					map_time_Date = 1
				}
			}

		; ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®è¡¨ç¤º??0æ™?0åˆ?€?6æ™?0åˆ?€?12æ™?0åˆ?€?18æ™?0åˆ? ã‚ã‚‹ã?? ãƒãƒƒãƒ—èª­ã¿è¾¼ã¿ç›´å¾Œã«æ–°ã—ã„ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’å–å¾—ï¼?
		if (map_time_Hour = 0 and map_time_Minutes = 0) or (map_time_Hour = 6 and map_time_Minutes = 0) or (map_time_Hour = 12 and map_time_Minutes = 0) or (map_time_Hour = 18 and map_time_Minutes = 0) or cnt = 0 {
			gosub *get_news
		}

		; BGMã®å†ç”Ÿ
		; ç¾åœ¨å†ç”Ÿã—ã¦ã?‚‹BGMã®ç¾åœ¨ã®å†ç”Ÿä½ç½®ã¨æ›²ã®é•·ã•ã‚’å–å¾?
		if cnt \ 10 = 0 {
			mci"status Cities-Box position" : BGM_Position = stat		; ç¾åœ¨ã®å†ç”Ÿä½ç½®
			mci "status Cities-Box length"  : BGM_Length = stat			; æ›²ã®é•·ã?

			; ç¾åœ¨ã®å†ç”Ÿä½ç½®ã¨æ›²ã®é•·ã•ãŒåŒã˜ãªã‚‰æ¬¡ã®æ›²ã‚’é¸æ›²
			if BGM_Position = BGM_Length : gosub *play_BGM

			; BGMã®å†ç”ŸãŒç„¡åŠ¹ãªã‚‰éŸ³é‡?0ã«ã™ã‚‹
			if config_Set_Play_BGM = 0 : mci "setaudio Cities-Box volume to 0" : else : mci "setaudio Cities-Box volume to 1000"
		}

		; ã‚¿ã‚¤ãƒ«ã®è©³ç´°ã‚’è¡¨ç¤ºã—ã¦ã?‚‹å ´å?
		if showing_detail = 1 : gosub *show_detail

		; ã‚¢ãƒ‰ã‚ªãƒ³é¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé–‹ã‹ã‚Œã¦ã?‚‹ãªã‚?*addon_select_menuã¸
		if cursor_mode != "normal" and cursor_mode != "delete" : gosub *addon_select_menu

		; ãƒœã‚¿ãƒ³ã®èª¬æ˜ã?è¡¨ç¤º
		gosub *main_drow_summary

		; ç¾åœ¨ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºã‚’å–å¾?
		windowx = ginfo_sizex
		windowy = ginfo_sizey

		; ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å·¦æ?ã®æ¨ªå¹?¨ã‚¿ã‚¤ãƒˆãƒ«ãƒã?ã®é«˜ã•ã‚’å–å¾?
		dim rc, 2 : rc(0) = 0 : rc(1) = 0
		ClientToScreen hwnd, varptr(rc)
		window_left_breadth = rc(0) - ginfo_wx1
		titlebar_h = rc(1) - ginfo_wy1

		; ä¸€æ—¥ã®æœ€åˆã?å‡¦ç?
		if map_time_Hour = 0 and map_time_Minutes = 0 : gosub *processing_start_of_day

		redraw 1

		await config_Drow_Interval
	loop

*main_drow_summary
	/*---------------------------------å?¨®ãƒœã‚¿ãƒ³ã®èª¬æ˜ã?è¡¨ç¤º-------------------------------------*/
	font config_SystemFont, 10

	; é€šå¸¸ã®ã‚«ãƒ¼ã‚½ãƒ«
	if click_range(20, windowy-70-titlebar_h, 20+32, windowy-70-titlebar_h+32) = 1 {
		color 255, 255, 255 : sboxf 128, 20, windowy-70-titlebar_h-18, 20+60, windowy-70-titlebar_h
		color 0, 0, 0 : pos 20+2, windowy-70-titlebar_h-18+2 : mes "ã‚«ãƒ¼ã‚½ãƒ«"
	}

	; é“è·¯
	if click_range(0, windowy-70-titlebar_h-2-32, 0+16, windowy-70-titlebar_h-2-32+16) = 1 and cursor_mode = "put_Road" {
		color 255, 255, 255 : sboxf 200, 0, windowy-70-titlebar_h-2-32-18, 16+40, windowy-70-titlebar_h-2-32
		color 0, 0, 0 : pos 0+2, windowy-70-titlebar_h-2-32-18+2 : mes "è»Šé“"
	}
	if click_range(0, windowy-70-titlebar_h-2-16, 0+16, windowy-70-titlebar_h-2-16+16) = 1 and cursor_mode = "put_Road" {
		color 255, 255, 255 : sboxf 200, 0, windowy-70-titlebar_h-2-16-18, 16+40, windowy-70-titlebar_h-2-16
		color 0, 0, 0 : pos 0+2, windowy-70-titlebar_h-2-16-18+2 : mes "æ­©é?"
	}
	if click_range(60, windowy-70-titlebar_h, 60+32, windowy-70-titlebar_h+32) = 1 {
		color 255, 255, 255 : sboxf 128, 60, windowy-70-titlebar_h-18, 60+50, windowy-70-titlebar_h
		color 0, 0, 0 : pos 60+2, windowy-70-titlebar_h-18+2 : mes "é“è·¯ãƒ»æ­©é?"
	}

	; ç·šè·¯
	if click_range(92, windowy-70-titlebar_h, 92+32, windowy-70-titlebar_h+32) = 1 {
		color 255, 255, 255 : sboxf 128, 92, windowy-70-titlebar_h-18, 92+50, windowy-70-titlebar_h
		color 0, 0, 0 : pos 92+2, windowy-70-titlebar_h-18+2 : mes "ç·šè·¯ãƒ»é§?"
	}

	; ä½å±?
	if click_range(0, windowy-70-titlebar_h-2-32, 0+16, windowy-70-titlebar_h-2-32+16) = 1 and cursor_mode = "put_Residential" {
		color 255, 255, 255 : sboxf 200, 0, windowy-70-titlebar_h-2-32-18, 16+40, windowy-70-titlebar_h-2-32
		color 0, 0, 0 : pos 0+2, windowy-70-titlebar_h-2-32-18+2 : mes "ä½å¯?º¦"
	}
	if click_range(0, windowy-70-titlebar_h-2-16, 0+16, windowy-70-titlebar_h-2-16+16) = 1 and cursor_mode = "put_Residential" {
		color 255, 255, 255 : sboxf 200, 0, windowy-70-titlebar_h-2-16-18, 16+40, windowy-70-titlebar_h-2-16
		color 0, 0, 0 : pos 0+2, windowy-70-titlebar_h-2-16-18+2 : mes "é«˜å¯?º¦"
	}
	if click_range(124, windowy-70-titlebar_h, 124+32, windowy-70-titlebar_h+32) = 1 {
		color 255, 255, 255 : sboxf 128, 124, windowy-70-titlebar_h-18, 124+50, windowy-70-titlebar_h
		color 0, 0, 0 : pos 124+2, windowy-70-titlebar_h-18+2 : mes "ä½å±?Œºç”»"
	}

	; å•?¥­
	if click_range(0, windowy-70-titlebar_h-2-32, 0+16, windowy-70-titlebar_h-2-32+16) = 1 and cursor_mode = "put_Commercial" {
		color 255, 255, 255 : sboxf 200, 0, windowy-70-titlebar_h-2-32-18, 16+40, windowy-70-titlebar_h-2-32
		color 0, 0, 0 : pos 0+2, windowy-70-titlebar_h-2-32-18+2 : mes "ä½å¯?º¦"
	}
	if click_range(0, windowy-70-titlebar_h-2-16, 0+16, windowy-70-titlebar_h-2-16+16) = 1 and cursor_mode = "put_Commercial" {
		color 255, 255, 255 : sboxf 200, 0, windowy-70-titlebar_h-2-16-18, 16+40, windowy-70-titlebar_h-2-16
		color 0, 0, 0 : pos 0+2, windowy-70-titlebar_h-2-16-18+2 : mes "é«˜å¯?º¦"
	}
	if click_range(156, windowy-70-titlebar_h, 156+32, windowy-70-titlebar_h+32) = 1 {
		color 255, 255, 255 : sboxf 128, 156, windowy-70-titlebar_h-18, 156+50, windowy-70-titlebar_h
		color 0, 0, 0 : pos 156+2, windowy-70-titlebar_h-18+2 : mes "å•?¥­åŒºç”»"
	}

	; ã‚ªãƒ•ã‚£ã‚¹
	if click_range(188, windowy-70-titlebar_h, 188+32, windowy-70-titlebar_h+32) = 1 {
		color 255, 255, 255 : sboxf 128, 188, windowy-70-titlebar_h-18, 188+60, windowy-70-titlebar_h
		color 0, 0, 0 : pos 188+2, windowy-70-titlebar_h-18+2 : mes "ã‚ªãƒ•ã‚£ã‚¹åŒºç”»"
	}

	; å·¥æ¥­
	if click_range(220, windowy-70-titlebar_h, 220+32, windowy-70-titlebar_h+32) = 1 {
		color 255, 255, 255 : sboxf 128, 220, windowy-70-titlebar_h-18, 220+50, windowy-70-titlebar_h
		color 0, 0, 0 : pos 220+2, windowy-70-titlebar_h-18+2 : mes "å·¥æ¥­åŒºç”»"
	}

	; è¾²æ¥­
	if click_range(252, windowy-70-titlebar_h, 252+32, windowy-70-titlebar_h+32) = 1 {
		color 255, 255, 255 : sboxf 128, 252, windowy-70-titlebar_h-18, 252+50, windowy-70-titlebar_h
		color 0, 0, 0 : pos 252+2, windowy-70-titlebar_h-18+2 : mes "è¾²æ¥­åŒºç”»"
	}

	; å…¬å…±æ–½è¨­
	if click_range(284, windowy-70-titlebar_h, 284+32, windowy-70-titlebar_h+32) = 1 {
		color 255, 255, 255 : sboxf 128, 284, windowy-70-titlebar_h-18, 284+50, windowy-70-titlebar_h
		color 0, 0, 0 : pos 284+2, windowy-70-titlebar_h-18+2 : mes "å…¬å…±æ–½è¨­"
	}

	; å…¬åœ?
	if click_range(316, windowy-70-titlebar_h, 316+32, windowy-70-titlebar_h+32) = 1 {
		color 255, 255, 255 : sboxf 128, 316, windowy-70-titlebar_h-18, 316+50, windowy-70-titlebar_h
		color 0, 0, 0 : pos 316+2, windowy-70-titlebar_h-18+2 : mes "å…¬åœ?"
	}

	; æ°´è·¯
	if click_range(348, windowy-70-titlebar_h, 348+32, windowy-70-titlebar_h+32) = 1 {
		color 255, 255, 255 : sboxf 128, 348, windowy-70-titlebar_h-18, 348+50, windowy-70-titlebar_h
		color 0, 0, 0 : pos 348+2, windowy-70-titlebar_h-18+2 : mes "æ°´è·¯"
	}

	; ç©ºæ¸¯
	if click_range(380, windowy-70-titlebar_h, 380+32, windowy-70-titlebar_h+32) = 1 {
		color 255, 255, 255 : sboxf 128, 380, windowy-70-titlebar_h-18, 380+50, windowy-70-titlebar_h
		color 0, 0, 0 : pos 380+2, windowy-70-titlebar_h-18+2 : mes "ç©ºæ¸¯"
	}

	; ç©ºæ¸¯
	if click_range(412, windowy-70-titlebar_h, 412+32, windowy-70-titlebar_h+32) = 1 {
		color 255, 255, 255 : sboxf 128, 412, windowy-70-titlebar_h-18, 412+50, windowy-70-titlebar_h
		color 0, 0, 0 : pos 412+2, windowy-70-titlebar_h-18+2 : mes "ã‚¿ã‚¤ãƒ«"
	}

	; æƒ??±
	if click_range(windowx-54-64, windowy-70-titlebar_h, windowx-54-64+32, windowy-70-titlebar_h+32) = 1 {
		color 255, 255, 255 : sboxf 128, windowx-54-64, windowy-70-titlebar_h-18, windowx-54-64+50, windowy-70-titlebar_h
		color 0, 0, 0 : pos windowx-54-64+2, windowy-70-titlebar_h-18+2 : mes "æƒ??±"
	}

	; äºˆç®?
	if click_range(windowx-54-64, windowy-40-titlebar_h, windowx-54-64+32, windowy-40-titlebar_h+32) = 1 {
		color 255, 255, 255 : sboxf 200, windowx-54-64, windowy-40-titlebar_h-18, windowx-54-64+50, windowy-40-titlebar_h
		color 0, 0, 0
		pos windowx-54-64+2, windowy-40-titlebar_h-18+2 : mes "äºˆç®?"
	}

	; æ’¤å»
	if click_range(windowx-54, windowy-70-titlebar_h, windowx-54+32, windowy-70-titlebar_h+32) = 1 {
		color 255, 255, 255 : sboxf 128, windowx-54, windowy-70-titlebar_h-18, windowx-54+50, windowy-70-titlebar_h
		color 0, 0, 0 : pos windowx-54+2, windowy-70-titlebar_h-18+2 : mes "æ’¤å»"
	}

	; è¨­å®?
	if click_range(windowx-54-32, windowy-40-titlebar_h, windowx-54-32+32, windowy-40-titlebar_h+32) = 1 {
		color 255, 255, 255 : sboxf 200, windowx-54-32, windowy-40-titlebar_h-18, windowx-54-32+50, windowy-40-titlebar_h
		color 0, 0, 0 : pos windowx-54-32+2, windowy-40-titlebar_h-18+2 : mes "è¨­å®?"
	}

	; ä¿å­?
	if click_range(windowx-54, windowy-40-titlebar_h, windowx-54+32, windowy-40-titlebar_h+32) = 1 {
		color 255, 255, 255 : sboxf 200, windowx-54, windowy-40-titlebar_h-18, windowx-54+50, windowy-40-titlebar_h
		color 0, 0, 0 : pos windowx-54+2, windowy-40-titlebar_h-18+2 : mes "ä¿å­?"
	}

	; çµ±è¨?
	if click_range(windowx-54-32, windowy-70-titlebar_h, windowx-54-32+32, windowy-70-titlebar_h+32) = 1 {
		color 255, 255, 255 : sboxf 128, windowx-32-54, windowy-70-titlebar_h-18, windowx-32-54+50, windowy-70-titlebar_h
		color 0, 0, 0 : pos windowx-32-54+2, windowy-70-titlebar_h-18+2 : mes "çµ±è¨?"
	}

	; çµ±è¨ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼
	if open_stat_menu = 1 {
		if click_range(windowx-112-32, windowy-70-titlebar_h-20, windowx-112-32+20, windowy-70-titlebar_h-20+20) = 1 {
			color 255, 255, 255 : sboxf 128, windowx-112-32, windowy-70-titlebar_h-20-18, windowx-112-32+50, windowy-70-titlebar_h-20
			color 0, 0, 0 : pos windowx-112-32+2, windowy-70-titlebar_h-20-18+2 : mes "ç¨®é¡?"
		}
		if click_range(windowx-112-32+20, windowy-70-titlebar_h-20, windowx-112-32+20+20, windowy-70-titlebar_h-20+20) = 1 {
			color 255, 255, 255 : sboxf 128, windowx-112-32+20, windowy-70-titlebar_h-20-18, windowx-112-32+20+50, windowy-70-titlebar_h-20
			color 0, 0, 0 : pos windowx-112-32+20+2, windowy-70-titlebar_h-20-18+2 : mes "åœ°ä¾¡"
		}
		if click_range(windowx-112-32+40, windowy-70-titlebar_h-20, windowx-112-32+40+20, windowy-70-titlebar_h-20+20) = 1 {
			color 255, 255, 255 : sboxf 128, windowx-112-32+40, windowy-70-titlebar_h-20-18, windowx-112-32+40+50, windowy-70-titlebar_h-20
			color 0, 0, 0 : pos windowx-112-32+40+2, windowy-70-titlebar_h-20-18+2 : mes "çŠ¯ç½ªç?"
		}
		if click_range(windowx-112-32+60, windowy-70-titlebar_h-20, windowx-112-32+60+20, windowy-70-titlebar_h-20+20) = 1 {
			color 255, 255, 255 : sboxf 128, windowx-112-32+60, windowy-70-titlebar_h-20-18, windowx-112-32+60+50, windowy-70-titlebar_h-20
			color 0, 0, 0 : pos windowx-112-32+60+2, windowy-70-titlebar_h-20-18+2 : mes "æ•™è‚²åº¦"
		}
		if click_range(windowx-112-32+80, windowy-70-titlebar_h-20, windowx-112-32+80+20, windowy-70-titlebar_h-20+20) = 1 {
			color 255, 255, 255 : sboxf 128, windowx-112-32+80, windowy-70-titlebar_h-20-18, windowx-112-32+80+50, windowy-70-titlebar_h-20
			color 0, 0, 0 : pos windowx-112-32+80+2, windowy-70-titlebar_h-20-18+2 : mes "å¹¸ç¦åº¦"
		}
		if click_range(windowx-112-32+100, windowy-70-titlebar_h-20, windowx-112-32+100+20, windowy-70-titlebar_h-20+20) = 1 {
			color 255, 255, 255 : sboxf 128, windowx-112-32+80, windowy-70-titlebar_h-20-18, windowx-112-32+80+50, windowy-70-titlebar_h-20
			color 0, 0, 0 : pos windowx-112-32+100+2, windowy-70-titlebar_h-20-18+2 : mes "é¨’éŸ³"
		}
	}

	; æ—©ã? / ä¸€æ™‚åœæ­¢
	if click_range(20, windowy-45-titlebar_h+10, 20+32, windowy-45-titlebar_h+10+32) = 1 {
		color 255, 255, 255 : sboxf 200, 20, windowy-45-titlebar_h+10-18, 20+50, windowy-45-titlebar_h+10
		color 0, 0, 0 : pos 20+2, windowy-45-titlebar_h+10-18+2 : mes "æ™‚é–“ã®æ—©ã?"
	}
	if click_range(52, windowy-45-titlebar_h+10, 52+32, windowy-45-titlebar_h+10+32) = 1 {
		color 255, 255, 255 : sboxf 200, 52, windowy-45-titlebar_h+10-18, 52+50, windowy-45-titlebar_h+10
		color 0, 0, 0 : pos 52+2, windowy-45-titlebar_h+10-18+2 : mes "ä¸€æ™‚åœæ­¢"
	}

	; é«˜å¯?º¦/ä½å¯?º¦ãªã©ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã‚¿ã‚¤ãƒ—ã?è¡¨ç¤º
	if cursor_mode != "normal" and cursor_mode != "delete" and addon_menu_categories > 1 {
		if click_range(0, windowy-70-titlebar_h-2-32, 0+16, windowy-70-titlebar_h-2-32+16) = 1 {
			color 255, 255, 255 : sboxf 128, 0, windowy-70-titlebar_h-2-32-18, 16+40, windowy-70-titlebar_h-2-32
			color 0, 0, 0 : pos 0+2, windowy-70-titlebar_h-2-32-18+2
			if addon_menu_categories_name(0) = "low" : mes "ä½å¯?º¦" : else : mes "è»Šé“"
		}
		if click_range(0, windowy-70-titlebar_h-2-16, 0+16, windowy-70-titlebar_h-2-16+16) = 1 {
			color 255, 255, 255 : sboxf 128, 0, windowy-70-titlebar_h-2-16-18, 16+40, windowy-70-titlebar_h-2-16
			color 0, 0, 0 : pos 0+2, windowy-70-titlebar_h-2-16-18+2
			if addon_menu_categories_name(1) = "high" : mes "é«˜å¯?º¦" : else : mes "æ­©é?"
		}
	}

	; å»ºç‰©åå¤‰æ›´ã®èª¬æ˜è¡¨ç¤º
	if showing_detail = 1 and click_range( show_detail_position_x+32+15+diax+25-20, show_detail_position_y-100-(diay1+5+diay2+5), show_detail_position_x+32+15+diax+25, show_detail_position_y-100-(diay1+5+diay2+5)+20 ) = 1 {
		color 255, 255, 255 : sboxf 200, show_detail_position_x+32+15+diax+25+3, show_detail_position_y-100-(diay1+5+diay2+5)-2, show_detail_position_x+32+15+diax+25+80, show_detail_position_y-100-(diay1+5+diay2+5)+17
		color 0, 0, 0 : pos show_detail_position_x+32+15+diax+25+5, show_detail_position_y-100-(diay1+5+diay2+5) : mes "å»ºç‰©åã‚’å¤‰æ›´"
	}

	return

*main_mouse_left_clicking
	/*-------------------------ç”»é¢ä¸Šã§å·¦ã‚¯ãƒªãƒ?‚¯ã•ã‚Œç¶šã‘ã¦ã?‚‹ã¨ãã?å‡¦ç?-------------------------*/
	; ã‚¢ãƒ‰ã‚ªãƒ³ã®è¨­ç½®??*build??
	if cursor_mode != "normal" and cursor_mode != "delete" and addon_menu_categories >= 1 {
		if click_range( 0, 0, windowx, windowy-70-titlebar_h-32 ) = 1 {
			gosub *build
		}
	}

	before_mouse_left_clicking = 1

	return

*main_mouse_left_release
	/*----------------------------ç”»é¢ä¸Šã§å·¦ã‚¯ãƒªãƒ?‚¯ã‹ã‚‰é›¢ã•ã‚ŒãŸã?å‡¦ç?----------------------------*/
	; ã‚¢ãƒ‰ã‚ªãƒ³ã®è»Šé“/ç·šè·¯/æ°´è·¯/æ»‘èµ°è·¯ãƒ»èª˜å°è·¯ã®ã‚¿ã‚¤ãƒ—ã¨å‘ãã‚’æŒ‡å®šï¼?*build_roadtypes??
	getkey is_mouse_left_pushing, 1
	if (cursor_mode = "put_Road" or cursor_mode = "put_Railroad" or cursor_mode = "put_Waterway" or cursor_mode = "put_Airport") and under_construction_tiles >= 1 and is_mouse_left_pushing = 0 {
		gosub *build_roadtypes
	}

	before_mouse_left_clicking = 0

	return

*main_onclick
	/*------------------------------ç”»é¢ä¸Šã§ã‚¯ãƒªãƒ?‚¯ã•ã‚ŒãŸã¨ãã?å‡¦ç?------------------------------*/
	; é€šå¸¸ã®ã‚«ãƒ¼ã‚½ãƒ«
	if click_range( 20, windowy-70-titlebar_h, 20+32, windowy-70-titlebar_h+32 ) = 1 {
		cursor_mode = "normal"
		addon_menu_categories = 0
		stat_mode = ""
	}

	; é“è·¯
	if click_range( 60, windowy-70-titlebar_h, 60+32, windowy-70-titlebar_h+32 ) = 1 {
		if cursor_mode != "put_Road" {
			category_mode = "roadway"
			addon_menu_categories = 2
			addon_menu_categories_name(0) = "roadway"   : addon_menu_categories_icon(0) = 66
			addon_menu_categories_name(1) = "promenade" : addon_menu_categories_icon(1) = 67
		}
		cursor_mode = "put_Road"
	}

	; ç·šè·¯
	if click_range( 92, windowy-70-titlebar_h, 92+32, windowy-70-titlebar_h+32 ) = 1 {
		cursor_mode = "put_Railroad"
		addon_menu_categories = 1
	}

	; ä½å±?
	if click_range( 124, windowy-70-titlebar_h, 124+32, windowy-70-titlebar_h+32 ) = 1 {
		if cursor_mode != "put_Residential" {
			category_mode = "low"
			addon_menu_categories = 2
			addon_menu_categories_name(0) = "low"  : addon_menu_categories_icon(0) = 8
			addon_menu_categories_name(1) = "high" : addon_menu_categories_icon(1) = 9
		}
		cursor_mode = "put_Residential"
	}

	; å•?¥­
	if click_range( 156, windowy-70-titlebar_h, 156+32, windowy-70-titlebar_h+32 ) = 1 {
		if cursor_mode != "put_Commercial" {
			category_mode = "low"
			addon_menu_categories = 2
			addon_menu_categories_name(0) = "low"  : addon_menu_categories_icon(0) = 20
			addon_menu_categories_name(1) = "high" : addon_menu_categories_icon(1) = 21
		}
		cursor_mode = "put_Commercial"
	}

	; ã‚ªãƒ•ã‚£ã‚¹
	if click_range( 188, windowy-70-titlebar_h, 188+32, windowy-70-titlebar_h+32 ) = 1 {
		cursor_mode = "put_Office"
		addon_menu_categories = 1
	}

	; å·¥æ¥­
	if click_range( 220, windowy-70-titlebar_h, 220+32, windowy-70-titlebar_h+32 ) = 1 {
		cursor_mode = "put_Industrial"
		addon_menu_categories = 1
	}

	; è¾²æ¥­
	if click_range( 252, windowy-70-titlebar_h, 252+32, windowy-70-titlebar_h+32 ) = 1 {
		cursor_mode = "put_Farm"
		addon_menu_categories = 1
	}

	; å…¬å…±æ–½è¨­
	if click_range( 284, windowy-70-titlebar_h, 284+32, windowy-70-titlebar_h+32 ) = 1 {
		cursor_mode = "put_Public"
		addon_menu_categories = 1
	}

	; å…¬åœ?
	if click_range( 316, windowy-70-titlebar_h, 316+32, windowy-70-titlebar_h+32 ) = 1 {
		cursor_mode = "put_Park"
		addon_menu_categories = 1
	}

	; æ°´è·¯
	if click_range( 348, windowy-70-titlebar_h, 348+32, windowy-70-titlebar_h+32 ) = 1 {
		cursor_mode = "put_Waterway"
		addon_menu_categories = 1
	}

	; ç©ºæ¸¯
	if click_range( 380, windowy-70-titlebar_h, 380+32, windowy-70-titlebar_h+32 ) = 1 {
		cursor_mode = "put_Airport"
		addon_menu_categories = 1
	}

	; ç©ºæ¸¯
	if click_range( 412, windowy-70-titlebar_h, 412+32, windowy-70-titlebar_h+32 ) = 1 {
		cursor_mode = "put_Tile"
		addon_menu_categories = 1
	}

	; æƒ??±ãƒ‘ãƒãƒ«
	if click_range( windowx-54-64, windowy-70-titlebar_h, windowx-54-32, windowy-70-titlebar_h+32 ) = 1 {
		gosub *information_panel
		addon_menu_categories = 0
		return
	}

	; äºˆç®—ãƒ‘ãƒãƒ«
	if click_range( windowx-54-64, windowy-40-titlebar_h, windowx-54-32, windowy-40-titlebar_h+32 ) = 1 {
		gosub *budget_panel
		addon_menu_categories = 0
		return
	}

	; çµ±è¨?
	if click_range( windowx-54-32, windowy-70-titlebar_h, windowx-54, windowy-70-titlebar_h+32 ) = 1 {
		if open_stat_menu = 0 {
			open_stat_menu = 1
			stat_mode = ""
		} else {
			open_stat_menu = 0
			stat_mode = ""
		}
		addon_menu_categories = 0
	}

	; æ’¤å»
	if click_range( windowx-54, windowy-70-titlebar_h, windowx-54+32, windowy-70-titlebar_h+32 ) = 1 {
		cursor_mode = "delete"
		addon_menu_categories = 0
		stat_mode = "type"
	}

	; è¨­å®?
	if click_range( windowx-54-32, windowy-40-titlebar_h, windowx-54, windowy-40-titlebar_h+32 ) = 1 {
		gosub *setting
		addon_menu_categories = 0
	}

	; ä¿å­?
	if click_range( windowx-54, windowy-40-titlebar_h, windowx-54+32, windowy-40-titlebar_h+32 ) = 1 {
		gosub *save
		addon_menu_categories = 0
	}

	; çµ±è¨ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼
	if open_stat_menu = 1 and click_range( windowx-112-32, windowy-70-titlebar_h-20, windowx-112-32+19, windowy-70-titlebar_h ) = 1 {
		if stat_mode != "type" {
			stat_mode = "type"
		} else {
			stat_mode = ""
		}
		return
	}
	if open_stat_menu = 1 and click_range( windowx-112-32+20, windowy-70-titlebar_h-20, windowx-112-32+39, windowy-70-titlebar_h ) = 1 {
		if stat_mode != "land_price" {
			stat_mode = "land_price"
		} else {
			stat_mode = ""
		}
		return
	}
	if open_stat_menu = 1 and click_range( windowx-112-32+40, windowy-70-titlebar_h-20, windowx-112-32+59, windowy-70-titlebar_h ) = 1 {
		if stat_mode != "crime_rate" {
			stat_mode = "crime_rate"
		} else {
			stat_mode = ""
		}
		return
	}
	if open_stat_menu = 1 and click_range( windowx-112-32+60, windowy-70-titlebar_h-20, windowx-112-32+79, windowy-70-titlebar_h ) = 1 {
		if stat_mode != "education_rate" {
			stat_mode = "education_rate"
		} else {
			stat_mode = ""
		}
		return
	}
	if open_stat_menu = 1 and click_range( windowx-112-32+80, windowy-70-titlebar_h-20, windowx-112-32+99, windowy-70-titlebar_h ) = 1 {
		if stat_mode != "happiness" {
			stat_mode = "happiness"
		} else {
			stat_mode = ""
		}
		return
	}
	if open_stat_menu = 1 and click_range( windowx-112-32+100, windowy-70-titlebar_h-20, windowx-112-32+119, windowy-70-titlebar_h ) = 1 {
		if stat_mode != "noise" {
			stat_mode = "noise"
		} else {
			stat_mode = ""
		}
		return
	}

	; æ™‚é–“ã®æ—©ã•å?ã‚Šæ›¿ã? / ä¸€æ™‚åœæ­¢
	if click_range(20, windowy-45-titlebar_h+10, 20+32, windowy-45-titlebar+10+32) = 1 and abs(cnt-changed_speed_cnt) > 2 {
		speed++
		if speed > 4 : speed = 1
		changed_speed_cnt = cnt
		return
	}
	if click_range(52, windowy-45-titlebar_h+10, 52+32, windowy-45-titlebar+10+32) = 1 and abs(cnt-changed_speed_cnt) > 2 {
		if pause = 0 : pause = 1 : else : pause = 0
		changed_speed_cnt = cnt
		return
	}

	; ã‚¢ãƒ‰ã‚ªãƒ³é¸æŠï¼?*addon_select_menu??
	if cursor_mode != "normal" and cursor_mode != "delete" {
		if click_range( 10+35, windowy-70-titlebar_h-32, total_addons_on_menu*35+10+35, windowy-70-titlebar_h ) = 1 {
			selected_addon_number_on_menu = mousex/35-1
		}
	}

	; é«˜å¯?º¦/ä½å¯?º¦ãªã©ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã‚¿ã‚¤ãƒ—é¸æŠï¼?*addon_select_menu??
	if cursor_mode != "normal" and cursor_mode != "delete" and addon_menu_categories > 1 {
		if click_range( 0, windowy-70-titlebar_h-32, 16, windowy-70-titlebar_h-16 ) = 1 {
			category_mode = addon_menu_categories_name(0)
			selected_addon_number_on_menu = 0
		}
		if click_range( 0, windowy-70-titlebar_h-16, 16, windowy-70-titlebar_h ) = 1 {
			category_mode = addon_menu_categories_name(1)
			selected_addon_number_on_menu = 0
		}
	}

	; ã‚«ãƒ¼ã‚½ãƒ«ãƒ¢ãƒ¼ãƒ‰ãŒå¤‰æ›´ã•ã‚ŒãŸã¨ãã?å‡¦ç?
	if before_cursor_mode != cursor_mode {
		selected_addon_number_on_menu = 0
	}

	; ã‚¢ãƒ‰ã‚ªãƒ³ã®å‰Šé™¤??*delete_obj??
	if cursor_mode = "delete" and click_range( 0, 0, windowx, windowy-70-titlebar_h-32 ) = 1 {
		gosub *delete_obj
	}

	; å»ºç‰©åå¤‰æ›´??*show_detail, *fix_new_name??
	if showing_detail = 1 and click_range( show_detail_position_x+32+15+diax+25-20, show_detail_position_y-100-(diay1+5+diay2+5), show_detail_position_x+32+15+diax+25, show_detail_position_y-100-(diay1+5+diay2+5)+20 ) = 1 {
		objsize 200, 16 : new_name = "æ–°ã—ã„å»ºç‰©å?"
		pos windowx-255, 7 : input new_name : new_name_stat = stat

		objsize 40, 16
		pos windowx-255+200, 7 : button gosub "OK", *fix_new_name

		showing_new_name_input = 1
	}

	before_cursor_mode = cursor_mode

	; ã‚¿ã‚¤ãƒ«ã®è©³ç´°ã‚’è¡¨ç¤º??*show_detail??
	if cursor_mode = "normal" and click_range( 0, 0, windowx, windowy-70-titlebar_h-32 ) = 1 and showing_new_name_input = 0 {
		if showing_detail = 0 {
			showing_detail = 1
			clicked_mx = mx : clicked_my = my
		} else {
			if mx != clicked_mx or my != clicked_my {
				clicked_mx = mx : clicked_my = my
			} else {
				showing_detail = 0
			}
		}
	}

	return

*main_onkey
	if selected_addon_number >= 0 and (cursor_mode = "put_Residential" or cursor_mode = "put_Commercial" or cursor_mode = "put_Office" or cursor_mode = "put_Industrial" or cursor_mode = "put_Farm" or cursor_mode = "put_Public" or cursor_mode = "put_Park") {
		getkey space, 32
		if space = 1 {
			if build_direction_number = 0 {
				build_direction_number = 1
			} else : if build_direction_number = 1 {
				build_direction_number = 3
			} else : if build_direction_number = 3 {
				build_direction_number = 2
			} else : if build_direction_number = 2 {
				build_direction_number = 0
			}

			change_direction = 1
		}
	}

	return

*addon_select_menu
	/*--------------------------------------ã‚¢ãƒ‰ã‚ªãƒ³é¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼----------------------------------*/
	if addon_menu_categories = 0 {
		return
	}

	stat_mode = "type"

	; é“è·¯
	if cursor_mode = "put_Road" {
		if category_mode = "roadway" {
			category_addons = type_Two_lane_road
			category_addons_number = type_number_Two_lane_road
		}
		if category_mode = "promenade" {
			category_addons = type_Promenade
			category_addons_number = type_number_Promenade
		}
	}
	; ç·šè·¯
	if cursor_mode = "put_Railroad" {
		category_addons = type_Two_lane_railroad
		category_addons_number = type_number_Two_lane_railroad
	}
	; ä½å±?
	if cursor_mode = "put_Residential" {
		if category_mode = "low" {
			category_addons = type_low_density_residential
			category_addons_number = type_number_low_density_residential
		}
		if category_mode = "high" {
			category_addons = type_high_density_residential
			category_addons_number = type_number_high_density_residential
		}
	}
	; å•?¥­
	if cursor_mode = "put_Commercial" {
		if category_mode = "low" {
			category_addons = type_low_density_commercial
			category_addons_number = type_number_low_density_commercial
		}
		if category_mode = "high" {
			category_addons = type_high_density_commercial
			category_addons_number = type_number_high_density_commercial
		}
	}
	; ã‚ªãƒ•ã‚£ã‚¹
	if cursor_mode = "put_Office" {
		category_addons = type_Office
		category_addons_number = type_number_Office
	}
	; å·¥æ¥­
	if cursor_mode = "put_Industrial" {
		category_addons = type_Industrial
		category_addons_number = type_number_Industrial
	}
	; è¾²æ¥­
	if cursor_mode = "put_Farm" {
		category_addons = type_Farm
		category_addons_number = type_number_Farm
	}
	; å…¬å…±æ–½è¨­
	if cursor_mode = "put_Public" {
		category_addons = type_Public
		category_addons_number = type_number_Public
	}
	; å…¬åœ?
	if cursor_mode = "put_Park" {
		category_addons = type_Park
		category_addons_number = type_number_Park
	}
	; æ°´è·¯
	if cursor_mode = "put_Waterway" {
		category_addons = type_Waterway
		category_addons_number = type_number_Waterway
	}
	; ç©ºæ¸¯
	if cursor_mode = "put_Airport" {
		category_addons = type_Airport
		category_addons_number = type_number_Airport
	}
	; ã‚¿ã‚¤ãƒ«
	if cursor_mode = "put_Tile" {
		category_addons = type_Tile
		category_addons_number = type_number_Tile
	}

	; ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚¿ã‚¤ãƒ—ãŒ2ã¤ä»¥ä¸Šã‚ã‚‹å?´åˆã€ãã‚Œãã‚Œã?ã‚¿ã‚¤ãƒ—ã?ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¡¨ç¤º?ˆé«˜å¯?º¦/ä½å¯?º¦ ãªã©??
	if addon_menu_categories > 1 {
		color 127,127,127 : sboxf 200, 0, windowy-70-titlebar_h-32-40, 16, windowy-70-titlebar_h

		repeat addon_menu_categories
			gmode 2
			pos 0, windowy-70-titlebar_h-2-32+(16*cnt)
			if category_mode = addon_menu_categories_name(cnt) {
				gcopy addon_menu_categories_icon(cnt), 0, 16, 16, 16
			} else {
				gcopy addon_menu_categories_icon(cnt), 0, 0, 16, 16
			}
		loop
	}

	; åœ°åŒºè¨­å®šã?ã‚¢ã‚¤ã‚³ãƒ³ã¨èª¬æ˜ã‚’ç”¨æ„?
	area_addon_icon = -1
	if cursor_mode = "put_Residential" {
		area_addon_summary = "å¸‚æ°‘ãŒä½ã?å ´æ‰€ã‚’æä¾›ã—ã¾ã™ã€‚ä½å±?œ°åŒºã‚’è¨­å®šã™ã‚‹ã¨ä½å±?»ºç¯‰ç‰©ãŒå»ºè¨­ã•ã‚Œã¾ã™ã€?"
		area_addon_icon = 40
		if category_mode = "low" {
			area_addon_number = -1 :  area_addon_name_JP = "ä½å¯?º¦ãªä½å±?œ°åŒº"
		} else {
			area_addon_number = -2 :  area_addon_name_JP = "é«˜å¯?º¦ãªä½å±?œ°åŒº"
		}
	}
	if cursor_mode = "put_Commercial" {
		area_addon_summary = "å¸‚æ°‘ãŒå•?¥­ã‚’å–¶ã‚€å ´æ‰€ã‚’æä¾›ã—ã¾ã™ã€‚å•†æ¥­åœ°åŒºã‚’è¨­å®šã™ã‚‹ã¨å•?¥­å»ºç¯‰ç‰©ãŒå»ºè¨­ã•ã‚Œã¾ã™ã€?"
		area_addon_icon = 41
		if category_mode = "low" {
			area_addon_number = -3 :  area_addon_name_JP = "ä½å¯?º¦ãªå•?¥­åœ°åŒº"
		} else {
			area_addon_number = -4 :  area_addon_name_JP = "é«˜å¯?º¦ãªå•?¥­åœ°åŒº"
		}
	}
	if cursor_mode = "put_Office" {
		area_addon_summary = "å¸‚æ°‘ãŒä»•äº‹ã™ã‚‹å?´ã‚’æä¾›ã—ã¾ã™ã€‚ã‚ªãƒ•ã‚£ã‚¹åœ°åŒºã‚’è¨­å®šã™ã‚‹ã¨ã‚ªãƒ•ã‚£ã‚¹å»ºç¯‰ç‰©ãŒå»ºè¨­ã•ã‚Œã¾ã™ã€?"
		area_addon_icon = 42
		area_addon_number = -5 :  area_addon_name_JP = "ã‚ªãƒ•ã‚£ã‚¹åœ°åŒº"
	}
	if cursor_mode = "put_Industrial" {
		area_addon_summary = "å¸‚æ°‘ãŒãƒ¢ãƒã‚’ç”Ÿç”£ã™ã‚‹å ´ã‚’æä¾›ã—ã¾ã™ã€‚å·¥æ¥­åœ°åŒºã‚’è¨­å®šã™ã‚‹ã¨å·¥æ¥­å»ºç¯‰ç‰©ãŒå»ºè¨­ã•ã‚Œã¾ã™ã€?"
		area_addon_icon = 43
		area_addon_number = -6 :  area_addon_name_JP = "å·¥æ¥­åœ°åŒº"
	}
	if cursor_mode = "put_Farm" {
		area_addon_summary = "å¸‚æ°‘ãŒè¾²ä½œç‰©ã‚’ç”Ÿç”£ã™ã‚‹å ´ã‚’æä¾›ã—ã¾ã™ã€‚è¾²æ¥­åœ°åŒºã‚’è¨­å®šã™ã‚‹ã¨ç•‘ã‚„ç”°ã€ç‰§å ´ãŒå»ºè¨­ã•ã‚Œã¾ã™ã€?"
		area_addon_icon = 58
		area_addon_number = -7 :  area_addon_name_JP = "è¾²æ¥­åœ°åŒº"
	}

	; ã‚¢ãƒ‰ã‚ªãƒ³ä¸€è¦§ã‚’è¡¨ç¤º
	total_addons_on_menu = notemax

	if area_addon_icon != -1 : total_addons_on_menu += 1

	repeat total_addons_on_menu
		if area_addon_icon != -1 and cnt != 0 {
			notesel category_addons
			noteget cnt_addon_name, cnt-1
		} else : if area_addon_icon = -1 {
			notesel category_addons
			noteget cnt_addon_name, cnt
		} else : if cnt = 0 {
			cnt_addon_name = "area"
		}

		if cnt_addon_name = "" {
			break
		}

		if area_addon_icon != -1 and cnt != 0 {
			notesel category_addons_number
			noteget cnt_addon_number, cnt-1
		} else : if area_addon_icon = -1 {
			notesel category_addons_number
			noteget cnt_addon_number, cnt
		}

		if area_addon_icon != -1 and cnt = 0 {
			addon_icon_number_on_menu = area_addon_icon
		} else {
			addon_icon_number_on_menu = int(sdnl(addon_icon_number, int(cnt_addon_number), 0))
		}
		gmode 2 : pos 40+cnt*35, windowy-70-titlebar_h-32

		if cnt = selected_addon_number_on_menu {
			gcopy addon_icon_number_on_menu, 0, 32, 32, 32
		} else {
			gcopy addon_icon_number_on_menu, 0, 0, 32, 32
		}

		await 1
	loop

	; é¸æŠã•ã‚Œã¦ã?‚‹ã‚¢ãƒ‰ã‚ªãƒ³ã®åå‰ã¨èª¬æ˜ã‚’è¡¨ç¤º
	if area_addon_icon != -1 and selected_addon_number_on_menu = 0 {
		color 255,255,255 : font config_SystemFont, 14
		pos 40, windowy-70-titlebar_h-32-40+5 : mes area_addon_name_JP

		color 255,255,255 : font config_SystemFont, 10
		pos 40, windowy-70-titlebar_h-32-40+22 : mes area_addon_summary

		selected_addon_number = area_addon_number

	} else {
		if area_addon_icon != -1 and cnt != 0 {
			notesel category_addons_number
			noteget selected_addon_number, selected_addon_number_on_menu-1
		} else : if area_addon_icon = -1 {
			notesel category_addons_number
			noteget selected_addon_number, selected_addon_number_on_menu
		}

		selected_addon_number = int(selected_addon_number)

		selected_addon_name_jp = sdnl(addon_name, selected_addon_number, 1)
		selected_addon_summary = sdnl(addon_summary, selected_addon_number, 0)

		color 255, 255, 255 : font config_SystemFont, 14
		pos 40, windowy-70-titlebar_h-32-40+5 : mes selected_addon_name_jp

		color 255, 255, 255 : font config_SystemFont, 10
		pos 40, windowy-70-titlebar_h-32-40+22 : mes selected_addon_summary
	}

	return

*build_on_reserved_area
	/*----------------------------åœ°åŒºè¨­å®šã•ã‚ŒãŸåœ°åŒºã«ã‚¢ãƒ‰ã‚ªãƒ³ã‚’è¨­ç½®------------------------------*/
	mx_tmp = mx : my_tmp = my : mz_tmp = z
	mx = x : my = y : mz = z
	cursor_mode_tmp = cursor_mode
	cursor = ""

	; ä½å±?
	if reservation(mx,my,mz) = "low_density_residential" {
		category_addons = type_low_density_residential
		category_addons_number = type_number_low_density_residential
		cursor_mode = "put_Residential"
	}
	if reservation(mx,my,mz) = "high_density_residential" {
		category_addons = type_high_density_residential
		category_addons_number = type_number_high_density_residential
		cursor_mode = "put_Residential"
	}

	; å•?¥­
	if reservation(mx,my,mz) = "low_density_commercial" {
		category_addons = type_low_density_commercial
		category_addons_number = type_number_low_density_commercial
		cursor_mode = "put_Commercial"
	}
	if reservation(mx,my,mz) = "high_density_commercial" {
		category_addons = type_high_density_commercial
		category_addons_number = type_number_high_density_commercial
		cursor_mode = "put_Commercial"
	}

	; ã‚ªãƒ•ã‚£ã‚¹
	if reservation(mx,my,mz) = "office" {
		category_addons = type_office
		category_addons_number = type_number_office
		cursor_mode = "put_Office"
	}

	; å·¥æ¥­
	if reservation(mx,my,mz) = "industrial" {
		category_addons = type_industrial
		category_addons_number = type_number_industrial
		cursor_mode = "put_Industrial"
	}

	; è¾²æ¥­
	if reservation(mx,my,mz) = "farm" {
		category_addons = type_farm
		category_addons_number = type_number_farm
		cursor_mode = "put_Farm"
	}

	if cursor_mode = "" : return

	notesel category_addons_number
	noteget selected_addon_number, rnd(notemax)
	selected_addon_number = int(selected_addon_number)

	from_build_on_reserved_area = 1
	gosub *build

	; å•é¡Œãªãå»ºè¨­ã§ããŸå ´åˆã?äºˆç´?–ã‚Šæ¶ˆã—
	if category(mx,my,mz,0) != "tile" {
		reservation(mx,my,mz) = "none"
	}

	mx = mx_tmp : my = my_tmp : mz = mz_tmp
	cursor_mode = cursor_mode_tmp

	return

*build
	/*----------------------------------ã‚¢ãƒ‰ã‚ªãƒ³ã®è¨­ç½®--------------------------------------------*/
	if selected_addon_number = map(mx,my,mz,0) : return

	name_before = name(mx,my,mz,0) : map_before = map(mx,my,mz,0)
	obj_type_before = obj_type(mx,my,mz,0) : obj_dire_before = obj_dire(mx,my,mz,0)
	category_before = category(mx,my,mz,0)

	; åœ°åŒºè¨­å®?
	if selected_addon_number < 0 {
		if category(mx,my,mz,0) = "road" or category(mx,my,mz,0) = "railroad" or category(mx,my,mz) = "station" or category(mx,my,mz) = "waterway" or category(mx,my,mz,0) = "port" {
			return
		}

		gosub *delete_obj

		if selected_addon_number = -1 : reservation(mx,my,mz) = "low_density_residential"
		if selected_addon_number = -2 : reservation(mx,my,mz) = "high_density_residential"
		if selected_addon_number = -3 : reservation(mx,my,mz) = "low_density_commercial"
		if selected_addon_number = -4 : reservation(mx,my,mz) = "high_density_commercial"
		if selected_addon_number = -5 : reservation(mx,my,mz) = "office"
		if selected_addon_number = -6 : reservation(mx,my,mz) = "industrial"
		if selected_addon_number = -7 : reservation(mx,my,mz) = "farm"

		return
	}

	; åœ°ä¾¡ã€çŠ¯ç½ªç?€æ•™è‚²åº¦ã€?¨’éŸ³ã®å½±éŸ¿ã‚’åæ˜?
		; ã‚¢ãƒ‰ã‚ªãƒ³ã‚’è¨­ç½®ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦å½±éŸ¿ã•ã‚Œã‚‹åœ°ä¾¡ã€çŠ¯ç½ªç?€æ•™è‚²åº¦ã€?¨’éŸ³ã¨ãã?å½±éŸ¿ç¯?›²
		addon_land_price_influence__tmp = int(sdnl(addon_land_price_influence, selected_addon_number, 0))
		addon_land_price_influence_grid__tmp = int(sdnl(addon_land_price_influence, selected_addon_number, 1))

		addon_crime_rate_influence__tmp = int(sdnl(addon_crime_rate_influence, selected_addon_number, 0))
		addon_crime_rate_influence_grid__tmp = int(sdnl(addon_crime_rate_influence, selected_addon_number, 1))

		addon_education_rate_influence__tmp = int(sdnl(addon_education_rate_influence, selected_addon_number, 0))
		addon_education_rate_influence_grid__tmp = int(sdnl(addon_education_rate_influence, selected_addon_number, 1))

		addon_noise_influence__tmp = int(sdnl(addon_noise_influence, selected_addon_number, 0))
		addon_noise_influence_grid__tmp = int(sdnl(addon_noise_influence, selected_addon_number, 1))

		p = 1

		; åœ°ä¾¡ã®å¤‰å‹•
		if addon_land_price_influence__tmp != 0 {
			if addon_land_price_influence_grid__tmp != 0 {
				add_value = addon_land_price_influence__tmp / addon_land_price_influence_grid__tmp * p
			} else : if addon_land_price_influence_grid__tmp = 0 {
				add_value = 0
			}

			round = 0
			for round, 1, addon_land_price_influence_grid__tmp+1, 1
				repeat (round*2-1)
					if mx+cnt-(round-1)>0 and mx+cnt-(round-1)<MAPSIZE_X and my+round-1>0 and my+round-1<MAPSIZE_Y {
						land_price(mx+cnt-(round-1),my+round-1,mz) += int( addon_land_price_influence__tmp - (add_value*(round-1)) )
					}
				loop
				repeat (round*2-1)
					if mx+cnt-(round-1)>0 and mx+cnt-(round-1)<MAPSIZE_X and my-round+1>0 and my-round+1<MAPSIZE_Y {
						land_price(mx+cnt-(round-1),my-round+1,mz) += int( addon_land_price_influence__tmp - (add_value*(round-1)) )
					}
				loop
				repeat (round*2-1)
					if mx+round-1>0 and mx+round-1<MAPSIZE_X and my+cnt-(round-1)>0 and my+cnt-(round-1)<MAPSIZE_Y {
						land_price(mx+round-1,my+cnt-(round-1),mz) += int( addon_land_price_influence__tmp - (add_value*(round-1)) )
					}
				loop
				repeat (round*2-1)
					if mx-round+1>0 and mx-round+1<MAPSIZE_X and my+cnt-(round-1)>0 and my+cnt-(round-1)<MAPSIZE_Y {
						land_price(mx-round+1,my+cnt-(round-1),mz) += int( addon_land_price_influence__tmp - (add_value*(round-1)) )
					}
				loop
			next
		}

		; çŠ¯ç½ªç??å¤‰å‹•
		if addon_crime_rate_influence__tmp != 0 {
			add_value = addon_crime_rate_influence__tmp / addon_crime_rate_influence_grid__tmp * p

			round = 0
			for round, 1, addon_crime_rate_influence_grid__tmp+1, 1
				repeat (round*2-1)
					if (mx+cnt-(round-1)) >= 0 and (mx+cnt-(round-1)) < MAPSIZE_X and (my+round-1) >= 0 and (my+round-1) < MAPSIZE_Y {
						crime_rate(mx+cnt-(round-1),my+round-1,mz) += int( addon_crime_rate_influence__tmp - (add_value*(round-1)) )
						if crime_rate(mx+cnt-(round-1),my+round-1,mz) > 100  : crime_rate(mx+cnt-(round-1),my+round-1) = 100
						if crime_rate(mx+cnt-(round-1),my+round-1,mz) < -100 : crime_rate(mx+cnt-(round-1),my+round-1) = -100
					}
				loop
				repeat (round*2-1)
					if (mx+cnt-(round-1)) >= 0 and (mx+cnt-(round-1)) < MAPSIZE_X and (my-round+1) >= 0 and (my-round+1) < MAPSIZE_Y {
						crime_rate(mx+cnt-(round-1),my-round+1,mz) += int( addon_crime_rate_influence__tmp - (add_value*(round-1)) )
						if crime_rate(mx+cnt-(round-1),my-round+1,mz) > 100  : crime_rate(mx+cnt-(round-1),my-round+1) = 100
						if crime_rate(mx+cnt-(round-1),my-round+1,mz) < -100 : crime_rate(mx+cnt-(round-1),my-round+1) = -100
					}
				loop
				repeat (round*2-1)
					if (mx+round-1) >= 0 and (mx+round-1) < MAPSIZE_X and (my+cnt-(round-1)) >= 0 and (my+cnt-(round-1)) < MAPSIZE_Y {
						crime_rate(mx+round-1,my+cnt-(round-1),mz) += int( addon_crime_rate_influence__tmp - (add_value*(round-1)) )
						if crime_rate(mx+round-1,my+cnt-(round-1),mz) > 100  : crime_rate(mx+round-1,my+cnt-(round-1)) = 100
						if crime_rate(mx+round-1,my+cnt-(round-1),mz) < -100 : crime_rate(mx+round-1,my+cnt-(round-1)) = -100
					}
				loop
				repeat (round*2-1)
					if (mx-round-1) >= 0 and (mx-round-1) < MAPSIZE_X and (my+cnt-(round-1)) >= 0 and (my+cnt-(round-1)) < MAPSIZE_Y {
						crime_rate(mx-round+1,my+cnt-(round-1),mz) += int( addon_crime_rate_influence__tmp - (add_value*(round-1)) )
						if crime_rate(mx-round+1,my+cnt-(round-1),mz) > 100  : crime_rate(mx-round+1,my+cnt-(round-1)) = 100
						if crime_rate(mx-round+1,my+cnt-(round-1),mz) < -100 : crime_rate(mx-round+1,my+cnt-(round-1)) = -100
					}
				loop
			next
		}

		; æ•™è‚²åº¦ã®å¤‰å‹•
		if addon_education_rate_influence__tmp != 0 {
			add_value = addon_education_rate_influence__tmp / addon_education_rate_influence_grid__tmp * p
			round = 0
			for round, 1, addon_education_rate_influence_grid__tmp+1, 1
				repeat (round*2-1)
					if (mx+cnt-(round-1)) >= 0 and (mx+cnt-(round-1)) < MAPSIZE_X and (my+round-1) >= 0 and (my+round-1) < MAPSIZE_Y {
						education_rate(mx+cnt-(round-1),my+round-1,mz) += int( addon_education_rate_influence__tmp - (add_value*(round-1)) )
					}
				loop
				repeat (round*2-1)
					if (mx+cnt-(round-1)) >= 0 and (mx+cnt-(round-1)) < MAPSIZE_X and (my-round+1) >= 0 and (my-round+1) < MAPSIZE_Y {
						education_rate(mx+cnt-(round-1),my-round+1,mz) += int( addon_education_rate_influence__tmp - (add_value*(round-1)) )
					}
				loop
				repeat (round*2-1)
					if (mx+round-1) >= 0 and (mx+round-1) < MAPSIZE_X and (my+cnt-(round-1)) >= 0 and (my+cnt-(round-1)) < MAPSIZE_Y {
						education_rate(mx+round-1,my+cnt-(round-1),mz) += int( addon_education_rate_influence__tmp - (add_value*(round-1)) )
					}
				loop
				repeat (round*2-1)
					if (mx-round-1) >= 0 and (mx-round-1) < MAPSIZE_X and (my+cnt-(round-1)) >= 0 and (my+cnt-(round-1)) < MAPSIZE_Y {
						education_rate(mx-round+1,my+cnt-(round-1),mz) += int( addon_education_rate_influence__tmp - (add_value*(round-1)) )
					}
				loop
			next
		}

		; é¨’éŸ³ã®å¤‰å‹•
		if addon_noise_influence__tmp != 0 {
			add_value = addon_noise_influence__tmp / addon_noise_influence_grid__tmp * p
			round = 0
			for round, 1, addon_noise_influence_grid__tmp+1, 1
				repeat (round*2-1)
					if (mx+cnt-(round-1)) >= 0 and (mx+cnt-(round-1)) < MAPSIZE_X and (my+round-1) >= 0 and (my+round-1) < MAPSIZE_Y {
						noise(mx+cnt-(round-1),my+round-1,mz) += int( addon_noise_influence__tmp - (add_value*(round-1)) )
					}
				loop
				repeat (round*2-1)
					if (mx+cnt-(round-1)) >= 0 and (mx+cnt-(round-1)) < MAPSIZE_X and (my-round+1) >= 0 and (my-round+1) < MAPSIZE_Y {
						noise(mx+cnt-(round-1),my-round+1,mz) += int( addon_noise_influence__tmp - (add_value*(round-1)) )
					}
				loop
				repeat (round*2-1)
					if (mx+round-1) >= 0 and (mx+round-1) < MAPSIZE_X and (my+cnt-(round-1)) >= 0 and (my+cnt-(round-1)) < MAPSIZE_Y {
						noise(mx+round-1,my+cnt-(round-1),mz) += int( addon_noise_influence__tmp - (add_value*(round-1)) )
					}
				loop
				repeat (round*2-1)
					if (mx-round-1) >= 0 and (mx-round-1) < MAPSIZE_X and (my+cnt-(round-1)) >= 0 and (my+cnt-(round-1)) < MAPSIZE_Y {
						noise(mx-round+1,my+cnt-(round-1),mz) += int( addon_noise_influence__tmp - (add_value*(round-1)) )
					}
				loop
			next
		}

	; é“è·¯/ç·šè·¯/æ°´è·¯
	if cursor_mode = "put_Road" or cursor_mode = "put_Railroad" or cursor_mode = "put_Waterway" or cursor_mode = "put_Airport" {
		; éšœå®³ç‰©ãŒã‚ã‚Œã?å‰Šé™¤
		if map(mx,my,mz) != tile_addon_number {
			from_build_roadtype = 1
			gosub *delete_obj
		}

		; é“è·¯ã€ç·šè·¯ã€æ°´è·¯ã¨äº¤å·®ã™ã‚‹å ´å?
		if category_before = "railroad" and cursor_mode = "put_Road" {
			category(mx,my,mz,1) = "train_crossing"
		}
		if category_before = "road" and cursor_mode = "put_Railroad" {
			category(mx,my,mz,1) = "train_crossing"
		}
		if category_before = "waterway" and (cursor_mode = "put_Road" or cursor_mode = "put_Railroad") {
			name(mx,my,mz,1) = name_before
			map(mx,my,mz,1) = map_before
			obj_type(mx,my,mz,1) = obj_type_before
			obj_dire(mx,my,mz,1) = obj_dire_before
			category(mx,my,mz,1) = "bridge"
		}

		; ã¨ã‚Šã‚ãˆãšå·¥äº‹ä¸­ã®ã‚¿ã‚¤ãƒ—ã«æŒ?®?
		map(mx,my,mz) = selected_addon_number
		name(mx,my,mz) = sdnl(addon_name, selected_addon_number, 0)

		if cursor_mode = "put_Road" {
			category(mx,my,mz,0) = "road"
		}
		if cursor_mode = "put_Railroad" {
			if sdnl(addon_type, selected_addon_number, 0) = "station" {
				category(mx,my,mz,0) = "station"
			} else {
				category(mx,my,mz,0) = "railroad"
			}
		}
		if cursor_mode = "put_Waterway" {
			if sdnl(addon_type, selected_addon_number, 0) = "port" {
				category(mx,my,mz,0) = "port"
				if category_before = "waterway" {
					name(mx,my,mz,1) = name_before
					map(mx,my,mz,1) = map_before
					obj_type(mx,my,mz,1) = obj_type_before
					obj_dire(mx,my,mz,1) = obj_dire_before
					category(mx,my,mz,1) = "port"
				}
			} else {
				category(mx,my,mz,0) = "waterway"
			}
		}
		if cursor_mode = "put_Airport" {
			if sdnl(addon_type, selected_addon_number, 1) = "Terminal_Building" {
				dont_return = 1
			} else {
				category(mx,my,mz,0) = "airport"
				category(mx,my,mz,1) = sdnl(addon_type, selected_addon_number, 1)
			}
		}

		if obj_type(mx,my,mz) != element2(selected_addon_number, addon_use_types_name, "under_construction")  {
			new_roadtype_x(under_construction_tiles) = mx
			new_roadtype_y(under_construction_tiles) = my
			under_construction_tiles ++
		}

		obj_type(mx,my,mz) = element2(selected_addon_number, addon_use_types_name, "under_construction")
		obj_dire(mx,my,mz) = 0

		sx = mx : sy = my : sz = mz
		from_build = 1 : gosub *get_addon_drow_position_new

		map_Money -= 5
 
		if dont_return = 0 {
			return
		} else {
			dont_return = 0
		}
	}

	; ã‚¿ã‚¤ãƒ«
	if cursor_mode = "put_Tile" {
		map(mx,my,mz,0)				= int(selected_addon_number)
		name(mx,my,mz,0)			= sdnl(addon_name, selected_addon_number, 0)

		category(mx,my,mz,0)		= sdnl(addon_type, selected_addon_number, 0)
		category(mx,my,mz,1)		= sdnl(addon_type, selected_addon_number, 1)
		category(mx,my,mz,2)		= sdnl(addon_type, selected_addon_number, 2)

		obj_type(mx,my,mz,0)		= 0
		obj_type(mx,my,mz,1)		= 0
		obj_dire(mx,my,mz,0)		= 0
		obj_dire(mx,my,mz,1)		= 0

		obj_tiles(mx,my,mz,0)		= 0
		obj_tiles(mx,my,mz,1)		= 0

		crop(mx,my,mz)				= ""
		crop_amount(mx,my,mz)		= 0

		reservation(mx,my,mz)		= "none"

		original_name(mx,my,mz)		= ""

		sx = mx : sy = my : sz = mz
		from_build = 1 : gosub *get_addon_drow_position_new

		return
	}

	; ä½å±?/å•?¥­/ã‚ªãƒ•ã‚£ã‚¹/å·¥æ¥­/è¾²æ¥­/å…¬å…±æ–½è¨­/å…¬åœ?
	if cursor_mode = "put_Residential" or cursor_mode = "put_Commercial" or cursor_mode = "put_Office" or cursor_mode = "put_Industrial" or cursor_mode = "put_Farm" or cursor_mode = "put_Public" or cursor_mode = "put_Park" or cursor_mode = "put_Airport" {

	*prebuild

		// ç©ºæ¸¯å»ºè¨­ãƒ¢ãƒ¼ãƒ‰ã?å ´åˆã€æ»‘èµ°è·¯ãƒ»èª˜å°è·¯ãªã‚‰return
		if cursor_mode = "put_Airport" and sdnl(addon_type, selected_addon_number, 1) != "Terminal_Building" {
			build_direction_number = -1
			return
		}

		; å‘¨å›²ã®ã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚«ãƒ?‚´ãƒªã‚’å–å¾?
		left_chip_category   = safesearch_str(category, mx-1, my, mz, 0, MAPSIZE_X, MAPSIZE_Y)
		top_chip_category    = safesearch_str(category, mx, my-1, mz, 0, MAPSIZE_X, MAPSIZE_Y)
		bottom_chip_category = safesearch_str(category, mx, my+1, mz, 0, MAPSIZE_X, MAPSIZE_Y)
		right_chip_category  = safesearch_str(category, mx+1, my, mz, 0, MAPSIZE_X, MAPSIZE_Y)

		left_chip_category_2   = safesearch_str(category, mx-1, my, mz, 1, MAPSIZE_X, MAPSIZE_Y)
		top_chip_category_2    = safesearch_str(category, mx, my-1, mz, 1, MAPSIZE_X, MAPSIZE_Y)
		bottom_chip_category_2 = safesearch_str(category, mx, my+1, mz, 1, MAPSIZE_X, MAPSIZE_Y)
		right_chip_category_2  = safesearch_str(category, mx+1, my, mz, 1, MAPSIZE_X, MAPSIZE_Y)

		; ã‚¢ãƒ‰ã‚ªãƒ³ã«å»ºè¨­å¯èƒ½å›æ•°ãŒè¨­ã‘ã‚‰ã‚Œã¦ã?‚‹å ´å?
		if int(sdnl(addon_build_limit, selected_addon_number, 0)) >= 1 and prebuilding = 0 {
			s = 0
			sz = 0
			printed_already_built = 1
			repeat MAPSIZE_X
				sx = cnt
				repeat MAPSIZE_Y
					sy = cnt
					if map(sx,sy,sz,0) = selected_addon_number : s ++
				loop
			loop
			wait 10		; â†waitã‚’å?ã‚Œãªã?¨èª¤ä½œå‹•ã‚’èµ·ã“ã™ãŸã‚
			
			if s >= int(sdnl(addon_build_limit, selected_addon_number, 0)) {
				dialog "ã“ã?å»ºç‰©ã¯æ—¢ã«å»ºè¨­å¯èƒ½å›æ•°ã‚’è¶?ˆã¦ã?¾ã™ï¼?"
				return
			}
		}

		; å»ºè¨­åœ°ã«é“è·¯ãªã©ã®éšœå®³ç‰©ãŒã‚ã‚‹å?´å?
		if (category(mx,my,mz,0) = "road" or category(mx,my,mz,0) = "railroad" or category(mx,my,mz,0) = "waterway") {
			return
		}

		; adatãƒ•ã‚¡ã‚¤ãƒ«å†?§ã®ã‚¿ã‚¤ãƒ—ã?IDã‚’å–å¾?
		build_type_number = element2(selected_addon_number, addon_use_types_name, "null")
		if build_type_number = -1 : return

		; é“è·¯ã«æ¥ç¶šã•ã‚Œã¦ã?ªã??´æ‰€ã«å»ºè¨­ã—ã‚ˆã?¨ã—ã¦ã?‚‹å ´å?
		if left_chip_category != "road" and top_chip_category != "road" and bottom_chip_category != "road" and right_chip_category != "road" {
			; è¾²æ¥­åœ°åŒºã¨å…¬åœ’ã?é™¤å¤–ã¨ã—ã€ä¸‹å‘ãã«è¨­å®šã™ã‚?
			if cursor_mode = "put_Farm" or cursor_mode = "put_Park" {
				build_direction_number = 2

				if prebuilding = 1 {
					prebuilding = 0
					return
				}
			} else {
				build_direction_number = -1
				change_direction = 0
				return
			}

		} else {		; é“è·¯ã«æ¥ç¶šã•ã‚Œã¦ã?‚‹å ´å?
			; å‘ãã‚’æ±ºå®šï¼ˆå·¦ä¸Šä¸‹å³ã®é ?¼?
			done = 0
			cant_build_left = 0 : cant_build_top = 0 : cant_build_bottom = 0 : cant_build_right = 0

			; è§’ç”¨ã®ã‚¢ãƒ‰ã‚ªãƒ³ã‹ã€ãã?§ãªã?‹ã‚’ç¢ºèª?
			tmp = sdnl3(addon_dire_names, selected_addon_number, build_type_number, 0)
			if instr(tmp, 0, "-") != -1 {
				street_corner_addon = 1
			} else {
				street_corner_addon = 0
			}

			while (done = 0 and change_direction = 0)
				if left_chip_category = "road" and (street_corner_addon = 1 and top_chip_category = "road" or street_corner_addon = 0) and cant_build_left = 0 {
					build_direction_number = 0
				} else : if top_chip_category = "road" and (street_corner_addon = 1 and right_chip_category = "road" or street_corner_addon = 0) and cant_build_top = 0 {
					build_direction_number = 1
				} else : if bottom_chip_category = "road" and (street_corner_addon = 1 and left_chip_category = "road" or street_corner_addon = 0) and cant_build_bottom = 0 {
					build_direction_number = 2
				} else : if right_chip_category = "road" and (street_corner_addon = 1 and bottom_chip_category = "road" or street_corner_addon = 0) and cant_build_right = 0 {
					build_direction_number = 3
				} else {
					build_direction_number = -1
					change_direction = 0
					return
				}

				; 2ãƒã‚¹ä»¥ä¸Šã?å»ºç¯‰ç‰©ã®å ´åˆã€å»ºè¨­ã™ã‚‹æ–¹å‘ã«ã»ã‹ã?å»ºç¯‰ç‰©ãŒãªã?‹ç¢ºèª?
				sx = mx : sy = my : sz = 0
				cant_build = 0
				repeat int(sdnl3(addon_chip_x, selected_addon_number, build_type_number, build_direction_number))
					repeat int(sdnl3(addon_chip_y, selected_addon_number, build_type_number, build_direction_number))
						if category(sx,sy,sz,0) != "tile" {
							if build_direction_number = 0 : cant_build_left = 1
							if build_direction_number = 1 : cant_build_top = 1
							if build_direction_number = 2 : cant_build_bottom = 1
							if build_direction_number = 3 : cant_build_right = 1
							cant_build = 1
						}

						//sx_position = sx * CHIP_SIZE/2 - sy * CHIP_SIZE/2 - camx
						//sy_position = sy * CHIP_SIZE/4 + sx * CHIP_SIZE/4 - camy
						//redraw 1 : color 155, 0, 0 : boxf sx_position, sy_position, sx_position+64, sy_position+32 : wait 50		; ç¾åœ¨å‡¦ç?—ã¦ã?‚‹ãƒã‚¹ã®è¡¨ç¤º

						if int(sdnl3(addon_chip_x, selected_addon_number, build_type_number, build_direction_number)) > 1 and int(sdnl3(addon_chip_y, selected_addon_number, build_type_number, build_direction_number)) > 1 and (build_direction_number = 0 or build_direction_number = 3) {
							if cnt = int(sdnl3(addon_chip_y, selected_addon_number, build_type_number, build_direction_number))-1 {
								sy = my
							} else {
								sy ++
							}
						} else : if int(sdnl3(addon_chip_y, selected_addon_number, build_type_number, build_direction_number)) > 1 {
							if build_direction_number = 2 {
								sy --
							} else {
								sy ++
							}
						}
					loop

					if int(sdnl3(addon_chip_x, selected_addon_number, build_type_number, build_direction_number)) > 1 and int(sdnl3(addon_chip_y, selected_addon_number, build_type_number, build_direction_number)) > 1 and int(sdnl3(addon_chip_y, selected_addon_number, build_type_number, build_direction_number)) > 1 and (build_direction_number = 1 or build_direction_number = 2) {
						sy = my
						sx ++
					} else : if int(sdnl3(addon_chip_x, selected_addon_number, build_type_number, build_direction_number)) > 1 {
						if build_direction_number = 3 {
							sx --
						} else {
							sx ++
						}
					}
				loop

				if cant_build = 0 : done = 1
			wend

			if prebuilding = 1 {
				prebuilding = 0
				return
			}
		}

		; adatãƒ•ã‚¡ã‚¤ãƒ«å†?§ã®å‘ãã®IDã‚’å–å¾?
		if build_direction_number = 0  {
			if street_corner_addon = 0 : tmp = "left" : else : tmp = "left-top"
		}
		if build_direction_number = 1  {
			if street_corner_addon = 0 : tmp = "top" : else : tmp = "right-top"
		}
		if build_direction_number = 2  {
			if street_corner_addon = 0 : tmp = "bottom" : else : tmp = "left-bottom"
		}
		if build_direction_number = 3  {
			if street_corner_addon = 0 : tmp = "right" : else : tmp = "right-bottom"
		}

		build_direction_number_ID = element3(selected_addon_number, build_type_number, addon_dire_names, tmp)

		; ã‚¢ãƒ‰ã‚ªãƒ³ã«ä¸‹åœ°ã‚¢ãƒ‰ã‚ªãƒ³ã®è¨­å®šãŒã‚ã‚‹å ´å?
		base_addon_name = sdnl(addon_base, selected_addon_number, build_type_number)
		if base_addon_name != "" {
			repeat total_addons
				if sdnl(addon_name, cnt, 0) = base_addon_name {
					name(mx,my,mz,1) = base_addon_name
					map(mx,my,mz,1) = cnt
				}
			loop
		}

		; ã‚¢ãƒ‰ã‚ªãƒ³æƒ??±ã®æ›¸ãè¾¼ã¿æ™‚ã«repeatã™ã‚‹å›æ•°
		repeat_x = int(sdnl3(addon_chip_x, selected_addon_number, build_type_number, build_direction_number_ID))
		repeat_y = int(sdnl3(addon_chip_y, selected_addon_number, build_type_number, build_direction_number_ID))

		; categoryã®å†?®¹
		if cursor_mode = "put_Residential" : category_tmp = "residential"
		if cursor_mode = "put_Commercial"  : category_tmp = "commercial"
		if cursor_mode = "put_Office"      : category_tmp = "office"
		if cursor_mode = "put_Industrial"  : category_tmp = "industrial"
		if cursor_mode = "put_Farm"        : category_tmp = "farm"
		if cursor_mode = "put_Public"      : category_tmp = "public"
		if cursor_mode = "put_Park"        : category_tmp = "park"
		if cursor_mode = "put_Airport"	   : category_tmp = "airport_terminal"

		; ã‚¿ã‚¤ãƒ«ã«ã‚¢ãƒ‰ã‚ªãƒ³ã®æƒ??±ã‚’æ›¸ãè¾¼ã¿
		sx = mx : sy = my : sz = 0

		repeat repeat_x
			repeat repeat_y
				map(sx,sy,sz,0)				= int(selected_addon_number)
				name(sx,sy,sz,0)			= sdnl(addon_name, selected_addon_number, 0)

				category(sx,sy,sz,0)		= category_tmp
				category(sx,sy,sz,1)		= sdnl(addon_type, selected_addon_number, 1)
				category(sx,sy,sz,2)		= sdnl(addon_type, selected_addon_number, 2)

				obj_type(sx,sy,sz,0)		= build_type_number
				obj_dire(sx,sy,sz,0)		= build_direction_number_ID

				obj_serial_num(sx,sy,sz)	= next_obj_serial_num : next_obj_serial_num ++

				if repeat_x > 1 {
					obj_use_tiles(sx,sy,sz,0)	= repeat_x
				} else {
					obj_use_tiles(sx,sy,sz,0)	= 0
				}
				if repeat_y > 1 {
					obj_use_tiles(sx,sy,sz,1)	= repeat_y
				} else {
					obj_use_tiles(sx,sy,sz,1)	= 0
				}

				obj_tiles(sx,sy,sz,0)		= sx-mx
				obj_tiles(sx,sy,sz,1)		= sy-my

				crop(sx,sy,sz)				= sdnl(addon_crop, selected_addon_number, 0)
				crop_amount(sx,sy,sz)		= int(sdnl(addon_crop, selected_addon_number, 1))

				reservation(sx,sy,sz)		= "none"

				original_name(sx,sy,sz)		= ""

				from_build = 1 : gosub *get_addon_drow_position_new

				if repeat_x > 1 and repeat_y > 1 and (build_direction_number = 0 or build_direction_number = 3) {
					if cnt = repeat_y-1 {
						sy = my
					} else {
						sy ++
					}
				} else : if repeat_y > 1 {
					if build_direction_number = 2 {
						sy --
					} else {
						sy ++
					}
				}
			loop

			if repeat_x > 1 and repeat_y > 1 and (build_direction_number = 1 or build_direction_number = 2) {
				sy = my
				sx ++
			} else : if repeat_x > 1 {
				if build_direction_number = 3 {
					sx --
				} else {
					sx ++
				}
			}
		loop
		
		
		; éƒ½å¸‚å?ä½“ã?åå®¹å¯èƒ½äººæ•°æˆ–ã„ã¯æ±‚äººæ•°ã‚’å¢—ã‚„ã—ã€RCOIFãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’å¤‰å‹•
		if category(mx,my,mz,0) = "residential" {
			map_total_Residential_maximum_capacity += int(sdnl(addon_maximum_capacity, selected_addon_number, 0))
			Vacancies += int(sdnl(addon_maximum_capacity, selected_addon_number, 0))
			map_demand_Residential -= 1
		}
		if category(mx,my,mz,0) = "commercial" {
			map_total_Commercial_maximum_capacity += int(sdnl(addon_maximum_capacity, selected_addon_number, 0))
			Vacancies += int(sdnl(addon_maximum_capacity, selected_addon_number, 0))
			map_demand_Commercial -= 1
		}
		if category(mx,my,mz,0) = "office" {
			map_total_Office_maximum_capacity += int(sdnl(addon_maximum_capacity, selected_addon_number, 0))
			Vacancies += int(sdnl(addon_maximum_capacity, selected_addon_number, 0))
			map_demand_Office -= 1
		}
		if category(mx,my,mz,0) = "industrial" {
			map_total_Industrial_maximum_capacity += int(sdnl(addon_maximum_capacity, selected_addon_number, 0))
			Vacancies += int(sdnl(addon_maximum_capacity, selected_addon_number, 0))
			map_demand_Industrial -= 1
		}
		if category(mx,my,mz,0) = "farm" {
			map_total_Farm_maximum_capacity += int(sdnl(addon_maximum_capacity, selected_addon_number, 0))
			Vacancies += int(sdnl(addon_maximum_capacity, selected_addon_number, 0))
			map_demand_Farm -= 1
		}
		if category(mx,my,mz,0) = "public" or category(mx,my,mz,0) = "airport_terminal" {	; ç©ºæ¸¯ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒ“ãƒ«ã‚‚å?å…±æ–½è¨­æ‰±ã?
			map_total_Public_maximum_capacity += int(sdnl(addon_maximum_capacity, selected_addon_number, 0))
			Vacancies += int(sdnl(addon_maximum_capacity, selected_addon_number, 0))
		}

		if from_build_on_reserved_area = 0 {
			map_Money -= 5
		} else {
			from_build_on_reserved_area = 0
		}
	}

	change_direction = 0

	return

*build_roadtypes
	/*----------------------------------é“è·¯ã®ã‚¿ã‚¤ãƒ—ã¨å‘ãã‚’è¨­å®?----------------------------------*/
	if from_Delete_obj = 1 {
		new_roadtype_x(under_construction_tiles) = mx : new_roadtype_y(under_construction_tiles) = my
		under_construction_tiles ++
	}

	repeat under_construction_tiles
		sx = new_roadtype_x(cnt) : sy = new_roadtype_y(cnt) : sz = 0
		center_x = sx : center_y = sy

		repeat 9
			if from_Delete_obj = 1 { from_Delete_obj = 0 : continue }
			if cnt = 1 { sx = center_x - 1 : sy = center_y }
			if cnt = 2 { sx = center_x     : sy = center_y - 1 }
			if cnt = 3 { sx = center_x     : sy = center_y + 1 }
			if cnt = 4 { sx = center_x + 1 : sy = center_y }
			if cnt = 5 { sx = center_x - 1 : sy = center_y - 1 }
			if cnt = 6 { sx = center_x + 1 : sy = center_y - 1 }
			if cnt = 7 { sx = center_x + 1 : sy = center_y + 1 }
			if cnt = 8 { sx = center_x - 1 : sy = center_y + 1 }

			obj_type_tmp  = "" : obj_dire_tmp = ""

			; å‘¨å›²ã®ã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚«ãƒ?‚´ãƒªã‚’å–å¾?
			left_chip_category   = safesearch_str(category, sx-1, sy, sz, 0, MAPSIZE_X, MAPSIZE_Y)
			top_chip_category    = safesearch_str(category, sx, sy-1, sz, 0, MAPSIZE_X, MAPSIZE_Y)
			bottom_chip_category = safesearch_str(category, sx, sy+1, sz, 0, MAPSIZE_X, MAPSIZE_Y)
			right_chip_category  = safesearch_str(category, sx+1, sy, sz, 0, MAPSIZE_X, MAPSIZE_Y)

			left_chip_category_2   = safesearch_str(category, sx-1, sy, sz, 1, MAPSIZE_X, MAPSIZE_Y)
			top_chip_category_2    = safesearch_str(category, sx, sy-1, sz, 1, MAPSIZE_X, MAPSIZE_Y)
			bottom_chip_category_2 = safesearch_str(category, sx, sy+1, sz, 1, MAPSIZE_X, MAPSIZE_Y)
			right_chip_category_2  = safesearch_str(category, sx+1, sy, sz, 1, MAPSIZE_X, MAPSIZE_Y)

			if sx < 0 or sx >= MAPSIZE_X or sy < 0 or sy >= MAPSIZE_Y {
				continue
			}

			obj_type_tmp = ""
			obj_dire_tmp = ""

			; é“è·¯
			if category(sx,sy,sz,0) = "road" {
				correct = iforandcorrect_3(left_chip_category, left_chip_category_2, top_chip_category, top_chip_category_2, bottom_chip_category, bottom_chip_category_2, right_chip_category, right_chip_category_2, "road", "bridge", "train_crossing")

				; å‘¨å›²ã®é“è·¯æ¥ç¶šãŒ1ã¤?ˆè¡Œãæ­¢ã¾ã‚Šï¼?
				if correct = 1 {
					obj_type_tmp = "dead_end"
					if left_chip_category = "road" or left_chip_category_2 = "bridge" or left_chip_category_2 = "train_crossing"       : obj_dire_tmp = "left"
					if top_chip_category = "road" or top_chip_category_2 = "bridge" or top_chip_category_2 = "train_crossing"          : obj_dire_tmp = "top"
					if bottom_chip_category = "road" or bottom_chip_category_2 = "bridge" or bottom_chip_category_2 = "train_crossing" : obj_dire_tmp = "bottom"
					if right_chip_category = "road" or right_chip_category_2 = "bridge" or right_chip_category_2 = "train_crossing"    : obj_dire_tmp = "right"
				}

				; å‘¨å›²ã®é“è·¯æ¥ç¶šãŒ1ã¤?ˆæ›²ãŒã‚Šè§’orç›´ç·šï¼?
				if correct = 2 {
					; æ›²ãŒã‚Šè§?
					if (left_chip_category = "road" or left_chip_category_2 = "bridge" or left_chip_category_2 = "train_crossing") and (top_chip_category = "road" or top_chip_category_2 = "bridge" or top_chip_category_2 = "train_crossing") {
						obj_type_tmp = "turn" : obj_dire_tmp = "left-top"
					}
					if (top_chip_category = "road" or top_chip_category_2 = "bridge" or top_chip_category_2 = "train_crossing") and (right_chip_category = "road" or right_chip_category_2 = "bridge" or right_chip_category_2 = "train_crossing") {
						obj_type_tmp = "turn" : obj_dire_tmp = "right-top"
					}
					if (left_chip_category = "road" or left_chip_category_2 = "bridge" or left_chip_category_2 = "train_crossing") and (bottom_chip_category = "road" or bottom_chip_category_2 = "bridge" or bottom_chip_category_2 = "train_crossing") {
						obj_type_tmp = "turn" : obj_dire_tmp = "left-bottom"
					}
					if (bottom_chip_category = "road" or bottom_chip_category_2 = "bridge" or bottom_chip_category_2 = "train_crossing") and (right_chip_category = "road" or right_chip_category_2 = "bridge" or right_chip_category_2 = "train_crossing") {
						obj_type_tmp = "turn" : obj_dire_tmp = "right-bottom"
					}

					; ç›´ç·?
					if (left_chip_category = "road" or left_chip_category_2 = "bridge" or left_chip_category_2 = "train_crossing") and (right_chip_category = "road" or right_chip_category_2 = "bridge" or right_chip_category_2 = "train_crossing") {
						obj_type_tmp = "default" : obj_dire_tmp = "depth"
					}
					if (top_chip_category = "road" or top_chip_category_2 = "bridge" or top_chip_category_2 = "train_crossing") and (bottom_chip_category = "road" or bottom_chip_category_2 = "bridge" or bottom_chip_category_2 = "train_crossing") {
						obj_type_tmp = "default" : obj_dire_tmp = "width"
					}
				}

				; å‘¨å›²ã®é“è·¯æ¥ç¶šãŒ3ã¤??Tå­—å‹äº¤å·®ç‚¹??
				if correct = 3 {
					obj_type_tmp = "intersection_T"
					if (left_chip_category = "road" or left_chip_category_2 = "bridge" or left_chip_category_2 = "train_crossing") and (top_chip_category = "road" or top_chip_category_2 = "bridge" or top_chip_category_2 = "train_crossing") and (bottom_chip_category = "road" or bottom_chip_category_2 = "bridge" or bottom_chip_category_2 = "train_crossing") {
						obj_dire_tmp = "left-top-bottom"
					}
					if (left_chip_category = "road" or left_chip_category_2 = "bridge" or left_chip_category_2 = "train_crossing") and (right_chip_category = "road" or right_chip_category_2 = "bridge" or right_chip_category_2 = "train_crossing") and (top_chip_category = "road" or top_chip_category_2 = "bridge" or top_chip_category_2 = "train_crossing") {
						obj_dire_tmp = "left-right-top"
					}
					if (left_chip_category = "road" or left_chip_category_2 = "bridge" or left_chip_category_2 = "train_crossing") and (right_chip_category = "road" or right_chip_category_2 = "bridge" or right_chip_category_2 = "train_crossing") and (bottom_chip_category = "road" or bottom_chip_category_2 = "bridge" or bottom_chip_category_2 = "train_crossing") {
						obj_dire_tmp = "left-right-bottom"
					}
					if (right_chip_category = "road" or right_chip_category_2 = "bridge" or right_chip_category_2 = "train_crossing") and (top_chip_category = "road" or top_chip_category_2 = "bridge" or top_chip_category_2 = "train_crossing") and (bottom_chip_category = "road" or bottom_chip_category_2 = "bridge" or bottom_chip_category_2 = "train_crossing") {
						obj_dire_tmp = "right-top-bottom"
					}
				}

				; å‘¨å›²ã®é“è·¯æ¥ç¶šãŒ4ã¤?ˆåå­—å‹äº¤å·®ç‚¹?‰ã¾ãŸã?å‘¨ã‚Šã«æ¥ç¶šã™ã‚‹é“è·¯ãŒãªã??´å?
				if correct = 4 or correct = 0 {
					obj_type_tmp = "intersection_cross" : obj_dire_tmp = "null"
				}
			}

			; ç·šè·¯/é§?
			if category(sx,sy,sz,0) = "railroad" or category(sx,sy,sz,0) = "station" {
				correct = iforandcorrect_4(left_chip_category, left_chip_category_2, top_chip_category, top_chip_category_2, bottom_chip_category, bottom_chip_category_2, right_chip_category, right_chip_category_2, "railroad", "station", "bridge", "train_crossing")

				; å‘¨å›²ã®é“è·¯æ¥ç¶šãŒ1ã¤?ˆè¡Œãæ­¢ã¾ã‚Šï¼?
				if correct = 1 {
					obj_type_tmp = "dead_end"
					if left_chip_category = "railroad" or left_chip_category = "station" or left_chip_category_2 = "bridge" or left_chip_category_2 = "train_crossing"         : obj_dire_tmp = "left"
					if top_chip_category = "railroad" or top_chip_category = "station" or top_chip_category_2 = "bridge" or top_chip_category_2 = "train_crossing"             : obj_dire_tmp = "top"
					if bottom_chip_category = "railroad" or bottom_chip_category = "station" or bottom_chip_category_2 = "bridge" or bottom_chip_category_2 = "train_crossing" : obj_dire_tmp = "bottom"
					if right_chip_category = "railroad" or right_chip_category = "station" or right_chip_category_2 = "bridge" or right_chip_category_2 = "train_crossing"     : obj_dire_tmp = "right"
				}

				; å‘¨å›²ã®é“è·¯æ¥ç¶šãŒ1ã¤?ˆæ›²ãŒã‚Šè§’orç›´ç·šï¼?
				if correct = 2 {
					; æ›²ãŒã‚Šè§’ï¼ˆç·šè·¯ã®ã¿??
					if category(sx,sy,sz,0) = "railroad" {
						if (left_chip_category = "railroad" or left_chip_category_2 = "bridge" or left_chip_category_2 = "train_crossing") and (top_chip_category = "railroad" or top_chip_category_2 = "bridge" or top_chip_category_2 = "train_crossing") {
							obj_type_tmp = "turn" : obj_dire_tmp = "left-top"
						}
						if (top_chip_category = "railroad" or top_chip_category_2 = "bridge" or top_chip_category_2 = "train_crossing") and (right_chip_category = "railroad" or right_chip_category_2 = "bridge" or right_chip_category_2 = "train_crossing") {
							obj_type_tmp = "turn" : obj_dire_tmp = "right-top"
						}
						if (left_chip_category = "railroad" or left_chip_category_2 = "bridge" or left_chip_category_2 = "train_crossing") and (bottom_chip_category = "railroad" or bottom_chip_category_2 = "bridge" or bottom_chip_category_2 = "train_crossing") {
							obj_type_tmp = "turn" : obj_dire_tmp = "left-bottom"
						}
						if (bottom_chip_category = "railroad" or bottom_chip_category_2 = "bridge" or bottom_chip_category_2 = "train_crossing") and (right_chip_category = "railroad" or right_chip_category_2 = "bridge" or right_chip_category_2 = "train_crossing") {
							obj_type_tmp = "turn" : obj_dire_tmp = "right-bottom"
						}
					}

					; ç›´ç·?
					if (left_chip_category = "railroad" or left_chip_category = "station" or left_chip_category_2 = "bridge" or left_chip_category_2 = "train_crossing") and (right_chip_category = "railroad" or right_chip_category = "station" or right_chip_category_2 = "bridge" or right_chip_category_2 = "train_crossing") {
						obj_type_tmp = "default" : obj_dire_tmp = "depth"
					}
					if (top_chip_category = "railroad" or top_chip_category = "station" or top_chip_category_2 = "bridge" or top_chip_category_2 = "train_crossing") and (bottom_chip_category = "railroad" or bottom_chip_category = "station" or bottom_chip_category_2 = "bridge" or bottom_chip_category_2 = "train_crossing") {
						obj_type_tmp = "default" : obj_dire_tmp = "width"
					}
				}

				; å‘¨å›²ã®é“è·¯æ¥ç¶šãŒ3ã¤??Tå­—å‹äº¤å·®ç‚¹ã€ç·šè·¯ã®ã¿??
				if correct = 3 and category(sx,sy,sz,0) = "railroad" {
					obj_type_tmp = "intersection_T"
					if (left_chip_category = "railroad" or left_chip_category_2 = "bridge" or left_chip_category_2 = "train_crossing") and (top_chip_category = "railroad" or top_chip_category_2 = "bridge" or top_chip_category_2 = "train_crossing") and (bottom_chip_category = "railroad" or bottom_chip_category_2 = "bridge" or bottom_chip_category_2 = "train_crossing") {
						obj_dire_tmp = "left-top-bottom"
					}
					if (left_chip_category = "railroad" or left_chip_category_2 = "bridge" or left_chip_category_2 = "train_crossing") and (right_chip_category = "railroad" or right_chip_category_2 = "bridge" or right_chip_category_2 = "train_crossing") and (top_chip_category = "railroad" or top_chip_category_2 = "bridge" or top_chip_category_2 = "train_crossing") {
						obj_dire_tmp = "left-right-top"
					}
					if (left_chip_category = "railroad" or left_chip_category_2 = "bridge" or left_chip_category_2 = "train_crossing") and (right_chip_category = "railroad" or right_chip_category_2 = "bridge" or right_chip_category_2 = "train_crossing") and (bottom_chip_category = "railroad" or bottom_chip_category_2 = "bridge" or bottom_chip_category_2 = "train_crossing") {
						obj_dire_tmp = "left-right-bottom"
					}
					if (right_chip_category = "railroad" or right_chip_category_2 = "bridge" or right_chip_category_2 = "train_crossing") and (top_chip_category = "railroad" or top_chip_category_2 = "bridge" or top_chip_category_2 = "train_crossing") and (bottom_chip_category = "railroad" or bottom_chip_category_2 = "bridge" or bottom_chip_category_2 = "train_crossing") {
						obj_dire_tmp = "right-top-bottom"
					}
				}

				; å‘¨å›²ã®é“è·¯æ¥ç¶šãŒ4ã¤?ˆåå­—å‹äº¤å·®ç‚¹?‰ã¾ãŸã?å‘¨ã‚Šã«æ¥ç¶šã™ã‚‹é“è·¯ãŒãªã??´åˆï¼ˆç·šè·¯ã®ã¿??
				if (correct = 4 or correct = 0) and category(sx,sy,sz,0) = "railroad" {
					obj_type_tmp = "intersection_cross" : obj_dire_tmp = "null"
				}
			}

			; æ°´è·¯/æ¸¯
			if category(sx,sy,sz,0) = "waterway" or category(sx,sy,sz,0) = "port" {
				; å‘¨å›²ã®ã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚«ãƒ?‚´ãƒªã‚’å–å¾?
				left_top_chip_category     = safesearch_str(category, sx-1, sy-1, sz, 0, MAPSIZE_X, MAPSIZE_Y)
				right_top_chip_category    = safesearch_str(category, sx+1, sy-1, sz, 0, MAPSIZE_X, MAPSIZE_Y)
				left_bottom_chip_category  = safesearch_str(category, sx-1, sy+1, sz, 0, MAPSIZE_X, MAPSIZE_Y)
				right_bottom_chip_category = safesearch_str(category, sx+1, sy+1, sz, 0, MAPSIZE_X, MAPSIZE_Y)

				left_top_chip_category_2     = safesearch_str(category, sx-1, sy-1, sz, 1, MAPSIZE_X, MAPSIZE_Y)
				right_top_chip_category_2    = safesearch_str(category, sx+1, sy-1, sz, 1, MAPSIZE_X, MAPSIZE_Y)
				left_bottom_chip_category_2  = safesearch_str(category, sx-1, sy+1, sz, 1, MAPSIZE_X, MAPSIZE_Y)
				right_bottom_chip_category_2 = safesearch_str(category, sx+1, sy+1, sz, 1, MAPSIZE_X, MAPSIZE_Y)

				correct = iforandcorrect_3_2(left_chip_category, left_chip_category_2, top_chip_category, top_chip_category_2, bottom_chip_category, bottom_chip_category_2, right_chip_category, right_chip_category_2, "waterway", "port", "bridge")

				; å‘¨å›²ã®æ°´è·¯ã?1ã¤?ˆè¡Œãæ­¢ã¾ã‚Šï¼?
				if correct = 1 {
					obj_type_tmp = "river_dead_end"

					if left_chip_category = "waterway" or left_chip_category = "port" or left_chip_category = "port" or left_chip_category_2 = "bridge"    	 	: obj_dire_tmp = "left"
					if top_chip_category = "waterway" or left_chip_category = "port" or top_chip_category = "port" or top_chip_category_2 = "bridge"     		  : obj_dire_tmp = "top"
					if bottom_chip_category = "waterway" or left_chip_category = "port" or bottom_chip_category = "port" or bottom_chip_category_2 = "bridge" : obj_dire_tmp = "bottom"
					if right_chip_category = "waterway" or right_chip_category = "port" or right_chip_category = "port" or right_chip_category_2 = "bridge"   : obj_dire_tmp = "right"
				}

				; å‘¨å›²ã®é“è·¯æ¥ç¶šãŒ2ã¤?ˆç›´ç·šoræ›²ãŒã‚Šè§’ï¼?
				if correct = 2 {
					; æ›²ãŒã‚Šè§?
					if (left_chip_category = "waterway" or left_chip_category = "port" or left_chip_category_2 = "bridge") and (top_chip_category = "waterway" or top_chip_category = "port" or top_chip_category_2 = "bridge") {
						if left_top_chip_category = "waterway" or left_top_chip_category = "port" or left_top_chip_category_2 = "bridge" : obj_type_tmp = "turn" :  else : obj_type_tmp = "river_turn"
						obj_dire_tmp = "left-top"
					}
					if (top_chip_category = "waterway" or top_chip_category = "port" or top_chip_category_2 = "bridge") and (right_chip_category = "waterway" or right_chip_category = "port" or right_chip_category_2 = "bridge") {
						if right_top_chip_category = "waterway" or right_top_chip_category = "port" or right_top_chip_category_2 = "bridge" : obj_type_tmp = "turn" :  else : obj_type_tmp = "river_turn"
						obj_dire_tmp = "right-top"
					}
					if (left_chip_category = "waterway" or left_chip_category = "port" or left_chip_category = "port" or left_chip_category_2 = "bridge") and (bottom_chip_category = "waterway" or left_chip_category = "port" or bottom_chip_category = "port" or bottom_chip_category_2 = "bridge") {
						if left_bottom_chip_category = "waterway" or left_bottom_chip_category = "port" or left_bottom_chip_category_2 = "bridge" : obj_type_tmp = "turn" :  else : obj_type_tmp = "river_turn"
						obj_dire_tmp = "left-bottom"
					}
					if (bottom_chip_category = "waterway" or left_chip_category = "port" or bottom_chip_category = "port" or bottom_chip_category_2 = "bridge") and (right_chip_category = "waterway" or right_chip_category = "port" or right_chip_category = "port" or bottom_chip_category_2 = "bridge") {
						if right_bottom_chip_category = "waterway" or right_bottom_chip_category = "port" or right_bottom_chip_category_2 = "bridge" : obj_type_tmp = "turn" :  else : obj_type_tmp = "river_turn"
						obj_dire_tmp = "right-bottom"
					}

					; ç›´ç·?
					if (left_chip_category = "waterway" or left_chip_category = "port" or left_chip_category_2 = "bridge") and (right_chip_category = "waterway" or right_chip_category = "port" or right_chip_category_2 = "bridge") {
						if category(sx, sy, sz, 0) = "port" {
							if left_chip_category = "port" {
								obj_type_tmp = "dead_end"
								if (top_chip_category = "waterway") { obj_dire_tmp = "bottom"	} else { obj_dire_tmp = "top" }
							} else : if right_chip_category = "port" {
								obj_type_tmp = "dead_end"
								if (top_chip_category = "waterway") { obj_dire_tmp = "bottom"	} else { obj_dire_tmp = "top" }
							}

						} else {
							obj_type_tmp = "river_default"
							obj_dire_tmp = "depth"
						}
					}
					if (top_chip_category = "waterway" or top_chip_category = "port" or top_chip_category_2 = "bridge") and (bottom_chip_category = "waterway" or bottom_chip_category = "port" or bottom_chip_category_2 = "bridge") {
						if category(sx, sy, sz, 0) = "port" {
							if top_chip_category = "port" {
								obj_type_tmp = "dead_end"
								if (left_chip_category = "waterway") { obj_dire_tmp = "right"	} else { obj_dire_tmp = "left" }
							} else : if bottom_chip_category = "port" {
								obj_type_tmp = "dead_end"
								if (left_chip_category = "waterway") { obj_dire_tmp = "right"	} else { obj_dire_tmp = "left" }
							}

						} else {
							obj_type_tmp = "river_default"
							obj_dire_tmp = "width"
						}
					}

				}

				; å‘¨å›²ã®é“è·¯æ¥ç¶šãŒ3ã¤??Tå­—å‹äº¤å·®ç‚¹, æ¸¯ã®å ´åˆã?ç›´ç·šorçµ‚ç«¯??
				if correct = 3 {
					if category(sx, sy, sz, 0) = "port" {
						if left_chip_category = "port" and right_chip_category = "port" {
							obj_type_tmp = "default"
							if (bottom_chip_category != "waterway" and bottom_chip_category != "port") { obj_dire_tmp = "bottom"	} else { obj_dire_tmp = "top" }
						} else : if top_chip_category = "port" and bottom_chip_category = "port" {
							obj_type_tmp = "default"
							if (right_chip_category != "waterway" and right_chip_category != "port") { obj_dire_tmp = "right"	} else { obj_dire_tmp = "left" }
						} else : if left_chip_category = "port" and right_chip_category = "waterway" {
							obj_type_tmp = "dead_end"
							if (bottom_chip_category != "waterway" and bottom_chip_category != "port") { obj_dire_tmp = "bottom"	} else { obj_dire_tmp = "top" }
						} else : if top_chip_category = "port" and bottom_chip_category = "waterway" {
							obj_type_tmp = "dead_end"
							if (right_chip_category != "waterway" and right_chip_category != "port") { obj_dire_tmp = "right"	} else { obj_dire_tmp = "left" }
						} else : if bottom_chip_category = "port" and top_chip_category = "waterway" {
							obj_type_tmp = "dead_end"
							if (right_chip_category != "waterway" and right_chip_category != "port") { obj_dire_tmp = "right"	} else { obj_dire_tmp = "left" }
						} else : if right_chip_category = "port" and left_chip_category = "waterway" {
							obj_type_tmp = "dead_end"
							if (bottom_chip_category != "waterway" and bottom_chip_category != "port") { obj_dire_tmp = "bottom"	} else { obj_dire_tmp = "top" }
						}

					} else {
						obj_type_tmp = "intersection_T"
						if (left_chip_category = "waterway" or left_chip_category = "port" or left_chip_category_2 = "bridge") and (top_chip_category = "waterway" or top_chip_category = "port" or top_chip_category_2 = "bridge") and (bottom_chip_category = "waterway" or bottom_chip_category = "port" or bottom_chip_category_2 = "bridge") {
							if (left_top_chip_category = "waterway" or left_top_chip_category = "port" or left_top_chip_category_2 = "bridge") or (left_bottom_chip_category = "waterway" or left_bottom_chip_category = "port" or left_bottom_chip_category_2 = "bridge") {
								obj_type_tmp = "intersection_T" } else { obj_type_tmp = "river_intersection_T"
							}
							obj_dire_tmp = "left-top-bottom"
						}
						if (left_chip_category = "waterway" or left_chip_category = "port" or left_chip_category_2 = "bridge") and (right_chip_category = "waterway" or right_chip_category = "port" or bottom_chip_category_2 = "bridge") and (top_chip_category = "waterway" or top_chip_category = "port" or top_chip_category_2 = "bridge") {
							if (left_top_chip_category = "waterway" or left_top_chip_category = "port" or left_top_chip_category_2 = "bridge") or (right_top_chip_category = "waterway" or right_top_chip_category = "port" or right_top_chip_category_2 = "bridge") {
								obj_type_tmp = "intersection_T" } else { obj_type_tmp = "river_intersection_T"
							}
							obj_dire_tmp = "left-right-top"
						}
						if (left_chip_category = "waterway" or left_chip_category = "port" or left_chip_category_2 = "bridge") and (right_chip_category = "waterway" or right_chip_category = "port" or bottom_chip_category_2 = "bridge") and (bottom_chip_category = "waterway" or bottom_chip_category = "port" or bottom_chip_category_2 = "bridge") {
							if (left_bottom_chip_category = "waterway" or left_bottom_chip_category = "port" or left_bottom_chip_category_2 = "bridge") or (right_bottom_chip_category = "waterway" or right_bottom_chip_category = "port" or right_bottom_chip_category_2 = "bridge") {
								obj_type_tmp = "intersection_T" } else { obj_type_tmp = "river_intersection_T"
							}
							obj_dire_tmp = "left-right-bottom"
						}
						if (right_chip_category = "waterway" or right_chip_category = "port" or bottom_chip_category_2 = "bridge") and (top_chip_category = "waterway" or top_chip_category = "port" or top_chip_category_2 = "bridge") and (bottom_chip_category = "waterway" or bottom_chip_category = "port" or bottom_chip_category_2 = "bridge") {
							if (right_top_chip_category = "waterway" or right_top_chip_category = "port" or right_top_chip_category_2 = "bridge") or (right_bottom_chip_category = "waterway" or right_bottom_chip_category = "port" or right_bottom_chip_category_2 = "bridge") {
								obj_type_tmp = "intersection_T" } else { obj_type_tmp = "river_intersection_T"
							}
							obj_dire_tmp = "right-top-bottom"
						}
					}
				}

				; å‘¨å›²ã®é“è·¯æ¥ç¶šãŒ4ã¤?ˆåå­—å‹äº¤å·®ç‚¹oræ²³å£??
				if correct = 4 {
					; æ²³å£
					if left_top_chip_category != "waterway" and left_top_chip_category != "port" and left_top_chip_category_2 != "bridge" and left_bottom_chip_category != "waterway" and left_bottom_chip_category != "port" and left_bottom_chip_category_2 != "bridge" {
						obj_type_tmp = "estuary" : obj_dire_tmp = "left-top-bottom"
					}
					if right_top_chip_category != "waterway" and right_top_chip_category != "port" and right_top_chip_category_2 != "bridge" and left_top_chip_category != "waterway" and left_top_chip_category != "port" and left_top_chip_category_2 != "bridge" {
						obj_type_tmp = "estuary" : obj_dire_tmp = "left-right-top"
					}
					if left_bottom_chip_category != "waterway" and left_bottom_chip_category != "port" and left_bottom_chip_category_2 != "bridge" and right_bottom_chip_category != "waterway" and right_bottom_chip_category != "port" and right_bottom_chip_category_2 != "bridge" {
						obj_type_tmp = "estuary" : obj_dire_tmp = "left-right-bottom"
					}
					if right_top_chip_category != "waterway" and right_top_chip_category != "port" and right_top_chip_category_2 != "bridge" and right_bottom_chip_category != "waterway" and right_bottom_chip_category != "port" and right_bottom_chip_category_2 != "bridge" {
						obj_type_tmp = "estuary" : obj_dire_tmp = "right-top-bottom"
					}

					; åå­—å‹äº¤å·®ç‚¹
					if (left_top_chip_category != "waterway" or left_top_chip_category != "port" or left_top_chip_category_2 != "bridge") and (right_top_chip_category = "waterway" or right_top_chip_category = "port" or right_top_chip_category_2 = "bridge") and (left_bottom_chip_category = "waterway" or left_bottom_chip_category = "port" or left_bottom_chip_category_2 = "bridge") and (right_bottom_chip_category = "waterway" or right_bottom_chip_category = "port" or right_bottom_chip_category_2 = "bridge") {
						obj_type_tmp = "intersection_cross_without_one_corner" : obj_dire_tmp = "left-top"
					}
					if (left_top_chip_category = "waterway" or left_top_chip_category = "port" or left_top_chip_category_2 = "bridge") and (right_top_chip_category != "waterway" or right_top_chip_category != "port" or right_top_chip_category_2 != "bridge") and (left_bottom_chip_category = "waterway" or left_bottom_chip_category = "port" or left_bottom_chip_category_2 = "bridge") and (right_bottom_chip_category = "waterway" or right_bottom_chip_category = "port" or right_bottom_chip_category_2 = "bridge") {
						obj_type_tmp = "intersection_cross_without_one_corner" : obj_dire_tmp = "right-top"
					}
					if (left_top_chip_category = "waterway" or left_top_chip_category = "port" or left_top_chip_category_2 = "bridge") and (right_top_chip_category = "waterway" or right_top_chip_category = "port" or right_top_chip_category_2 = "bridge") and (left_bottom_chip_category != "waterway" or left_bottom_chip_category != "port" or left_bottom_chip_category_2 != "bridge") and (right_bottom_chip_category = "waterway" or right_bottom_chip_category = "port" or right_bottom_chip_category_2 = "bridge") {
						obj_type_tmp = "intersection_cross_without_one_corner" : obj_dire_tmp = "left-bottom"
					}
					if (left_top_chip_category = "waterway" or left_top_chip_category = "port" or left_top_chip_category_2 = "bridge") and (right_top_chip_category = "waterway" or right_top_chip_category = "port" or right_top_chip_category_2 = "bridge") and (left_bottom_chip_category = "waterway" or left_bottom_chip_category = "port" or left_bottom_chip_category_2 = "bridge") and (right_bottom_chip_category != "waterway" or right_bottom_chip_category != "port" or right_bottom_chip_category_2 != "bridge") {
						obj_type_tmp = "intersection_cross_without_one_corner" : obj_dire_tmp = "right-bottom"
					}
					if left_top_chip_category != "waterway" and left_top_chip_category != "port" and left_top_chip_category_2 != "bridge" and right_top_chip_category != "waterway" and right_top_chip_category != "port" and right_top_chip_category_2 != "bridge" and left_bottom_chip_category != "waterway" and left_bottom_chip_category != "port" and left_bottom_chip_category_2 != "bridge" and right_bottom_chip_category != "waterway" and right_bottom_chip_category != "port" and right_bottom_chip_category_2 != "bridge" {
						obj_type_tmp = "river_intersection_cross" : obj_dire_tmp = "null"
					}
					if (left_top_chip_category = "waterway" or left_top_chip_category = "port" or left_top_chip_category_2 = "bridge") and (right_top_chip_category = "waterway" or right_top_chip_category = "port" or right_top_chip_category_2 = "bridge") and (left_bottom_chip_category = "waterway" or left_bottom_chip_category = "port" or left_bottom_chip_category_2 = "bridge") and (right_bottom_chip_category = "waterway" or right_bottom_chip_category = "port" or right_bottom_chip_category_2 = "bridge") {
						obj_type_tmp = "intersection_cross" : obj_dire_tmp = "null"
					}
				}

				; å‘¨ã‚Šã«æ¥ç¶šã™ã‚‹é“è·¯ãŒãªã??´å?
				if correct = 0 {
					obj_type_tmp = "isolated" : obj_dire_tmp = "null"
				}
			}

			; ç©ºæ¸¯ã®æ»‘èµ°è·¯/èª˜å°è·¯
			if category(sx,sy,sz,0) = "airport" {
				correct = iforandcorrect_2(left_chip_category, left_chip_category_2, top_chip_category, top_chip_category_2, bottom_chip_category, bottom_chip_category_2, right_chip_category, right_chip_category_2, "airport", ""+category(sx,sy,sz,1)+"")

				; å‘¨å›²ã®é“è·¯æ¥ç¶šãŒ1ã¤?ˆè¡Œãæ­¢ã¾ã‚Šï¼?
				if correct = 1 {
					obj_type_tmp = "dead_end"
					if left_chip_category = "airport"	: obj_dire_tmp = "left"
					if top_chip_category = "airport"	: obj_dire_tmp = "top"
					if bottom_chip_category = "airport"	: obj_dire_tmp = "bottom"
					if right_chip_category = "airport"	: obj_dire_tmp = "right"
				}

				; å‘¨å›²ã®é“è·¯æ¥ç¶šãŒ1ã¤?ˆæ›²ãŒã‚Šè§’orç›´ç·šï¼?
				if correct = 2 {
					; æ›²ãŒã‚Šè§’ï¼ˆèª˜å°è·¯ã®ã¿??
					if category(sx,sy,sz,1) = "Taxiway" {
						if (left_chip_category = "airport") and (top_chip_category = "airport") {
							obj_type_tmp = "turn" : obj_dire_tmp = "left-top"
						}
						if (top_chip_category = "airport") and (right_chip_category = "airport") {
							obj_type_tmp = "turn" : obj_dire_tmp = "right-top"
						}
						if (left_chip_category = "airport") and (bottom_chip_category = "airport") {
							obj_type_tmp = "turn" : obj_dire_tmp = "left-bottom"
						}
						if (bottom_chip_category = "airport") and (right_chip_category = "airport") {
							obj_type_tmp = "turn" : obj_dire_tmp = "right-bottom"
						}
					}

					; ç›´ç·?
					if (left_chip_category = "airport") and (right_chip_category = "airport") {
						obj_type_tmp = "default" : obj_dire_tmp = "depth"
					}
					if (top_chip_category = "airport") and (bottom_chip_category = "airport") {
						obj_type_tmp = "default" : obj_dire_tmp = "width"
					}
				}

				; å‘¨å›²ã®é“è·¯æ¥ç¶šãŒ3ã¤??Tå­—å‹äº¤å·®ç‚¹??
				if correct = 3 {
					obj_type_tmp = "intersection_T"
					if (left_chip_category = "airport") and (top_chip_category = "airport") and (bottom_chip_category = "airport") {
						obj_dire_tmp = "left-top-bottom"
					}
					if (left_chip_category = "airport") and (right_chip_category = "airport") and (top_chip_category = "airport") {
						obj_dire_tmp = "left-right-top"
					}
					if (left_chip_category = "airport") and (right_chip_category = "airport") and (bottom_chip_category = "airport") {
						obj_dire_tmp = "left-right-bottom"
					}
					if (right_chip_category = "airport") and (top_chip_category = "airport") and (bottom_chip_category = "airport") {
						obj_dire_tmp = "right-top-bottom"
					}
				}

				; å‘¨å›²ã®é“è·¯æ¥ç¶šãŒ4ã¤?ˆåå­—å‹äº¤å·®ç‚¹?‰ã¾ãŸã?å‘¨ã‚Šã«æ¥ç¶šã™ã‚‹é“è·¯ãŒãªã??´å?
				if correct = 4 or correct = 0 {
					obj_type_tmp = "intersection_cross" : obj_dire_tmp = "null"
				}
			}

			; ã‚¿ã‚¤ãƒ—ã¨å‘ãã‚’æŒ‡å®?
			if obj_type_tmp != "" and obj_dire_tmp != "" and obj_type_tmp != obj_type(sx,sy,sz) and obj_dire_tmp != obj_dire(sx,sy,sz) {
				; è¸å?ã¾ãŸã?æ©‹ã‚’è¨­ç½®ã™ã‚‹å¿?¦ãŒã‚ã‚‹å ´å?
				if category(sx,sy,sz,1) = "train_crossing" {
					obj_type_tmp = "train_crossing"

					if cursor_mode = "put_Road" {
						if obj_dire_tmp = "width" {
							obj_dire_tmp = "depth"
						} else : if obj_dire_tmp = "depth" {
							obj_dire_tmp = "width"
						} else {
							if top_chip_category = "road" or bottom_chip_category = "road" {
								obj_dire_tmp = "depth"
							} else {
								obj_dire_tmp = "width"
							}
						}
					} else {
						if top_chip_category = "railroad" or bottom_chip_category = "railroad" {
							obj_dire_tmp = "width"
						} else {
							obj_dire_tmp = "depth"
						}
					}
				}
				if category(sx,sy,sz,1) = "bridge" {
					obj_type_tmp = "bridge"
					if obj_dire_tmp != "width" and obj_dire_tmp != "depth" {
						if category(sx,sy,sz,0) = "road" {
							if top_chip_category = "road" or bottom_chip_category = "road" {
								obj_dire_tmp = "width"
							} else : if left_chip_category = "road" or right_chip_category = "road" {
								obj_dire_tmp = "depth"
							}
						}
						if category(sx,sy,sz,0) = "railroad" {
							if top_chip_category = "railroad" or top_chip_category = "station" or bottom_chip_category = "railroad" or bottom_chip_category = "station" {
								obj_dire_tmp = "width"
							} else : if left_chip_category = "railroad" or left_chip_category = "station" or right_chip_category = "railroad" or right_chip_category = "station" {
								obj_dire_tmp = "depth"
							}
						}
					}
				}

				; è¨­å®?
				obj_type_t = element2(map(sx,sy,sz,0), addon_use_types_name, obj_type_tmp)
				obj_dire_t = element3(map(sx,sy,sz,0), obj_type_t, addon_dire_names, obj_dire_tmp)
				if obj_type_t = -1 or obj_dire_t = -1 or obj_type_tmp = "" {
					//å»ºè¨­ã«å¤±æ•—ã™ã‚Œã?ã€ãƒãƒ?ƒ•ã‚¡ã‹ã‚‰å»ºè¨­ã™ã‚‹å‰ã?çŠ¶æ…‹ã«æˆ»ã?
					name_t = name(sx,sy,sz,0)
					repeat 2
						map(sx,sy,sz,cnt) = map(sx,sy,sz,cnt+2)
						name(sx,sy,sz,cnt) = name(sx,sy,sz,cnt+2)
						obj_type(sx,sy,sz,cnt) = obj_type(sx,sy,sz,cnt+2)
						obj_dire(sx,sy,sz,cnt) = obj_dire(sx,sy,sz,cnt+2)
					loop
					repeat 3
						category(sx,sy,sz,cnt) = category(sx,sy,sz,cnt+3)
					loop

					continue
				}

				obj_type(sx,sy,sz,0) = obj_type_t
				obj_dire(sx,sy,sz,0) = obj_dire_t

				from_build = 1 : gosub *get_addon_drow_position_new

				; ã‚¢ãƒ‰ã‚ªãƒ³ã«ä¸‹åœ°ã‚¢ãƒ‰ã‚ªãƒ³ã®è¨­å®šãŒã‚ã‚‹å ´å?
				base_addon_name = sdnl3(addon_base, map(sx,sy,sz,0), obj_type_t, 0)
				if base_addon_name != "" {
					base_addon_type = sdnl3(addon_base, map(sx,sy,sz,0), obj_type_t, 1)
					base_addon_dire = sdnl3(addon_base, map(sx,sy,sz,0), obj_type_t, 2)
					repeat total_addons
						if sdnl(addon_name, cnt, 0) = base_addon_name {
							name(sx,sy,sz,1) = base_addon_name
							map(sx,sy,sz,1) = cnt
							obj_type(sx,sy,sz,1) = int(base_addon_type)
							obj_dire(sx,sy,sz,1) = int(base_addon_dire)
						}
					loop
				}
			}
		loop
	loop

	//ãã‚Œãã‚Œã®ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒãƒ•ã‚¡ã‚’æ›´æ–°
	repeat under_construction_tiles
		sx = new_roadtype_x(cnt) : sy = new_roadtype_y(cnt) : sz = 0
		repeat 2
			map(sx,sy,sz,cnt+2) = map(sx,sy,sz,cnt)
			name(sx,sy,sz,cnt+2) = name(sx,sy,sz,cnt)
			obj_type(sx,sy,sz,cnt+2) = obj_type(sx,sy,sz,cnt)
			obj_dire(sx,sy,sz,cnt+2) = obj_dire(sx,sy,sz,cnt)
		loop
		repeat 3
			category(sx,sy,sz,cnt+3) = category(sx,sy,sz,cnt)
		loop
	loop

	under_construction_tiles = 0
	return

*delete_obj
	/*----------------------------------æŒ?®šã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®å‰Šé™¤----------------------------------*/
	; ã‚¢ãƒ‰ã‚ªãƒ³ã‚’è¨­ç½®ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦å½±éŸ¿ã•ã‚Œã‚‹åœ°ä¾¡ã€çŠ¯ç½ªç?€æ•™è‚²åº¦ã¨ãã?å½±éŸ¿ç¯?›²
	addon_land_price_influence__tmp = int(sdnl(addon_land_price_influence, map(mx,my,mz,0), 0))
	addon_land_price_influence_grid__tmp = int(sdnl(addon_land_price_influence, map(mx,my,mz,0), 1))

	addon_crime_rate_influence__tmp = int(sdnl(addon_crime_rate_influence, map(mx,my,mz,0), 0))
	addon_crime_rate_influence_grid__tmp = int(sdnl(addon_crime_rate_influence, map(mx,my,mz,0), 1))

	addon_education_rate_influence__tmp = int(sdnl(addon_education_rate_influence, map(mx,my,mz,0), 0))
	addon_education_rate_influence_grid__tmp = int(sdnl(addon_education_rate_influence, map(mx,my,mz,0), 1))

	p = 1

	; å‰Šé™¤
	start_x = mx-obj_tiles(mx,my,mz,0)
	start_y = my-obj_tiles(mx,my,mz,1)

	sx = start_x : sy = start_y : sz = 0

	repeat_x = obj_use_tiles(mx,my,mz,0) : if repeat_x = 0 : repeat_x = 1
	repeat_y = obj_use_tiles(mx,my,mz,1) : if repeat_y = 0 : repeat_y = 1

	before_obj_use_tiles_x = obj_use_tiles(sx,sy,sz,0)
	before_obj_use_tiles_y = obj_use_tiles(sx,sy,sz,1)

	before_obj_dire = obj_dire(sx,sy,sz)

	repeat repeat_x
		repeat repeat_y
			map(sx,sy,sz,0)				= tile_addon_number
			name(sx,sy,sz,0)			= sdnl(addon_name, tile_addon_number, 0)

			category(sx,sy,sz,0)		= sdnl(addon_type, tile_addon_number, 0)
			category(sx,sy,sz,1)		= ""
			category(sx,sy,sz,2)		= ""

			obj_type(sx,sy,sz,0)		= 0
			obj_dire(sx,sy,sz,0)		= 0

			obj_serial_num(sx,sy,sz)	= 0

			obj_use_tiles(sx,sy,sz,0)	= 0
			obj_use_tiles(sx,sy,sz,1)	= 0

			obj_tiles(sx,sy,sz,0)		= 0
			obj_tiles(sx,sy,sz,1)		= 0

			crop(sx,sy,sz)				= ""
			crop_amount(sx,sy,sz)		= 0

			reservation(sx,sy,sz)		= "none"
			original_name(sx,sy,sz)		= ""


			from_build = 1 : gosub *get_addon_drow_position_new

			if before_obj_use_tiles_y > 1 {
				if before_obj_dire = 2 : sy-- : else : sy++
			}
		loop

		if before_obj_use_tiles_x > 1 {
			if before_obj_dire = 3 : sx-- : else : sx++
			sy = start_y
		}
	loop

	; å‘¨å›²ã®é“è·¯/ç·šè·¯/æ°´è·¯ã«åæ˜ 
	from_Delete_obj = 1
	if from_build_roadtype != 1{
		gosub *build_roadtypes
	}
	from_build_roadtype = 0

	; åœ°ä¾¡ã®å¤‰å‹•
	if addon_land_price_influence__tmp != 0 {
		if addon_land_price_influence_grid__tmp != 0 {
			add_value = addon_land_price_influence__tmp / addon_land_price_influence_grid__tmp * p
		} else : if addon_land_price_influence_grid__tmp = 0 {
			add_value = 0
		}

		round = 0
		for round, 1, addon_land_price_influence_grid__tmp+1, 1
			repeat (round*2-1)
				if mx+cnt-(round-1)>0 and mx+cnt-(round-1)<MAPSIZE_X and my+round-1>0 and my+round-1<MAPSIZE_Y {
					land_price(mx+cnt-(round-1),my+round-1,mz) -= int( addon_land_price_influence__tmp - (add_value*(round-1)) )
				}
			loop
			repeat (round*2-1)
				if mx+cnt-(round-1)>0 and mx+cnt-(round-1)<MAPSIZE_X and my-round+1>0 and my-round+1<MAPSIZE_Y {
					land_price(mx+cnt-(round-1),my-round+1,mz) -= int( addon_land_price_influence__tmp - (add_value*(round-1)) )
				}
			loop
			repeat (round*2-1)
				if mx+round-1>0 and mx+round-1<MAPSIZE_X and my+cnt-(round-1)>0 and my+cnt-(round-1)<MAPSIZE_Y {
					land_price(mx+round-1,my+cnt-(round-1),mz) -= int( addon_land_price_influence__tmp - (add_value*(round-1)) )
				}
			loop
			repeat (round*2-1)
				if mx-round+1>0 and mx-round+1<MAPSIZE_X and my+cnt-(round-1)>0 and my+cnt-(round-1)<MAPSIZE_Y {
					land_price(mx-round+1,my+cnt-(round-1),mz) -= int( addon_land_price_influence__tmp - (add_value*(round-1)) )
				}
			loop
		next
	}

	; çŠ¯ç½ªç??å¤‰å‹•
	if addon_crime_rate_influence__tmp != 0 {
		add_value = addon_crime_rate_influence__tmp / addon_crime_rate_influence_grid__tmp * p

		round = 0
		for round, 1, addon_crime_rate_influence_grid__tmp+1, 1
			repeat (round*2-1)
				if (mx+cnt-(round-1)) >= 0 and (mx+cnt-(round-1)) < MAPSIZE_X and (my+round-1) >= 0 and (my+round-1) < MAPSIZE_Y {
					crime_rate(mx+cnt-(round-1),my+round-1,mz) -= int( addon_crime_rate_influence__tmp - (add_value*(round-1)) )
					if crime_rate(mx+cnt-(round-1),my+round-1,mz) > 100  : crime_rate(mx+cnt-(round-1),my+round-1,mz) = 100
					if crime_rate(mx+cnt-(round-1),my+round-1,mz) < -100 : crime_rate(mx+cnt-(round-1),my+round-1,mz) = -100
				}
			loop
			repeat (round*2-1)
				if (mx+cnt-(round-1)) >= 0 and (mx+cnt-(round-1)) < MAPSIZE_X and (my-round+1) >= 0 and (my-round+1) < MAPSIZE_Y {
					crime_rate(mx+cnt-(round-1),my-round+1,mz) -= int( addon_crime_rate_influence__tmp - (add_value*(round-1)) )
					if crime_rate(mx+cnt-(round-1),my-round+1,mz) > 100  : crime_rate(mx+cnt-(round-1),my-round+1,mz) = 100
					if crime_rate(mx+cnt-(round-1),my-round+1,mz) < -100 : crime_rate(mx+cnt-(round-1),my-round+1,mz) = -100
				}
			loop
			repeat (round*2-1)
				if (mx+round-1) >= 0 and (mx+round-1) < MAPSIZE_X and (my+cnt-(round-1)) >= 0 and (my+cnt-(round-1)) < MAPSIZE_Y {
					crime_rate(mx+round-1,my+cnt-(round-1),mz) -= int( addon_crime_rate_influence__tmp - (add_value*(round-1)) )
					if crime_rate(mx+round-1,my+cnt-(round-1),mz) > 100  : crime_rate(mx+round-1,my+cnt-(round-1),mz) = 100
					if crime_rate(mx+round-1,my+cnt-(round-1),mz) < -100 : crime_rate(mx+round-1,my+cnt-(round-1),mz) = -100
				}
			loop
			repeat (round*2-1)
				if (mx-round-1) >= 0 and (mx-round-1) < MAPSIZE_X and (my+cnt-(round-1)) >= 0 and (my+cnt-(round-1)) < MAPSIZE_Y {
					crime_rate(mx-round+1,my+cnt-(round-1),mz) -= int( addon_crime_rate_influence__tmp - (add_value*(round-1)) )
					if crime_rate(mx-round+1,my+cnt-(round-1),mz) > 100  : crime_rate(mx-round+1,my+cnt-(round-1)) = 100
					if crime_rate(mx-round+1,my+cnt-(round-1),mz) < -100 : crime_rate(mx-round+1,my+cnt-(round-1)) = -100
				}
			loop
		next
	}

	; æ•™è‚²åº¦ã®å¤‰å‹•
	if addon_education_rate_influence__tmp != 0 {
		add_value = addon_education_rate_influence__tmp / addon_education_rate_influence_grid__tmp * p
		round = 0
		for round, 1, addon_education_rate_influence_grid__tmp+1, 1
			repeat (round*2-1)
				if (mx+cnt-(round-1)) >= 0 and (mx+cnt-(round-1)) < MAPSIZE_X and (my+round-1) >= 0 and (my+round-1) < MAPSIZE_Y {
					education_rate(mx+cnt-(round-1),my+round-1,mz) -= int( addon_education_rate_influence__tmp - (add_value*(round-1)) )
				}
			loop
			repeat (round*2-1)
				if (mx+cnt-(round-1)) >= 0 and (mx+cnt-(round-1)) < MAPSIZE_X and (my-round+1) >= 0 and (my-round+1) < MAPSIZE_Y {
					education_rate(mx+cnt-(round-1),my-round+1,mz) -= int( addon_education_rate_influence__tmp - (add_value*(round-1)) )
				}
			loop
			repeat (round*2-1)
				if (mx+round-1) >= 0 and (mx+round-1) < MAPSIZE_X and (my+cnt-(round-1)) >= 0 and (my+cnt-(round-1)) < MAPSIZE_Y {
					education_rate(mx+round-1,my+cnt-(round-1),mz) -= int( addon_education_rate_influence__tmp - (add_value*(round-1)) )
				}
			loop
			repeat (round*2-1)
				if (mx-round-1) >= 0 and (mx-round-1) < MAPSIZE_X and (my+cnt-(round-1)) >= 0 and (my+cnt-(round-1)) < MAPSIZE_Y {
					education_rate(mx-round+1,my+cnt-(round-1),mz) -= int( addon_education_rate_influence__tmp - (add_value*(round-1)) )
				}
			loop
		next
	}

	return

*get_news
	/*-------------------------------------ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®å–å¾?-----------------------------------------*/
	news_content = ""

	; ç‰¹æ®Šãƒ‹ãƒ¥ãƒ¼ã‚¹
	exist "data/news/special.news"
	if strsize = -1 : error "F06 : special.newsãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\n/data/news/ãƒ•ã‚©ãƒ«ãƒ€å†?«special.newsãŒã‚ã‚Šã¾ã›ã‚“ã€?"

	notesel news_file : noteload "data/news/special.news"

	; ãƒãƒƒãƒ—ä½œæ?ç›´å¾Œã?ãƒ‹ãƒ¥ãƒ¼ã‚¹
	if not_displayed_news_new_map = 1 {
		not_displayed_news_new_map = 0
		same_news = 0

		; åŒã˜å†?®¹ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’è¤?•°èª­ã¿è¾¼ã‚€
		repeat notemax
			noteget news_tmp, cnt

			if instr(news_tmp, 0, "case=\"new_map\"") != -1 {
				split news_tmp, ", ", tmp, news_content_candidate_tmp
				news_content_candidate(same_news) = strmid(news_content_candidate_tmp, 0, instr(news_content_candidate_tmp, 0, "}"))	; è¡¨ç¤ºã™ã‚‹ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®å€™è£?
				same_news ++	; åŒã˜å†?®¹ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®æ•°
			}
		loop

		if same_news > 0 : news_content = news_content_candidate(rnd(same_news))		; å€™è£œã?ä¸­ã‹ã‚‰ã²ã¨ã¤ãƒ©ãƒ³ãƒ€ãƒ?ã«é¸ã¶
	}

	; äººå£å¢—åŠ ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹
	if before_map_Total_Population != map_Total_Population {
		show_news_population = ""

		if before_map_Total_Population < 1000 and Total_map_Population >= 1000       : show_news_population = "over_1000"
		if before_map_Total_Population < 5000 and Total_map_Population >= 5000       : show_news_population = "over_5000"
		if before_map_Total_Population < 10000 and Total_map_Population >= 10000     : show_news_population = "over_10000"
		if before_map_Total_Population < 30000 and Total_map_Population >= 30000     : show_news_population = "over_30000"
		if before_map_Total_Population < 50000 and Total_map_Population >= 50000     : show_news_population = "over_50000"
		if before_map_Total_Population < 80000 and Total_map_Population >= 80000     : show_news_population = "over_80000"
		if before_map_Total_Population < 100000 and Total_map_Population >= 100000   : show_news_population = "over_100000"
		if before_map_Total_Population < 200000 and Total_map_Population >= 200000   : show_news_population = "over_200000"
		if before_map_Total_Population < 300000 and Total_map_Population >= 300000   : show_news_population = "over_300000"
		if before_map_Total_Population < 400000 and Total_map_Population >= 400000   : show_news_population = "over_400000"
		if before_map_Total_Population < 500000 and Total_map_Population >= 500000   : show_news_population = "over_500000"
		if before_map_Total_Population < 600000 and Total_map_Population >= 600000   : show_news_population = "over_600000"
		if before_map_Total_Population < 700000 and Total_map_Population >= 700000   : show_news_population = "over_700000"
		if before_map_Total_Population < 800000 and Total_map_Population >= 800000   : show_news_population = "over_800000"
		if before_map_Total_Population < 900000 and Total_map_Population >= 900000   : show_news_population = "over_900000"
		if before_map_Total_Population < 1000000 and Total_map_Population >= 1000000 : show_news_population = "over_1000000"

		same_news = 0

		; åŒã˜å†?®¹ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’è¤?•°èª­ã¿è¾¼ã‚€
		repeat notemax
			noteget news_tmp, cnt
			if instr(news_tmp, 0, "case=\""+show_news_population+"\"") != -1 {
				split news_tmp, ", ", tmp, news_content_candidate_tmp
				news_content_candidate(same_news) = strmid(news_content_candidate_tmp, 0, instr(news_content_candidate_tmp, 0, "}"))	; è¡¨ç¤ºã™ã‚‹ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®å€™è£?
				same_news ++	; åŒã˜å†?®¹ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®æ•°
			}
		loop
		if same_news > 0 : news_content = news_content_candidate(rnd(same_news))		; å€™è£œã?ä¸­ã‹ã‚‰ã²ã¨ã¤ãƒ©ãƒ³ãƒ€ãƒ?ã«é¸ã¶
	}

	; ç‰¹ã«å ±ã˜ã‚‹ã“ã¨ãŒãªã??´åˆã€ã©ã?§ã‚‚ã„ã?ƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’è¡¨ç¤º
	exist "data/news/others.news"
	if strsize = -1 : error "F07 : others.newsãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\n/data/news/ãƒ•ã‚©ãƒ«ãƒ€å†?«others.newsãŒã‚ã‚Šã¾ã›ã‚“ã€?"

	notesel news_file : noteload "data/news/others.news"

	if news_content = "" {
		not_displayed_news_new_map = 0
		same_news = 0

		; åŒã˜å†?®¹ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’è¤?•°èª­ã¿è¾¼ã‚€
		repeat notemax
			noteget news_tmp, cnt
			if instr(news_tmp, 0, "case=\"others\"") != -1 {
				split news_tmp, ", ", tmp, news_content_candidate_tmp
				news_content_candidate(same_news) = strmid(news_content_candidate_tmp, 0, instr(news_content_candidate_tmp, 0, "}"))	; è¡¨ç¤ºã™ã‚‹ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®å€™è£?
				same_news ++	; åŒã˜å†?®¹ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®æ•°
			}
		loop

		news_content = ""
		while news_content = ""
			if same_news > 0 : news_content = news_content_candidate(rnd(same_news))		; å€™è£œã?ä¸­ã‹ã‚‰ã²ã¨ã¤ãƒ©ãƒ³ãƒ€ãƒ?ã«é¸ã¶
		wend
	}

	before_map_Total_Population = map_Total_Population

	return

*play_BGM
	/*----------------------------------------BGMã®å†ç”Ÿ-------------------------------------------*/
	; æ¬¡ã®BGMã‚’ãƒ©ãƒ³ãƒ€ãƒ?ã«é¸å‡º
	chdir ""+directory+"\\bgm"
	mci "close Cities-Box"

	; ãƒ‘ã‚¹åã‚’å«ã‚ãŸãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’å–å¾?
	dirlist2h 1, ',' : dirlist2 buf_BGMs, "*.mp3", 1, '\\'
	sdim BGM_filelist, buf_BGMs : dirlist2r BGM_filelist
	notesel BGM_filelist : total_BGMs = notemax

	chdir directory

	; ãƒ©ãƒ³ãƒ€ãƒ?ã«é¸å‡º
	repeat
		BGM_rnd = rnd(total_BGMs)

		; ç¾åœ¨å†ç”Ÿã—ã¦ã?‚‹BGMã¨åŒã˜æ›²ã§ãªã?“ã¨ã¨ã€ç‰¹å®šã?æ¡ä»¶ä¸‹ã?ã¿ã§æµã‚Œã‚‹BGM?ˆãƒ•ã‚¡ã‚¤ãƒ«åã«[Sp]ãŒã‚ã‚‹ï¼‰ã§ãªã?“ã¨ã‚’ç¢ºèª?
		notesel BGM_filelist : noteget next_BGM_file, BGM_rnd

		if next_BGM_file != playing_BGM_file {
			if instr(next_BGM_file, 0, "[less_") != -1 {			; äººå£â—‹äººä»¥ä¸‹ã?å ´åˆã?ã¿æµã‚Œã‚‹BGM
				less_var = int(strmid(next_BGM_file, 6, instr(next_BGM_file, 0, "]")))
				if map_Total_Population <= less_var {
					playing_BGM_file = next_BGM_file
					break
				}
			} else : if instr(next_BGM_file, 0, "[more_") != -1 {	; äººå£â—‹äººä»¥ä¸Šã?å ´åˆã?ã¿æµã‚Œã‚‹BGM
				more_var = int(strmid(next_BGM_file, 6, instr(next_BGM_file, 0, "]")))
				if map_Total_Population >= more_var {
					playing_BGM_file = next_BGM_file
					break
				}
			} else : if instr(next_BGM_file, 0, "[m_") != -1 {	; â—‹æœˆã®ã¿æµã‚Œã‚‹æ›²
				month_var = int(strmid(next_BGM_file, 3, instr(next_BGM_file, 0, "]")))
				if month_var = map_time_month {
					playing_BGM_file = next_BGM_file
					break
				}
			} else : if instr(next_BGM_file, 0, "[Sp]") = -1 {
				playing_BGM_file = next_BGM_file
				break
			}
		}
		await 1
	loop

	; å¤©æ°—ãŒé›¨ãªã‚‰ã€?1/5ã®ç¢ºç?§ãƒ©ãƒ³ãƒ€ãƒ?ã§é›¨ã£ã½ã?›²ã‚’æµã™
	if add_rain > 0 and rnd(5) = 2 : playing_BGM_file = "[Sp]Satie-Jeteveux.mp3"

	; å†ç”Ÿ
	exist ""+directory+"/bgm/"+playing_BGM_file+""
	if strsize = -1 : error "S06 : å†ç”Ÿãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\nbgmãƒ•ã‚©ãƒ«ãƒ€å†?«"+playing_BGM_file+"ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€?"

	mci "open \""+directory+"\\bgm\\"+playing_BGM_file+"\" alias Cities-Box"	; é–‹ã
	mci "play Cities-Box"													    ; å†ç”Ÿ
	mci "setaudio Cities-Box volume to 1000"

	changed_BGM = 1

	; ãƒœãƒªãƒ¥ãƒ¼ãƒ?
	if config_Set_Play_BGM = 0 : mci "setaudio Cities-Box volume to 0"

	return

*climate
	/*--------------------------------------------å¤©å€™ã?å¤‰å‹•--------------------------------------*/
	; æ°—æ¸©ã®å¤‰å‹•
	change_temperature = rnd(5)
	if change_temperature = 0 and pause = 0 {
		; æ—¥ä¸­ã¯æ°—æ¸©ãŒä¸ŠãŒã‚Šã‚„ã™ãã€å¤œé–“ã¯ä¸‹ãŒã‚Šã‚„ã™ãã™ã‚‹
		temperature_increase_or_decrease = rnd(8)

		; æ—¥ä¸­
		if 8 <= map_time_Hour and 14 >= map_time_Hour {
			if 0 <= temperature_increase_or_decrease and 5 >= temperature_increase_or_decrease { temperature_increase = 1 : temperature_decrease = 0 }
			if 6 <= temperature_increase_or_decrease and 7 >= temperature_increase_or_decrease { temperature_increase = 0 : temperature_decrease = 1 }

		; å¤œé–“
		} else {
			if 0 <= temperature_increase_or_decrease and 1 >= temperature_increase_or_decrease { temperature_increase = 1 : temperature_decrease = 0 }
			if 2 <= temperature_increase_or_decrease and 7 >= temperature_increase_or_decrease { temperature_increase = 0 : temperature_decrease = 1 }
		}

		; 12æœˆï½?2æœˆï¼?-10â„?½?15â„??ç¯?›²ã§æ°—æ¸©ã‚’å¤‰å‹•
		if map_time_Month = 12 or (1 <= map_time_Month and 2 >= map_time_Month) {
			if temperature_increase = 1 and map_temperature < 15  : map_temperature ++
			if temperature_decrease = 1 and map_temperature > -10 : map_temperature --
		}

		; 3æœˆï½?5æœˆï¼?10â„?½?25â„??ç¯?›²ã§æ°—æ¸©ã‚’å¤‰å‹•
		if 3 <= map_time_Month and 5 >= map_time_Month {
			if temperature_increase = 1 and map_temperature < 25 : map_temperature ++
			if temperature_decrease = 1 and map_temperature > 10 : map_temperature --
		}

		; 6æœˆï½?8æœˆï¼?20â„?½?35â„??ç¯?›²ã§æ°—æ¸©ã‚’å¤‰å‹•
		if 6 <= map_time_Month and 8 >= map_time_Month {
			if temperature_increase = 1 and map_temperature < 35 : map_temperature ++
			if temperature_decrease = 1 and map_temperature > 20 : map_temperature --
		}

		; 9æœˆï½?11æœˆï¼?10â„?½?25â„??ç¯?›²ã§æ°—æ¸©ã‚’å¤‰å‹•
		if 9 <= map_time_Month and 11 >= map_time_Month {
			if temperature_increase = 1 and map_temperature < 25 : map_temperature ++
			if temperature_decrease = 1 and map_temperature > 10 : map_temperature --
		}
	}

	; å¤©æ°—ã?å¤‰å‹•
	; é›¨ãƒ»é›ªã®è¡¨ç¤ºã€æ°—æ¸©ã®å¤‰å‹•
	if map_Set_Change_Weather = 1 {
		add_rain_increase_or_decrease = rnd(2)
		if add_rain_increase_or_decrease = 0 {
			add_rain --
		} else : if add_rain_increase_or_decrease = 1 {
			add_rain ++
		}

		repeat 50
			if rain_y(cnt) >= windowy or rain(cnt) = 0 {
				rain_increase_or_decrease = rnd(2)

				if rain_increase_or_decrease = 0 and add_rain >= 0 {
					rain(cnt) = 1
					rain_x(cnt) = rnd(windowx)
					rain_y(cnt) = -rnd(windowy)
					snow_size(cnt) = rnd(5)+1
				} else {
					rain(cnt) = 0
					rain_x(cnt) = 0
					rain_y(cnt) = 0
					snow_size(cnt) = 0
				}
			}

			if rain(cnt) = 1 {
				color 255, 255, 255
				if map_temperature >= 3 {	; æ°—æ¸©ã?3â„?»¥ä¸Šãªã‚‰é›¨
					if pause = 0 {
						rain_y(cnt) += 5 * speed
					}
					line rain_x(cnt), rain_y(cnt), rain_x(cnt), rain_y(cnt)+20
				} else {				; æ°—æ¸©ã?2â„?»¥ä¸‹ãªã‚‰é›ª
					if pause = 0 {
						rain_x(cnt) += (rnd(3)-1)*2
						rain_y(cnt) += 1 * speed
					}
					circle rain_x(cnt), rain_y(cnt), rain_x(cnt)+snow_size(cnt), rain_y(cnt)+snow_size(cnt)
				}
			}
		loop
	}

	return

*show_detail
	/*---------------------------------ã‚¿ã‚¤ãƒ«ã®è©³ç´°ã‚’è¡¨ç¤º-----------------------------------------*/
	; æ›´åœ°ãªã‚‰return
	if category(clicked_mx, clicked_my, clicked_mz, 0) = "tile" {
		return
	}
	
	; ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®å¤§ãã•ã‚’æ–‡å­—å?ã®é•·ã•ã«ã‚ˆã£ã¦æ±ºã‚ã‚‹
	buffer 999
		font config_SystemFont, 14
		if original_name(clicked_mx, clicked_my, clicked_mz) = "" {
			mes sdnl(addon_name, map(clicked_mx,clicked_my,clicked_mz), 1)
		} else {
			mes original_name(clicked_mx, clicked_my, clicked_mz)
		}

		diax = ginfo(14) + 5 : diay1 = ginfo(15) + 2
		if diax < 100 : diax = 100

	gsel 0

	; ç›¸å¯¾çš?ªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®è¡¨ç¤ºåº§æ¨™ã?ç®—å?
	show_detail_position_x = clicked_mx * CHIP_SIZE/2 - clicked_my * CHIP_SIZE/2 - camx
	show_detail_position_y = clicked_my * CHIP_SIZE/4 + clicked_mx * CHIP_SIZE/4 - camy + CHIP_SIZE

	; è©³ç´°
	dia_lines = 0
	mes_tmp = ""

	if category(clicked_mx, clicked_my, clicked_mz, 0) = "residential" {
		mes_tmp = "ä½å®?œ°åŒº\nä½æ°? : "+residents(clicked_mx, clicked_my, clicked_mz)+"äºº\nå¹¸ç¦åº¦ : "+happiness(clicked_mx, clicked_my, clicked_mz)+"\næ•™è‚²åº¦ : "+education_rate(clicked_mx, clicked_my, clicked_mz)+"\nåœ°ä¾¡ : Â§"+land_price(clicked_mx, clicked_my, clicked_mz)+"0000"
		dia_lines = 5
	}
	if category(clicked_mx, clicked_my, clicked_mz, 0) = "commercial" {
		mes_tmp = "å•?¥­åœ°åŒº\nåŠ´åƒè€?•° : "+workers(clicked_mx, clicked_my, clicked_mz)+"äºº\nå¹¸ç¦åº¦ : "+happiness(clicked_mx, clicked_my, clicked_mz)+"\nåœ°ä¾¡ : Â§"+land_price(clicked_mx, clicked_my, clicked_mz)+"0000"
		dia_lines = 4
	}
	if category(clicked_mx, clicked_my, clicked_mz, 0) = "office" {
		mes_tmp = "ã‚ªãƒ•ã‚£ã‚¹åœ°åŒº\nåŠ´åƒè€?•° : "+workers(clicked_mx, clicked_my, clicked_mz)+"äºº\nå¹¸ç¦åº¦ : "+happiness(clicked_mx, clicked_my, clicked_mz)+"\nåœ°ä¾¡ : Â§"+land_price(clicked_mx, clicked_my, clicked_mz)+"0000"
		dia_lines = 4
	}
	if category(clicked_mx, clicked_my, clicked_mz, 0) = "industrial" {
		mes_tmp = "å·¥æ¥­åœ°åŒº\nåŠ´åƒè€?•° : "+workers(clicked_mx, clicked_my, clicked_mz)+"äºº\nå¹¸ç¦åº¦ : "+happiness(clicked_mx, clicked_my, clicked_mz)+"\nåœ°ä¾¡ : Â§"+land_price(clicked_mx, clicked_my, clicked_mz)+"0000"
		dia_lines = 4
	}
	if category(clicked_mx, clicked_my, clicked_mz, 0) = "farm" {
		mes_tmp = "è¾²æ¥­åœ°åŒº\nåŠ´åƒè€?•° : "+workers(clicked_mx, clicked_my, clicked_mz)+"äºº\nå¹¸ç¦åº¦ : "+happiness(clicked_mx, clicked_my, clicked_mz)+"\nåœ°ä¾¡ : Â§"+land_price(clicked_mx, clicked_my, clicked_mz)+"0000\nç”Ÿç”£ç‰© : "+crop(clicked_mx, clicked_my, clicked_mz)+""
		dia_lines = 5
	}
	if category(clicked_mx, clicked_my, clicked_mz, 0) = "public" {
		mes_tmp = "å…¬å…±æ–½è¨­\nåŠ´åƒè€?•° : "+workers(clicked_mx, clicked_my, clicked_mz)+"äºº\nå¹¸ç¦åº¦ : "+happiness(clicked_mx, clicked_my, clicked_mz)+"\nåœ°ä¾¡ : Â§"+land_price(clicked_mx, clicked_my, clicked_mz)+"0000"
		dia_lines = 4
	}
	if category(clicked_mx, clicked_my, clicked_mz, 0) = "park" {
		mes_tmp = "å…¬åœ’\nåœ°ä¾¡ : Â§"+land_price(clicked_mx, clicked_my, clicked_mz)+"0000"
		dia_lines = 2
	}

	; è©³ç´°ã®è¡¨ç¤ºã«ã‹ã‹ã‚‹ã‚µã‚¤ã‚ºã‚’å–å¾?
	buffer 999
		font config_SystemFont, 10
		pos 0, 0 : mes mes_tmp
		diay2 = ginfo(15) * dia_lines
	gsel 0

	; è¡¨ç¤º
	color 255, 255, 255
	line show_detail_position_x+32, show_detail_position_y-100, show_detail_position_x+32, show_detail_position_y-32

	color 0, 0, 0
	sboxf 128, show_detail_position_x+32, show_detail_position_y-100-(diay1+5+diay2+5), show_detail_position_x+32+15+diax+25, show_detail_position_y-100

	if category(clicked_mx, clicked_my, clicked_mz, 0) = "residential" : color 34, 177, 76
	if category(clicked_mx, clicked_my, clicked_mz, 0) = "commercial"  : color 63, 72, 204
	if category(clicked_mx, clicked_my, clicked_mz, 0) = "office"      : color 0, 162, 232
	if category(clicked_mx, clicked_my, clicked_mz, 0) = "industrial"  : color 255, 242, 0
	if category(clicked_mx, clicked_my, clicked_mz, 0) = "farm"        : color 185, 122, 87
	if category(clicked_mx, clicked_my, clicked_mz, 0) = "public"      : color 195, 195, 195
	if category(clicked_mx, clicked_my, clicked_mz, 0) = "park"        : color 119, 153, 17
	if category(clicked_mx, clicked_my, clicked_mz, 0) = "road"        : color 50, 50, 50
	if category(clicked_mx, clicked_my, clicked_mz, 0) = "railroad"    : color 175, 112, 77
	if category(clicked_mx, clicked_my, clicked_mz, 0) = "waterway"    : color 0, 0, 255
	if category(clicked_mx, clicked_my, clicked_mz, 0) = "station"     : color 255, 0, 0
	if category(clicked_mx, clicked_my, clicked_mz, 0) = "port"        : color 255, 0, 0

	boxf show_detail_position_x+32, show_detail_position_y-100-(diay1+5+diay2+5), show_detail_position_x+32+10, show_detail_position_y-100

	color 255, 255, 255
	; å»ºç‰©åï¼ˆã‚¢ãƒ‰ã‚ªãƒ³åï¼?
	font config_SystemFont, 14
	pos show_detail_position_x+32+15, show_detail_position_y-100-(diay1+5+diay2+5)+5
	if original_name(clicked_mx, clicked_my, clicked_mz) = "" {
		mes sdnl(addon_name, map(clicked_mx,clicked_my,clicked_mz), 1)
	} else {
		mes original_name(clicked_mx, clicked_my, clicked_mz)
	}

	; è©³ç´°
	font config_SystemFont, 10
	pos show_detail_position_x+32+15, show_detail_position_y-100-(diay1+5+diay2+5)+diay1+5 : mes mes_tmp
	//mes "Category:"+category(clicked_mx,clicked_my)+"\nType:"+obj_type(clicked_mx,clicked_my)+" / Dire:"+obj_dire(clicked_mx,clicked_my)+""	; category, obj_type, obj_direã®æƒ??±

	; å»ºç‰©åå¤‰æ›´ãƒœã‚¿ãƒ³
	pos show_detail_position_x+32+15+diax+25-20, show_detail_position_y-100-(diay1+5+diay2+5) : gmode 2 : gcopy 71, 0, 0, 20, 20

	return

*fix_new_name
	/*-----------------------------------å»ºç‰©åã‚’å¤‰æ›´---------------------------------------------*/
	original_name(clicked_mx, clicked_my, clicked_mz) = new_name

	clrobj new_name_stat
	showing_new_name_input = 0

	return

*processing_start_of_day
	/*---------------------ä¸€æ—¥ã®å§‹ã¾ã‚Šã?å‡¦ç?¼ˆä½æ°‘ã?å¤‰å‹•ã€äºˆç®—ã?æ”¯å‡ºãªã©??-----------------------*/
	gosub *processing_get_first

	sx = 0 : sy = 0 : sz = 0
	happiness_tmp = 0

	gender_M = 0 : gender_F = 0

	map_total_Residential = 0 : map_total_Commercial = 0 : map_total_Office = 0 : map_total_Industrial = 0 : map_total_Farm = 0
	map_total_Police_Stations = 0 : map_total_Fire_Depertments = 0 : map_total_Post_Offices = 0 : map_total_Education = 0

	map_Total_Population = 0
	map_gender_M = 0 : map_gender_F = 0

	repeat MAPSIZE_X
		sx = cnt
		repeat MAPSIZE_Y
			sy = cnt

			; äººå£ãƒ»åŠ´åƒäººå£ãƒ»éœ€è¦åº¦ãªã©ã‚’å¢—æ¸?
			if category(sx,sy,sz,0) = "residential" {
				; ä½æ°‘æ•°ã‚’å¤‰æ›´ã™ã‚‹ã‹ã©ã?‹æ±ºã‚ã‚‹?ˆä½æ°‘æ•°0ãªã‚‰é«˜ç¢ºç?¼?
				if residents(sx,sy,sz) = 0 : rtmp = rnd(10) : else : rtmp = rnd(100)

				; ä½æ°‘æ•°ã®å¢—æ¸?
				if rtmp = 9 {
					if map_demand_Residential < 0 : map_demand_Residential = 0

					rndv = rnd(2)

					; å¤‰æ›´å‰ã?ä½æ°‘æ•°
					before_residents = residents(sx,sy,sz)

					; å¤‰æ›´å‰ã?ä½æ°‘ã?å¹´é½¢ã¨æ€§åˆ¥
					sdim age_in_Residential_tmp, 16, before_residents + 10
					split age(sx,sy,sz), "]", age_in_Residential_tmp
					dim age_in_Residential, before_residents + 10
					repeat before_residents
						split age_in_Residential_tmp(cnt), "[", cut, age_in_Residential_tmp(cnt)
						age_in_Residential(cnt) = int(age_in_Residential_tmp(cnt))
					loop

					sdim gender_in_Residential_tmp, 16, before_residents + 10
					split gender(sx,sy,sz), "]", gender_in_Residential_tmp
					dim gender_in_Residential, before_residents + 10
					repeat before_residents
						split gender_in_Residential_tmp(cnt), "[", cut, gender_in_Residential_tmp(cnt)
						gender_in_Residential(cnt) = int(gender_in_Residential_tmp(cnt))
					loop

					; ä½æ°‘æ•°ã®å¢—æ¸›å?ç?
					; ä½æ°‘ã?å¢—åŠ 
					if rndv = 0 {
						if int(sdnl(addon_maximum_capacity, map(sx,sy,sz,0), 0)) - before_residents > 0 {
							add_residents = rnd(int(sdnl(addon_maximum_capacity, map(sx,sy,sz,0), 0)) - before_residents)
							residents(sx,sy,sz) += add_residents
							map_demand_Residential -= add_residents

							repeat add_residents
								new_age_tmp = rnd(120)
								if new_age_tmp <= 4 {
									new_age_tmp = 0			; 1/30ã®ç¢ºç?§0æ­³å…?
								} else {
									new_age_tmp -= 4		; new_age_tmp > 4ã®å ´åˆã€new_age_tmpã‹ã‚‰4å¼•ã„ãŸæ­³ã‚’æ–°ã—ã„ä½æ°‘ã?å¹´é½¢ã¨ã™ã‚‹
								}

								age(sx,sy,sz) += "["+new_age_tmp+"]"

								gender_rnd = rnd(2)
								if gender_rnd = 0 : gender(sx,sy,sz) += "[m]"
								if gender_rnd = 1 : gender(sx,sy,sz) += "[f]"
							loop
						}
					}

					; ä½æ°‘ã?æ¸›å°?
					if rndv = 1 {
						if before_residents > 0 {
							cut_residents = rnd(before_residents+5) - 5
							if cut_residents < 0 {
								residents(sx,sy,sz) = 0										; -5 <= cut_residents < 0ã®å ´åˆã€ãã®å®¶ã®ä½æ°‘å?å“¡ãŒã?ãƒ??å¤–ã¸å‡ºã‚?
							} else {
								residents(sx,sy,sz) = before_residents - (cut_residents + 5)	; ãã?ä»–ã?å ´åˆã€cut_residetsã«5ã‚’è¶³ã—ãŸäººæ•°ãŒã?ãƒ??å¤–ã¸å‡ºã‚?
							}
							age(sx,sy,sz) = ""
							gender(sx,sy,sz) = ""
							if residents(sx,sy,sz) > 0 {
								repeat residents(sx,sy,sz)
									age(sx,sy,sz) += "["+age_in_Residential(cnt)+"]"
									gender(sx,sy,sz) += "["+gender_in_Residential(cnt)+"]"
								loop
							}
						}
					}

					if residents(sx,sy,sz) < 0 : residents(sx,sy,sz) = 0
				}

				; ç·äººå£æ•°ã«ã‚‚åæ˜?
					map_Total_Population += residents(sx,sy,sz)

				; æ¯å¹´1æœ?1æ—¥ã«ã€ä½æ°‘ã?å¹´é½¢ã«1ã‚’è¶³ã?
				if map_Time_Month = 1 and map_Time_Date = 1 and residents(sx,sy,sz) > 0 {
					; å¹´é½¢ã«1ã‚’è¶³ã?
					//dim age_in_Residential, residents(sx,sy,sz)
					repeat residents(sx,sy,sz)
						; 120æ­³ã‚’å¯¿å‘½ã¨ã—ã¦ã€drop = 0ãªã‚‰ä½äººä¸€äººãŒæ­»äº¡
						drop = rnd(121-age_in_Residential(cnt))

						if drop = 0 {
							age_in_Residential(cnt) = -1
							map_Total_Population -= 1
						} else {
							age_in_Residential(cnt) ++
						}
						age(sx,sy,sz) = ""
						gender(sx,sy,sz) = ""
						repeat residents(sx,sy,sz)
							if age_in_Residential(cnt) >= 0 {
								gender(sx,sy,sz) += "["+gender_in_Residential(cnt)+"]"
								age(sx,sy,sz) += "["+age_in_Residential(cnt)+"]"
							}
						loop
					loop
				}

				; ä½äººã®å¹´é½¢ã‚’å–å¾?
				sdim age_in_Residential_tmp, 16, residents(sx,sy,sz)
				split age(sx,sy,sz), "]", age_in_Residential_tmp
				dim age_in_Residential, residents(sx,sy,sz)
				repeat residents(sx,sy,sz)
					split age_in_Residential_tmp(cnt), "[", cut, age_in_Residential_tmp(cnt)
					age_in_Residential(cnt) = int(age_in_Residential_tmp(cnt))
				loop

				; å°±è·å…ˆã¾ãŸã?å°±å­¦å…ˆã?æ±ºå®?
				gosub *fix_workplace
				gosub *fix_school
			}

			; å¹¸ç¦åº¦ã‚’æ›´æ–°
			happiness(sx,sy,sz) = (int(((double(land_price(sx,sy,sz))/200)*100)*0.40) - int((double(crime_rate(sx,sy,sz)/50)*0.20)) + int(((double(education_rate(sx,sy,sz))/60)*100)*0.20)) - int((double(noise(sx,sy,sz))*0.20))

			; å¹¸ç¦åº¦ã®å¹³å?€¤ã‚’ç®—å?ã™ã‚‹ãŸã‚ã«å¹¸ç¦åº¦ã‚’åŠ ç®?
			happiness_tmp += happiness(sx,sy,sz)

			; ç”·å¥³åˆ¥äººå£ã‚’ç®—å?
			if gender(sx,sy,sz) != "" and residents(sx,sy,sz) > 0 {
				split gender(sx,sy,sz), "]", gender_tmp

				repeat residents(sx,sy,sz)
					if instr(gender_tmp(cnt), 0, "m") != -1 {
						gender_M ++
						map_gender_M ++
					}
					if instr(gender_tmp(cnt), 0, "f") != -1 {
						gender_F ++
						map_gender_F ++
					}
				loop
			}

			; ã‚¢ãƒ‰ã‚ªãƒ³ã®è¡¨ç¤ºä½ç½®ã‚’ã‚‚ã?¸€åº¦ç¢ºèªï¼ˆæ¯æœˆ1æ—¥ã®ã¿ã€ã‚¿ã‚¤ãƒ«è‰²ã®å¤‰æ›´ã®ãŸã‚??
			if map_time_Date = 1 { from_Build = 1 : gosub *get_addon_drow_position_new }

			; ç¨éßã‚’æ”¯å‡º??¾´åã™ã‚‹ãŸã‚ã«ãã‚Œãã‚Œã®å»ºç‰©ã®ç·æ•°ã‚’å–å¾—ï¼ˆæ¯æœˆ1æ—¥ã®ã¿??
			if category(sx,sy,sz,1) = "police_station"  : map_total_Police_Stations ++
			if category(sx,sy,sz,1) = "fire_depertment" : map_total_Fire_Depertments ++
			if category(sx,sy,sz,1) = "post_office"     : map_total_Post_Offices ++
			if category(sx,sy,sz,1) = "education"       : map_total_Education ++

			if category(sx,sy,sz,0) = "residential"     : map_total_Residential ++
			if category(sx,sy,sz,0) = "commercial"      : map_total_Commercial ++
			if category(sx,sy,sz,0) = "office"          : map_total_Office ++
			if category(sx,sy,sz,0) = "industrial"      : map_total_Industrial ++
			if category(sx,sy,sz,0) = "farm"            : map_total_Farm ++

		loop
		await 1
	loop

	; å¹¸ç¦åº¦ã®å¹³å?€¤ã‚’ç®—å?
	happiness_ave = happiness_tmp / (MAPSIZE_X*MAPSIZE_Y)

	; æ”¯æŒç‡ã‚’ç®—å?
	map_approval_rate = happiness_ave

	; ç¨éßã®æ”¯å‡º??¾´åï¼ˆæ¯æœˆ1æ—¥ã®ã¿??
	; ãŠã‚ˆã³æœˆã”ã¨ã®çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã®å‡ºåŠ?
	; ã•ã‚‰ã«ã‚ªãƒ¼ãƒˆã‚»ãƒ¼ãƒ–ã‚‚è¡Œã†
	if map_time_Date = 1 {
		; ç¨éßã®æ”¯å‡º??¾´å?
		if map_total_Police_Stations = 0  : take_budget_of_Police = 0          : else : take_budget_of_Police = map_total_Police_Stations * map_budget_of_Police*10
		if map_total_Fire_Depertments = 0 : take_budget_of_Fire_Depertment = 0 : else : take_budget_of_Fire_Depertment = map_total_Fire_Depertments * map_budget_of_Police*10
		if map_total_Post_Offices = 0     : take_budget_of_Post_Office = 0     : else : take_budget_of_Post_Office = map_total_Post_Offices * map_budget_of_Post_Office*10
		if map_total_Education = 0        : take_budget_of_Education = 0       : else : take_budget_of_Education = map_total_Education * map_budget_of_Education*10

		if map_total_Residential = 0 : take_tax_of_Residential = 0 : else : take_tax_of_Residential = map_total_Residential * map_tax_of_Residential
		if map_total_Commercial = 0  : take_tax_of_Commercial = 0  : else : take_tax_of_Commercial = map_total_Commercial * map_tax_of_Commercial
		if map_total_Office = 0      : take_tax_of_Office = 0      : else : take_tax_of_Office = map_total_Office * map_tax_of_Office
		if map_total_Industrial = 0  : take_tax_of_Industrial = 0  : else : take_tax_of_Industrial = map_total_Industrial * map_tax_of_Industrial
		if map_total_Farm = 0        : take_tax_of_Farm = 0        : else : take_tax_of_Farm = map_total_Farm * map_tax_of_Farm

		map_Money -= take_budget_of_Police + take_budget_of_Fire_Depertment + take_budget_of_Post_Office + take_budget_of_Education
		map_Money += take_tax_of_Residential + take_tax_of_Commercial + take_tax_of_Office + take_tax_of_Industrial + take_tax_of_Farm

		; çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã®å‡ºåŠ?
		notesel statistics
		noteadd "date : "+map_time_Year+"."+map_time_Month+".1, population total : "+map_Total_Population+", population man : "+map_gender_M+", population female : "+map_gender_F+", money : "+map_Money+", approval rate : "+map_approval_rate+", workers commercial : "+map_Total_workers_Commercial+", workers office : "+map_Total_workers_Office+", workers industrial : "+map_Total_workers_Industrial+", workers farm : "+map_Total_workers_Farm+""

		; ã‚ªãƒ¼ãƒˆã‚»ãƒ¼ãƒ–ï¼?config_Auto_Save = 1ã®ã¨ãï¼?
		if config_Auto_Save = 1 {
			from_autosave = 1
			gosub *save
		}
	}

	; éœ€è¦åº¦ã‚’å¢—æ¸?
	; ç·æ±‚äººæ•°ã‚’å–å¾?
	before_Vacancies = Vacancies
	Vacancies = (map_total_Commercial_maximum_capacity-map_Total_workers_Commercial) + (map_total_Office_maximum_capacity-map_Total_workers_Office) + (map_total_Industrial_maximum_capacity-map_Total_workers_Industrial) + (map_total_Public_maximum_capacity-map_Total_workers_Public)

	; éåŠ´åƒè€?¼ˆå­¦ç”Ÿå«ã‚€?‰æ•°ã‚’å–å¾?
	before_Vagrants = Vagrants
	map_Total_Vagrants = map_Total_Population - map_Total_workers_Commercial - map_Total_workers_Office - map_Total_workers_Industrial - map_Total_workers_Public

	if map_Total_Vagrants < 0 : map_Total_Vagrants = 0

	; RCOIFéœ€è¦ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’å¤‰å‹•
	; Residential?ˆä½å±?¼?
	if map_Total_Population > 0 {
		map_demand_Residential 	= happiness_ave + (-rnd(20)+10) + Special_map_demand_Residential
	} else {
		map_demand_Residential 	= 100
	}
	if map_demand_Residential < 0 : map_demand_Residential = 1
	if map_demand_Residential > 100 : map_demand_Residential = 100

	; Commercial?ˆå•†æ¥­??
	if map_Total_Commercial_maximum_capacity > 0 {
		map_demand_Commercial 	+= rnd(30) - 10  + Special_map_demand_Commercial
	} else {
		map_demand_Commercial 	= 100
	}
	if map_demand_Commercial < 0 : map_demand_Commercial = 1
	if map_demand_Commercial > 100 : map_demand_Commercial = 100

	; Office?ˆã‚ªãƒ•ã‚£ã‚¹??
	if map_Total_Office_maximum_capacity > 0 {
		map_demand_Office 		+= rnd(30) - 10  + Special_map_demand_Office
	} else {
		map_demand_Office 		= 100
	}
	if map_demand_Office < 0 : map_demand_Office = 1
	if map_demand_Office > 100 : map_demand_Office = 100

	; Industrial?ˆå·¥æ¥­??
	if map_Total_Industrial_maximum_capacity > 0 {
		map_demand_Industrial 	+= rnd(30) - 10  + Special_map_demand_Industrial
	} else {
		map_demand_Industrial 	= 100
	}
	if map_demand_Industrial < 0 : map_demand_Industrial = 1
	if map_demand_Industrial > 100 : map_demand_Industrial = 100

	; Farm?ˆè¾²æ¥­??
	if map_Total_Farm_maximum_capacity > 0 {
		map_demand_Farm 	+= rnd(30) - 10  + Special_map_demand_Farm
	} else {
		map_demand_Farm 	= 100
	}
	if map_demand_Farm < 0 : map_demand_Farm = 1
	if map_demand_Farm > 100 : map_demand_Farm = 100

	return

*processing_get_first
	/*-----------*processingã§æ‰±ã?ƒ‡ãƒ¼ã‚¿ã®ã?¡ã€å–å¾—ã«æ™‚é–“ãŒã‹ã‹ã‚‹ã‚‚ã?ã‚’äºˆã‚å–å¾—ã—ã¦ãŠã----------*/
	; è·å ´
	dim all_workplace_x, next_obj_serial_num
	dim all_workplace_y, next_obj_serial_num
	dim all_workplace_z, next_obj_serial_num

	gx = 0 : gy = 0 : gz = 0 : gi = 0

	repeat MAPSIZE_X
		gx = cnt
		repeat MAPSIZE_Y
			gy = cnt
			if category(gx,gy,gz,0) = "commercial" or category(gx,gy,gz,0) = "office" or category(gx,gy,gz,0) = "industrial" or category(gx,gy,gz,0) = "farm" or category(gx,gy,gz,0) = "public" {
				all_workplace_x(gi) = gx : all_workplace_y(gi) = gy : all_workplace_z(gi) = gz
				gi ++
			}
		loop
	loop

	; å­¦æ ¡
	dim all_elementary_schools_x, next_obj_serial_num : dim all_elementary_schools_y, next_obj_serial_num : dim all_elementary_schools_z, next_obj_serial_num
	dim all_junior_high_schools_x, next_obj_serial_num : dim all_junior_high_schools_y, next_obj_serial_num : dim all_junior_high_schools_z, next_obj_serial_num
	dim all_high_schools_x, next_obj_serial_num : dim all_high_schools_y, next_obj_serial_num : dim all_high_schools_z, next_obj_serial_num
	dim all_universities_x, next_obj_serial_num : dim all_universities_y, next_obj_serial_num : dim all_universities_z, next_obj_serial_num

	gx = 0 : gy = 0 : gz = 0
	gi_e = 0 : gi_j = 0 : gi_h = 0 : gi_u = 0

	repeat MAPSIZE_X
		gx = cnt
		repeat MAPSIZE_Y
			gy = cnt
			if category(gx,gy,gz,2) = "elementary-school" {
				all_elementary_schools_x(gi_e) = gx : all_elementary_schools_y(gi_e) = gy : all_elementary_schools_z(gi_e) = gz
				gi_e ++
			}
			if category(gx,gy,gz,2) = "junior-high-school" {
				all_junior_high_schools_x(gi_j) = gx : all_junior_high_schools_y(gi_j) = gy : all_junior_high_schools_z(gi_j) = gz
				gi_j ++
			}
			if category(gx,gy,gz,2) = "high-school" {
				all_high_schools_x(gi_h) = gx : all_high_schools_y(gi_h) = gy : all_high_schools_z(gi_h) = gz
				gi_h ++
				}
			if category(gx,gy,gz,2) = "university" {
				all_universities_x(gi_u) = gx : all_universities_y(gi_u) = gy : all_universities_z(gi_u) = gz
				gi_u ++
			}
		loop
	loop

	return

*fix_workplace
	/*------------------------------------ä½æ°‘ã?è·å ´ã‚’æ±ºå®?----------------------------------------*/
	sdim workplace_tmp, 8, residents(sx,sy,sz)
	split workplace(sx,sy,sz), "][", workplace_tmp
	workplace(sx,sy,sz) = ""
	repeat residents(sx,sy,sz)
		if instr(workplace_tmp(cnt), 0, "[") != -1 : split workplace_tmp(cnt), "[", cut, workplace_tmp(cnt)
		if instr(workplace_tmp(cnt), 0, "]") != -1 : split workplace_tmp(cnt), "]", workplace_tmp(cnt), cut

		; åŠ´åƒè€?Œå±?‚‹ã®ã«ç·åŠ´åƒè€?•°ã?0ã®å ´åˆï¼ˆãƒã‚°å¯¾ç­–ï¼?
		if workers_zero = 1 {
			if instr(workplace(sx,sy,sz), 0, "c") != -1 : map_Total_workers_Commercial += 1
			if instr(workplace(sx,sy,sz), 0, "o") != -1 : map_Total_workers_Office += 1
			if instr(workplace(sx,sy,sz), 0, "i") != -1 : map_Total_workers_Industrial += 1
			if instr(workplace(sx,sy,sz), 0, "f") != -1 : map_Total_workers_Farm += 1
			if instr(workplace(sx,sy,sz), 0, "p") != -1 : map_Total_workers_Public += 1

			if sx = MAPSIZE_X and sy = MAPSIZE_Y and sz = MAPSIZE_Z : workers_zero = 0
		}

		if workplace_tmp(cnt) = "" and age_in_Residential(cnt) >= 18 and age_in_Residential(cnt) <= 60 {
			; å°±è·å…ˆãŒæ±ºã¾ã£ã¦ãŠã‚‰ãšã€ã‹ã¤18æ­³ä»¥ä¸?60æ­³ä»¥ä¸‹ãªã‚?(å¹´é½¢/10)åˆ??1ã®ç¢ºç?§å°±è·å…ˆã‚’æ±ºã‚ã‚‹
			dr = rnd((age_in_Residential(cnt)/10))

			if dr = 0 {
				new_workplace_rnd = rnd(gi-1)	; è·å ´ã¯ãƒ©ãƒ³ãƒ€ãƒ?ã«æ±ºã‚ã‚‹
				new_workplace_x = all_workplace_x(new_workplace_rnd)
				new_workplace_y = all_workplace_y(new_workplace_rnd)
				new_workplace_z = all_workplace_z(new_workplace_rnd)

				; åå®¹äººæ•°å†?«åã¾ã‚‹å?´åˆã?å°±è·ã‚’æ±ºå®šã™ã‚?
				if category(new_workplace_x, new_workplace_y, new_workplace_z, 0) = "commercial" {
					if int(sdnl(addon_maximum_capacity, map(new_workplace_x, new_workplace_y, new_workplace_z), 0)) >= workers(new_workplace_x, new_workplace_y, new_workplace_z) + 1 {
						workers(new_workplace_x, new_workplace_y, new_workplace_z) ++
						workplace_tmp(cnt) = "c"+str(obj_serial_num(new_workplace_x, new_workplace_y, new_workplace_z))+""

						map_Total_workers_Commercial ++
						map_demand_Commercial --

						repeat gi
							if obj_serial_num(all_workplace_x(cnt), all_workplace_y(cnt), all_workplace_z(cnt)) = obj_serial_num(new_workplace_x, new_workplace_y, new_workplace_z) {
								workers(all_workplace_x(cnt), all_workplace_y(cnt), all_workplace_z(cnt)) ++
							}
						loop
					}
				}
				if category(new_workplace_x, new_workplace_y, new_workplace_z, 0) = "office" {
					if int(sdnl(addon_maximum_capacity, map(new_workplace_x, new_workplace_y, new_workplace_z), 0)) >= workers(new_workplace_x, new_workplace_y, new_workplace_z) + 1 {
						workers(new_workplace_x, new_workplace_y, new_workplace_z) ++
						workplace_tmp(cnt) = "o"+str(obj_serial_num(new_workplace_x, new_workplace_y, new_workplace_z))+""

						map_Total_workers_Office ++
						map_demand_Office --

						repeat gi
							if obj_serial_num(all_workplace_x(cnt), all_workplace_y(cnt), all_workplace_z(cnt)) = obj_serial_num(new_workplace_x, new_workplace_y, new_workplace_z) {
								workers(all_workplace_x(cnt), all_workplace_y(cnt), all_workplace_z(cnt)) ++
							}
						loop
					}
				}
				if category(new_workplace_x, new_workplace_y, new_workplace_z, 0) = "industrial" {
					if int(sdnl(addon_maximum_capacity, map(new_workplace_x, new_workplace_y, new_workplace_z), 0)) >= workers(new_workplace_x, new_workplace_y, new_workplace_z) + 1 {
						workers(new_workplace_x, new_workplace_y, new_workplace_z) ++
						workplace_tmp(cnt) = "i"+str(obj_serial_num(new_workplace_x, new_workplace_y, new_workplace_z))+""

						map_Total_workers_Industrial ++
						map_demand_Industrial --
					}

					repeat gi
						if obj_serial_num(all_workplace_x(cnt), all_workplace_y(cnt), all_workplace_z(cnt)) = obj_serial_num(new_workplace_x, new_workplace_y, new_workplace_z) {
							workers(all_workplace_x(cnt), all_workplace_y(cnt), all_workplace_z(cnt)) ++
						}
					loop
				}
				if category(new_workplace_x, new_workplace_y, new_workplace_z, 0) = "farm" {
					if int(sdnl(addon_maximum_capacity, map(new_workplace_x, new_workplace_y, new_workplace_z), 0)) >= workers(new_workplace_x, new_workplace_y, new_workplace_z) + 1 {
						workers(new_workplace_x, new_workplace_y, new_workplace_z) ++
						workplace_tmp(cnt) = "f"+str(obj_serial_num(new_workplace_x, new_workplace_y, new_workplace_z))+""

						map_Total_workers_Farm ++
						map_demand_Farm --

						repeat gi
							if obj_serial_num(all_workplace_x(cnt), all_workplace_y(cnt), all_workplace_z(cnt)) = obj_serial_num(new_workplace_x, new_workplace_y, new_workplace_z) {
								workers(all_workplace_x(cnt), all_workplace_y(cnt)) ++
							}
						loop
					}
				}
				if category(new_workplace_x, new_workplace_y, new_workplace_z, 0) = "public" {
					if int(sdnl(addon_maximum_capacity, map(new_workplace_x, new_workplace_y, new_workplace_z), 0)) >= workers(new_workplace_x, new_workplace_y, new_workplace_z) + 1 {
						workers(new_workplace_x, new_workplace_y, new_workplace_z) ++
						workplace_tmp(cnt) = "p"+str(obj_serial_num(new_workplace_x, new_workplace_y, new_workplace_z))+""

						map_Total_workers_Public ++
						map_demand_Public --

						repeat gi
							if obj_serial_num(all_workplace_x(cnt), all_workplace_y(cnt), all_workplace_z(cnt)) = obj_serial_num(new_workplace_x, new_workplace_y, new_workplace_z) {
								workers(all_workplace_x(cnt), all_workplace_y(cnt), all_workplace_z(cnt)) ++
							}
						loop
					}
				}
			}
		}

		workplace(sx,sy,sz) += "["+workplace_tmp(cnt)+"]"
	loop

	return

*fix_school
	/*------------------------------------ä½æ°‘ãŒé€šã†å­¦æ ¡ã‚’æ±ºå®?------------------------------------*/
	sdim school_tmp, 8, residents(sx,sy,sz)
	split school(sx,sy,sz), "][", school_tmp

	sdim workplace_tmp, 8, residents(sx,sy,sz)
	split workplace(sx,sy,sz), "][", workplace_tmp

	school(sx,sy,sz) = ""
	repeat residents(sx,sy,sz)
		if instr(school_tmp(cnt), 0, "[") != -1 : split school_tmp(cnt), "[", cut, school_tmp(cnt)
		if instr(school_tmp(cnt), 0, "]") != -1 : split school_tmp(cnt), "]", school_tmp(cnt), cut

		if instr(workplace_tmp(cnt), 0, "[") != -1 : split workplace_tmp(cnt), "[", cut, workplace_tmp(cnt)
		if instr(workplace_tmp(cnt), 0, "]") != -1 : split workplace_tmp(cnt), "]", workplace_tmp(cnt), cut

		; å°±å­¦å…ˆã‚’å¹´é½¢åˆ¥ã§æ±ºã‚ã‚‹
		if school_tmp(cnt) = "" {
			; å°å­¦æ ¡??6??12æ­³??
			if age_in_Residential(cnt) >= 6 and age_in_Residential(cnt) <= 12 and gi_e >= 1 {
				new_school_rnd = rnd(gi_e)	; å­¦æ ¡ã¯ãƒ©ãƒ³ãƒ€ãƒ?ã«æ±ºã‚ã‚‹
				new_school_x = all_elementary_schools_x(new_school_rnd)
				new_school_y = all_elementary_schools_y(new_school_rnd)
				new_school_z = all_elementary_schools_z(new_school_rnd)

				if int(sdnl(addon_maximum_capacity, map(new_school_x, new_school_y, new_school_z), 0)) >= students(new_school_x, new_school_y, new_school_z) + 1 {
					school_tmp(cnt) = "e"+str(obj_serial_num(new_school_x, new_school_y, new_school_z))+""
					students(new_school_x, new_school_y, new_school_z) += 1

					; ?‘ã¤ã§2ãƒã‚¹ä»¥ä¸Šã?å­¦æ ¡ã®å ´åˆã€å­¦æ ¡å†?§åŒã˜ç”Ÿå¾’æ•°ã«ã™ã‚‹
					redraw 1
					repeat gi_e
						if obj_serial_num(all_elementary_schools_x(cnt), all_elementary_schools_y(cnt), all_elementary_schools_z(cnt)) = obj_serial_num(new_school_x, new_school_y, new_school_z) and all_elementary_schools_x(cnt) != new_school_x and all_elementary_schools_y(cnt) != new_school_y and all_elementary_schools_z(cnt) != new_school_z {
							students(all_elementary_schools_x(cnt), all_elementary_schools_y(cnt), all_elementrary_schools_z(cnt)) = students(new_school_x, new_school_y, new_school_z)		//è¦ä¿®æ­£
						}
					loop
				}
			}
			//ä¸­å­¦æ ¡??13??15æ­³??
			if age_in_Residential(cnt) >= 13 and age_in_Residential(cnt) <= 15 and gi_j >= 1 {
				new_school_rnd = rnd(gi_j)	; å­¦æ ¡ã¯ãƒ©ãƒ³ãƒ€ãƒ?ã«æ±ºã‚ã‚‹
				new_school_x = all_junior_high_schools_x(new_school_rnd)
				new_school_y = all_junior_high_schools_y(new_school_rnd)
				new_school_z = all_junior_high_schools_z(new_school_rnd)

				if int(sdnl(addon_maximum_capacity, map(new_school_x, new_school_y, new_school_z), 0)) >= students(new_school_x, new_school_y, new_school_z) + 1 {
					school_tmp(cnt) = "j"+str(obj_serial_num(new_school_x, new_school_y, new_school_z))+""
					students(new_school_x, new_school_y, new_school_z) += 1

					//?‘ã¤ã§2ãƒã‚¹ä»¥ä¸Šã?å­¦æ ¡ã®å ´åˆã€å­¦æ ¡å†?§åŒã˜ç”Ÿå¾’æ•°ã«ã™ã‚‹
					repeat gi_j
						if obj_serial_num(all_junior_high_schools_x(cnt), all_junior_high_schools_y(cnt), all_junior_high_schools_z(cnt)) = obj_serial_num(new_school_x, new_school_y, new_school_z) and all_junior_high_schools_x(cnt) != new_school_x and all_junior_high_schools_y(cnt) != new_school_y and all_junior_high_schools_z(cnt) != new_school_z {
							students(all_junior_high_schools_x(cnt), all_junior_high_schools_y(cnt), all_junior_high_schools_z(cnt)) = students(new_school_x, new_school_y, new_school_z)
						}
					loop
				}
			}
		}
		if school_tmp(cnt) = "" and workplace_tmp(cnt) = "" and age_in_Residential(cnt) >= 16 and age_in_Residential(cnt) <= 50 {
			//é«˜æ?¡??16??18æ­³??
			dr_h = rnd(3)	; é«˜æ?¡ã¯ 1/3ã®ç¢ºç?§å…¥ã‚?

			if dr_h = 0 and age_in_Residential(cnt) >= 16 and age_in_Residential(cnt) <= 18 and gi_h >= 1 {
				new_school_rnd = rnd(gi_h)	; å­¦æ ¡ã¯ãƒ©ãƒ³ãƒ€ãƒ?ã«æ±ºã‚ã‚‹
				new_school_x = all_high_schools_x(new_school_rnd)
				new_school_y = all_high_schools_y(new_school_rnd)
				new_school_z = all_high_schools_z(new_school_rnd)

				if int(sdnl(addon_maximum_capacity, map(new_school_x, new_school_y, new_school_z), 0)) >= students(new_school_x, new_school_y, new_school_z) + 1 {
					school_tmp(cnt) = "h"+str(obj_serial_num(new_school_x, new_school_y, new_school_z))+""
					students(new_school_x, new_school_y, new_school_z) += 1

					//?‘ã¤ã§2ãƒã‚¹ä»¥ä¸Šã?å­¦æ ¡ã®å ´åˆã€å­¦æ ¡å†?§åŒã˜ç”Ÿå¾’æ•°ã«ã™ã‚‹
					repeat gi_h
						if obj_serial_num(all_high_schools_x(cnt), all_high_schools_y(cnt), all_high_schools_z(cnt)) = obj_serial_num(new_school_x, new_school_y, new_school_z) and all_high_schools_x(cnt) != new_school_x and all_high_schools_y(cnt) != new_school_y and all_high_schools_z(cnt) != new_school_z {
							students(all_high_schools_x(cnt), all_high_schools_y(cnt), all_high_schools_z(cnt)) = students(new_school_x, new_school_y, new_school_z)
						}
					loop
				}
			}

			//å¤§å­¦??19??50æ­³??
			dr_u = rnd(age_in_Residential(cnt))	; å¤§å­¦ã¯1/å¹´é½¢ã®ç¢ºç?§å…¥ã‚?

			if dr_u = 0 and age_in_Residential(cnt) >= 19 and age_in_Residential(cnt) <= 50 and gi_u >= 1 {
				new_school_rnd = rnd(gi_u)	; å­¦æ ¡ã¯ãƒ©ãƒ³ãƒ€ãƒ?ã«æ±ºã‚ã‚‹
				new_school_x = all_universities_x(new_school_rnd)
				new_school_y = all_universities_y(new_school_rnd)
				new_school_z = all_universities_z(new_school_rnd)

				if int(sdnl(addon_maximum_capacity, map(new_school_x, new_school_y, new_school_z), 0)) >= students(new_school_x, new_school_y, new_school_z) + 1 {
					school_tmp(cnt) = "u"+str(obj_serial_num(new_school_x, new_school_y, new_school_z))+""
					students(new_school_x, new_school_y, new_school_z) += 1

					//?‘ã¤ã§2ãƒã‚¹ä»¥ä¸Šã?å­¦æ ¡ã®å ´åˆã€å­¦æ ¡å†?§åŒã˜ç”Ÿå¾’æ•°ã«ã™ã‚‹
					repeat gi_j
						if obj_serial_num(all_universities_x(cnt), all_universities_y(cnt), all_universities_z(cnt)) = obj_serial_num(new_school_x, new_school_y, new_school_z) and all_universities_x(cnt) != new_school_x and all_universities_y(cnt) != new_school_y and all_universities_z(cnt) != new_school_z {
							students(all_universities_x(cnt), all_universities_y(cnt), all_universities_z(cnt)) = students(new_school_x, new_school_y, new_school_z)
						}
					loop
				}
			}
		}

		school(sx,sy,sz) += "["+school_tmp(cnt)+"]"
	loop

	return


*information_panel
	/*------------------------------------æƒ??±ãƒ‘ãƒãƒ«----------------------------------------------*/
	screen 1, 675, 250
	gsel 1, 2 : title "æƒ??±ãƒ‘ãƒãƒ«"

	statistics_mode = "population total"

*information_panel_2
	gosub *getStatistics

	redraw 0
	
	color 128, 128, 128 : boxf

	mci "stop Cities-Box"
	mci "set Cities-Box_2 time format milliseconds"

	if map_approval_rate > 50 : mci "open \""+directory+"\\bgm\\[Sp]Satie-Jeteveux.mp3\" alias Cities-Box_2" : else : mci "open \""+directory+"\\bgm\\[Sp]Tchikovsky-Serenade-1st.mp3\" alias Cities-Box_2"
	if config_Set_Play_BGM = 1 : mci "play Cities-Box_2"

	pos 10, 10 : gmode 2 : gcopy 52, 0, 0, 32, 32

	font config_SystemFont, 16 : color 255, 255, 255
	pos 50, 15 : mes "éƒ½å¸‚ã?æƒ??±"

	color 255, 255, 255 : boxf 10, 45, 340, 95
	color 128, 128, 128 : boxf 11, 46, 339, 94

	color 255, 255, 255 : font config_SystemFont, 14
	pos 15, 50  : mes "éƒ½å¸‚å "+map_city_name+"\nå¸‚é•·ã€€ "+map_mayor_name+""
	pos 200, 50 : mes "è³?ßã€€ Â§ "+map_Money+"\næ”¯æŒç‡ "+map_approval_rate+"%"

	color 255, 255, 255 : boxf 10, 100, 340, 200
	color 128, 128, 128 : boxf 11, 101, 339, 199

	color 255, 255, 255 : font config_SystemFont, 14
	pos 15, 105  : mes "å•?¥­åœ°åŒºã®åŠ´åƒè€?•° ã€€ã€€"+map_Total_workers_Commercial+"äºº\nã‚ªãƒ•ã‚£ã‚¹åœ°åŒºã®åŠ´åƒè€?•°ã€€ã€€"+map_Total_workers_Office+"äºº\nå·¥æ¥­åœ°åŒºã®åŠ´åƒè€?•° ã€€ã€€"+map_Total_workers_Industrial+"äºº\nè¾²æ¥­åœ°åŒºã®åŠ´åƒè€?•°ã€€ã€€"+map_Total_workers_Farm+"äºº\nå…¬å‹™å“¡ã®åŠ´åƒè€?•°ã€€ã€€ã€€"+map_Total_workers_Public+"äºº"
	//pos 230, 105  : mes "éåŠ´åƒè€?•° ã€€ã€€"+map_Total_Vagrants+"äºº"

	color 255, 255, 255 : boxf 10, 205, 340, 245
	color 128, 128, 128 : boxf 11, 206, 339, 244

	color 255, 255, 255 : font config_SystemFont, 14
	pos 15, 210 : mes "äººå£ "+map_Total_Population+"äºº"
	pos 200, 210 : mes "ç”·æ€§äººå£ "+map_gender_M+"äºº\nå¥³æ€§äººå£ "+map_gender_F+"äºº"

	// ã‚°ãƒ©ãƒ•ã?è¡¨ç¤º
	color 255, 255, 255 : boxf 345, 45, 665, 245
	color 128, 128, 128 : boxf 346, 46, 664, 244

	color 255, 255, 255 : font config_SystemFont, 14

	pos 350, 50
	if statistics_mode = "population total"		: mes "äººå£ã®æ¨ç§»"
	if statistics_mode = "population man"		: mes "ç”·æ€§äººå£ã®æ¨ç§»"
	if statistics_mode = "population female"	: mes "å¥³æ€§äººå£ã®æ¨ç§»"
	if statistics_mode = "population money"		: mes "è³?ßã®æ¨ç§»"
	if statistics_mode = "approval rate"		: mes "æ”¯æŒç‡ã®æ¨ç§»"
	if statistics_mode = "workers commercial"	: mes "å•?¥­åœ°åŒºåŠ´åƒè€?•°ã®æ¨ç§»"
	if statistics_mode = "workers office"		: mes "ã‚ªãƒ•ã‚£ã‚¹åœ°åŒºåŠ´åƒè€?•°ã®æ¨ç§»"
	if statistics_mode = "workers industrial"	: mes "å·¥æ¥­åœ°åŒºåŠ´åƒè€?•°ã®æ¨ç§»"
	if statistics_mode = "workers farm"			: mes "è¾²æ¥­åœ°åŒºåŠ´åƒè€?•°ã®æ¨ç§»"

	line 390, 70, 390, 230 : line 390, 230, 534, 230 : graph_high = 230-70

	font config_SystemFont, 10

	// ç¸¦è»¸
	repeat graph_high/25+1
		pos 355, 230-10-cnt*25 : mes str(int(1.0*(max-min)/graph_high*cnt*25))
	loop

	// æ¨ªè»¸
	repeat count_of_statistics
		pos leftmost_plot_point+(12*cnt-4), 232 : mes statistics_date_month(cnt)
	loop

	// ãƒ—ãƒ­ãƒ?ƒˆã¨ã‚°ãƒ©ãƒ•æç”»
	repeat count_of_statistics
		statistics_temp_before = statistics_temp
		if statistics_mode = "population total" 	: statistics_temp = statistics_population_total(cnt)
		if statistics_mode = "population man"		: statistics_temp = statistics_population_man(cnt)
		if statistics_mode = "population female"	: statistics_temp = statistics_population_female(cnt)
		if statistics_mode = "money"				: statistics_temp = statistics_money(cnt)
		if statistics_mode = "approval rate"		: statistics_temp = statistics_approval_rate(cnt)
		if statistics_mode = "workers commercial"	: statistics_temp = statistics_workers_commercial(cnt)
		if statistics_mode = "workers office"		: statistics_temp = statistics_workers_office(cnt)
		if statistics_mode = "workers industrial"	: statistics_temp = statistics_workers_industrial(cnt)
		if statistics_mode = "workers farm"			: statistics_temp = statistics_workers_farm(cnt)

		if cnt >= 1 {
			line leftmost_plot_point+(12*(cnt-1)), 230-1.0*graph_high/(max-min)*statistics_temp_before, leftmost_plot_point+(12*cnt), 230-1.0*graph_high/(max-min)*statistics_temp
		}
		
		circle leftmost_plot_point+(12*cnt-2), 230-1.0*graph_high/(max-min)*statistics_temp-2, leftmost_plot_point+(12*cnt+2), 230-1.0*graph_high/(max-min)*statistics_temp+2
	loop

	// ã‚°ãƒ©ãƒ•ãƒ¢ãƒ¼ãƒ‰é¸æŠã?ã‚¿ãƒ³ã‚’é?ç½®
	objsize 100, 20
	pos 550, 60+20*0	: button "äººå£",			*information_panel__graph_set_population_total
	pos 550, 60+20*1	: button "ç”·æ€§äººå£",		*information_panel__graph_set_population_man
	pos 550, 60+20*2	: button "å¥³æ€§äººå£",		*information_panel__graph_set_population_female
	pos 550, 60+20*3	: button "è³?ß", 			*information_panel__graph_set_money
	pos 550, 60+20*4	: button "æ”¯æŒç‡",			*information_panel__graph_set_approval_rate
	pos 550, 60+20*5	: button "å•?¥­åŠ´åƒè€?•°",	*information_panel__graph_set_workers_commercial
	pos 550, 60+20*6	: button "ã‚ªãƒ•ã‚£ã‚¹åŠ´åƒè€?•°",*information_panel__graph_set_workers_office
	pos 550, 60+20*7	: button "å·¥æ¥­åŠ´åƒè€?•°",	*information_panel__graph_set_workers_industrial
	pos 550, 60+20*8	: button "è¾²æ¥­åŠ´åƒè€?•°",	*information_panel__graph_set_workers_farm

	redraw 1

	stop

*information_panel__graph_set_population_total
	statistics_mode = "population total"
	goto *information_panel_2

*information_panel__graph_set_population_man
	statistics_mode = "population man"
	goto *information_panel_2

*information_panel__graph_set_population_female
	statistics_mode = "population female"
	goto *information_panel_2

*information_panel__graph_set_money
	statistics_mode = "money"
	goto *information_panel_2

*information_panel__graph_set_approval_rate
	statistics_mode = "approval rate"
	goto *information_panel_2

*information_panel__graph_set_workers_commercial
	statistics_mode = "workers commercial"
	goto *information_panel_2

*information_panel__graph_set_workers_office
	statistics_mode = "workers office"
	goto *information_panel_2

*information_panel__graph_set_workers_industrial
	statistics_mode = "workers industrial"
	goto *information_panel_2

*information_panel__graph_set_workers_farm
	statistics_mode = "workers farm"
	goto *information_panel_2

*getStatistics
	notesel statistics
	count_of_statistics = notemax
	leftmost_plot_point = 390+12*(12+1)-12*(count_of_statistics)

	sdim	statistics_date,				16, count_of_statistics		// ãƒ??ã‚¿ã‚’ä¿å­˜ã—ãŸæ—¥ä»?
	dim		statistics_population_total,		count_of_statistics		// äººå£ã®æ¨ç§»
	dim		statistics_population_man,			count_of_statistics		// ç”·æ€§äººå£ã®æ¨ç§»
	dim		statistics_population_female,		count_of_statistics		// å¥³æ€§äººå£ã®æ¨ç§»
	dim		statistics_money,					count_of_statistics		// è³?ßã®æ¨ç§»
	dim		statistics_approval_rate,			count_of_statistics		// æ”¯æŒç‡ã®æ¨ç§»
	dim		statistics_workers_commercial,		count_of_statistics		// å•?¥­åœ°åŒºåŠ´åƒè€?•°ã®æ¨ç§»
	dim		statistics_workers_office,			count_of_statistics		// ã‚ªãƒ•ã‚£ã‚¹åœ°åŒºåŠ´åƒè€?•°ã®æ¨ç§»
	dim		statistics_workers_industrial,		count_of_statistics		// å·¥æ¥­åœ°åŒºåŠ´åƒè€?•°ã®æ¨ç§»
	dim		statistics_workers_farm,			count_of_statistics		// è¾²æ¥­åœ°åŒºåŠ´åƒè€?•°ã®æ¨ç§»

	dim		statistics_date_month,				count_of_statistics		// ãƒ??ã‚¿ã‚’ä¿å­˜ã—ãŸæ—¥ä»˜ã?ã?¡æœ?

	min = 0
	max = 0

	repeat count_of_statistics
		if count_of_statistics > 12 {
			noteget a_line_of_statistics, count_of_statistics-12+cnt
		} else {
			noteget a_line_of_statistics, cnt
		}

		split a_line_of_statistics, ", ", statistics_date_temp, statistics_population_total_temp, statistics_population_man_temp, statistics_population_female_temp, statistics_money_temp, statistics_approval_rate_temp, statistics_workers_commercial_temp, statistics_workers_office_temp, statistics_workers_industrial_temp, statistics_workers_farm_temp

		statistics_date(cnt)				= get_chapter(statistics_date_temp, "date", " : ", "")
		statistics_population_total(cnt)	= int(get_chapter(statistics_population_total_temp, "population total", " : ", ""))
		statistics_population_man(cnt)		= int(get_chapter(statistics_population_man_temp, "population man", " : ", ""))
		statistics_population_female(cnt)	= int(get_chapter(statistics_population_female_temp, "population female", " : ", ""))
		statistics_money(cnt)				= int(get_chapter(statistics_money_temp, "money", " : ", ""))
		statistics_approval_rate(cnt)		= int(get_chapter(statistics_approval_rate_temp, "approval rate", " : ", ""))
		statistics_workers_commercial(cnt)	= int(get_chapter(statistics_workers_commercial_temp, "workers commercial", " : ", ""))
		statistics_workers_office(cnt)		= int(get_chapter(statistics_workers_office_temp, "workers office", " : ", ""))
		statistics_workers_industrial(cnt)	= int(get_chapter(statistics_workers_industrial_temp, "workers industrial", " : ", ""))
		statistics_workers_farm(cnt)		= int(get_chapter(statistics_workers_farm_temp, "workers farm", " : ", ""))

		split statistics_date(cnt), ".", not_use, statistics_date_month(cnt), not_use

		if statistics_mode = "population total" {
			if statistics_population_total(cnt) > max : max = statistics_population_total(cnt)
		}
		if statistics_mode = "population man" {
			if statistics_population_man(cnt) > max : max = statistics_population_man(cnt)
		}
		if statistics_mode = "population female" {
			if statistics_population_female(cnt) > max : max = statistics_population_female(cnt)
		}
		if statistics_mode = "money" {
			if statistics_money(cnt) > max : max = statistics_money(cnt)
		}
		if statistics_mode = "approval rate" {
			if statistics_approval_rate(cnt) > max : max = statistics_approval_rate(cnt)
		}
		if statistics_mode = "workers commercial" {
			if statistics_workers_commercial(cnt) > max : max = statistics_workers_commercial(cnt)
		}
		if statistics_mode = "workers office" {
			if statistics_workers_office(cnt) > max : max = statistics_workers_office(cnt)
		}
		if statistics_mode = "workers industrial" {
			if statistics_workers_industrial(cnt) > max : max = statistics_workers_industrial(cnt)
		}
		if statistics_mode = "workers farm" {
			if statistics_workers_farm(cnt) > max : max = statistics_workers_farm(cnt)
		}
	loop

	if count_of_statistics > 12 {
		count_of_statistics = 12
	}

	if max = 0 {
		max = 1
	}

	return

*budget_panel
	/*------------------------------------äºˆç®—ãƒ‘ãƒãƒ«----------------------------------------------*/
	screen 1, 300, 380
	gsel 1, 2 : title "äºˆç®—ãƒ‘ãƒãƒ«"

	color 128, 128, 128 : boxf

	mci "stop Cities-Box"
	mci "set Cities-Box_2 time format milliseconds"

	if map_Money > 0 : mci"open \""+directory+"\\bgm\\[Sp]Satie-Jeteveux.mp3\" alias Cities-Box_2" : else : mci"open \""+directory+"\\bgm\\[Sp]Tchikovsky-Serenade-1st.mp3\" alias Cities-Box_2"
	if config_Set_Play_BGM = 1 : mci "play Cities-Box_2"

	objsize 50, 20
	font config_SystemFont, 14 : color 255, 255, 255

	; æ”¯å‡ºç?
	pos 200, 70  : input map_budget_of_Police : input_stat__map_budget_of_Police = stat
	pos 280, 70  : mes "%"
	pos 200, 90  : input map_budget_of_Fire_Depertment : input_stat__map_budget_of_Fire_Depertment = stat
	pos 280, 90  : mes "%"
	pos 200, 110 : input map_budget_of_Post_Office : input_stat__map_budget_of_Post_Office = stat
	pos 280, 110 : mes "%"
	pos 200, 130 : input map_budget_of_Education : input_stat__map_budget_of_Education = stat
	pos 280, 130 : mes "%"

	; ç¨ç‡
	pos 200, 190 : input map_tax_of_Residential : input_stat__map_tax_of_Residential = stat
	pos 290, 190 : mes "%"
	pos 200, 210 : input map_tax_of_Commercial : input_stat__map_tax_of_Commercial = stat
	pos 290, 210 : mes "%"
	pos 200, 230 : input map_tax_of_Office : input_stat__map_tax_of_Office = stat
	pos 290, 230 : mes "%"
	pos 200, 250 : input map_tax_of_Industrial : input_stat__map_tax_of_Industrial = stat
	pos 290, 250 : mes "%"
	pos 200, 280 : input map_tax_of_Farm : input_stat__map_tax_of_Farm = stat
	pos 290, 280 : mes "%"

	objsize 50, 20
	pos 240, 350 : button "OK", *fix_budget

	repeat
		redraw 0

		color 128, 128, 128 : boxf

		font config_SystemFont, 16 : color 255, 255, 255
		pos 10, 10 : mes "ä»Šæœˆã®äºˆç®?"

		; æ”¯å‡ºç??ãƒ‘ã?ã‚»ãƒ³ãƒ??ã‚¸ã‚’ä¸Šé™ãƒ»ä¸‹é™ã«åˆã‚ã›ã‚‹
		if map_budget_of_Police < 0 { map_budget_of_Police = 0 : objprm input_stat__map_budget_of_Police, map_budget_of_Police }
		if map_budget_of_Fire_Depertment < 0 { map_budget_of_Fire_Depertment = 0 : objprm input_stat__map_budget_of_Fire_Depertment, map_budget_of_Fire_Depertment }
		if map_budget_of_Post_Office < 0 { map_budget_of_Post_Office = 0 : objprm input_stat__map_budget_of_Post_Office, map_budget_of_Post_Office }
		if map_budget_of_Education < 0 { map_budget_of_Education = 0 : objprm input_stat__map_budget_of_Education, map_budget_of_Education }

		; ç¨ç‡ã®ãƒ‘ã?ã‚»ãƒ³ãƒ??ã‚¸ã‚’ä¸Šé™ãƒ»ä¸‹é™ã«åˆã‚ã›ã‚‹
		if map_tax_of_Residential < 0 { map_tax_of_Residential = 0 : objprm input_stat__map_tax_of_Residential, map_tax_of_Residential }
		if map_tax_of_Commercial < 0 { map_tax_of_Commercial = 0 : objprm input_stat__map_tax_of_Commercial, map_tax_of_Commercial }
		if map_tax_of_Office < 0 { map_tax_of_Office = 0 : objprm input_stat__map_tax_of_Office, map_tax_of_Office }
		if map_tax_of_Industrial < 0 { map_tax_of_Industrial = 0 : objprm input_stat__map_tax_of_Industrial, map_tax_of_Industrial }
		if map_tax_of_Farm < 0 { map_tax_of_Farm = 0 : objprm input_stat__map_tax_of_Farm, map_tax_of_Farm }

		; æ”¯å‡ºã®å…·ä½“çš„ãªé‡‘é¡ã‚’ç®—å?
		if map_total_Police_Stations = 0  : take_map_budget_of_Police = 0          : else : take_map_budget_of_Police = map_total_Police_Stations * map_budget_of_Police * 10
		if map_total_Fire_Depertments = 0 : take_map_budget_of_Fire_Depertment = 0 : else : take_map_budget_of_Fire_Depertment = map_total_Fire_Depertments * map_budget_of_Fire_Depertment * 10
		if map_total_Post_Offices = 0     : take_map_budget_of_Post_Office = 0     : else : take_map_budget_of_Post_Office = map_total_Post_Offices * map_budget_of_Post_Office * 10
		if map_total_Education = 0        : take_map_budget_of_Education = 0       : else : take_map_budget_of_Education = map_total_Education * map_budget_of_Education * 10

		; åå?ã®å…·ä½“çš„ãªé‡‘é¡ã‚’ç®—å?
		if map_total_Residential = 0 : take_map_tax_of_Residential = 0 : else : take_map_tax_of_Residential = map_total_Residential * map_tax_of_Residential
		if map_total_Commercial = 0  : take_map_tax_of_Commercial = 0  : else : take_map_tax_of_Commercial = map_total_Commercial * map_tax_of_Commercial
		if map_total_Office = 0      : take_map_tax_of_Office = 0      : else : take_map_tax_of_Office = map_total_Office * map_tax_of_Office
		if map_total_Industrial = 0  : take_map_tax_of_Industrial = 0  : else : take_map_tax_of_Industrial = map_total_Industrial * map_tax_of_Industrial
		if map_total_Farm = 0        : take_map_tax_of_Farm = 0        : else : take_map_tax_of_Farm = map_total_Farm * map_tax_of_Farm

		font config_SystemFont, 14

		color 255, 127, 39
		pos 10, 30 : mes "ç¹°è¶Šéß Â§"+map_Money+""

		color 255, 255, 255

		pos 8, 50  : mes "æ”¯å‡º"
		pos 10, 70  : mes "è­¦å¯Ÿç½²ã€€ ã€€ã€€Â§-"+take_map_budget_of_Police+""
		pos 10, 90  : mes "æ¶ˆé˜²ç½²ã€€ã€€ã€€ Â§-"+take_map_budget_of_Fire_Depertment+""
		pos 10, 110  : mes "éƒµä¾¿äº‹æ¥­ ã€€ã€€Â§-"+take_map_budget_of_Post_Office+""
		pos 10, 130 : mes "æ•™è‚²äº‹æ¥­ã€€ã€€ Â§-"+take_map_budget_of_Education+""

		pos 8, 170  : mes "åå?"
		pos 10, 190 : mes "ä½å±?œ°åŒºã€€ã€€ Â§+"+take_map_tax_of_Residential+""
		pos 10, 210 : mes "å•?¥­åœ°åŒºã€€ã€€ Â§+"+take_map_tax_of_Commercial+""
		pos 10, 230 : mes "ã‚ªãƒ•ã‚£ã‚¹åœ°åŒº ã€€Â§+"+take_map_tax_of_Office+""
		pos 10, 250 : mes "å·¥æ¥­åœ°åŒº ã€€ã€€Â§+"+take_map_tax_of_Industrial+""
		pos 10, 270 : mes "è¾²æ¥­åœ°åŒº ã€€ã€€Â§+"+take_map_tax_of_Farm+""

		repeat 4
			pos 250, 70+(cnt*20)  : mes "%"
		loop

		repeat 4
			pos 250, 190+(cnt*20) : mes "%"
		loop

		expenses = take_map_budget_of_Police + take_map_budget_of_Fire_Depertment + take_map_budget_of_Post_Office + take_map_budget_of_Education
		color 255, 0, 0
		pos 10, 290 : mes "ä»Šæœˆã®æ”¯å‡ºã€€ Â§-"+expenses+""

		income = take_map_tax_of_Residential + take_map_tax_of_Commercial + take_map_tax_of_Office + take_map_tax_of_Industrial + take_map_tax_of_Farm
		color 0, 255, 0
		pos 10, 310 : mes "ä»Šæœˆã®åå?ã€€ Â§+"+income+""

		color 0, 162, 232
		pos 10, 330 : mes "æœˆæœ«ã®è³?ßã€€ Â§"+(map_Money - expenses + income)+""

		redraw 1
		wait 10
	loop

	stop

*fix_budget
	gsel ginfo_act, -1

	if Set_Play_BGM = 1 {
		mci "stop Cities-Box_2"
		mci "play Cities-Box"
	}

	gsel 0
	goto *main

*setting
	/*-------------------------------------ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã®è¨­å®šç”»é¢---------------------------------*/
	screen 1, 300, 400
	gsel 1 : title "ãƒãƒƒãƒ—è¨­å®?"
	*setting_2
	onclick *setting_onclick

	color 95, 95, 95 : boxf

	color 255, 255, 255
	font config_SystemFont, 16

	; éƒ½å¸‚å(map_City_Name)
	pos 10, 10 : mes "éƒ½å¸‚å"
	objsize 210, 20
	pos 80, 10 : input map_City_Name

	; å¸‚é•·å?(map_Mayor_Name)
	pos 10, 40 : mes "å¸‚é•·å?"
	objsize 210, 20
	pos 80, 40 : input map_Mayor_Name

	; å¤©å€™ã?å¤‰åŒ–(map_Set_Change_Weather)
	if map_Set_Change_Weather = 0 {
		pos 10, 73 : gcopy 14, 0, 0, 16, 16
	} else {
		pos 10, 73 : gcopy 14, 0, 16, 16, 16
	}
	pos 35, 70 : mes "å¤©å€™ã?å¤‰åŒ–"

	; å¤œé–“ã¯æš—ãã™ã‚‹(map_Set_Dark_on_Night)
	if map_Set_Dark_on_Night = 0 {
		pos 10, 103 : gcopy 14, 0, 0, 16, 16
	} else {
		pos 10, 103 : gcopy 14, 0, 16, 16, 16
	}
	pos 35, 100 : mes "å¤œé–“ã¯æš—ãã™ã‚‹"

	; BGMã®å†ç”Ÿã®æœ‰ç„¡(config_Set_Play_BGM)
	if config_Set_Play_BGM = 0 {
		pos 10, 133 : gcopy 14, 0, 0, 16, 16
	} else {
		pos 10, 133 : gcopy 14, 0, 16, 16, 16
	}
	pos 35, 130 : mes "BGMã®å†ç”Ÿ"

	; ã‚ªãƒ¼ãƒˆã‚»ãƒ¼ãƒ–ï¼?config_Auto_Save??
	if config_Auto_Save = 0 {
		pos 10, 163 : gcopy 14, 0, 0, 16, 16
	} else {
		pos 10, 163 : gcopy 14, 0, 16, 16, 16
	}
	pos 35, 160 : mes "ã‚ªãƒ¼ãƒˆã‚»ãƒ¼ãƒ?"

	; ãƒ•ã‚©ãƒ³ãƒ?(config_SystemFont)
	pos 10, 190 : mes "ãƒ•ã‚©ãƒ³ãƒ?"
	objsize 194, 20
	pos 80, 190 : input config_SystemFont

	gmode 2 : pos 274, 190 : gcopy 16, 0, 0, 16, 16

	stop

*setting_onclick
	gsel 1

	; å¤©å€™ã?å¤‰åŒ–(map_Set_Change_Weather)
	if click_range(10, 73, 10+16, 73+16) = 1 {
		if map_Set_Change_Weather = 0 {
			map_Set_Change_Weather = 1
		} else {
			map_Set_Change_Weather = 0
		}
	}

	; å¤œé–“ã¯æš—ãã™ã‚‹(map_Set_Dark_on_Night)
	if click_range(10, 103, 10+16, 103+16) = 1 {
		if map_Set_Dark_on_Night = 0 {
			map_Set_Dark_on_Night = 1
		} else {
			map_Set_Dark_on_Night = 0
		}
	}

	; BGMã®å†ç”Ÿã®æœ‰ç„¡(config_Set_Play_BGM)
	if click_range(10, 133, 10+16, 133+16) = 1 {
		if config_Set_Play_BGM = 0 {
			config_Set_Play_BGM = 1
		} else {
			config_Set_Play_BGM = 0
		}
	}

	; ã‚ªãƒ¼ãƒˆã‚»ãƒ¼ãƒ?(config_Auto_Save)
	if click_range(10, 163, 10+16, 163+16) = 1 {
		if config_Auto_Save = 0 {
			config_Auto_Save = 1
		} else {
			config_Auto_Save = 0
		}
	}

	; ãƒ•ã‚©ãƒ³ãƒ?(SystemFont)
	; å‚ç?ãƒœã‚¿ãƒ³
		if click_range(274, 160, 274+16, 160+16) = 1 : gosub *refer_fonts

	goto *setting_2

*refer_fonts
	#uselib "comdlg32.dll"
	#func ChooseFont "ChooseFontA" int

	mref bmscr, 67
	dim chfont,16
	dim logfont,16
	sdim setting_SystemFont,32

	chfont.0 = 60
	chfont.1 = bmscr.13
	chfont.3=varptr(logfont)
	chfont.5 = 0x01000141

	pm=varptr(chfont)
	ChooseFont pm

	if stat = 0 {
		return
	}

	style=0
	if (chfont.12 & 0x0100):style=style+1
	if (chfont.12 & 0x0200):style=style+2
	if (logfont.5 & 0x0000FF00):style=style+4
	if (logfont.5 & 0x00FF0000):style=style+8
	size=chfont.4/10
	memcpy config_SystemFont,logfont,32,0,28

	if from_menu_setting = 1 : goto *menu_setting_2

	return

*save
	/*------------------------------------ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã®ä¿å­?--------------------------------------*/
	save_mapdata = ""

	; èª¤åå¿œé˜²æ­¢
	if from_autosave = 0 and click_range(0, 0, windowx, windowy) = 1 and click_range(windowx-54, windowy-40-titlebar_h, windowx, windowy) = 0 : return

	; ä¿å­˜å?ãƒ•ã‚¡ã‚¤ãƒ«ã®é¸æŠ?
	if from_autosave = 0 {
		dialog "cbd", 17, "Cities Box ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿"
		save_mapdata_name = refstr
		if stat = 0 : return
	} else {
		from_autosave = 0
		save_mapdata_name = "auto_save/"+map_City_Name+"_autosave.cbd"
	}
	
	if instr(save_mapdata_name, 0, ".cbd") = -1 : save_mapdata_name = ""+save_mapdata_name+".cbd"

	; ä¿å­˜ä¸­è¡¨ç¤º
	color : sboxf 128, 0, 0, windowx, windowy
	color 255, 255, 255 : font config_SystemFont, 26
	cmes "ä¿å­˜ä¸­...", 0, (windowy/2)-18, windowx, (windowy/2)+18

	; ãƒãƒƒãƒ—ä¿å­?
	title "ä¿å­˜ä¸­..."

	save_name = "name(x,y) {\n"
	save_name2 = "name2(x,y) {\n"
	save_category = "category(x,y) {\n"
	save_category_2 = "category_2(x,y) {\n"
	save_category_3 = "category_3(x,y) {\n"
	save_obj_type = "obj_type(x,y) {\n"
	save_obj_type2 = "obj_type2(x,y) {\n"
	save_obj_dire = "obj_dire(x,y) {\n"
	save_obj_dire2 = "obj_dire2(x,y) {\n"
	save_obj_serial_num = "obj_serial_num(x,y) {\n"
	save_obj_use_tiles_x = "obj_use_tiles_x(x,y) {\n"
	save_obj_use_tiles_y = "obj_use_tiles_y(x,y) {\n"
	save_obj_tiles_x = "obj_tiles_x(x,y) {\n"
	save_obj_tiles_y = "obj_tiles_y(x,y) {\n"
	save_residents = "residents(x,y) {\n"
	save_workers_Commercial = "workers_Commercial(x,y) {\n"
	save_workers_Office = "workers_Office(x,y) {\n"
	save_workers_Industrial = "workers_Industrial(x,y) {\n"
	save_workers_Farm = "workers_Farm(x,y) {\n"
	save_workers_Public = "workers_Public(x,y) {\n"
	save_studets = "students(x,y) {\n"
	save_land_price = "land_price(x,y) {\n"
	save_crime_rate = "crime_rate(x,y) {\n"
	save_education_rate = "education_rate(x,y) {\n"
	save_happiness = "happiness(x,y) {\n"
	save_noise = "noise(x,y) {\n"
	save_crop = "crop(x,y) {\n"
	save_crop_amount = "crop_amount(x,y) {\n"
	save_age = "age(x,y) {\n"
	save_gender = "gender(x,y) {\n"
	save_workplace = "workplace(x,y) {\n"
	save_school = "school(x,y) {\n"
	save_reservation = "reservation(x,y) {\n"
	save_original_name = "original_name(x,y) {\n"
	save_statistics = "statistics {\n" + statistics + "}"

	sz = 0
	repeat MAPSIZE_X
		sy = cnt
		repeat MAPSIZE_Y
			sx = cnt

			if sx != MAPSIZE_X-1 : comma = ", " : else : comma = "\n"

			save_name            += name(sx,sy,sz,0)+comma
			save_name2           += name(sx,sy,sz,1)+comma
			save_category        += category(sx,sy,sz,0)+comma
			save_category_2      += category(sx,sy,sz,1)+comma
			save_category_3      += category(sx,sy,sz,2)+comma
			save_obj_type        += strf("%03d", obj_type(sx,sy,sz,0))+comma
			save_obj_type2       += strf("%03d", obj_type(sx,sy,sz,1))+comma
			save_obj_dire        += strf("%03d", obj_dire(sx,sy,sz,0))+comma
			save_obj_dire2       += strf("%03d", obj_dire(sx,sy,sz,1))+comma
			save_obj_serial_num  += strf("%04d", obj_serial_num(sx,sy,sz))+comma
			save_obj_use_tiles_x += strf("%03d", obj_use_tiles(sx,sy,sz,0))+comma
			save_obj_use_tiles_y += strf("%03d", obj_use_tiles(sx,sy,sz,1))+comma
			save_obj_tiles_x     += strf("%03d", obj_tiles(sx,sy,sz,0))+comma
			save_obj_tiles_y     += strf("%03d", obj_tiles(sx,sy,sz,1))+comma
			save_residents       += strf("%03d", residents(sx,sy,sz))+comma
			if category(sx,sy,sz,0) = "commercial" : save_workers_Commercial += strf("%03d", workers(sx,sy,sz))+comma : else : save_workers_Commercial += "000"+comma
			if category(sx,sy,sz,0) = "office"     : save_workers_Office     += strf("%03d", workers(sx,sy,sz))+comma : else : save_workers_Office     += "000"+comma
			if category(sx,sy,sz,0) = "industrial" : save_workers_Industrial += strf("%03d", workers(sx,sy,sz))+comma : else : save_workers_Industrial += "000"+comma
			if category(sx,sy,sz,0) = "farm"       : save_workers_Farm       += strf("%03d", workers(sx,sy,sz))+comma : else : save_workers_Farm       += "000"+comma
			if category(sx,sy,sz,0) = "public"     : save_workers_Public     += strf("%03d", workers(sx,sy,sz))+comma : else : save_workers_Public     += "000"+comma
			save_studets         += strf("%03d", students(sx,sy,sz))+comma
			save_land_price      += strf("%03d", land_price(sx,sy,sz))+comma
			save_crime_rate      += strf("%03d", crime_rate(sx,sy,sz))+comma
			save_education_rate  += strf("%03d", education_rate(sx,sy,sz))+comma
			save_happiness       += strf("%03d", happiness(sx,sy,sz))+comma
			save_noise			 += strf("%03d", noise(sx,sy,sz))+comma
			save_crop            += crop(sx,sy,sz)+comma
			save_crop_amount     += strf("%03d", crop_amount(sx,sy,sz))+comma
			save_age             += age(sx,sy,sz)+comma
			save_gender          += gender(sx,sy,sz)+comma
			save_workplace       += workplace(sx,sy,sz)+comma
			save_school          += school(sx,sy,sz)+comma
			save_reservation     += reservation(sx,sy,sz)+comma
			save_original_name   += original_name(sx,sy,sz)+comma
		loop
	loop

	notesel save_mapdata

	; ä¿å­˜ã—ãŸCities Boxã®ãƒã?ã‚¸ãƒ§ãƒ³?ˆãƒªãƒªãƒ¼ã‚¹ãƒŠãƒ³ãƒã???
		noteadd "Version = "+about_release_number+";", -1

	; ã‚¢ãƒ‰ã‚ªãƒ³ã‚»ãƒ?ƒˆ
		noteadd "Addons_Set = \""+map_Addons_Set+"\";", -1
		noteadd " ", -1

	; æ¬¡ã«å??ãƒ??ãƒ??ã‚¿(*.cbx)ã®è¨­å®šã‚’ä¿å­?
		noteadd "City_Name = \""+map_City_Name+"\";", -1
		noteadd "Mayor_Name = \""+map_Mayor_Name+"\";", -1
		noteadd "Total_Population = "+map_Total_Population+";", -1
		noteadd "Set_Change_Weather = "+map_Set_Change_Weather+";", -1
		noteadd "Temperature = "+map_temperature+";", -1
		noteadd "Set_Dark_on_Night = "+map_Set_Dark_on_Night+";", -1
		noteadd " ", -1

	; ãƒãƒƒãƒ—ã‚µã‚¤ã‚º
		noteadd "MAPSIZE_X = "+MAPSIZE_X+";", -1
		noteadd "MAPSIZE_Y = "+MAPSIZE_Y+";", -1
		noteadd " ", -1

	; æ—¥æ™?
		noteadd "time_Year = "+map_time_Year+";", -1
		noteadd "time_Month = "+map_time_Month+";", -1
		noteadd "time_Date = "+map_time_Date+";", -1
		noteadd "time_Hour = "+map_time_Hour+";", -1
		noteadd "time_Minutes = "+map_time_Minutes+";", -1
		noteadd " ", -1

	; éœ€è¦åº¦
		noteadd "demand_Residential = "+map_demand_Residential+";", -1
		noteadd "demand_Commercial = "+map_demand_Commercial+";", -1
		noteadd "demand_Office = "+map_demand_Office+";", -1
		noteadd "demand_Industrial = "+map_demand_Industrial+";", -1
		noteadd "demand_Farm = "+map_demand_Farm+";", -1

	; è³?ß
		noteadd "Money = "+map_Money+";", -1
		noteadd " ", -1

	; äºˆç®?
		noteadd "budget_of_Police = "+map_budget_of_Police+";", -1
		noteadd "budget_of_Fire_Depertment = "+map_budget_of_Fire_Depertment+";", -1
		noteadd "budget_of_Post_Office = "+map_budget_of_Post_Office+";", -1
		noteadd "budget_of_Education = "+map_budget_of_Education+";", -1

		noteadd "tax_of_Residential = "+map_tax_of_Residential+";", -1
		noteadd "tax_of_Commercial = "+map_tax_of_Commercial+";", -1
		noteadd "tax_of_Office = "+map_tax_of_Office+";", -1
		noteadd "tax_of_Industrial = "+map_tax_of_Industrial+";", -1
		noteadd "tax_of_Farm = "+map_tax_of_Farm+";", -1

		noteadd " ", -1
		noteadd " \n", -1

	; é…å?ãƒ??ã‚¿ã®ä¿å­?
	save_mapdata += save_name+"}\n"
	save_mapdata += save_name2+"}\n"
	save_mapdata += save_category+"}\n"
	save_mapdata += save_category_2+"}\n"
	save_mapdata += save_category_3+"}\n"
	save_mapdata += save_obj_type+"}\n"
	save_mapdata += save_obj_type2+"}\n"
	save_mapdata += save_obj_dire+"}\n"
	save_mapdata += save_obj_dire2+"}\n"
	save_mapdata += save_obj_serial_num+"}\n"
	save_mapdata += save_obj_use_tiles_x+"}\n"
	save_mapdata += save_obj_use_tiles_y+"}\n"
	save_mapdata += save_obj_tiles_x+"}\n"
	save_mapdata += save_obj_tiles_y+"}\n"
	save_mapdata += save_residents+"}\n"
	save_mapdata += save_workers_Commercial+"}\n"
	save_mapdata += save_workers_Office+"}\n"
	save_mapdata += save_workers_Industrial+"}\n"
	save_mapdata += save_workers_Farm+"}\n"
	save_mapdata += save_workers_Public+"}\n"
	save_mapdata += save_studets+"}\n"
	save_mapdata += save_land_price+"}\n"
	save_mapdata += save_crime_rate+"}\n"
	save_mapdata += save_education_rate+"}\n"
	save_mapdata += save_happiness+"}\n"
	save_mapdata += save_noise+"}\n"
	save_mapdata += save_crop+"}\n"
	save_mapdata += save_crop_amount+"}\n"
	save_mapdata += save_age+"}\n"
	save_mapdata += save_gender+"}\n"
	save_mapdata += save_workplace+"}\n"
	save_mapdata += save_school+"}\n"
	save_mapdata += save_reservation+"}\n"
	save_mapdata += save_original_name+"}\n"
	save_mapdata += save_statistics

	; ä¿å­?
	notesel save_mapdata
	notesave save_mapdata_name

	title about_title

	return

*update
	/*----------------------------------ã‚¢ãƒ??ãƒ??ã‚¿ãƒ¼ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼?µ·å‹?--------------------------*/
	color 0, 0, 0
	sboxf 128, 0, 0, windowx, windowy

	font config_SystemFont, 14
	color 255, 255, 255 : cmes "ã‚¢ãƒ??ãƒ??ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸­ã§ã™\nã—ã?ã‚‰ããŠå¾?¡ä¸‹ã•ã?...", 0, windowy/2-20, windowx, windowy/2+20

	if normalUpdate = 1 {
		latest_version__Updater = get_chapter(latest_version, "Updater", " : ", ";")
		latest_version__Updater_Name = get_chapter(latest_version, "Updater_Name", " : ", ";")

		download latest_version__Updater, latest_version__Updater_Name, latest_version__Updater_Name

		exist latest_version__Updater_Name
		exe = latest_version__Updater_Name
	} else : if devUpdate = 1 {
		Dev_latest_version__Updater = get_chapter(Dev_latest_version, "Updater", " : ", ";")
		Dev_latest_version__Updater_Name = get_chapter(Dev_latest_version, "Updater_Name", " : ", ";")

		download Dev_latest_version__Updater, Dev_latest_version__Updater_Name, Dev_latest_version__Updater_Name

		exist Dev_latest_version__Updater_Name
		exe = Dev_latest_version__Updater_Name
	}

	if strsize = -1 : error "S07 : ã‚¢ãƒ??ãƒ??ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ\nã‚¢ãƒ??ãƒ??ã‚¿ "+exe+"ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒå®Œäº?—ã¾ã›ã‚“ã§ã—ãŸã€?"

	if normalUpdate = 1 {
		exec latest_version__Updater_Name
	} else {
		exec Dev_latest_version__Updater_Name
	}
	end

*exit
	if ginfo_act = 0 {
		gsel 0
		end

	} else {
		gsel ginfo_act, -1

		gsel 0

		mci "close Cities-Box_2"
		mci "play Cities-Box"

		; è¨­å®šã‚’ä¿å­?
		chdir directory

		config = ""

		notesel config
		noteadd "SystemFont = \""+config_SystemFont+"\"", -1
		noteadd "Set_Play_BGM = "+config_Set_Play_BGM+";", -1
		noteadd "Ignore_Update = "+config_Ignore_Update+";", -1
		noteadd "Get_Dev_Version = "+config_Get_Dev_Version+";", -1
		noteadd "OS = \""+config_OS+"\";", -1
		noteadd "Adjustment_Interval = "+config_Adjustment_Interval+";", -1
		noteadd "Drow_Interval = "+config_Drow_Interval+";", -1
		noteadd "Config_WindowSize_X = "+Config_WindowSize_X+";", -1
		noteadd "Config_WindowSize_Y = "+Config_WindowSize_Y+";", -1
		noteadd "Auto_Save = "+config_Auto_Save+";", -1
		notesave "data/config.dat"

		from_menu_setting = 0

		if return_from_exit = "menu" : goto *menu
		if return_from_exit = "main" : goto *main

		stop
	}
