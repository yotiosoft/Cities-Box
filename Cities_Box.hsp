/*--------------------------------------------------------------------------------------------------

									   Cities Box Ver 0.6.2
										 Main Source Code
	
										(C)YotioSoft 2017
	
--------------------------------------------------------------------------------------------------*/

*include
#include "hspinet.as"

*define
/*ãƒãƒƒãƒ—ã‚µã‚¤ã‚ºï¼ˆ64x64ï¼‰*/
#define chip_size		64

/*ã‚¿ã‚¤ãƒ«ã‚’å¡—ã‚Šã¤ã¶ã™ãŸã‚ã®ãƒã‚¯ãƒ­*/
#define qv(%1,%2)	macro1=%1*chip_size/2-camx-%2*chip_size/2,%1*chip_size/2+chip_size/2-camx-%2*chip_size/2:\
					macro1(2)=%1*chip_size/2+chip_size-camx-%2*chip_size/2,%1*chip_size/2+chip_size/2-camx-%2*chip_size/2:\
					macro2=%2*chip_size/4+chip_size/4-camy+%1*chip_size/4,%2*chip_size/4-camy+%1*chip_size/4:\
					macro2(2)=%2*chip_size/4+chip_size/4-camy+%1*chip_size/4,%2*chip_size/4+chip_size/2-camy+%1*chip_size/4:\
					gmode 3,,,128 : gsquare -1,macro1,macro2
	
/*ã‚¯ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒ“ãƒ¥ãƒ¼ã®ä½ç½®ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®ãƒã‚¯ãƒ­ï¼ˆãƒãƒƒãƒ—è¡¨ç¤ºç”¨ï¼‰*/
#define qv2(%1,%2)	macro1@=%1*chip_size/2-camx-%2*chip_size/2,%1*chip_size/2+chip_size/2-camx-%2*chip_size/2:\
					macro1@(2)=%1*chip_size/2+chip_size-camx-%2*chip_size/2,%1*chip_size/2+chip_size/2-camx-%2*chip_size/2:\
					macro2@=%2*chip_size/4+chip_size/4-camy+%1*chip_size/4,%2*chip_size/4-camy+%1*chip_size/4:\
					macro2@(2)=%2*chip_size/4+chip_size/4-camy+%1*chip_size/4,%2*chip_size/4+chip_size/2-camy+%1*chip_size/4:\

*uselib
	#uselib "user32.dll"
		#func FindWindow "FindWindowA" str, int
		#func GetWindowRect "GetWindowRect" int, int
		#func DrawText "DrawTextW" int,wstr,int,int,int
	
		#func ClientToScreen "ClientToScreen" int, int
	
		#func GetWindowLong "GetWindowLongA" int,int
		#func SetWindowLong "SetWindowLongA" int,int,int
	
		#define WM_SIZE	0x00005	//ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºå¤‰æ›´
		#define WS_MAXIMIZEBOX	0x10000	//æœ€å¤§åŒ–ãƒœã‚¿ãƒ³
		#define WS_THICKFRAME	0x40000	//ã‚µã‚¤ã‚ºå¤‰æ›´å¯èƒ½
	
*module
#module

/*æŒ‡å®šã•ã‚ŒãŸç¯„å›²å†…ã«ãƒã‚¦ã‚¹ãŒã‚ã‚‹ã‹ç¢ºèªã™ã‚‹é–¢æ•°ï¼ˆä½¿ç”¨ä¾‹ï¼šclick_range (100, 0, 300, 300) ï¼‰*/
#defcfunc click_range int mouse_x, int mouse_y, int mouse_x2, int mouse_y2
	if ginfo_wx1 <= ginfo_mx and ginfo_wx2 >= ginfo_mx and ginfo_wy1 <= ginfo_my and ginfo_wy2 >= ginfo_my and mouse_x <= mousex and mouse_x2 >= mousex and mouse_y <= mousey and mouse_y2 >= mousey {
		return 1
	}
	
	return 0
	
/*ã‚¢ãƒ‰ã‚ªãƒ³ã®ç•ªå·ã‚’å–å¾—ã™ã‚‹é–¢æ•°*/
#defcfunc addon_num str input_addon_name
	chdir directory@
	exist "data/temp/"+input_addon_name+".temp"
	
	if strsize = -1 {
		return addon_num@("tile_greenfield")	; ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã€ã¨ã‚Šã‚ãˆãšæ›´åœ°ï¼ˆgreenfieldï¼‰ã®å€¤ã‚’è¿”ã™
	}	
	
	notesel temp_file
	noteload "data/temp/"+input_addon_name+".temp"
	
	return int(temp_file)
	
/*å„é …ç›®ã®èª­ã¿è¾¼ã¿ï¼ˆä½¿ç”¨ä¾‹ï¼šget_chapter(å…ƒã®å¤‰æ•°, "æ¤œç´¢ã™ã‚‹é …ç›®", "å§‹ç‚¹åŒºåˆ‡ã‚Šã‚³ãƒ¼ãƒ‰", "çµ‚ç«¯ã‚³ãƒ¼ãƒ‰") ï¼‰*/
#defcfunc get_chapter var underlying_var, str search_chapter, str punctuate, str end_word
	value = instr(underlying_var, 0, search_chapter)
	get_chapter_buf = strmid ( underlying_var, value + strlen(""+search_chapter+""+punctuate+""), instr(underlying_var, value + strlen(""+search_chapter+""+punctuate+""), end_word) )
	
	return get_chapter_buf
	
/*æŒ‡å®šã•ã‚ŒãŸæ–‡å­—åˆ—ãŒä½•ç•ªç›®ã®è¦ç´ ã«ã‚ã‚‹ã‹ã‚’å–å¾—ï¼ˆ2æ¬¡é…åˆ—ç”¨ï¼‰ï¼ˆä½¿ç”¨ä¾‹ï¼šelement2 æ¤œç´¢ã™ã‚‹ã‚¢ãƒ‰ã‚ªãƒ³å, æ¤œç´¢ã™ã‚‹æ–‡å­—åˆ—ãŒå«ã¾ã‚Œã‚‹å¤‰æ•°å, ãã®å¤‰æ•°ã®è¦ç´ æ•°ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹å¤‰æ•°, "æ¤œç´¢ã™ã‚‹æ–‡å­—åˆ—"ï¼‰*/
#defcfunc element2 str search_addon_name, array search_var, array search_var_elements, str search_word
	chdir directory@
	exist "data/temp/"+search_addon_name+".temp"
	if strsize = -1 {
		return -2
	}
	
	notesel temp_file
	noteload "data/temp/"+search_addon_name+".temp"
	
	finish = -1
	
	repeat search_var_elements( int(temp_file) )
		if search_var(int(temp_file), cnt) = search_word {
			finish = cnt
			break
		}
	loop
	
	return finish
	
/*æŒ‡å®šã•ã‚ŒãŸæ–‡å­—åˆ—ãŒä½•ç•ªç›®ã®è¦ç´ ã«ã‚ã‚‹ã‹ã‚’å–å¾—ï¼ˆ3æ¬¡é…åˆ—ç”¨ï¼‰ï¼ˆä½¿ç”¨ä¾‹ï¼šelement3 æ¤œç´¢ã™ã‚‹ã‚¢ãƒ‰ã‚ªãƒ³å, æ¤œç´¢ã™ã‚‹æ–‡å­—åˆ—ãŒå«ã¾ã‚Œã‚‹å¤‰æ•°å, ãã®å¤‰æ•°ã®è¦ç´ æ•°ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹å¤‰æ•°, "æ¤œç´¢ã™ã‚‹æ–‡å­—åˆ—", æ¤œç´¢ã™ã‚‹æ–‡å­—åˆ—ãŒå«ã¾ã‚Œã‚‹3ç•ªç›®ã®è¦ç´ ã®å¤‰æ•°å, ãã®3ç•ªç›®ã®è¦ç´ ã®å¤‰æ•°ã®è¦ç´ æ•°ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹å¤‰æ•°, "3ç•ªç›®ã®è¦ç´ ã§æ¤œç´¢ã™ã‚‹æ–‡å­—åˆ—"ï¼‰*/
#defcfunc element3 str search_addon_name, array search_var, array search_var_elements, str search_word, array second_search_var, array second_search_var_elements, str second_search_word
	chdir directory@
	exist "data/temp/"+search_addon_name+".temp"
	
	if strsize = -1 {
		return -2
	}
	
	notesel temp_file
	noteload "data/temp/"+search_addon_name+".temp"
	
	finish = -1
	
	repeat search_var_elements( int(temp_file) )
		if search_var(int(temp_file), cnt) = search_word {
			icnt = cnt
			repeat second_search_var_elements( int(temp_file), icnt )
				if second_search_var(int(temp_file), icnt, cnt) = second_search_word {
					finish = cnt
					break
				}
			loop
		}
	loop
	
	return finish

/*æ–‡å­—ã‚’ä¸­å¤®ã«è¡¨ç¤ºï¼ˆä½¿ç”¨ä¾‹ï¼šcmes "hogehoge", 0, 640, 0, 480, 0ï¼‰*/
#deffunc cmes str ctext, int cx, int cy, int cx2, int cy2, int redraw_exist
	RECT = cx, cy, cx2, cy2
	DrawText@ hdc, ctext, -1, varptr(RECT), $01
	
	if redraw_exist = 0 : redraw 1
	return

/*ç”»åƒã‚’ã¼ã‹ã™ï¼ˆhsp/sample/new/gblur.hsp | ä½¿ç”¨ä¾‹ï¼šgblur 2ï¼‰*/
#deffunc gblur int p1, int p2
	gmode 3, ginfo_sx, ginfo_sy, 128
	if (p2&1)=0 {
		repeat p1
		pos 1,0:gcopy ginfo(3)
		pos 0,0:gcopy ginfo(3),2,0
		loop
	}
	if (p2&2)=0 {
		repeat p1
		pos 0,1:gcopy ginfo(3)
		pos 0,0:gcopy ginfo(3),0,2
		loop
	}
	return
	
/*åŠé€æ˜è‰²è¡¨ç¤ºå‘½ä»¤*/
#deffunc boxfa int ax, int ay, int bx, int by
	pdx = ax, bx, bx, ax
	pdy = ay, ay, by, by
	gsquare -1,pdx, pdy
	return
	
/*åŠé€æ˜è‰²è¡¨ç¤ºå‘½ä»¤ï¼ˆæ©Ÿèƒ½ã¯boxfaã¨åŒã˜ï¼‰*/
#deffunc sboxf int depth, int ax, int ay, int bx, int by
	pdx = ax, bx, bx, ax
	pdy = ay, ay, by, by
	gmode 3,,,depth
	gsquare -1,pdx, pdy
	return
	
/*ã‚¢ãƒ‰ã‚ªãƒ³ã®æƒ…å ±ã‚’å–å¾—*/
#deffunc get_about_addon int search_addon_number@, int search_type_number@, int search_direction_number@, var input_top_left_x, var input_top_left_y, var input_bottom_right_x, var input_bottom_right_y,var input_size_x, var input_size_y
	//ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”»åƒä¸Šã®åº§æ¨™ã‚’å–å¾—
		input_top_left_x = addon_top_left_x@( search_addon_number@, search_type_number@, search_direction_number@ )
		input_top_left_y = addon_top_left_y@( search_addon_number@, search_type_number@, search_direction_number@ )
		input_bottom_right_x = addon_bottom_right_x@( search_addon_number@, search_type_number@, search_direction_number@ )
		input_bottom_right_y = addon_bottom_right_y@( search_addon_number@, search_type_number@, search_direction_number@ )
		
		input_size_x = addon_size_x@( search_addon_number@, search_type_number@, search_direction_number@ )
		input_size_y = addon_size_y@( search_addon_number@, search_type_number@, search_direction_number@ )
	
	return
	
/*æš—å·åŒ–ï¼†å¾©å·ï¼ˆè¨€ã†ã»ã©é›£ã—ã„ã‚‚ã®ã§ã‚‚ãªã„ã‘ã©â€¦ï¼‰*/
//æš—å·åŒ–
#deffunc enc var p1, int key, int size
	repeat size
	    poke p1, cnt, peek(p1, cnt) + key
	loop
	
	return

//å¾©å·
#deffunc dec var p1, int key, int size
	repeat size
	    poke p1, cnt, peek(p1, cnt) - key
	loop
	
	return
	
//ƒ_ƒEƒ“ƒ[ƒhi—vhspinet.dllj
#deffunc download str url, str request, str dlname
	netinit@
	neturl@ url
	
	netdlname@ dlname					;	ƒ_ƒEƒ“ƒ[ƒhŒã‚Ìƒtƒ@ƒCƒ‹–¼
	netrequest@ request					;	ƒtƒ@ƒCƒ‹–¼‚Ìw’èi‚±‚±‚Åw’è‚·‚éj
	
	repeat
		exist dlname
		netexec@ res
		if res : break
		await 50
	loop

	netterm@
	
	return
								
#global

*load_about
	//ã‚¿ã‚¤ãƒˆãƒ«ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®èª­ã¿è¾¼ã¿
		notesel about
		noteload "data/about.txt"
		
		noteget about_title, 0
		noteget about_version, 1
	
		split about_title, " : ", not_use, about_title
		split about_version, " : ", not_use, about_version
	
		title about_title
		
*load_config
	//æœ¬ä½“è¨­å®šèª­ã¿è¾¼ã¿
		notesel config
		noteload "data/config.dat"
	
		SystemFont = get_chapter(config, "SystemFont", " = \"", "\"")
		Set_Play_BGM = int( get_chapter(config, "Set_Play_BGM", " = ", ";") )
	
		Config_WindowSize_X = int( get_chapter(config, "Config_WindowSize_X", " = ", ";") )
		Config_WindowSize_Y = int( get_chapter(config, "Config_WindowSize_Y", " = ", ";") )
	
*changeable
	//ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ã‚µã‚¤ã‚ºã‚’å¤‰æ›´å¯èƒ½åŒ–
		windowx=Config_WindowSize_X : windowy=Config_WindowSize_Y
		screen 0, ginfo_dispx, ginfo_dispy : width windowx, windowy
		
		GetWindowLong hwnd, -16
		SetWindowLong hwnd, -16, stat | WS_THICKFRAME | WS_MAXIMIZEBOX
	
		gsel 0
	
*buffering
	//èª­ã¿è¾¼ã¿ä¸­ç”»é¢
		color 0, 0, 0 : boxf
	
		color 255, 255, 255 : font SystemFont, 14
		pos 10, 10 : mes "ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„\nLoading images..."
		
	//ãƒ­ã‚´ã€èƒŒæ™¯ç”»åƒï¼ˆbuffer 1ã¯è¨­å®šã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ä½¿ã†ãŸã‚ä½¿ç”¨ä¸å¯ï¼‰
		celload "img/logo.png", 2										; ãƒ­ã‚´
		celload "img/title_background.png", 15							; ã‚¿ã‚¤ãƒˆãƒ«èƒŒæ™¯ç”»åƒ
	
	//ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã‚¢ã‚¤ã‚³ãƒ³
		celload "img/menu_icons/menu/cursor.png", 3							; æ¨™æº–ã‚«ãƒ¼ã‚½ãƒ«
		celload "img/menu_icons/menu/road.png", 4							; ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆé“è·¯æ•·è¨­ï¼‰
		celload "img/menu_icons/menu/low_density_residential.png", 5		; ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆä½å±…åœ°åŒºå»ºè¨­ï¼‰
		celload "img/menu_icons/menu/commercial.png", 12					; ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆå•†æ¥­åœ°åŒºå»ºè¨­ï¼‰
		celload "img/menu_icons/menu/office.png", 6							; ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆã‚ªãƒ•ã‚£ã‚¹å»ºè¨­ï¼‰
		celload "img/menu_icons/menu/industrial.png", 19					; ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆå·¥æ¥­åœ°åŒºå»ºè¨­ï¼‰
		celload "img/menu_icons/menu/public.png", 7							; ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆéƒµä¾¿å±€å»ºè¨­ï¼‰
		celload "img/menu_icons/menu/park.png", 29							; ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆå…¬åœ’å»ºè¨­ï¼‰
	
		celload "img/menu_icons/menu/bulldozer.png", 10						; æ’¤å»ãƒœã‚¿ãƒ³
		celload "img/menu_icons/save/save.png", 11							; ä¿å­˜ãƒœã‚¿ãƒ³
		celload "img/menu_icons/setting/setting.png", 13					; è¨­å®šãƒœã‚¿ãƒ³
		celload "img/menu_icons/stat/stat.png", 30							; çµ±è¨ˆãƒœã‚¿ãƒ³
	
	//å°ã‚µã‚¤ã‚ºã®ã‚¢ã‚¤ã‚³ãƒ³
		celload "img/menu_icons/mini/low_density_residential.png", 8		; ä½å¯†åº¦ä½å±…åœ°åŒº
		celload "img/menu_icons/mini/high_density_residential.png", 9		; é«˜å¯†åº¦ä½å±…åœ°åŒº
		celload "img/menu_icons/mini/low_density_commercial.png", 20		; ä½å¯†åº¦å•†æ¥­åœ°åŒº
		celload "img/menu_icons/mini/high_density_commercial.png", 21		; é«˜å¯†åº¦å•†æ¥­åœ°åŒº
	
	//è¨­å®šã§ä½¿ã†ã‚¢ã‚¤ã‚³ãƒ³
		celload "img/menu_icons/setting/check.png", 14						; ãƒã‚§ãƒƒã‚¯ãƒœã‚¿ãƒ³
		celload "img/menu_icons/setting/refer.png", 16						; å‚ç…§ãƒœã‚¿ãƒ³
	
	//çµ±è¨ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ä½¿ã†ã‚¢ã‚¤ã‚³ãƒ³
		celload "img/menu_icons/stat/type.png", 31							; å»ºç¯‰ç‰©ã®ç¨®é¡
		celload "img/menu_icons/stat/land_price.png", 32					; åœ°ä¾¡
		celload "img/menu_icons/stat/crime_rate.png", 33					; çŠ¯ç½ªç‡
		celload "img/menu_icons/stat/education_rate.png", 47				; æ•™è‚²ç‡
	
	//çŠ¯ç½ªç‡ã€åœ°ä¾¡ã®çµ±è¨ˆã§ä½¿ã†ã‚¿ã‚¤ãƒ«
		celload "img/quarter/+3.png", 34									; åœ°ä¾¡/çŠ¯ç½ªç‡/æ•™è‚²ç‡ : æœ€è‰¯
		celload "img/quarter/+2.png", 35									; åœ°ä¾¡/çŠ¯ç½ªç‡/æ•™è‚²ç‡ : è‰¯
		celload "img/quarter/+1.png", 36									; åœ°ä¾¡/çŠ¯ç½ªç‡/æ•™è‚²ç‡ : æ¦‚ã­è‰¯
		celload "img/quarter/0.png" , 48									; åœ°ä¾¡/çŠ¯ç½ªç‡/æ•™è‚²ç‡ : 0
		celload "img/quarter/-1.png", 37									; åœ°ä¾¡/çŠ¯ç½ªç‡/æ•™è‚²ç‡ : å°‘ã—ä½ã„/æ‚ªã„
		celload "img/quarter/-2.png", 38									; åœ°ä¾¡/çŠ¯ç½ªç‡/æ•™è‚²ç‡ : ä½ã„/æ‚ªã„
		celload "img/quarter/-3.png", 39									; åœ°ä¾¡/çŠ¯ç½ªç‡/æ•™è‚²ç‡ : æœ€ä½/æœ€æ‚ª
	
	//ã‚¨ãƒªã‚¢è¨­å®šã§ä½¿ã†ã‚¢ã‚¤ã‚³ãƒ³
		celload "img/area/residential.png", 40								; ã‚¨ãƒªã‚¢ : ä½å±…åœ°åŒº
		celload "img/area/commercial.png", 41								; ã‚¨ãƒªã‚¢ : å•†æ¥­åœ°åŒº
		celload "img/area/office.png", 42									; ã‚¨ãƒªã‚¢ : ã‚ªãƒ•ã‚£ã‚¹åœ°åŒº
		celload "img/area/industrial.png", 43								; ã‚¨ãƒªã‚¢ : å·¥æ¥­åœ°åŒº
	
	//ãƒã‚¤ãƒ³ã‚¿ãƒ¼
		celload "img/pointer/blue.png", 17									; é’ã„ãƒã‚¤ãƒ³ã‚¿ãƒ¼
		celload "img/pointer/red.png", 18									; èµ¤ã„ãƒã‚¤ãƒ³ã‚¿ãƒ¼
	
	//åœ°åŒºã‚’ç¤ºã™ã‚¿ã‚¤ãƒ«
		celload "img/quarter/residential.png", 22							; ä½å±…åœ°åŒº
		celload "img/quarter/commercial.png", 23							; å•†æ¥­åœ°åŒº
		celload "img/quarter/office.png", 24								; ã‚ªãƒ•ã‚£ã‚¹åœ°åŒº
		celload "img/quarter/industrial.png", 25							; å·¥æ¥­åœ°åŒº
		celload "img/quarter/public.png", 26								; å…¬å…±æ–½è¨­
		celload "img/quarter/h_residential.png", 44							; é«˜å¯†åº¦ä½å±…åœ°åŒº
		celload "img/quarter/h_commercial.png", 45							; é«˜å¯†åº¦å•†æ¥­åœ°åŒº
		celload "img/quarter/h_office.png", 46								; é«˜å¯†åº¦ã‚ªãƒ•ã‚£ã‚¹åœ°åŒº
	
	//æœ€åˆã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ã®ãƒœã‚¿ãƒ³
		celload "img/start_menu/hoe.png", 27								; é¬
		celload "img/start_menu/city.png", 28								; éƒ½å¸‚
	
*preparation
	//èª­ã¿è¾¼ã¿ä¸­ç”»é¢
		color 0, 0, 0 : boxf
	
		color 255, 255, 255 : font SystemFont, 14
		pos 10, 10 : mes "ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„\nIn preparation..."
		
	//onexit
		onexit *exit
	
	//mciç™»éŒ²
		mci "set Cities-Box time format milliseconds"
	
	//æš—å·åŒ–ã‚­ãƒ¼
		iCipherKey = 2147483647
	
	//ãƒãƒƒãƒ•ã‚¡ç•ªå·1000ä»¥é™ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
		//ã¾ãšAddonãƒ•ã‚©ãƒ«ãƒ€å†…ã®ã‚¢ãƒ‰ã‚ªãƒ³ã®æ•°ã‚’å–å¾—
			directory = dirinfo(0)
	
			#include "hspext.as"
				chdir "addons"
	
				//ã¾ãšãƒ‘ã‚¹åã‚’è¦—ã„ãŸãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’å–å¾—
					dirlist2h 2, ','
					dirlist2 buf_addons, "*.adat*", 1, '\\'
		
					sdim addon_file_name, buf_addons
					dirlist2r addon_file_name
					
				//æ¬¡ã«ãƒ‘ã‚¹åã‚’å«ã‚ãŸãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’å–å¾—
					dirlist2h 1, ','
					dirlist2 buf_addons, "*.adat*", 1, '\\'
					
					sdim filelist, buf_addons
					dirlist2r filelist
					
					notesel filelist
					total_addons = notemax
	
					addon_number = 0
	
			//sdimï¼†dim
				sdim addon_name, total_addons
				sdim addon_jp_name, total_addons
				sdim addon_summary, total_addons
				sdim addon_icon, total_addons
				sdim addon_type, total_addons
				sdim addon_type_2, total_addons
				dim addon_maximum_capacity, total_addons
	
				sdim use_type, total_addons, 100
				dim addon_total_use_types, total_addons
	
				dim addon_total_addon_direction, total_addons, 100
				sdim addon_direction, total_addons, 100, 100
				sdim addon_image, total_addons, 100
	
				addon_direction = ""
			
				sdim addon_size_x_buf, total_addons, 100, 100
				sdim addon_size_y_buf, total_addons, 100, 100
				dim addon_size_x, total_addons, 100, 100
				dim addon_size_y, total_addons, 100, 100
			
				sdim addon_chip_x_buf, total_addons, 100, 100
				sdim addon_chip_y_buf, total_addons, 100, 100
				dim addon_chip_x, total_addons, 100, 100
				dim addon_chip_y, total_addons, 100, 100
			
				sdim addon_top_left_x_buf, total_addons, 100, 100
				sdim addon_top_left_y_buf, total_addons, 100, 100
				dim addon_top_left_x, total_addons, 100, 100
				dim addon_top_left_y, total_addons, 100, 100
			
				sdim addon_bottom_right_x_buf, total_addons, 100, 100
				sdim addon_bottom_right_y_buf, total_addons, 100, 100
				dim addon_bottom_right_x, total_addons, 100, 100
				dim addon_bottom_right_y, total_addons, 100, 100
	
				dim addon_land_price_influence, 128
				dim addon_land_price_influence_grid, 128
	
				dim addon_crime_rate_influence, 128
				dim addon_crime_rate_influence_grid, 128
	
				dim addon_education_rate_influence, 128
				dim addon_education_rate_influence_grid, 128
	
				sdim type_Two_lane_road, 128
				sdim type_number_Two_lane_road, 128
				sdim type_low_density_residential, 128
				sdim type_number_low_density_residential, 128
				sdim type_high_density_residential, 128
				sdim type_number_high_density_residential, 128
				sdim type_office, 128
				sdim type_industrial, 128
				sdim type_public, 128
	
*load_addons
	//ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®adatãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿
		repeat total_addons
			notesel filelist
			noteget buf_filelist, cnt
	
			notesel buf_adat
			noteload buf_filelist
	
			//ç¾åœ¨ã®ãƒ‘ã‚¹åã®ã¿å–å¾—
				addon_path = getpath(buf_filelist, 32)
	
			//ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå¤‰æ›´
				chdir addon_path
	
			//ã‚¢ãƒ‰ã‚ªãƒ³åå–å¾—
					addon_name(cnt) = get_chapter(buf_adat, "addon_name", " = \\", "\"")
	
			//èª­ã¿è¾¼ã¿ä¸­ç”»é¢
				color 0, 0, 0 : boxf
				
				color 255, 255, 255 : font SystemFont, 14
				pos 10, 10 : mes "ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„\nLoading addons : "+addon_name(cnt)+""
	
			//å„é …ç›®ã®èª­ã¿è¾¼ã¿
	
				//æ—¥æœ¬èªã®ã‚¢ãƒ‰ã‚ªãƒ³åã¨èª¬æ˜
					addon_jp_name(cnt) = get_chapter(buf_adat, "addon_jp_name", " = \\", "\"")
					addon_summary(cnt) = get_chapter(buf_adat, "addon_summary", " = \\", "\"")
	
				//ã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ã‚¤ã‚³ãƒ³
					addon_icon(cnt) = get_chapter(buf_adat, "addon_icon", " = \\", "\"")
							
				//ã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¿ã‚¤ãƒ—
					addon_type(cnt) = get_chapter(buf_adat, "addon_type", " = \"", "\"")
					addon_type_2(cnt) = get_chapter(buf_adat, "addon_type_2", " = \"", "\"")
	
				//å»ºç‰©ã®åå®¹å¯èƒ½äººæ•°ï¼ˆä½å±…åœ°åŒºã®å ´åˆã¯ä½æ°‘æ•°ã€å•†æ¥­ãƒ»ã‚ªãƒ•ã‚£ã‚¹ãƒ»å·¥æ¥­ãƒ»å…¬å…±æ–½è¨­ã¯åŠ´åƒè€…æ•°ï¼‰
					addon_maximum_capacity(cnt) = int( get_chapter(buf_adat, "maximum_capacity", " = \"", "\"") )
	
				//åœ°ä¾¡ã®å½±éŸ¿åŠ›
					addon_land_price_influence(cnt) = int( get_chapter(buf_adat, "land_price_influence", " = \"", "\"") )
					addon_land_price_influence_grid(cnt) = int( get_chapter(buf_adat, "land_price_influence_grid", " = \"", "\"") )
	
				//çŠ¯ç½ªç‡ã¸ã®å½±éŸ¿åŠ›ï¼ˆ+ãªã‚‰çŠ¯ç½ªç‡å¢—ã€-ãªã‚‰çŠ¯ç½ªç‡æ¸›ï¼‰
					addon_crime_rate_influence(cnt) = int( get_chapter(buf_adat, "crime_rate_influence", " = \"", "\"") )
					addon_crime_rate_influence_grid(cnt) = int( get_chapter(buf_adat, "crime_rate_influence_grid", " = \"", "\"") )
	
				//æ•™è‚²ç‡ã¸ã®å½±éŸ¿ç‡
					addon_education_rate_influence(cnt) = int( get_chapter(buf_adat, "education_rate_influence", " = \"", "\"") )
					addon_education_rate_influence_grid(cnt) = int( get_chapter(buf_adat, "education_rate_influence_grid", " = \"", "\"") )
	
				//çª“ã®è‰²ï¼ˆRGBå€¤ï¼‰
					addon_window_color_tmp = get_chapter(buf_adat, "window_color", " = (", ")")
	
					if instr(buf_adat, 0, "window_color") != -1 {
						split addon_window_color_tmp, ", ", addon_window_color_R_tmp, addon_window_color_G_tmp, addon_window_color_B_tmp
						addon_window_color_R(cnt) = int(addon_window_color_R_tmp) : addon_window_color_G(cnt) = int(addon_window_color_G_tmp) : addon_window_color_B(cnt) = int(addon_window_color_B_tmp)
	
					} else {
						addon_window_color_R(cnt) = -1 : addon_window_color_G(cnt) = -1 : addon_window_color_B(cnt) = -1
	
					}
					
	
				//ã‚¢ãƒ‰ã‚ªãƒ³ã®adatãƒ•ã‚¡ã‚¤ãƒ«ã®è©³ç´°ã®èª­ã¿è¾¼ã¿ã¸
					gosub *load_adat
	
				//ã‚«ãƒ†ã‚´ãƒªåˆ†ã‘
					if addon_type(cnt) = "Two_lane_road" {
						notesel type_Two_lane_road
						noteadd addon_name(cnt), -1
	
						notesel type_number_Two_lane_road
						noteadd str(cnt), -1
					}
							
					if addon_type(cnt) = "low_density_residential" {
						notesel type_low_density_residential
						noteadd addon_name(cnt), -1
	
						notesel type_number_low_density_residential
						noteadd str(cnt), -1
					}
					if addon_type(cnt) = "high_density_residential" {
						notesel type_high_density_residential
						noteadd addon_name(cnt), -1
	
						notesel type_number_high_density_residential
						noteadd str(cnt), -1
					}
	
					if addon_type(cnt) = "low_density_commercial" {
						notesel type_low_density_commercial
						noteadd addon_name(cnt), -1
	
						notesel type_number_low_density_commercial
						noteadd str(cnt), -1
					}
					if addon_type(cnt) = "high_density_commercial" {
						notesel type_high_density_commercial
						noteadd addon_name(cnt), -1
	
						notesel type_number_high_density_commercial
						noteadd str(cnt), -1
					}
					
					if addon_type(cnt) = "office" {
						notesel type_office
						noteadd addon_name(cnt), -1
	
						notesel type_number_office
						noteadd str(cnt), -1
					}
	
					if addon_type(cnt) = "industrial" {
						notesel type_industrial
						noteadd addon_name(cnt), -1
						
						notesel type_number_industrial
						noteadd str(cnt), -1
					}
					
					if addon_type(cnt) = "public" {
						notesel type_public
						noteadd addon_name(cnt), -1

						notesel type_number_public
						noteadd str(cnt), -1
					}
	
					if addon_type(cnt) = "park" {
						notesel type_park
						noteadd addon_name(cnt), -1

						notesel type_number_park
						noteadd str(cnt), -1
					}
	
				//ã‚¢ãƒ‰ã‚ªãƒ³ã®ãƒãƒƒãƒ•ã‚¡ï¼ˆ1000ï½ã€è¤‡æ•°ã®ç”»åƒã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯1001000ï½ï¼‰
					if addon_total_use_types(addon_number) > 1 {
						repeat addon_total_use_types(addon_number)
							addon_buffer_number = (1000 + addon_number) * 1001 + cnt
							celload addon_image(addon_number, cnt), addon_buffer_number
							await 1
						loop
					} else {
						celload addon_image(addon_number, 0), (1000 + addon_number)
					}
	
				//ã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ã‚¤ã‚³ãƒ³ã®ãƒãƒƒãƒ•ã‚¡ï¼ˆ10001000ï½ï¼‰
					celload addon_icon(addon_number), (10001000 + addon_number)

				//ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æˆ»ã™
					chdir directory
	
				//ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜
					temp_file = str(addon_number)
					
					notesel temp_file
					notesave "data/temp/"+addon_name(cnt)+".temp"
	
				//ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æˆ»ã™
					chdir ""+directory+"\\addons"
	
				addon_number++
	
			await 1
		loop
	
	chdir directory
	
*check_update
	color 0, 0, 0 : boxf
	
	color 255, 255, 255 : font SystemFont, 14
	pos 10, 10 : mes "‚µ‚Î‚ç‚­‚¨‘Ò‚¿‚­‚¾‚³‚¢\nƒAƒbƒvƒf[ƒg‚ÌŠm”F’†..."
	
	//Šù‚ÉƒAƒbƒvƒf[ƒ^[‚ª‚ ‚ê‚Îíœ
		exist "Cities_Box_UD.exe"
		if strsize != -1 {
			delete "Cities_Box_UD.exe"
		}
	
	download "http://joogle.web.fc2.com/datacenter/cities_box/", "datacenter_url.txt", "data/datacenter_url.txt"
	
	notesel datacenter_url
	noteload "data/datacenter_url.txt"
	
	if instr(datacenter_url, 0, "http://") = -1 {
		datacenter_url = "http://yotiosoft.com/dc/cities_box/"
	}
	
	download datacenter_url, "latest_version.txt", "data/latest_version.txt"
	
	notesel latest_version
	noteload "data/latest_version.txt"
	
	if instr(latest_version, 0, "<!DOCTYPE html>") != -1 {
		goto *menu
	}
	
	latest_version__Release_number = int(get_chapter(latest_version, "Release Number", " : ", ";"))
	latest_version__Title = get_chapter(latest_version, "Title", " : ", ";")
	latest_version__Version = get_chapter(latest_version, "Version", " : ", ";")
	
	notesel about
	noteload "data/about.txt"
	noteget tmp_about, 2
	split tmp_about, " : ", tmp, NOW_Release_number
	NOW_Release_number = int(NOW_Release_number)
	
*menu
	onclick gosub *menu_onclick
	
	if latest_version__Release_number > NOW_Release_number and update_button = 0 {
		objsize 100, 20
		pos windowx-100-20, windowy-titlebar_h-60+20 : button gosub "XV‚·‚é", *update
		update_button = 1
	}
	
	repeat
		//ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºã¨ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼ã®é«˜ã•ã‚’å–å¾—
			gosub *get_windowsize
	
		redraw 0
				
		pos 0, 0 : gzoom windowx, windowy-titlebar_h, 15, 0, 0, 948, 635 : gblur 2
				
		pos windowx/2-55, double(50./483)*(windowy-titlebar_h) : gmode 0 : gcopy 2, 0, 0, 110, 110
			
		color 255, 255, 255 : font SystemFont, 18
		cmes "Ver."+about_version+"", 0, double(200./483)*(windowy-titlebar_h), windowx, double(270./483)*(windowy-titlebar)+30
			
		font SystemFont, 14
			
		color 0, 162, 232
			
		if click_range(windowx/2-50-20-10, double(300./483)*(windowy-titlebar_h), windowx/2-50-20+50+10, double(300./483)*(windowy-titlebar_h)+50+2+20) = 1 {
			gmode 3,,,200 : boxfa windowx/2-50-20-10, double(300./483)*(windowy-titlebar_h), windowx/2-50-20+50+10, double(300./483)*(windowy-titlebar_h)+50+2+20
		}
		if click_range(windowx/2+20-10, double(300./483)*(windowy-titlebar_h), windowx/2+20+50+10, double(300./483)*(windowy-titlebar_h)+50+2+20) = 1 {
			gmode 3,,,200 : boxfa windowx/2+20-10, double(300./483)*(windowy-titlebar_h), windowx/2+20+50+10, double(300./483)*(windowy-titlebar_h)+50+2+20
		}
			
		color 255, 255, 255
			
		gmode 2
		pos windowx/2-50-20, double(300./483)*(windowy-titlebar_h) : gcopy 27, 0, 0, 50, 50
			cmes "æ–°ã—ã„ãƒãƒƒãƒ—", windowx/2-50-20-10, double(300./483)*(windowy-titlebar_h)+50+2, windowx/2-50-20+50+10, double(300./483)*(windowy-titlebar_h)+50+2+20
					
		pos windowx/2+20, double(300./483)*(windowy-titlebar_h) : gcopy 28, 0, 0, 50, 50
<<<<<<< HEAD
			cmes "“Ç‚İ‚İ", windowx/2+20, double(300./483)*(windowy-titlebar_h)+50+2, windowx/2+20+50, double(300./483)*(windowy-titlebar_h)+50+2+20
	
		//ƒAƒbƒvƒf[ƒg‚ª‚ ‚Á‚½ê‡
			if latest_version__Release_number > NOW_Release_number {
				color 0, 162, 232 : sboxf 128, 0, windowy-titlebar_h-60, windowx, windowy
				color 255, 255, 255
				pos 10, windowy-titlebar_h-60+5 : mes "ƒAƒbƒvƒf[ƒg‚ª‚ ‚è‚Ü‚·IXV‚µ‚Ü‚·‚©H\n"+latest_version__Title+" Ver."+latest_version__Version+""
			}
=======
			cmes "èª­ã¿è¾¼ã¿", windowx/2+20, double(300./483)*(windowy-titlebar_h)+50+2, windowx/2+20+50, double(300./483)*(windowy-titlebar_h)+50+2+20
>>>>>>> 28d86f9c04c6273608186df0ff49b05f12686fb4
		
		wait 1
		redraw 1
	loop
	
*menu_onclick
	//ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ã§ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã¨ãã«å‹•ä½œ
	if click_range(windowx/2-50-20-10, double(300./483)*(windowy-titlebar_h), windowx/2-50-20+50+10, double(300./483)*(windowy-titlebar_h)+50+2+20) = 1 {
		goto *new_map
	}
	if click_range(windowx/2+20-10, double(300./483)*(windowy-titlebar_h), windowx/2+20+50+10, double(300./483)*(windowy-titlebar_h)+50+2+20) = 1 {
		goto *load_map
	}
	
	return
	
*new_map
	map_mode = "new_map"
	
	//ãƒãƒƒãƒ—æ–°è¦ä½œæˆ
		mapx=100:mapy=100
	
		dim buffer_number, mapx, mapy
		dim atlx, mapx, mapy
		dim atly, mapx, mapy
		dim abrx, mapx, mapy
		dim abry, mapx, mapy
		dim sizex, mapx, mapy
		dim sizey, mapx, mapy
	
		dim map, mapx, mapy					//å„åº§æ¨™ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·
		sdim name, mapx, mapy				//å„åº§æ¨™ã®ã‚¢ãƒ‰ã‚ªãƒ³å
		sdim category, mapx, mapy			//å„ãƒã‚¹ã«ç½®ã‹ã‚Œã¦ã„ã‚‹ã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼ˆroad, residentialãªã©ï¼‰
		dim obj_type, mapx, mapy			//åº§æ¨™ä¸Šã«ã‚ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¿ã‚¤ãƒ—
		dim obj_dire, mapx, mapy			//åº§æ¨™ä¸Šã«ã‚ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å‘ã
		dim obj_serial_num, mapx, mapy		//ã²ã¨ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¤‡æ•°ã®ã‚¿ã‚¤ãƒ«ã‚’è¦ã™ã‚‹ã¨ãã®ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é€šã—ç•ªå·ï¼ˆ1ãƒã‚¹ã®å ´åˆã¯0ï¼‰
		dim obj_use_tiles_x, mapx, mapy		//ã²ã¨ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¤‡æ•°ã®ã‚¿ã‚¤ãƒ«ã‚’è¦ã™ã‚‹ã¨ãã®ã€å¿…è¦ãªxæ–¹å‘ã®ã‚¿ã‚¤ãƒ«æ•°
		dim obj_use_tiles_y, mapx, mapy		//ã²ã¨ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¤‡æ•°ã®ã‚¿ã‚¤ãƒ«ã‚’è¦ã™ã‚‹ã¨ãã®ã€å¿…è¦ãªyæ–¹å‘ã®ã‚¿ã‚¤ãƒ«æ•°
		dim obj_tiles_x, mapx, mapy			//ã²ã¨ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¤‡æ•°ã®ã‚¿ã‚¤ãƒ«ã‚’è¦ã™ã‚‹ã¨ãã®ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¨­ç½®ã—ãŸå ´æ‰€ã‹ã‚‰ã®xæ–¹å‘ã®ã‚¿ã‚¤ãƒ«ã®æ•°ï¼ˆ1ãƒã‚¹ã®å ´åˆã¯0ï¼‰
		dim obj_tiles_y, mapx, mapy			//ã²ã¨ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¤‡æ•°ã®ã‚¿ã‚¤ãƒ«ã‚’è¦ã™ã‚‹ã¨ãã®ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¨­ç½®ã—ãŸå ´æ‰€ã‹ã‚‰ã®yæ–¹å‘ã®ã‚¿ã‚¤ãƒ«ã®æ•°ï¼ˆ1ãƒã‚¹ã®å ´åˆã¯0ï¼‰
		
		dim residents, mapx, mapy			//å„å»ºç¯‰ç‰©ã®ä½æ°‘ã®æ•°ï¼ˆä½å®…åœ°ã®ã¿ï¼‰
		dim workers_Commercial, mapx, mapy	//å•†æ¥­åœ°åŒºã®å¾“æ¥­å“¡æ•°ï¼ˆå•†æ¥­åœ°åŒºã®ã¿ï¼‰
		dim workers_Office, mapx, mapy		//ã‚ªãƒ•ã‚£ã‚¹åœ°åŒºã®å¾“æ¥­å“¡æ•°ï¼ˆã‚ªãƒ•ã‚£ã‚¹åœ°åŒºã®ã¿ï¼‰
		dim workers_Industrial, mapx, mapy	//å·¥æ¥­åœ°åŒºã®å¾“æ¥­å“¡æ•°ï¼ˆå·¥æ¥­åœ°åŒºã®ã¿ï¼‰
		dim workers_Public, mapx, mapy		//å…¬å…±æ–½è¨­ã®å¾“æ¥­å“¡æ•°ï¼ˆå…¬å…±æ–½è¨­ã®ã¿ï¼‰
	
		dim land_price, mapx, mapy			//åœ°ä¾¡ï¼ˆä¸‡å††/ãƒã‚¹ï¼‰
		dim crime_rate, mapx, mapy			//çŠ¯ç½ªç‡
		dim education_rate, mapx, mapy		//æ•™è‚²ç‡
	
		sdim reservation, 100, 100			//åœ°åŒºã®äºˆç´„ï¼ˆåœ°åŸŸè¨­å®šã•ã‚ŒãŸãŒã¾ã å»ºç‰©ãŒç«‹ã£ã¦ã„ãªã„åŒºåŸŸï¼‰
		
		repeat mapx * mapy
			map(ix,iy) = addon_num_buf
			name(ix,iy) = "tile_greenfield"
			category(ix,iy) = "tile"
	
			obj_type(ix,iy) = 0
			obj_dire(ix,iy) = 0
	
			obj_serial_num(ix,iy) = 0
			obj_use_tiles_x(ix,iy) = 0
			obj_use_tiles_y(ix,iy) = 0
			obj_tiles_x(ix,iy) = 0
			obj_tiles_y(ix,iy) = 0
	
			residents(ix,iy) = 0
			workers_Commercial(ix,iy) = 0
			workers_Office(ix,iy) = 0
			workers_Industrial(ix,iy) = 0
			workers_Public(ix,iy) = 0
	
			land_price(ix,iy) = 20
			crime_rate(ix,iy) = 0
			education_rate(ix,iy) = 0
	
			reservation(ix,iy) = "none"
			
			ix++
			if ix = mapx {
				ix = 0
				iy += 1
			}
		loop
	
	City_Name = ""
	Mayor_Name = ""
	Set_Change_Weather = 1
	
	demand_of_Resindential = 100	; ä½å®…åœ°åŒºã®éœ€è¦åº¦
	demand_of_Commercial = 100		; å•†æ¥­åœ°åŒºã®éœ€è¦åº¦
	demand_of_Office = 100			; ã‚ªãƒ•ã‚£ã‚¹åœ°åŒºã®éœ€è¦åº¦
	demand_of_Industrial = 100		; å·¥æ¥­åœ°åŒºã®éœ€è¦åº¦
	
	time_Year = gettime(0)			; ã‚²ãƒ¼ãƒ å†…ã®æ™‚é–“ã®å¹´
	time_Month = gettime(1)			; ã‚²ãƒ¼ãƒ å†…ã®æ™‚é–“ã®æœˆ
	time_Date = gettime(3)			; ã‚²ãƒ¼ãƒ å†…ã®æ™‚é–“ã®æ—¥
	time_Hour = 0					; ã‚²ãƒ¼ãƒ å†…ã®æ™‚é–“ã®æ™‚
	time_Minutes = 0				; ã‚²ãƒ¼ãƒ å†…ã®æ™‚é–“ã®åˆ†
	
	Total_Population = 0			; éƒ½å¸‚ã®ç·äººå£
	total_maximum_capacity = 0		; éƒ½å¸‚ã®åå®¹å¯èƒ½äººæ•°
	
	next_obj_serial_num = 0			; è¤‡æ•°ã®ã‚¿ã‚¤ãƒ«ã‚’è¦ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é€šã—ç•ªå·
	
	Not_Played_NewMap_BGM = 1		; ãƒãƒƒãƒ—ä½œæˆç›´å¾Œã®BGMã‚’ã¾ã é³´ã‚‰ã—ã¦ã„ãªã„å ´åˆã¯1
	
	//æ°—æ¸©ã®åˆæœŸå€¤
		//12æœˆï½2æœˆï¼š-10â„ƒï½15â„ƒã®ç¯„å›²ã§æ°—æ¸©ã‚’å¤‰å‹•
		if time_Month = 12 or (1 <= time_Month and 2 >= time_Month) {
			temperature = rnd(25)-10
		}
	
		//3æœˆï½5æœˆï¼š10â„ƒï½25â„ƒã®ç¯„å›²ã§æ°—æ¸©ã‚’å¤‰å‹•
		if 3 <= time_Month and 5 >= time_Month {
			temperature = rnd(15) + 10
		}
	
		//6æœˆï½8æœˆï¼š20â„ƒï½35â„ƒã®ç¯„å›²ã§æ°—æ¸©ã‚’å¤‰å‹•
		if 6 <= time_Month and 8 >= time_Month {
			temperature= rnd(15) + 20
		}
	
		//9æœˆï½11æœˆï¼š10â„ƒï½25â„ƒã®ç¯„å›²ã§æ°—æ¸©ã‚’å¤‰å‹•
		if 9 <= time_Month and 11 >= time_Month {
			temperature = rnd(15) + 10
		}
	
	from_new_map = 1
	goto *new_map_setting
	
*load_map
	if from_new_map = 0 {
		dialog "cbx;*.cbd", 16, "Cities Box ç°¡æ˜“æš—å·åŒ–ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ï¼ˆVer.0.4.4ä»¥é™ï¼‰, Cities Box éæš—å·åŒ–ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ï¼ˆVer.0.4.3.1ä»¥å‰ï¼‰"
	}
	
	if stat = 1 or from_new_map = 1 {
		if from_new_map = 0 {
			load_mapdata_name = refstr
		}
		if from_new_map = 1 {
			load_mapdata_name = save_mapdata_name
		}
		
		chdir directory
	
		if from_new_map = 0 {
			map_mode = "load_map"
		}
		goto *map_preparating
		
	} else {
		goto *menu
	}
	
*map_preparating
	clrobj
	
	title "ãƒãƒƒãƒ—èª­ã¿è¾¼ã¿ä¸­..."
	
	//å¤‰æ•°ã‚’åˆæœŸåŒ–
		camx=-300:camy=-150		//ã‚«ãƒ¡ãƒ©ã®ä½åœ°
		mapx=100:mapy=100
		
		menu_line_y = 400		//ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¨ã®å¢ƒç•Œç·š
		cursor_mode = "normal"	//ã‚«ãƒ¼ã‚½ãƒ«ã®ãƒ¢ãƒ¼ãƒ‰
		
		pointer_icon = -1		//ãƒã‚¤ãƒ³ã‚¿ã®ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆ-1ã§å››è§’å½¢ï¼‰
		
		before_mousex = 0
		before_mousey = 0
		
		before_camx = 0
		before_camy = 0
		
		put_addon_name = "tile_greenfield"
	
		stat_mode = ""
	
	if from_new_map = 0 {
		dim buffer_number, mapx, mapy
		dim atlx, mapx, mapy
		dim atly, mapx, mapy
		dim abrx, mapx, mapy
		dim abry, mapx, mapy
		dim sizex, mapx, mapy
		dim sizey, mapx, mapy
	
		dim map, mapx, mapy					//å„åº§æ¨™ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·
		sdim name, mapx, mapy				//å„åº§æ¨™ã®ã‚¢ãƒ‰ã‚ªãƒ³å
		sdim category, mapx, mapy			//å„ãƒã‚¹ã«ç½®ã‹ã‚Œã¦ã„ã‚‹ã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼ˆroad, residentialãªã©ï¼‰
		dim obj_type, mapx, mapy			//åº§æ¨™ä¸Šã«ã‚ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¿ã‚¤ãƒ—
		dim obj_dire, mapx, mapy			//åº§æ¨™ä¸Šã«ã‚ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å‘ã
		dim obj_serial_num, mapx, mapy		//ã²ã¨ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¤‡æ•°ã®ã‚¿ã‚¤ãƒ«ã‚’è¦ã™ã‚‹ã¨ãã®ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é€šã—ç•ªå·ï¼ˆ1ãƒã‚¹ã®å ´åˆã¯0ï¼‰
		dim obj_use_tiles_x, mapx, mapy		//ã²ã¨ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¤‡æ•°ã®ã‚¿ã‚¤ãƒ«ã‚’è¦ã™ã‚‹ã¨ãã®ã€å¿…è¦ãªxæ–¹å‘ã®ã‚¿ã‚¤ãƒ«æ•°
		dim obj_use_tiles_y, mapx, mapy		//ã²ã¨ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¤‡æ•°ã®ã‚¿ã‚¤ãƒ«ã‚’è¦ã™ã‚‹ã¨ãã®ã€å¿…è¦ãªyæ–¹å‘ã®ã‚¿ã‚¤ãƒ«æ•°
		dim obj_tiles_x, mapx, mapy			//ã²ã¨ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¤‡æ•°ã®ã‚¿ã‚¤ãƒ«ã‚’è¦ã™ã‚‹ã¨ãã®ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¨­ç½®ã—ãŸå ´æ‰€ã‹ã‚‰ã®xæ–¹å‘ã®ã‚¿ã‚¤ãƒ«ã®æ•°
		dim obj_tiles_y, mapx, mapy			//ã²ã¨ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¤‡æ•°ã®ã‚¿ã‚¤ãƒ«ã‚’è¦ã™ã‚‹ã¨ãã®ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¨­ç½®ã—ãŸå ´æ‰€ã‹ã‚‰ã®yæ–¹å‘ã®ã‚¿ã‚¤ãƒ«ã®æ•°
		
		dim residents, mapx, mapy			//å„å»ºç¯‰ç‰©ã®ä½æ°‘ã®æ•°ï¼ˆä½å®…åœ°ã®ã¿ï¼‰
		dim workers_Commercial, mapx, mapy	//å•†æ¥­åœ°åŒºã®å¾“æ¥­å“¡æ•°ï¼ˆå•†æ¥­åœ°åŒºã®ã¿ï¼‰
		dim workers_Office, mapx, mapy		//ã‚ªãƒ•ã‚£ã‚¹åœ°åŒºã®å¾“æ¥­å“¡æ•°ï¼ˆã‚ªãƒ•ã‚£ã‚¹åœ°åŒºã®ã¿ï¼‰
		dim workers_Industrial, mapx, mapy	//å·¥æ¥­åœ°åŒºã®å¾“æ¥­å“¡æ•°ï¼ˆå·¥æ¥­åœ°åŒºã®ã¿ï¼‰
		dim workers_Public, mapx, mapy		//å…¬å…±æ–½è¨­ã®å¾“æ¥­å“¡æ•°ï¼ˆå…¬å…±æ–½è¨­ã®ã¿ï¼‰
	
		dim land_price, mapx, mapy			//åœ°ä¾¡ï¼ˆä¸‡å††/ãƒã‚¹ï¼‰
		dim crime_rate, mapx, mapy			//çŠ¯ç½ªç‡
		dim education_rate, mapx, mapy		//æ•™è‚²ç‡
		
		sdim reservation, 100, 100			//åœ°åŒºã®äºˆç´„ï¼ˆåœ°åŸŸè¨­å®šã•ã‚ŒãŸãŒã¾ã å»ºç‰©ãŒç«‹ã£ã¦ã„ãªã„åŒºåŸŸï¼‰
	}
	if from_new_map = 1 {
		from_new_map = 0
	}
	
	ix = 0 : iy = 0
	
	addon_num_buf = addon_num("tile_greenfield")
	
	//ãƒãƒƒãƒ—èª­ã¿è¾¼ã¿
		;if map_mode = "load_map" {
	
			//æš—å·åŒ–æ¸ˆã¿ã®ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã®å ´åˆ
			if instr(load_mapdata_name, 0, "cbx") != -1 {
				
				notesel load_mapdata_Cipher
				noteload load_mapdata_name
		
				l = notemax
				
				//å¾©å·
					repeat l
						notesel load_mapdata_Cipher
						noteget load_mapdata_Cipher_buf, cnt
		
						load_mapdata_Cipher_buf_strlen = strlen(load_mapdata_Cipher_buf)
						dec load_mapdata_Cipher_buf, (strlen(getpath(load_mapdata_name,8+1))/2), load_mapdata_Cipher_buf_strlen
		
						notesel load_mapdata
						noteadd load_mapdata_Cipher_buf, cnt
					loop
	
			} else {
	
				notesel load_mapdata
				noteload load_mapdata_name
	
			}
	
			//éƒ½å¸‚å(City_Name)ã‚’èª­ã¿è¾¼ã¿
				City_Name = get_chapter(load_mapdata, "City_Name", " = \"", "\"")
	
			//å¸‚é•·å(Mayor_Name)ã‚’èª­ã¿è¾¼ã¿
				Mayor_Name = get_chapter(load_mapdata, "Mayor_Name", " = \"", "\"")
	
			//æ—¥æ™‚
				time_Year = int(get_chapter(load_mapdata, "time_Year", " = ", ";"))			; ã‚²ãƒ¼ãƒ å†…ã®æ™‚é–“ã®å¹´
				time_Month = int(get_chapter(load_mapdata, "time_Month", " = ", ";"))		; ã‚²ãƒ¼ãƒ å†…ã®æ™‚é–“ã®æœˆ
				time_Date = int(get_chapter(load_mapdata, "time_Date", " = ", ";"))			; ã‚²ãƒ¼ãƒ å†…ã®æ™‚é–“ã®æ—¥
				time_Hour = int(get_chapter(load_mapdata, "time_Hour", " = ", ";"))			; ã‚²ãƒ¼ãƒ å†…ã®æ™‚é–“ã®æ™‚
				time_Minutes = int(get_chapter(load_mapdata, "time_Minutes", " = ", ";"))	; ã‚²ãƒ¼ãƒ å†…ã®æ™‚é–“ã®åˆ†
	
				if time_Year = 0 {
					time_Year = gettime(0)
				}
				if time_Month = 0 {
					time_Month = gettime(1)
				}
				if time_Date = 0 {
					time_Date = gettime(3)
				}
	
			//éœ€è¦åº¦(demand_â—‹â—‹)ã‚’èª­ã¿è¾¼ã¿
				demand_Residential = int( get_chapter(load_mapdata, "demand_Residential", " = ", ";") )
				demand_Commercial = int( get_chapter(load_mapdata, "demand_Commercial", " = ", ";") )
				demand_Office = int( get_chapter(load_mapdata, "demand_Office", " = \"", ";") )
				demand_Industrial = int( get_chapter(load_mapdata, "demand_Industrial", " = ", ";") )
	
				if instr(load_mapdata, 0, "demand_Residential") = -1 {
					demand_Residential = 0
				}
				if instr(load_mapdata, 0, "demand_Commercial") = -1 {
					demand_Commercial = 0
				}
				if instr(load_mapdata, 0, "demand_Office") = -1 {
					demand_Office = 0
				}
				if instr(load_mapdata, 0, "demand_Industrial") = -1 {
					demand_Industrial = 0
				}
	
			//è¨­å®šèª­ã¿è¾¼ã¿
				//å¤©å€™ã®å¤‰åŒ–(Set_Change_Weather)
					Set_Change_Weather = int( get_chapter(load_mapdata, "Set_Change_Weather", " = ", ";") )
					
				//æ°—æ¸©(temperature)
					temperature = int( get_chapter(load_mapdata, "Temperature", " = ", ";") )
		
			//name(x,y)ã®èª­ã¿è¾¼ã¿ï¼†name(x,y)ã‚’ã‚‚ã¨ã«map(x,y)ã¨éƒ½å¸‚ã®åå®¹å¯èƒ½äººæ•°ã‚‚å–å¾—
				name_buf = get_chapter(load_mapdata, "name(x,y)", " {", "}")
			
				repeat mapy
					y = cnt
		
					notesel name_buf
					noteget name_buf_a_line, (y+1)
		
					sdim name_buf_a_tile, mapx
					split name_buf_a_line, ", ", name_buf_a_tile
			
					repeat mapx
						x = cnt
						name(x,y) = name_buf_a_tile(x)
						map(x,y) = addon_num(name_buf_a_tile(x))
	
						//å„ç¨®ã®åœ°åŒºã®åå®¹å¯èƒ½äººæ•°ã«åŠ ç®—
							if addon_type(map(x,y)) = "low_density_residential" or addon_type(map(x,y)) = "high_density_residential" {
								total_Residential_maximum_capacity += addon_maximum_capacity(map(x,y))
							}
							if addon_type(map(x,y)) = "low_density_commercial" or addon_type(map(x,y)) = "high_density_commercial" {
								total_Commercial_maximum_capacity += addon_maximum_capacity(map(x,y))
							}
							if addon_type(map(x,y)) = "office" {
								total_Office_maximum_capacity += addon_maximum_capacity(map(x,y))
							}
							if addon_type(map(x,y)) = "industrial" {
								total_Industrial_maximum_capacity += addon_maximum_capacity(map(x,y))
							}
							if addon_type(map(x,y)) = "public" {
								total_Public_maximum_capacity += addon_maximum_capacity(map(x,y))
							}
					loop
			
				loop
			
			//category(x,y)ã®èª­ã¿è¾¼ã¿
				category_buf = get_chapter(load_mapdata, "category(x,y)", " {", "}")
			
				repeat mapy
					y = cnt
		
					notesel category_buf
					noteget category_buf_a_line, (y+1)
		
					sdim category_buf_a_tile, mapx
					split category_buf_a_line, ", ", category_buf_a_tile
			
					repeat mapx
						x = cnt
						category(x,y) = category_buf_a_tile(x)
					loop
			
				loop
		
			//obj_type(x,y)ã®èª­ã¿è¾¼ã¿
				obj_type_buf = get_chapter(load_mapdata, "obj_type(x,y)", " {", "}")
			
				repeat mapy
					y = cnt
		
					notesel obj_type_buf
					noteget obj_type_buf_a_line, (y+1)
		
					sdim obj_type_buf_a_tile, mapx
					split obj_type_buf_a_line, ", ", obj_type_buf_a_tile
			
					repeat mapx
						x = cnt
						obj_type(x,y) = int(obj_type_buf_a_tile(x))
					loop
			
				loop
		
			//obj_dire(x,y)ã®èª­ã¿è¾¼ã¿
				obj_dire_buf = get_chapter(load_mapdata, "obj_dire(x,y)", " {", "}")
			
				repeat mapy
					y = cnt
		
					notesel obj_dire_buf
					noteget obj_dire_buf_a_line, (y+1)
		
					sdim obj_dire_buf_a_tile, mapx
					split obj_dire_buf_a_line, ", ", obj_dire_buf_a_tile
			
					repeat mapx
						x = cnt
						obj_dire(x,y) = int(obj_dire_buf_a_tile(x))
					loop
			
				loop
	
			//obj_serial_num(x,y)ã®èª­ã¿è¾¼ã¿
				if instr(load_mapdata, 0, "obj_serial_num(x,y)") != -1 {
					obj_serial_num_buf = get_chapter(load_mapdata, "obj_serial_num(x,y)", " {", "}")
					
					repeat mapy
						y = cnt
			
						notesel obj_serial_num_buf
						noteget obj_serial_num_buf_a_line, (y+1)
			
						sdim obj_serial_num_buf_a_tile, mapx
						split obj_serial_num_buf_a_line, ", ", obj_serial_num_buf_a_tile
				
						repeat mapx
							x = cnt
							obj_serial_num(x,y) = int(obj_serial_num_buf_a_tile(x))
	
							if obj_serial_num(x,y) > next_obj_serial_num {
								next_obj_serial_num = obj_serial_num(x,y)
							}
						loop
					loop
				}
	
			//obj_use_tiles_x(x,y)ã®èª­ã¿è¾¼ã¿
				if instr(load_mapdata, 0, "obj_use_tiles_x(x,y)") != -1 {
					obj_use_tiles_x_buf = get_chapter(load_mapdata, "obj_use_tiles_x(x,y)", " {", "}")
					
					repeat mapy
						y = cnt
			
						notesel obj_use_tiles_x_buf
						noteget obj_use_tiles_x_buf_a_line, (y+1)
			
						sdim obj_use_tiles_x_buf_a_tile, mapx
						split obj_use_tiles_x_buf_a_line, ", ", obj_use_tiles_x_buf_a_tile
				
						repeat mapx
							x = cnt
							obj_use_tiles_x(x,y) = int(obj_use_tiles_x_buf_a_tile(x))
						loop
				
					loop
				}
	
			//obj_use_tiles_y(x,y)ã®èª­ã¿è¾¼ã¿
				if instr(load_mapdata, 0, "obj_use_tiles_y(x,y)") != -1 {
					obj_use_tiles_y_buf = get_chapter(load_mapdata, "obj_use_tiles_y(x,y)", " {", "}")
				
					repeat mapy
						y = cnt
			
						notesel obj_use_tiles_y_buf
						noteget obj_use_tiles_y_buf_a_line, (y+1)
			
						sdim obj_use_tiles_y_buf_a_tile, mapx
						split obj_use_tiles_y_buf_a_line, ", ", obj_use_tiles_y_buf_a_tile
				
						repeat mapx
							x = cnt
							obj_use_tiles_y(x,y) = int(obj_use_tiles_y_buf_a_tile(x))
						loop
				
					loop
				}
	
			//obj_tiles_x(x,y)ã®èª­ã¿è¾¼ã¿
				if instr(load_mapdata, 0, "obj_tiles_x(x,y)") != -1 {
					obj_tiles_x_buf = get_chapter(load_mapdata, "obj_tiles_x(x,y)", " {", "}")
					
					repeat mapy
						y = cnt
			
						notesel obj_tiles_x_buf
						noteget obj_tiles_x_buf_a_line, (y+1)
			
						sdim obj_tiles_x_buf_a_tile, mapx
						split obj_tiles_x_buf_a_line, ", ", obj_tiles_x_buf_a_tile
				
						repeat mapx
							x = cnt
							obj_tiles_x(x,y) = int(obj_tiles_x_buf_a_tile(x))
						loop
				
					loop
				}
	
			//obj_tiles_y(x,y)ã®èª­ã¿è¾¼ã¿
				if instr(load_mapdata, 0, "obj_tiles_y(x,y)") != -1 {
					obj_tiles_y_buf = get_chapter(load_mapdata, "obj_tiles_y(x,y)", " {", "}")
	
					repeat mapy
						y = cnt
			
						notesel obj_tiles_y_buf
						noteget obj_tiles_y_buf_a_line, (y+1)
			
						sdim obj_tiles_y_buf_a_tile, mapx
						split obj_tiles_y_buf_a_line, ", ", obj_tiles_y_buf_a_tile
				
						repeat mapx
							x = cnt
							obj_tiles_y(x,y) = int(obj_tiles_y_buf_a_tile(x))
						loop
				
					loop
				}
	
			//residents(x,y)ã®èª­ã¿è¾¼ã¿
				residents_buf = get_chapter(load_mapdata, "residents(x,y)", " {", "}")
			
				repeat mapy
					y = cnt
		
					notesel residents_buf
					noteget residents_buf_a_line, (y+1)
		
					sdim residents_buf_a_tile, mapx
					split residents_buf_a_line, ", ", residents_buf_a_tile
			
					repeat mapx
						x = cnt
						residents(x,y) = int(residents_buf_a_tile(x))
						Total_Population += residents(x,y)
					loop
			
				loop
	
			//workers_Commercial(x,y)ã®èª­ã¿è¾¼ã¿
				if instr(load_mapdata, 0, "workers_Commercial(x,y)") != -1 {
					workers_Commercial_buf = get_chapter(load_mapdata, "workers_Commercial(x,y)", " {", "}")
				
					repeat mapy
						y = cnt
			
						notesel workers_Commercial_buf
						noteget workers_Commercial_buf_a_line, (y+1)
			
						sdim workers_Commercial_buf_a_tile, mapx
						split workers_Commercial_buf_a_line, ", ", workers_Commercial_buf_a_tile
				
						repeat mapx
							x = cnt
							workers_Commercial(x,y) = int(workers_Commercial_buf_a_tile(x))
							Total_workers_Commercial += workers_Commercial(x,y)
						loop
				
					loop
				}
	
			//workers_Office(x,y)ã®èª­ã¿è¾¼ã¿
				if instr(load_mapdata, 0, "workers_Office(x,y)") != -1 {
					workers_Office_buf = get_chapter(load_mapdata, "workers_Office(x,y)", " {", "}")
				
					repeat mapy
						y = cnt
			
						notesel workers_Office_buf
						noteget workers_Office_buf_a_line, (y+1)
			
						sdim workers_Office_buf_a_tile, mapx
						split workers_Office_buf_a_line, ", ", workers_Office_buf_a_tile
				
						repeat mapx
							x = cnt
							workers_Office(x,y) = int(workers_Office_buf_a_tile(x))
							Total_workers_Office += workers_Office(x,y)
						loop
				
					loop
				}
	
			//workers_Industrial(x,y)ã®èª­ã¿è¾¼ã¿
				if instr(load_mapdata, 0, "workers_Industrial(x,y)") != -1 {
					workers_Industrial_buf = get_chapter(load_mapdata, "workers_Industrial(x,y)", " {", "}")
				
					repeat mapy
						y = cnt
			
						notesel workers_Industrial_buf
						noteget workers_Industrial_buf_a_line, (y+1)
			
						sdim workers_Industrial_buf_a_tile, mapx
						split workers_Industrial_buf_a_line, ", ", workers_Industrial_buf_a_tile
				
						repeat mapx
							x = cnt
							workers_Industrial(x,y) = int(workers_Industrial_buf_a_tile(x))
							Total_workers_Industrial += workers_Industrial(x,y)
						loop
				
					loop
				}
	
			//workers_Public(x,y)ã®èª­ã¿è¾¼ã¿
				if instr(load_mapdata, 0, "workers_Public(x,y)") != -1 {
					workers_Public_buf = get_chapter(load_mapdata, "workers_Public(x,y)", " {", "}")
				
					repeat mapy
						y = cnt
			
						notesel workers_Public_buf
						noteget workers_Public_buf_a_line, (y+1)
			
						sdim workers_Public_buf_a_tile, mapx
						split workers_Public_buf_a_line, ", ", workers_Public_buf_a_tile
				
						repeat mapx
							x = cnt
							workers_Public(x,y) = int(workers_Public_buf_a_tile(x))
							Total_workers_Public += workers_Public(x,y)
						loop
				
					loop
				}
	
			//land_price(x,y)ã®èª­ã¿è¾¼ã¿
				if instr(load_mapdata, 0, "land_price(x,y)") != -1 {
					land_price_buf = get_chapter(load_mapdata, "land_price(x,y)", " {", "}")
				
					repeat mapy
						y = cnt
			
						notesel land_price_buf
						noteget land_price_buf_a_line, (y+1)
			
						sdim land_price_buf_a_tile, mapx
						split land_price_buf_a_line, ", ", land_price_buf_a_tile
				
						repeat mapx
							x = cnt
							land_price(x,y) = int(land_price_buf_a_tile(x))
						loop
				
					loop
	
				} else {
					//ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã«land_priceã®æƒ…å ±ãŒãªã„å ´åˆã¯å…¨ã¦50ä¸‡å††/ãƒã‚¹ã«è¨­å®š
						repeat mapx
							x = cnt
							repeat mapy
								y = cnt
	
								land_price(x,y) = 50
							loop
						loop
				}
	
			//crime_rate(x,y)ã®èª­ã¿è¾¼ã¿
				if instr(load_mapdata, 0, "crime_rate(x,y)") != -1 {
					crime_rate_buf = get_chapter(load_mapdata, "crime_rate(x,y)", " {", "}")
				
					repeat mapy
						y = cnt
			
						notesel crime_rate_buf
						noteget crime_rate_buf_a_line, (y+1)
			
						sdim crime_rate_buf_a_tile, mapx
						split crime_rate_buf_a_line, ", ", crime_rate_buf_a_tile
				
						repeat mapx
							x = cnt
							crime_rate(x,y) = int(crime_rate_buf_a_tile(x))
						loop
				
					loop
	
				} else {
					//ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã«crime_rateã®æƒ…å ±ãŒãªã„å ´åˆã¯å…¨ã¦0ã«è¨­å®š
						repeat mapx
							x = cnt
							repeat mapy
								y = cnt
	
								crime_rate(x,y) = 0
							loop
						loop
				}
	
			//education_rate(x,y)ã®èª­ã¿è¾¼ã¿
				if instr(load_mapdata, 0, "education_rate(x,y)") != -1 {
					education_rate_buf = get_chapter(load_mapdata, "education_rate(x,y)", " {", "}")
				
					repeat mapy
						y = cnt
			
						notesel education_rate_buf
						noteget education_rate_buf_a_line, (y+1)
			
						sdim education_rate_buf_a_tile, mapx
						split education_rate_buf_a_line, ", ", education_rate_buf_a_tile
				
						repeat mapx
							x = cnt
							education_rate(x,y) = int(education_rate_buf_a_tile(x))
						loop
				
					loop
	
				} else {
					//ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã«education_rateã®æƒ…å ±ãŒãªã„å ´åˆã¯å…¨ã¦0ã«è¨­å®š
						repeat mapx
							x = cnt
							repeat mapy
								y = cnt
	
								education_rate(x,y) = 0
							loop
						loop
				}
	
			//reservation(x,y)ã®èª­ã¿è¾¼ã¿
				if instr(load_mapdata, 0, "reservation(x,y)") != -1 {
					reservation_buf = get_chapter(load_mapdata, "reservation(x,y)", " {", "}")
				
					repeat mapy
						y = cnt
			
						notesel reservation_buf
						noteget reservation_buf_a_line, (y+1)
			
						sdim reservation_buf_a_tile, mapx
						split reservation_buf_a_line, ", ", reservation_buf_a_tile
				
						repeat mapx
							x = cnt
							reservation(x,y) = reservation_buf_a_tile(x)
						loop
				
					loop
	
				} else {
					//ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã«reservationã®æƒ…å ±ãŒãªã„å ´åˆã¯å…¨ã¦0ã«è¨­å®š
						repeat mapx
							x = cnt
							repeat mapy
								y = cnt
	
								reservation(x,y) = "none"
							loop
						loop
				}
		;}
	
	//é›¨ç²’ã®åˆæœŸä½ç½®
		randomize
	
		repeat 1000
			rain(cnt) = 0
			rain_x(cnt) = rnd(windowx)
			rain_y(cnt) = -rnd(windowy)
		loop
	
	//element2ã€element3é–¢æ•°ã¯ä½•åº¦ã‚‚ä½¿ã†ã¨å‹•ä½œãŒé‡ããªã‚‹ãŸã‚ã€ã‚ˆãä½¿ã†tile_greenfieldã®"null"ã®element2ãŠã‚ˆã³element3é–¢æ•°ã®å†…å®¹ã‚’åˆ¥ã®å¤‰æ•°ã«ä¿å­˜
		//æ›´åœ°ï¼ˆtile_greenfieldï¼‰ã®"null"ã®obj_typeç•ªå·
			tile_greenfield_null_type_buf = element2( "tile_greenfield", use_type, addon_total_use_types, "null")
		
		//æ›´åœ°ï¼ˆtile_greenfieldï¼‰ã®"null"ã®obj_direç•ªå·
			tile_greenfield_null_dire_buf = element3( "tile_greenfield", use_type, addon_total_use_types, "null", addon_direction, addon_total_addon_direction, "null")
	
	//éœ€è¦åº¦ã‚’å¢—æ¸›
		//ç·æ±‚äººæ•°ã‚’å–å¾—
			Vacancies = (total_Commercial_maximum_capacity-Total_workers_Commercial) + (total_Office_maximum_capacity-Total_workers_Office) + (total_Industrial_maximum_capacity-Total_workers_Industrial) + (total_Public_maximum_capacity-Total_workers_Public)
		
		//ç·æµ®æµªè€…æ•°ã‚’å–å¾—
			Total_Vagrants = Total_Population - Total_workers_Commercial - Total_workers_Office - Total_workers_Industrial - Total_workers_Public
	
	//èª­ã¿è¾¼ã¿å¾Œæœ€åˆã®ãƒ«ãƒ¼ãƒ—ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™
		first_loop = 1
		
*main
	randomize
	
	repeat
	
		dim done_build, 6, mapx, mapy
	
		main_cnt ++
	
		//1å›ã®ãƒ«ãƒ¼ãƒ—ã§1åˆ†ã¨ã™ã‚‹
			time_Minutes ++
		
		//time_Minutes=60ã§1æ™‚é–“ã¨ã™ã‚‹
			if time_Minutes = 60 {
				time_Minutes = 0
				time_Hour ++
			}
	
		//time_Hour=24ã§1æ—¥ã¨ã™ã‚‹
			if time_Hour= 24 {
				time_Date ++
				time_Hour = 0
				time_Minutes = 0
	
				if time_Date > 28 and time_Month = 2 and time_Year\4 != 0 {
					time_Date = 1
					time_Month ++
				}
				if time_Date > 29 and time_Month = 2 and time_Year\4 = 0 {
					time_Date = 1
					time_Month ++
				}
				if time_Date > 30 and (time_Month = 4 or time_Month = 6 or time_Month = 9 or time_Month = 11) {
					time_Date = 1
					time_Month ++
				}
				if time_Date > 31 and (time_Month = 1 or time_Month = 3 or time_Month = 5 or time_Month = 7 or time_Month = 8 or time_Month = 10 or time_Month = 12) {
					time_Date = 1
					time_Month ++
				}
	
				if time_Month > 12 {
					time_Year ++
					time_Month = 1
					time_Date = 1
				}
			}
	
		/*ã‚«ãƒ¡ãƒ©æ“ä½œ*/
			getkey key_left, 37
			if key_left = 1 {
				camx -= 10
			}
			
			getkey key_up, 38
			if key_up = 1 {
				camy -= 5
			}
			
			getkey key_right, 39
			if key_right = 1 {
				camx += 10
			}
			
			getkey key_down, 40
			if key_down = 1 {
				camy += 5
			}
	
		/*ãƒãƒƒãƒ—æå†™*/
			redraw 0
			color 0, 0, 0 : boxf
	
			if mousex != before_mousex or mousey != before_mousey or camx != before_camx or camy != before_camy {
				mousex_=mousex+camx-(chip_size/2)	//mx,myã«ãƒã‚¦ã‚¹åº§æ¨™å–å¾—
				mousey_=mousey+camy+16
				mx=(mousey_+mousex_/2)/(chip_size/2)
				my=(-mousex_+mousey_*2)/chip_size
	
				before_mousex = mousex
				before_mousey = mousey
			}
	
		; ------ FPSå–å¾—å‡¦ç† ------
			  if gettime(7) < msecond { ; ãƒŸãƒªç§’ã®æ¡ä¸ŠãŒã‚Šã‚’ç¢ºèªã™ã‚‹
			    ; fpsã«ã‚«ã‚¦ãƒ³ãƒˆã—ãŸãƒ•ãƒ¬ãƒ¼ãƒ æ•°ã‚’ä»£å…¥ã—ã€ã‚«ã‚¦ãƒ³ãƒˆã‚’1ãƒ•ãƒ¬ãƒ¼ãƒ ç›®ã«æˆ»ã™
			    fps = frame_count
			    frame_count = 1
			
			  } else {
			    ; ä¸Šè¨˜ä»¥å¤–ã®å ´åˆãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
			    frame_count = frame_count + 1
			
			  }
			  ; msecondã¸ç¾åœ¨ã®ãƒŸãƒªç§’å€¤ã‚’ä»£å…¥
			  msecond = gettime(7)
	
		/*BGMå†ç”Ÿ*/
			gosub *play_BGM
	
		stick key,0 ; ã‚­ãƒ¼å–å¾—
	
*main_2
		onclick 0
		
		repeat mapx
			x = cnt
				
			repeat mapy
				y = cnt
	
				//äºˆç´„åœ°åŒºã«å»ºç‰©ã‚’å»ºè¨­
					if reservation(x,y) != "none" and rnd(500) = 0 {
						gosub *Build_on_Reservation_area
					}
	
				//ãƒã‚¦ã‚¹ã®ã©ã®ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¦ã„ã‚‹ã‹å–å¾—
					mouse_left = 0
					mouse_right = 0
					
					getkey mouse_left, 1
					getkey mouse_right, 2
	
					if mouse_left = 1 or mouse_right = 1 {
						gosub *main_onclick
					}
	
				if camx != before_camx or camy != before_camy or windowx != before_windowx or windowy != before_windowy {
	
					//ç”»é¢ä¸­å¤®ã®åº§æ¨™
						x_=(windowx/2)+camx-chip_size/2	//mx,myã«ãƒã‚¦ã‚¹åº§æ¨™å–å¾—
						y_=(windowy/2)+camy
						middle_x=(y_+x_/2)/(chip_size/2)
						middle_y=(-x_+y_*2)/chip_size
	
					//å·¦ä¸Šã®xåº§æ¨™
						left_top_x_ = 0+camx-chip_size/2
						left_top_y_ = 0+camy
						left_top_x = (left_top_y_+left_top_x_/2)/(chip_size/2)
		
					//å·¦ä¸‹ã®yåº§æ¨™
						left_bottom_x_ = 0+camx-chip_size/2
						left_bottom_y_ = windowy+camy
						left_bottom_y = (-left_bottom_x_+left_bottom_y_*2)/chip_size
		
					//å³ä¸Šã®yåº§æ¨™
						right_top_x_ = windowx+camx-chip_size/2
						right_top_y_ = 0+camy
						right_top_y = (-right_top_x_+right_top_y_*2)/chip_size
		
					//å³ä¸‹ã®xåº§æ¨™
						right_bottom_x_ = windowx+camx-chip_size/2
						right_bottom_y_ = windowy+camy
						right_bottom_x = (right_bottom_y_+right_bottom_x_/2)/(chip_size/2)
	
						before_camx = camx
						before_camy = camy

						before_windowx = windowx
						before_windowy = windowy
	
				}
	
				if x>(left_top_x-1) and x<(right_bottom_x+1) and y>(right_top_y-1) and y<(left_bottom_y+1) {
		
					//å‘¨å›²ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç•ªå·ã‚’å–å¾—
						left_chip = ""
						top_chip = ""
						bottom_chip = ""
						right_chip = ""
		
						if x > 0 {
							left_chip = category(x-1, y)
						}
						if y > 0 {
							top_chip = category(x, y-1)
						}
						if mapy-1 > y {
							bottom_chip = category(x, y+1)
						}
						if mapx-1 > x {
							right_chip = category(x+1, y)
						}
		
					//é“è·¯ã®å‘ãã‚’èª¿ç¯€
						category_buf = category(x,y)
						
						if category_buf = "road" {
							gosub *adjustment_road
						}
						
					//ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆé“è·¯ã‚„å»ºç‰©ãªã©ï¼‰ã®è¡¨ç¤ºã‚’ã™ã‚‹ãŸã‚ã®æº–å‚™
						x_buf = x
						y_buf = y
	
						if x > 0 and x < mapx {
							if obj_use_tiles_x(x,y) > 0 {
								if obj_tiles_x(x,y) > 0 {
									x -= obj_tiles_x(x,y)
								} else {
									x -= (obj_use_tiles_x(x,y)-1) + obj_tiles_x(x,y)
								}
							}
						}
	
						if y > 0 and y < mapy {
							if obj_use_tiles_y(x,y) > 0 {
								if obj_tiles_y(x,y) < 0 {
									y -= obj_tiles_y(x,y)
								} else {
									y += (obj_use_tiles_y(x,y)-1) + obj_tiles_y(x,y)
								}
							}
						}
	
					//name(x,y)ãŒ"tile_greenfield"ã«ã‚‚é–¢ã‚ã‚‰ãšobj_type(x,y)ãŒ0ä»¥å¤–ã®å ´åˆï¼ˆé»’ã„ãƒã‚¹é˜²æ­¢ï¼‰
						if name(x,y) = "tile_greenfield" and obj_type(x,y) != tile_greenfield_null_type_buf {
							obj_type(x,y) = tile_greenfield_null_type_buf
						}
	
					//ã‚¯ã‚©ãƒ¼ã‚¿ãƒ¼ãƒ“ãƒ¥ãƒ¼ã®åº§æ¨™ã‚’ç”»é¢ä¸Šã®åº§æ¨™ã«å¤‰æ›
						qv2 x, y
	
					//ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒãƒƒãƒ•ã‚¡ç•ªå·ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å·¦ä¸Šã®åº§æ¨™ï¼ˆatlxï¼‰ã€å·¦ä¸‹ã®åº§æ¨™ï¼ˆatlyï¼‰ã€å³ä¸Šã®åº§æ¨™ï¼ˆabrxï¼‰ã€å³ä¸‹ã®åº§æ¨™ï¼ˆabryï¼‰ã€ã‚µã‚¤ã‚ºï¼ˆsizex, sizeyï¼‰ã‚’å–å¾—
						if addon_total_use_types( map(x,y) ) > 1 {		; ã²ã¨ã¤ã®ã‚¢ãƒ‰ã‚ªãƒ³ã§è¤‡æ•°ã®ç”»åƒã‚’é ˜ã™ã‚‹å ´åˆ
							buffer_number(x,y) = (map(x,y) + 1000) * 1001 + obj_type(x,y)
							get_about_addon map(x,y), obj_type(x,y), obj_dire(x,y), atlx, atly, abrx, abry, sizex, sizey
							
						} else {										; ã²ã¨ã¤ã®ã‚¢ãƒ‰ã‚ªãƒ³ã§ã²ã¨ã¤ã®ç”»åƒã‚’é ˜ã™ã‚‹å ´åˆ
							buffer_number(x,y) = map(x,y) + 1000
							get_about_addon map(x,y), obj_type(x,y), obj_dire(x,y), atlx, atly, abrx, abry, sizex, sizey
								
						}
							
					//ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¡¨ç¤º
						pos macro1, macro2 - sizey + 1 + (8*(obj_use_tiles_x(x,y)))
						gmode 2 : gcopy buffer_number(x,y), atlx, atly, sizex, sizey
	
						x = x_buf
						y = y_buf
	
				}
	
				//äººå£ãƒ»éœ€è¦åº¦å¤‰å‹•
					gosub *fluctuation
					
			loop
					
		loop
	
		//æ™‚é–“å¸¯ã«å¿œã˜ã¦æ˜ã‚‹ã•ã‚’èª¿ç¯€
		/*
			//æš—ãã™ã‚‹å‰ã«è‰²ã‚’å–å¾—
			repeat windowx
				wx = cnt
				repeat windowy
					wy = cnt
					pget wx, wy
	
					ginfo_tmp(wx,wy,0) = ginfo_r
					ginfo_tmp(wx,wy,1) = ginfo_g
					ginfo_tmp(wx,wy,2) = ginfo_b
				loop
			loop
		*/
			//å¤œé–“
			if (time_Hour >= 18 and time_Hour <= 23) or (time_Hour >= 0 and time_Hour <= 5) {
				color 0, 0, 0 : sboxf 200, 0, 0, windowx, windowy
			}
	
			//å¤•æ–¹ï¼ˆã ã‚“ã ã‚“æš—ãï¼‰
			if time_Hour = 17 {
				color 0, 0, 0 : sboxf double(time_Minutes+1.0)/60*200, 0, 0, windowx, windowy
			}
	
			//æ˜ã‘æ–¹ï¼ˆã ã‚“ã ã‚“æ˜ã‚‹ãï¼‰
			if time_Hour = 6 {
				color 0, 0, 0 : sboxf 200-double(time_Minutes+1.0)/60*200, 0, 0, windowx, windowy
			}
	
		//å¤œé–“ã¯çª“ã‚’å…‰ã‚‰ã›ã‚‹
			/*repeat windowx
				wx = cnt
				
				repeat windowy
					wy = cnt
					
					if ginfo_r = 195 and ginfo_g = 195 and ginfo_b = 195 {
						color 255, 242, 0
						pset wx, wy
					}
				loop
			loop
	
					/*
					
					if addon_window_color_R(addon_number) != -1 {
						buffer (1000 + addon_number)
							pos 0, 0 : gcopy (1000 + addon_number), 0, 0, addon_img_size_X(addon_number), addon_img_size_Y(addon_number)
							
							repeat addon_img_size_X(addon_number)
								rx = cnt
								repeat addon_img_size_Y(addon_number)
									ry = cnt
	
									pget rx, ry
									
									if ginfo_r = addon_window_color_R(addon_number) and ginfo_g = addon_window_color_G(addon_number) and ginfo_b = addon_window_color_B(addon_number) {
										color 234, 222, 0
										pset rx, ry
									}
	
								loop
							loop
	
						gsel 0
					}
	
					gsel 0*/
	
		//ãƒã‚¦ã‚¹ãƒã‚¤ãƒ³ã‚¿ã®ä½ç½®ã®ãƒãƒƒãƒ—ã‚’å…‰ã‚‰ã›ã‚‹
			if opening_addon_menu = 1 {
				menu_line_y = windowy-70-titlebar_h-32-20
			} else {
				menu_line_y = windowy-70-titlebar_h
			}
					
			if mousey < menu_line_y {
				if pointer_icon = -1 {
					color 0, 0, 0
					
					qv2 mx,my
					pos macro1, macro2-32
	
					if cursor_mode = "normal" {
						gmode 4,,,128 : gcopy 17, 0, 0, 64, 32
					}
					if cursor_mode = "bulldozer" {
						gmode 4,,,128 : gcopy 18, 0, 0, 64, 32
					}
							
				} else {
					color 0, 0, 0
					
					qv2 mx,my
					pos macro1, macro2-32
					gmode 4,,,128 : gcopy 17, 0, 0, 64, 32
								
					qv2 mx,my
					color : gmode 4,,,200
	
					if instr(put_addon_name, 0, "Area : ") != -1 or (pointer_icon >= 22 and pointer_icon <= 25) {
						pos macro1,macro2-32 : gcopy pointer_icon, 0, 0, 64, 32					; åœ°åŒºè¨­å®šã®å ´åˆ
	
					} else {
						pos macro1+16,macro2-32 : gcopy (10001000+pointer_icon), 0, 0, 32, 32	; å€‹åˆ¥ã®å»ºç‰©ã®å ´åˆ
					}
				}
			}
	
		if cnt \ 10 = 0 and mx >= 0 and mx < 100 and my >= 0 and my < 100 {
			title "stat_mode = \""+stat_mode+"\" land_price = "+land_price(mx,my)+" demand_R "+demand_Residential+" Vacancies "+Vacancies+" Total_Vagrants "+Total_Vagrants+" ãƒã‚¦ã‚¹åº§æ¨™("+mx+","+my+") ã‚«ãƒ¡ãƒ©åº§æ¨™("+camx+","+camy+") add_rain:"+add_rain+" FPS:"+fps+""
		}
	
		//ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã„ã¦ã„ã‚‹ã¨ãã¯stat_mode = "type"ã«ã™ã‚‹
			if cursor_mode != "normal" and cursor_mode != "put_Road" {
				stat_mode = "type"
				stat_mode_changed = 1
			}
	
			if cursor_mode = "normal" and stat_mode_changed = 1 {
				stat_mode = ""
				stat_mode_changed = 0
			}
	
		//stat_mode = "type"ã®å ´åˆã¯åœ°åŒºã‚’ç¤ºã™è‰²ã‚’è¡¨ç¤ºã™ã‚‹
			if stat_mode = "type" {
		
				repeat mapx
					x = cnt
					repeat mapy
						y = cnt
						
						qv2 x,y
						category_buf = category(x,y)
						reservation_buf = reservation(x,y)
						
						if category_buf = "residential" or instr(reservation_buf, 0, "residential") != -1 {
							color : gmode 4,,,128
							pos macro1, macro2-32 : gcopy 22, 0, 0, 64, 32
						}
						if category_buf = "commercial" or instr(reservation_buf, 0, "commercial") != -1 {
							color : gmode 4,,,128
							pos macro1, macro2-32 : gcopy 23, 0, 0, 64, 32
						}
						if category_buf = "office" or instr(reservation_buf, 0, "office") != -1 {
							color : gmode 4,,,128
							pos macro1, macro2-32 : gcopy 24, 0, 0, 64, 32
						}
						if category_buf = "industrial" or instr(reservation_buf, 0, "industrial") != -1 {
							color : gmode 4,,,128
							pos macro1, macro2-32 : gcopy 25, 0, 0, 64, 32
						}
						if category_buf = "public" {
							color : gmode 4,,,128
							pos macro1, macro2-32 : gcopy 26, 0, 0, 64, 32
						}
					loop
				loop
		
			}
	
		//stat_mode = "land_price"ã®å ´åˆã¯åœ°ä¾¡ã‚’ç¤ºã™è‰²ã‚’è¡¨ç¤ºã™ã‚‹
			if stat_mode = "land_price" {
		
				repeat mapx
					x = cnt
					repeat mapy
						y = cnt
	
						category_buf = category(x,y)
	
						if category_buf != "road" and category_buf != "tile" {
						
							qv2 x,y
							land_price_buf = land_price(x,y)
							
							if land_price_buf > 100 {
								color : gmode 4,,,128
								pos macro1, macro2-32 : gcopy 34, 0, 0, 64, 32
								
							} else : if land_price_buf > 50 {
								color : gmode 4,,,128
								pos macro1, macro2-32 : gcopy 35, 0, 0, 64, 32
		
							} else : if land_price_buf > 0 {
								color : gmode 4,,,128
								pos macro1, macro2-32 : gcopy 36, 0, 0, 64, 32
	
							} else : if land_price_buf = 0 {
								color : gmode 4,,,128
								pos macro1, macro2-32 : gcopy 48, 0, 0, 64, 32
		
							} else : if land_price_buf > -50 {
								color : gmode 4,,,128
								pos macro1, macro2-32 : gcopy 37, 0, 0, 64, 32
		
							} else : if land_price_buf > -100 {
								color : gmode 4,,,128
								pos macro1, macro2-32 : gcopy 38, 0, 0, 64, 32
		
							} else {
								color : gmode 4,,,128
								pos macro1, macro2-32 : gcopy 39, 0, 0, 64, 32
							}
	
						}
		
					loop
				loop
		
			}
	
		//stat_mode = "crime_rate"ã®å ´åˆã¯çŠ¯ç½ªç‡ã‚’ç¤ºã™è‰²ã‚’è¡¨ç¤ºã™ã‚‹
			if stat_mode = "crime_rate" {
				repeat mapx
					x = cnt
					repeat mapy
						y = cnt
	
						category_buf = category(x,y)
	
						if category_buf != "road" and category_buf != "tile" {
						
							qv2 x,y
							crime_rate_buf = crime_rate(x,y)
							
							if crime_rate_buf <= -100 {
								color : gmode 4,,,128
								pos macro1, macro2-32 : gcopy 34, 0, 0, 64, 32
								
							} else : if crime_rate_buf <= -30 {
								color : gmode 4,,,128
								pos macro1, macro2-32 : gcopy 35, 0, 0, 64, 32
	
							} else : if crime_rate_buf = 0 {
								color : gmode 4,,,128
								pos macro1, macro2-32 : gcopy 48, 0, 0, 64, 32
		
							} else : if crime_rate_buf < 0 {
								color : gmode 4,,,128
								pos macro1, macro2-32 : gcopy 36, 0, 0, 64, 32
		
							} else : if crime_rate_buf <= 30 {
								color : gmode 4,,,128
								pos macro1, macro2-32 : gcopy 37, 0, 0, 64, 32
		
							} else : if crime_rate_buf <= 100 {
								color : gmode 4,,,128
								pos macro1, macro2-32 : gcopy 38, 0, 0, 64, 32
		
							} else {
								color : gmode 4,,,128
								pos macro1, macro2-32 : gcopy 39, 0, 0, 64, 32
							}
	
						}
		
					loop
				loop
		
			}
	
		//stat_mode = "educaton_rate"ã®å ´åˆã¯çŠ¯ç½ªç‡ã‚’ç¤ºã™è‰²ã‚’è¡¨ç¤ºã™ã‚‹
			if stat_mode = "education_rate" {
		
				repeat mapx
					x = cnt
					repeat mapy
						y = cnt
	
						category_buf = category(x,y)
	
						if category_buf != "road" and category_buf != "tile" {
						
							qv2 x,y
							education_rate_buf = education_rate(x,y)
							
							if education_rate_buf <= -100 {
								color : gmode 4,,,128
								pos macro1, macro2-32 : gcopy 39, 0, 0, 64, 32
								
							} else : if education_rate_buf <= -30 {
								color : gmode 4,,,128
								pos macro1, macro2-32 : gcopy 38, 0, 0, 64, 32
	
							} else : if education_rate_buf = 0 {
								color : gmode 4,,,128
								pos macro1, macro2-32 : gcopy 48, 0, 0, 64, 32
		
							} else : if education_rate_buf < 0 {
								color : gmode 4,,,128
								pos macro1, macro2-32 : gcopy 37, 0, 0, 64, 32
		
							} else : if education_rate_buf <= 30 {
								color : gmode 4,,,128
								pos macro1, macro2-32 : gcopy 36, 0, 0, 64, 32
		
							} else : if education_rate_buf <= 100 {
								color : gmode 4,,,128
								pos macro1, macro2-32 : gcopy 35, 0, 0, 64, 32
		
							} else {
								color : gmode 4,,,128
								pos macro1, macro2-32 : gcopy 34, 0, 0, 64, 32
							}
	
						}
		
					loop
				loop
		
			}
	
		//å¤©å€™ã®å¤‰å‹•
			gosub *climate
	
*menu_buttons
			//ç¾åœ¨ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºã¨ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼ã®é«˜ã•ã‚’å–å¾—
				gosub *get_windowsize
			
			//ãƒ¡ãƒ‹ãƒ¥ãƒ¼
				color 0, 0, 0
				gmode 3,,,200 : boxfa 0, windowy-70-titlebar_h, windowx, windowy
	
				//æ¨™æº–ã‚«ãƒ¼ã‚½ãƒ«ãƒœã‚¿ãƒ³
					if cursor_mode = "normal" {
						gmode 2
						pos 20, windowy-70-titlebar_h : gcopy 3, 0, 32, 32, 32
					} else {
						gmode 2
						pos 20, windowy-70-titlebar_h : gcopy 3, 0, 0, 32, 32
					}
	
				//é“è·¯ãƒœã‚¿ãƒ³
					if cursor_mode = "put_Road" {
						gmode 2
						pos 60, windowy-70-titlebar_h : gcopy 4, 0, 32, 32, 32
					} else {
						gmode 2
						pos 60, windowy-70-titlebar_h : gcopy 4, 0, 0, 32, 32
					}
	
				//å»ºç‰©ï¼ˆä½å±…åœ°åŒºï¼‰ãƒœã‚¿ãƒ³
					if cursor_mode = "put_Residential" {
						gmode 2
						pos 92, windowy-70-titlebar_h : gcopy 5, 0, 32, 32, 32
					} else {
						gmode 2
						pos 92, windowy-70-titlebar_h : gcopy 5, 0, 0, 32, 32
					}
	
				//å»ºç‰©ï¼ˆå•†æ¥­åœ°åŒºï¼‰ãƒœã‚¿ãƒ³
					if cursor_mode = "put_Commercial" {
						gmode 2
						pos 124, windowy-70-titlebar_h : gcopy 12, 0, 32, 32, 32
					} else {
						gmode 2
						pos 124, windowy-70-titlebar_h : gcopy 12, 0, 0, 32, 32
					}
	
				//å»ºç‰©ï¼ˆã‚ªãƒ•ã‚£ã‚¹ï¼‰ãƒœã‚¿ãƒ³
					if cursor_mode = "put_Office" {
						gmode 2
						pos 156, windowy-70-titlebar_h : gcopy 6, 0, 32, 32, 32
					} else {
						gmode 2
						pos 156, windowy-70-titlebar_h : gcopy 6, 0, 0, 32, 32
					}
	
				//å»ºç‰©ï¼ˆå·¥æ¥­åœ°åŒºï¼‰ãƒœã‚¿ãƒ³
					if cursor_mode = "put_Industrial" {
						gmode 2
						pos 188, windowy-70-titlebar_h : gcopy 19, 0, 32, 32, 32
					} else {
						gmode 2
						pos 188, windowy-70-titlebar_h : gcopy 19, 0, 0, 32, 32
					}
	
				//å»ºç‰©ï¼ˆå…¬å…±æ–½è¨­ï¼‰ãƒœã‚¿ãƒ³
					if cursor_mode = "put_Public" {
						gmode 2
						pos 220, windowy-70-titlebar_h : gcopy 7, 0, 32, 32, 32
					} else {
						gmode 2
						pos 220, windowy-70-titlebar_h : gcopy 7, 0, 0, 32, 32
					}
	
				//å…¬åœ’ãƒœã‚¿ãƒ³
					if cursor_mode = "put_Park" {
						gmode 2
						pos 252, windowy-70-titlebar_h : gcopy 29, 0, 32, 32, 32
					} else {
						gmode 2
						pos 252, windowy-70-titlebar_h : gcopy 29, 0, 0, 32, 32
					}
	
				//æ’¤å»ãƒœã‚¿ãƒ³
					if cursor_mode = "bulldozer" {
						gmode 2
						pos windowx-54, windowy-70-titlebar_h : gcopy 10, 0, 32, 32, 32
					} else {
						gmode 2
						pos windowx-54, windowy-70-titlebar_h : gcopy 10, 0, 0, 32, 32
					}
	
				//è¨­å®šãƒœã‚¿ãƒ³
					gmode 2
					pos windowx-54-32, windowy-40-titlebar_h : gcopy 13, 0, 0, 32, 32
	
				//ä¿å­˜ãƒœã‚¿ãƒ³
					gmode 2
					pos windowx-54, windowy-40-titlebar_h : gcopy 11, 0, 0, 32, 32
	
				//çµ±è¨ˆãƒœã‚¿ãƒ³
					gmode 2
					pos windowx-54-32, windowy-70-titlebar_h : gcopy 30, 0, 0, 32, 32
	
				//çµ±è¨ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆoepn_stat_menu = 1ã®ã¨ãï¼‰
					if open_stat_menu = 1 {
						sboxf 128, windowx-72-32-1, windowy-70-titlebar_h-20-1, windowx-72-32-1+(20*4)+1, windowy-70-titlebar_h
	
						gmode 2
	
						if stat_mode = "type" {
							pos windowx-72-32, windowy-70-titlebar_h-20 : gcopy 31, 0, 20, 20, 20
						} else {
							pos windowx-72-32, windowy-70-titlebar_h-20 : gcopy 31, 0, 0, 20, 20
						}
	
						if stat_mode = "land_price" {
							pos windowx-72-32+20, windowy-70-titlebar_h-20 : gcopy 32, 0, 20, 20, 20
						} else {
							pos windowx-72-32+20, windowy-70-titlebar_h-20 : gcopy 32, 0, 0, 20, 20
						}
	
						if stat_mode = "crime_rate" {
							pos windowx-72-32+40, windowy-70-titlebar_h-20 : gcopy 33, 0, 20, 20, 20
						} else {
							pos windowx-72-32+40, windowy-70-titlebar_h-20 : gcopy 33, 0, 0, 20, 20
						}
	
						if stat_mode = "education_rate" {
							pos windowx-72-32+60, windowy-70-titlebar_h-20 : gcopy 47, 0, 20, 20, 20
						} else {
							pos windowx-72-32+60, windowy-70-titlebar_h-20 : gcopy 47, 0, 0, 20, 20
						}
					}
	
				//äººå£ã€æ—¥ä»˜ãƒ»æ°—æ¸©ã‚’è¡¨ç¤º
					color 255, 255, 255 : font "Yu Gothic UI", 12
					pos 300, windowy-70-titlebar_h+5 : mes "äººå£ "+Total_Population+"äºº\n"+time_Year+"å¹´"+time_Month+"æœˆ"+time_Date+"æ—¥ "+strf("%02d",time_Hour)+":"+strf("%02d",time_Minutes)+"  æ°—æ¸© "+temperature+"â„ƒ"
	
				//ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®è¡¨ç¤ºï¼ˆ0æ™‚0åˆ†ã€6æ™‚0åˆ†ã€12æ™‚0åˆ†ã€18æ™‚0åˆ† ã‚ã‚‹ã„ã¯ ãƒãƒƒãƒ—èª­ã¿è¾¼ã¿ç›´å¾Œã«æ–°ã—ã„ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’å–å¾—ï¼‰	
					if (time_Hour = 0 and time_Minutes = 0) or (time_Hour = 6 and time_Minutes = 0) or (time_Hour = 12 and time_Minutes = 0) or (time_Hour = 18 and time_Minutes = 0) or first_loop = 1 {
						gosub *get_news
					}
	
					color 255, 255, 255 : font "Yu Gothic UI", 10
					pos 20, windowy-32-titlebar_h+5 : mes "News : "+news_content+""
	
				//ã‚¢ãƒ‰ã‚ªãƒ³é¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé–‹ã‹ã‚Œã¦ã„ã‚‹å ´åˆã¯ã‚¢ãƒ‰ã‚ªãƒ³é¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®èƒŒæ™¯è‰²ã‚’è¡¨ç¤º
					if opening_addon_menu = 1 {
						gosub *open_menu_addon_menu
					} else : if cursor_mode = "normal" {
						put_addon_name = ""
					}
				
				//RCOIéœ€è¦ãƒ¡ãƒ¼ã‚¿
					font SystemFont, 10
					
					//R - ä½å±…åŒºç”»
						color 34, 177, 76 : boxf windowx-150, windowy-titlebar_h-20-(demand_Residential/3), windowx-150+10, windowy-titlebar_h-20
						cmes "R", windowx-150, windowy-titlebar_h-20, windowx-150+10, windowy-titlebar_h-10
					//C - å•†æ¥­åŒºç”»
						color 63, 72, 204 : boxf windowx-140, windowy-titlebar_h-20-(demand_Commercial/3), windowx-140+10, windowy-titlebar_h-20
						cmes "C", windowx-140, windowy-titlebar_h-20, windowx-140+10, windowy-titlebar_h-10
					//O - ã‚ªãƒ•ã‚£ã‚¹åŒºç”»
						color 0, 162, 232 : boxf windowx-130, windowy-titlebar_h-20-(demand_Office/3), windowx-130+10, windowy-titlebar_h-20
						cmes "O", windowx-130, windowy-titlebar_h-20, windowx-130+10, windowy-titlebar_h-10
					//I - å·¥æ¥­åŒºç”»
						color 255, 242, 0 : boxf windowx-120, windowy-titlebar_h-20-(demand_Industrial/3), windowx-120+10, windowy-titlebar_h-20
						cmes "I", windowx-120, windowy-titlebar_h-20, windowx-120+10, windowy-titlebar_h-10
					
			redraw 1
			await 30
			c+=16
	loop
	
*main_onclick
	//ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã®ä¸Šè¾ºï¼ˆwindowy-70-titlebar_hï¼‰ã‚ˆã‚Šä¸ŠãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸå ´åˆã¯return
		if opening_addon_menu = 1 {
			menu_line_y = windowy-70-titlebar_h-32-20
		} else {
			menu_line_y = windowy-70-titlebar_h
		}
	
		if mousey <= menu_line_y and open_stat_menu = 0 and (mousex >= 0 and mousey >= 0 and mousex <= windowx and mousey <= windowy) {
			gosub *build_obj
			return
		}
	
	/*------------------------------------------ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ãƒœã‚¿ãƒ³ã®å‹•ä½œ------------------------------------------------*/
		//æ¨™æº–ã‚«ãƒ¼ã‚½ãƒ«ãƒœã‚¿ãƒ³
			if click_range( 20, windowy-70-titlebar_h, 20+32, windowy-70-titlebar_h+32 ) = 1 {
				cursor_mode = "normal"
		
				opening_addon_menu = 0
				opening_menu_put_Road = 0
				opening_menu_put_Residential = 0
				opening_menu_put_Commercial = 0
				opening_menu_put_Office = 0
				opening_menu_put_Public = 0
				opening_menu_put_Park = 0
	
				open_stat_menu = 0
			}
				
		//é“è·¯ãƒœã‚¿ãƒ³
			if click_range( 60, windowy-70-titlebar_h, 60+32, windowy-70-titlebar_h+32 ) = 1 {
					
				if opening_menu_put_Road = 0 {
					cursor_mode = "put_Road"
					density = ""
		
					opening_addon_menu = 1
					opening_menu_put_Road = 1
	
					//ã¨ã‚Šã‚ãˆãšä¸€ç•ªå·¦ã«ã‚ã‚‹ã‚¢ãƒ‰ã‚ªãƒ³ã‚’é¸æŠã•ã›ã¦ãŠã
						clicked_addon_number = 0
		
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³åã‚’å–å¾—
							notesel type_Two_lane_road
							noteget put_addon_name, clicked_addon_number
				
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·ã‚’å–å¾—
							notesel type_number_Two_lane_road
							noteget addon_num_normal_road, clicked_addon_number
							addon_num_normal_road = int(addon_num_normal_road)
				} 
		
				opening_menu_put_Residential = 0
				opening_menu_put_Commercial = 0
				opening_menu_put_Office = 0
				opening_menu_put_Industrial = 0
				opening_menu_put_Public = 0
				opening_menu_put_Park = 0
	
				open_stat_menu = 0
			}
		
		//å»ºç‰©ï¼ˆä½å±…åœ°åŒºï¼‰ãƒœã‚¿ãƒ³
			if click_range( 92, windowy-70-titlebar_h, 92+32, windowy-70-titlebar_h+32 ) = 1 {
					
				if opening_menu_put_Reaidential = 0 {
					cursor_mode = "put_Residential"
					density = "low"
					
					opening_addon_menu = 1
					opening_menu_put_Residential = 1
	
					//ã¨ã‚Šã‚ãˆãšä¸€ç•ªå·¦ã«ã‚ã‚‹ã‚¢ãƒ‰ã‚ªãƒ³ã‚’é¸æŠã•ã›ã¦ãŠã
						clicked_addon_number = 0
			
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³åã‚’å–å¾—
							notesel type_low_density_residential
							noteget put_addon_name, clicked_addon_number
				
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·ã‚’å–å¾—
							notesel type_number_low_density_residential
							noteget addon_num_buf, clicked_addon_number
							addon_num_buf = int(addon_num_buf)
				} 
					
				opening_menu_put_Road = 0
				opening_menu_put_Commercial = 0
				opening_menu_put_Office = 0
				opening_menu_put_Industrial = 0
				opening_menu_put_Public = 0
				opening_menu_put_Park = 0
	
				open_stat_menu = 0
			}
		
		//å»ºç‰©ï¼ˆå•†æ¥­åœ°åŒºï¼‰ãƒœã‚¿ãƒ³
			if click_range( 124, windowy-70-titlebar_h, 124+32, windowy-70-titlebar_h+32 ) = 1 {
		
				if opening_menu_put_Commercial = 0 {
					cursor_mode = "put_Commercial"
					density = "low"
					
					opening_addon_menu = 1
					opening_menu_put_Commercial = 1
		
					//ã¨ã‚Šã‚ãˆãšä¸€ç•ªå·¦ã«ã‚ã‚‹ã‚¢ãƒ‰ã‚ªãƒ³ã‚’é¸æŠã•ã›ã¦ãŠã
						clicked_addon_number = 0
			
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³åã‚’å–å¾—
							notesel type_low_density_commercial
							noteget put_addon_name, clicked_addon_number
			
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·ã‚’å–å¾—
							notesel type_number_low_density_commercial
							noteget addon_num_buf, clicked_addon_number
							addon_num_buf = int(addon_num_buf)
				} 
		
				opening_menu_put_Road = 0
				opening_menu_put_Residential = 0
				opening_menu_put_Office = 0
				opening_menu_put_Industrial = 0
				opening_menu_put_Public = 0
				opening_menu_put_Park = 0
	
				open_stat_menu = 0
			}
		
		//å»ºç‰©ï¼ˆã‚ªãƒ•ã‚£ã‚¹ï¼‰ãƒœã‚¿ãƒ³
			if click_range( 156, windowy-70-titlebar_h, 156+32, windowy-70-titlebar_h+32 ) = 1 {
		
				if opening_menu_put_Office = 0 {
					cursor_mode = "put_Office"
		
					opening_addon_menu = 1
					opening_menu_put_Office = 1
		
					//ã¨ã‚Šã‚ãˆãšä¸€ç•ªå·¦ã«ã‚ã‚‹ã‚¢ãƒ‰ã‚ªãƒ³ã‚’é¸æŠã•ã›ã¦ãŠã
						clicked_addon_number = 0
			
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³åã‚’å–å¾—
							notesel type_office
							noteget put_addon_name, clicked_addon_number
				
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·ã‚’å–å¾—
							notesel type_number_office
							noteget addon_num_buf, clicked_addon_number
							addon_num_buf = int(addon_num_buf)
				} 
		
				opening_menu_put_Road = 0
				opening_menu_put_Residential = 0
				opening_menu_put_Commercial = 0
				opening_menu_put_Industrial = 0
				opening_menu_put_Public = 0
				opening_menu_put_Park = 0
	
				open_stat_menu = 0
			}
		
		//å»ºç‰©ï¼ˆå·¥æ¥­åœ°åŒºï¼‰ãƒœã‚¿ãƒ³
			if click_range( 188, windowy-70-titlebar_h, 188+32, windowy-70-titlebar_h+32 ) = 1 {
		
				if opening_menu_put_Office = 0 {
					cursor_mode = "put_Industrial"
	
					opening_addon_menu = 1
					opening_menu_put_Industrial = 1
	
					//ã¨ã‚Šã‚ãˆãšä¸€ç•ªå·¦ã«ã‚ã‚‹ã‚¢ãƒ‰ã‚ªãƒ³ã‚’é¸æŠã•ã›ã¦ãŠã
						clicked_addon_number = 0
			
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³åã‚’å–å¾—
							notesel type_industrial
							noteget put_addon_name, clicked_addon_number
				
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·ã‚’å–å¾—
							notesel type_number_industrial
							noteget addon_num_buf, clicked_addon_number
							addon_num_buf = int(addon_num_buf)
				} 
		
				opening_menu_put_Road = 0
				opening_menu_put_Residential = 0
				opening_menu_put_Commercial = 0
				opening_menu_put_Office = 0
				opening_menu_put_Public = 0
				opening_menu_put_Park = 0
	
				open_stat_menu = 0
			}
				
		//å»ºç‰©ï¼ˆå…¬å…±æ–½è¨­ï¼‰ãƒœã‚¿ãƒ³
			if click_range( 220, windowy-70-titlebar_h, 220+32, windowy-70-titlebar_h+32 ) = 1 {
		
				if opening_menu_put_Public = 0 {
					cursor_mode = "put_Public"
		
					opening_addon_menu = 1
					opening_menu_put_Public = 1
		
					//ã¨ã‚Šã‚ãˆãšä¸€ç•ªå·¦ã«ã‚ã‚‹ã‚¢ãƒ‰ã‚ªãƒ³ã‚’é¸æŠã•ã›ã¦ãŠã
						clicked_addon_number = 0
			
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³åã‚’å–å¾—
							notesel type_public
							noteget put_addon_name, clicked_addon_number
			
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·ã‚’å–å¾—
							notesel type_number_public
							noteget addon_num_buf, clicked_addon_number
							addon_num_buf = int(addon_num_buf)
				} 
		
				opening_menu_put_Road = 0
				opening_menu_put_Residential = 0
				opening_menu_put_Commercial = 0
				opening_menu_put_Office = 0
				opening_menu_put_Industrial = 0
				opening_menu_put_Park = 0
	
				open_stat_menu = 0
			}
		
		//å»ºç‰©ï¼ˆå…¬åœ’ï¼‰ãƒœã‚¿ãƒ³
			if click_range( 252, windowy-70-titlebar_h, 252+32, windowy-70-titlebar_h+32 ) = 1 {
		
				if opening_menu_put_Park = 0 {
					cursor_mode = "put_Park"
		
					opening_addon_menu = 1
					opening_menu_put_Park = 1
		
					//ã¨ã‚Šã‚ãˆãšä¸€ç•ªå·¦ã«ã‚ã‚‹ã‚¢ãƒ‰ã‚ªãƒ³ã‚’é¸æŠã•ã›ã¦ãŠã
						clicked_addon_number = 0
			
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³åã‚’å–å¾—
							notesel type_park
							noteget put_addon_name, clicked_addon_number
				
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·ã‚’å–å¾—
							notesel type_number_park
							noteget addon_num_buf, clicked_addon_number
							addon_num_buf = int(addon_num_buf)
				} 
		
				opening_menu_put_Road = 0
				opening_menu_put_Residential = 0
				opening_menu_put_Commercial = 0
				opening_menu_put_Office = 0
				opening_menu_put_Industrial = 0
				opening_menu_put_Public = 0
	
				open_stat_menu = 0
			}
		
		//æ’¤å»ãƒœã‚¿ãƒ³
			if click_range( windowx-54, windowy-70-titlebar_h, windowx-54+32, windowy-70-titlebar_h+32 ) = 1 {
				cursor_mode = "bulldozer"
		
				opening_addon_menu = 0
				opening_menu_put_Road = 0
				opening_menu_put_Residential = 0
				opening_menu_put_Commercial = 0
				opening_menu_put_Office = 0
				opening_menu_put_Public = 0
			}
		
		//è¨­å®šãƒœã‚¿ãƒ³
			if click_range( windowx-54-32, windowy-40-titlebar_h, windowx-54, windowy-40-titlebar_h+32 ) = 1 {
				cursor_mode = "normal"
				opening_addon_menu = 0
				gosub *setting
			}
		
		//ä¿å­˜ãƒœã‚¿ãƒ³
			if click_range( windowx-54, windowy-40-titlebar_h, windowx-54+32, windowy-40-titlebar_h+32 ) = 1 {
				cursor_mode = "normal"
				opening_addon_menu = 0
				gosub *save
			}
		
		//çµ±è¨ˆãƒœã‚¿ãƒ³
			if click_range( windowx-54-32, windowy-70-titlebar_h, windowx-54, windowy-70-titlebar_h+32 ) = 1 {
				if open_stat_menu = 0 {
					open_stat_menu = 1
					stat_mode = ""
		
				} else {
					open_stat_menu = 0
					stat_mode = ""
				}
			}
		
		//çµ±è¨ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼
			if open_stat_menu = 1 and click_range( windowx-72-32, windowy-70-titlebar_h-20, windowx-72-32+20, windowy-70-titlebar_h ) = 1 {
				if stat_mode != "type" {
					stat_mode = "type"
				} else {
					stat_mode = ""
				}
			}
			if open_stat_menu = 1 and click_range( windowx-72-32+20, windowy-70-titlebar_h-20, windowx-72-32+40, windowy-70-titlebar_h ) = 1 {
				if stat_mode != "land_price" {
					stat_mode = "land_price"
				} else {
					stat_mode = ""
				}
			}
			if open_stat_menu = 1 and click_range( windowx-72-32+40, windowy-70-titlebar_h-20, windowx-72-32+60, windowy-70-titlebar_h ) = 1 {
				if stat_mode != "crime_rate" {
					stat_mode = "crime_rate"
				} else {
					stat_mode = ""
				}
			}
			if open_stat_menu = 1 and click_range( windowx-72-32+60, windowy-70-titlebar_h-20, windowx-72-32+80, windowy-70-titlebar_h ) = 1 {
				if stat_mode != "education_rate" {
					stat_mode = "education_rate"
				} else {
					stat_mode = ""
				}
			}
		
		//ã‚¢ãƒ‰ã‚ªãƒ³é¸æŠãƒœã‚¿ãƒ³ï¼ˆæ°´è‰²ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ï¼‰
			
			/*-------------------------------------------é“è·¯---------------------------------------------------*/
				notesel type_Two_lane_road
				if opening_menu_put_Road = 1 and click_range( 10+35, windowy-70-titlebar_h-32, notemax*35+10+35, windowy-70-titlebar_h ) = 1 {
					cursor_mode = "put_Road"
		
					clicked_addon_number = mousex/35 - 1
		
					//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³åã‚’å–å¾—
						notesel type_Two_lane_road
						noteget put_addon_name, clicked_addon_number
						
					//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·ã‚’å–å¾—
						notesel type_number_Two_lane_road
						noteget addon_num_normal_road, clicked_addon_number
						addon_num_normal_road = int(addon_num_normal_road)
				}
	
			/*-----------------------------------------ä½å±…åœ°åŒº-------------------------------------------------*/
	
			//ä½å±…åœ°åŒºã®ä½å¯†åº¦ãƒ»é«˜å¯†åº¦é¸æŠãƒœã‚¿ãƒ³
				//ä½å¯†åº¦
					if cursor_mode = "put_Residential" and click_range( 0, windowy-70-titlebar_h-32, 16, windowy-70-titlebar_h-16 ) = 1 {
						density = "low"
		
					//ã¨ã‚Šã‚ãˆãšåœ°åŒºè¨­å®šã‚¢ã‚¤ã‚³ãƒ³ã‚’é¸æŠã•ã›ã¦ãŠã
						clicked_addon_number = 0
			
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³åã‚’å–å¾—
							notesel type_low_density_residential
							noteget put_addon_name, clicked_addon_number
				
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·ã‚’å–å¾—
							notesel type_number_low_density_residential
							noteget addon_num_buf, clicked_addon_number
							addon_num_buf = int(addon_num_buf)
								
						gosub *open_menu_addon_menu
					}
				//é«˜å¯†åº¦
					if cursor_mode = "put_Residential" and click_range( 0, windowy-70-titlebar_h-16, 16, windowy-70-titlebar_h ) = 1 {
						density = "high"
		
						//ã¨ã‚Šã‚ãˆãšåœ°åŒºè¨­å®šã‚¢ã‚¤ã‚³ãƒ³ã‚’é¸æŠã•ã›ã¦ãŠã
							clicked_addon_number = 0
			
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³åã‚’å–å¾—
							notesel type_high_density_residential
							noteget put_addon_name, clicked_addon_number
				
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·ã‚’å–å¾—
							notesel type_number_high_density_residential
							noteget addon_num_buf, clicked_addon_number
							addon_num_buf = int(addon_num_buf)
							
						gosub *open_menu_addon_menu
					}
			
			//ä½å¯†åº¦ä½å±…åœ°åŒº
				notesel type_low_density_residential
				if opening_menu_put_Residential = 1 and density = "low" and click_range( 10+35, windowy-70-titlebar_h-32, (notemax+1)*35+10+35, windowy-70-titlebar_h ) = 1 {
					cursor_mode = "put_Residential"
					
					clicked_addon_number = mousex/35 - 1
					
					//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³åã‚’å–å¾—
						notesel type_low_density_residential
						noteget put_addon_name, clicked_addon_number - 1
		
					//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·ã‚’å–å¾—
						notesel type_number_low_density_residential
						noteget addon_num_buf, clicked_addon_number - 1
						addon_num_buf = int(addon_num_buf)
				}
				
			//é«˜å¯†åº¦ä½å±…åœ°åŒº
				notesel type_high_density_residential
				if opening_menu_put_Residential = 1 and density = "high" and click_range( 10+35, windowy-70-titlebar_h-32, (notemax+1)*35+10+35, windowy-70-titlebar_h ) = 1 {
					cursor_mode = "put_Residential"
		
					clicked_addon_number = mousex/35 - 1
		
					//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³åã‚’å–å¾—
						notesel type_high_density_residential
						noteget put_addon_name, clicked_addon_number - 1
		
					//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·ã‚’å–å¾—
						notesel type_number_high_density_residential
						noteget addon_num_buf, clicked_addon_number - 1
						addon_num_buf = int(addon_num_buf)
				}
	
			/*--------------------------------------------å•†æ¥­åœ°åŒº---------------------------------------------*/
	
			//å•†æ¥­åœ°åŒºã®ä½å¯†åº¦ãƒ»é«˜å¯†åº¦é¸æŠãƒœã‚¿ãƒ³
				//ä½å¯†åº¦
					if cursor_mode = "put_Commercial" and click_range( 0, windowy-70-titlebar_h-32, 16, windowy-70-titlebar_h-16 ) = 1 {
						density = "low"
		
					//ã¨ã‚Šã‚ãˆãšåœ°åŒºè¨­å®šã‚¢ã‚¤ã‚³ãƒ³ã‚’é¸æŠã•ã›ã¦ãŠã
						clicked_addon_number = 0
			
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³åã‚’å–å¾—
							notesel type_low_density_commercial
							noteget put_addon_name, clicked_addon_number
				
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·ã‚’å–å¾—
							notesel type_number_low_density_commercial
							noteget addon_num_buf, clicked_addon_number
							addon_num_buf = int(addon_num_buf)
								
						gosub *open_menu_addon_menu
					}
				//é«˜å¯†åº¦
					if cursor_mode = "put_Commercial" and click_range( 0, windowy-70-titlebar_h-16, 16, windowy-70-titlebar_h ) = 1 {
						density = "high"
		
						//ã¨ã‚Šã‚ãˆãšåœ°åŒºè¨­å®šã‚¢ã‚¤ã‚³ãƒ³ã‚’é¸æŠã•ã›ã¦ãŠã
							clicked_addon_number = 0
			
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³åã‚’å–å¾—
							notesel type_high_density_commercial
							noteget put_addon_name, clicked_addon_number
				
						//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·ã‚’å–å¾—
							notesel type_number_high_density_commercial
							noteget addon_num_buf, clicked_addon_number
							addon_num_buf = int(addon_num_buf)
							
						gosub *open_menu_addon_menu
					}
			
			//ä½å¯†åº¦å•†æ¥­åœ°åŒº
				notesel type_low_density_commercial
				if opening_menu_put_commercial = 1 and density = "low" and click_range( 10+35, windowy-70-titlebar_h-32, (notemax+1)*35+10+35, windowy-70-titlebar_h ) = 1 {
					cursor_mode = "put_Commercial"
		
					clicked_addon_number = mousex/35 - 1
		
					//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³åã‚’å–å¾—
						notesel type_low_density_commercial
						noteget put_addon_name, clicked_addon_number - 1
		
					//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·ã‚’å–å¾—
						notesel type_number_low_density_commercial
						noteget addon_num_buf, clicked_addon_number - 1
						addon_num_buf = int(addon_num_buf)
				}
	
			//é«˜å¯†åº¦å•†æ¥­åœ°åŒº
				notesel type_high_density_commercial
				if opening_menu_put_commercial = 1 and density = "high" and click_range( 10+35, windowy-70-titlebar_h-32, (notemax+1)*35+10+35, windowy-70-titlebar_h ) = 1 {
					cursor_mode = "put_Commercial"
		
					clicked_addon_number = mousex/35 - 1
		
					//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³åã‚’å–å¾—
						notesel type_high_density_commercial
						noteget put_addon_name, clicked_addon_number - 1
		
					//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·ã‚’å–å¾—
						notesel type_number_high_density_commercial
						noteget addon_num_buf, clicked_addon_number - 1
						addon_num_buf = int(addon_num_buf)
				}
	
			/*--------------------------------------------ã‚ªãƒ•ã‚£ã‚¹-----------------------------------------------*/
			
			//é«˜å¯†åº¦ã‚ªãƒ•ã‚£ã‚¹
				notesel type_office
				if opening_menu_put_Office = 1 and click_range( 10+35, windowy-70-titlebar_h-32, (notemax+1)*35+10+35, windowy-70-titlebar_h ) = 1 {
					cursor_mode = "put_Office"
		
					clicked_addon_number = mousex/35 - 1
		
					//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³åã‚’å–å¾—
						notesel type_office
						noteget put_addon_name, clicked_addon_number - 1
		
					//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·ã‚’å–å¾—
						notesel type_number_office
						noteget addon_num_buf, clicked_addon_number - 1
						addon_num_buf = int(addon_num_buf)
				}
	
			/*--------------------------------------------å·¥æ¥­åœ°åŒº-----------------------------------------------*/
			
			//å·¥æ¥­åœ°åŒº
				notesel type_industrial
				if opening_menu_put_industrial = 1 and click_range( 10+35, windowy-70-titlebar_h-32, (notemax+1)*35+10+35, windowy-70-titlebar_h ) = 1 {
					cursor_mode = "put_Industrial"
		
					clicked_addon_number = mousex/35 - 1
						
					//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³åã‚’å–å¾—
						notesel type_industrial
						noteget put_addon_name, clicked_addon_number - 1
						
					//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·ã‚’å–å¾—
						notesel type_number_industrial
						noteget addon_num_buf, clicked_addon_number - 1
						addon_num_buf = int(addon_num_buf)
				}
				
			/*---------------------------------------------å…¬å…±æ–½è¨­-----------------------------------------------*/
			
			//å…¬å…±æ–½è¨­
				notesel type_public
				if opening_menu_put_public = 1 and click_range( 10+35, windowy-70-titlebar_h-32, notemax*35+10+35, windowy-70-titlebar_h ) = 1 {
					cursor_mode = "put_Public"
		
					clicked_addon_number = mousex/35 - 1
		
					//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³åã‚’å–å¾—
						notesel type_public
						noteget put_addon_name, clicked_addon_number
						
					//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·ã‚’å–å¾—
						notesel type_number_public
						noteget addon_num_buf, clicked_addon_number
						addon_num_buf = int(addon_num_buf)
				}
	
			/*-----------------------------------------------å…¬åœ’-------------------------------------------------*/
			
			//å…¬åœ’
				notesel type_public
				if opening_menu_put_Park = 1 and click_range( 10+35, windowy-70-titlebar_h-32, notemax*35+10+35, windowy-70-titlebar_h ) = 1 {
					cursor_mode = "put_Park"
		
					clicked_addon_number = mousex/35 - 1
		
					//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³åã‚’å–å¾—
						notesel type_park
						noteget put_addon_name, clicked_addon_number
						
					//é¸æŠã•ã‚ŒãŸã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¢ãƒ‰ã‚ªãƒ³ç•ªå·ã‚’å–å¾—
						notesel type_number_park
						noteget addon_num_buf, clicked_addon_number
						addon_num_buf = int(addon_num_buf)
				}
	
			/*----------------------------------------------------------------------------------------------------*/
	
	gosub *build_obj
	
	return
	
*build_obj
	dim cannot_build, 4
	dim direction_check, 4
	
*build_obj_2
	/*-----------------é“è·¯ãƒ»å»ºç‰©ã®å»ºè¨­ãƒ»æ•·è¨­ï¼ˆå·¦ã‚¯ãƒªãƒƒã‚¯ï¼‰ã€æ’¤å»ï¼ˆå³ã‚¯ãƒªãƒƒã‚¯ or æ’¤å»ãƒ¢ãƒ¼ãƒ‰ï¼‰---------------------*/
	
		//æ¨™æº–ã‚«ãƒ¼ã‚½ãƒ«ãƒ¢ãƒ¼ãƒ‰ã‚ã‚‹ã„ã¯ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒã‚¦ã‚¹yåº§æ¨™ãŒmenu_line_yä»¥ä¸Šã®å ´åˆã¯return
			if from_Build_on_Reservation_area = 0 and (cursor_mode = "normal" or mousey >= menu_line_y or mx < 0 or my < 0) {
				pointer_icon = -1
				return
			}
	
		//æ’¤å»ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯é¸æŠã•ã‚ŒãŸãƒã‚¹ã‚’æ›´åœ°ã«ã™ã‚‹
			if from_Build_on_Reservation_area = 0 and cursor_mode = "bulldozer" {
				gosub *delete_obj
				return
			}
	
		//ã‚«ãƒ¼ã‚½ãƒ«ãŒãƒãƒƒãƒ—å¤–ã«ã‚ã‚‹å ´åˆã¯return
			if from_Build_on_Reservation_area = 0 and (mx < 0 or my < 0 or mx > mapx-1 or my > mapy-1) {
				return
			}
	
		//å‘¨å›²ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚«ãƒ†ã‚´ãƒªã‚’å–å¾—
			left_chip = ""
			top_chip = ""
			bottom_chip = ""
			right_chip = ""
			
			if mx > 0 {
				left_chip = category(mx-1, my)
			}
			if my > 0 {
				top_chip = category(mx, my-1)
			}
			if mapy-1 > my {
				bottom_chip = category(mx, my+1)
			}
			if mapx-1 > mx {
				right_chip = category(mx+1, my)
			}
	
		//å»ºè¨­ãƒ»æ•·è¨­
			if mouse_left = 1 {
				
				//é“è·¯æ•·è¨­
					if cursor_mode = "put_Road" and map(mx, my) != addon_num_normal_road {
						//é“è·¯ã®å‘ãã‚’æƒãˆã‚‹
							x_buf = x : y_buf = y
							x = mx : y = my
	
							category_buf = category(mx,my)
							
							from_build_obj = 1
							gosub *adjustment_road
							
							x = x_buf : y = y_buf
	
						//æ•·è¨­ã—ãŸåœ°ç‚¹ã®æƒ…å ±ã‚’æ›¸ãæ›ãˆ
							cetegory_buf = category(mx,my)
							
							map(mx, my) = addon_num_normal_road
							name(mx, my) = put_addon_name
							category(mx, my) = "road"
							
							obj_serial_num(mx, my) = 0
							obj_use_tiles_x(mx,my) = 0
							obj_use_tiles_y(mx,my) = 0
							obj_tiles_x(mx, my) = 0
							obj_tiles_y(mx, my) = 0
							
							if addon_chip_x(addon_num_buf, obj_type(mx,my), obj_dire(mx,my)) = 1 and addon_chip_y(addon_num_buf, obj_type(mx,my), obj_dire(mx,my)) = 1 {
								if category_buf = "residential" {
									Total_Population -= residents(mx,my)
									total_Residential_maximum_capacity -= addon_maximum_capacity(addon_num_buf)
									residents(mx,my) = 0
								}
			
								if category_buf = "commercial" {
									Total_workers_Commercial -= workers_Commercial(mx, my)
									total_Commercial_maximum_capacity -= addon_maximum_capacity(addon_num_buf)
									workers_Commercial(mx, my) = 0
								}
			
								if category_buf = "office" {
									Total_workers_Office -= workers_Office(mx, my)
									total_Office_maximum_capacity -= addon_maximum_capacity(addon_num_buf)
									workers_Office(mx, my) = 0
								}
			
								if category_buf = "industrial" {
									Total_workers_Industrial -= workers_Industrial(mx, my)
									total_Industrial_maximum_capacity -= addon_maximum_capacity(addon_num_buf)
									workers_Industrial(mx, my) = 0
								}
			
								if category_buf = "public" {
									Total_workers_Public -= workers_Public(mx, my)
									total_Public_maximum_capacity -= addon_maximum_capacity(addon_num_buf)
									workers_Public(mx, my) = 0
								}
							}
	
						return
					}
	
				//é“è·¯æ•·è¨­ä»¥å¤–ã®å ´åˆã€é¸æŠã•ã‚ŒãŸãƒã‚¹ã®å‘¨å›²ï¼ˆä¸Šä¸‹å·¦å³ï¼‰ã«é“è·¯ãŒã‚ã‚‹ã‹ã©ã†ã‹ï¼ˆé“è·¯ã«æ¥ç¶šã§ãã‚‹ã‹ï¼‰
					if cursor_mode != "put_Road" {
	
						//ãã‚‚ãã‚‚å»ºè¨­åœ°ã«é“è·¯ãŒã‚ã‚‹å ´åˆ
							if category(mx,my) = "road" and cursor_mode != "put_Road" and (ginfo_mx>=ginfo_wx1 & ginfo_mx<=ginfo_wx2) and (ginfo_my>=ginfo_wy1+titlebar_h&ginfo_my<=ginfo_wy2) {
								;dialog "ã“ã®åŒºç”»ã¯æ—¢ã«å æœ‰ã•ã‚Œã¦ã„ã¾ã™"
								return
							}
	
						around_road_exist = -1
						
						if mx > 0 {
							if category(mx-1, my) = "road" and cannot_build(0) = 0 {
								around_road_exist += 1
	
								direction = "left"
								direction_check(0) = 1
	
								now_direction_num = 0
							}
						}
						if my > 0 {
							if category(mx, my-1) = "road" and cannot_build(1) = 0 {
								around_road_exist += 1
	
								direction = "top"
								direction_check(1) = 1
	
								now_direction_num = 1
							}
						}
						if my < mapy {
							if category(mx, my+1) = "road" and cannot_build(2) = 0 {
								around_road_exist += 1
	
								direction = "bottom"
								direction_check(2) = 1
	
								now_direction_num = 2
							}
						}
						if mx < mapx {
							if category(mx+1, my) = "road" and cannot_build(3) = 0 {
								around_road_exist += 1
	
								direction = "right"
								direction_check(3) = 1
	
								now_direction_num = 3
							}
						}
	
						//é“è·¯ã«æ¥ç¶šã•ã‚Œã¦ã„ãªã„å ´æ‰€ã«å»ºè¨­ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹å ´åˆ
							if around_road_exist = -1 and (ginfo_mx>=ginfo_wx1 & ginfo_mx<=ginfo_wx2) and (ginfo_my>=ginfo_wy1+titlebar_h&ginfo_my<=ginfo_wy2) {
								dialog "é“è·¯ã«æ¥ç¶šã•ã‚Œã¦ã„ãªã„å ´æ‰€ã«ã¯å»ºè¨­ã§ãã¾ã›ã‚“ï¼"
								return
							}
	
						//åœ°åŒºè¨­å®šã®å ´åˆ
							if instr(put_addon_name, 0, "Area : ") != -1 {
								gosub *set_area
								return
							}
							
						if around_road_exist >= 0 {
							//å»ºç‰©ï¼ˆä½å±…åœ°åŒºï¼‰å»ºè¨­
								if cursor_mode = "put_Residential" {
									category_buf = "residential"
								}
	
							//å»ºç‰©ï¼ˆå•†æ¥­åœ°åŒºï¼‰å»ºè¨­
								if cursor_mode = "put_Commercial" {
									category_buf = "commercial"
								}
				
							//å»ºç‰©ï¼ˆé«˜å¯†åº¦ã‚ªãƒ•ã‚£ã‚¹ï¼‰å»ºè¨­
								if cursor_mode = "put_Office" {
									category_buf = "office"
								}
	
							//å»ºç‰©ï¼ˆå·¥æ¥­åœ°åŒºï¼‰å»ºè¨­
								if cursor_mode = "put_Industrial" {
									category_buf = "industrial"
								}
				
							//å»ºç‰©ï¼ˆå…¬å…±æ–½è¨­ï¼‰å»ºè¨­
								if cursor_mode = "put_Public" {
									category_buf = "public"
								}
	
							//å»ºç‰©ï¼ˆå…¬åœ’ï¼‰å»ºè¨­
								if cursor_mode = "put_Park" {
									category_buf = "park"
								}
	
							//å‘ãã«å¿œã˜ã¦obj_type_bufã¨obj_dire_bufã‚’ä»£å…¥
								if direction = "left" {
									obj_type_buf = element2( put_addon_name, use_type, addon_total_use_types, "null")
									obj_dire_buf = element3( put_addon_name, use_type, addon_total_use_types, "null", addon_direction, addon_total_addon_direction, "left")
								}
								if direction = "top" {
									obj_type_buf = element2( put_addon_name, use_type, addon_total_use_types, "null")
									obj_dire_buf = element3( put_addon_name, use_type, addon_total_use_types, "null", addon_direction, addon_total_addon_direction, "top")
								}
								if direction = "bottom" {
									obj_type_buf = element2( put_addon_name, use_type, addon_total_use_types, "null")
									obj_dire_buf = element3( put_addon_name, use_type, addon_total_use_types, "null", addon_direction, addon_total_addon_direction, "bottom")
								}
								if direction = "right" {
									obj_type_buf = element2( put_addon_name, use_type, addon_total_use_types, "null")
									obj_dire_buf = element3( put_addon_name, use_type, addon_total_use_types, "null", addon_direction, addon_total_addon_direction, "right")
								}
	
								if obj_type_buf < 0 or obj_dire_buf < 0 {
									return
								}
								
							//2ãƒã‚¹ä»¥ä¸Šã®å»ºç¯‰ç‰©ã®å ´åˆã€å»ºè¨­ã™ã‚‹æ–¹å‘ã«ã»ã‹ã®å»ºç¯‰ç‰©ãŒãªã„ã‹ç¢ºèª
								if addon_chip_x(addon_num_buf, obj_type_buf, obj_dire_buf) >= 2 or addon_chip_y(addon_num_buf, obj_type_buf, obj_dire_buf) >= 2 {
									found_other_obj = 0
									
									repeat addon_chip_x(addon_num_buf, obj_type_buf, obj_dire_buf)
										rx = mx + cnt
	
										if direction = "right" and addon_chip_x(addon_num_buf, obj_type_buf, obj_dire_buf) > 1 {
											rx -= 1
										}
										
										repeat addon_chip_y(addon_num_buf, obj_type_buf, obj_dire_buf)
											ry = my + cnt
	
											if direction = "bottom" and addon_chip_y(addon_num_buf, obj_type_buf, obj_dire_buf) > 1 {
												ry -= 1
											}
	
											if done_build(0,rx,ry) = 0 and category(rx,ry) != "tile" and (category(rx,ry) = "road" or obj_use_tiles_x(rx,ry) != 0 or obj_use_tiles_y(rx,ry) != 0) {
												found_other_obj = 1
												
												if direction = "left" {
													cannot_build(0) = 1
												}
												if direction = "top" {
													cannot_build(1) = 1
												}
												if direction = "bottom" {
													cannot_build(2) = 1
												}
												if direction = "right" {
													cannot_build(3) = 1
												}
		
												//ã»ã‹ã«å»ºè¨­å¯èƒ½ãªå‘ãã‚’æ¢ã™
													found_other_direction = 0
														
													repeat 4
															
														if direction_check(cnt) = 1 and cnt != now_direction_num and cannot_build(cnt) = 0 {
															found_other_direction = 1
															direction_check(now_direction_num) = 0
															
															if cnt = 0 {
																direction = "left"
																now_direction_num = 0
																break
															}
															if cnt = 1 {
																direction = "top"
																now_direction_num = 1
																break
															}
															if cnt = 2 {
																direction = "bottom"
																now_direction_num = 2
																break
															}
															if cnt = 3 {
																direction = "right"
																now_direction_num = 3
																break
															}
														}
													loop
		
												//ã»ã‹ã«å»ºè¨­å¯èƒ½ãªå‘ããŒè¦‹ã¤ã‹ã£ãŸå ´åˆ
													if found_other_direction = 1 {
														able_build_here = 1
														break
														
												//ã»ã‹ã«å»ºè¨­å¯èƒ½ãªå‘ããŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸå ´åˆ
													} else {
														cannot_build_here = 1
														break
													}
											}
	
											done_build(0,rx,ry) = 1
										loop
									loop
	
									if able_build_here = 1 and found_other_obj = 1 {
										able_build_here = 0
										found_other_obj = 0
										
										goto *build_obj_2
									}
									
									if cannot_build_here = 1 and found_other_obj = 1 {
										if from_Build_on_Reservation_area = 0 {
											dialog "ã“ã®åŒºç”»ã¯æ—¢ã«å æœ‰ã•ã‚Œã¦ã„ã¾ã™"
										}
										
										cannot_build_here = 0
										found_other_obj = 0
										
										return
									}
										
								}
	
							//Build_on_Reservation_areaã‹ã‚‰ããŸå ´åˆã¯from_Build_on_Reservation_area = 0ã«
								if from_Build_on_Reservation_area = 1 {
									from_Build_on_Reservation_area = 0
								}
	
							//obj_type_bufã‚’obj_type(mx,my)ã«ã€obj_dire_bufã‚’obj_dire(mx,my)ã«ä»£å…¥
								obj_type(mx,my) = obj_type_buf
								obj_dire(mx,my) = obj_dire_buf
	
							//xæ–¹å‘ã«1ãƒã‚¹ã—ã‹ä½¿ã‚ãªã„å»ºç¯‰ç‰©ã®å ´åˆã€obj_use_tiles_xã¯0ã«
								if addon_chip_x(addon_num_buf, obj_type(mx,my), obj_dire(mx,my)) = 1 {
									acx = 0
								} else {
									acx = 1
								}
	
							//yæ–¹å‘ã«1ãƒã‚¹ã—ã‹ä½¿ã‚ãªã„å»ºç¯‰ç‰©ã®å ´åˆã€obj_use_tiles_yã¯0ã«
								if addon_chip_y(addon_num_buf, obj_type(mx,my), obj_dire(mx,my)) = 1 {
									acy = 0
								} else {
									acy = 1
								}
	
							//ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é€šã—ç•ªå·
								if obj_serial_num(mx, my) = 0 {
									next_obj_serial_num += 1
								}
								
							//å»ºè¨­å‡¦ç†
								repeat addon_chip_x(addon_num_buf, obj_type(mx,my), obj_dire(mx,my))
									rx = cnt
									
									if direction = "right" and addon_chip_x(addon_num_buf, obj_type_buf, obj_dire_buf) > 1 {
										rx -= 1
									}
									
									repeat addon_chip_y(addon_num_buf, obj_type(mx,my), obj_dire(mx,my))
										ry = cnt
	
										if direction = "bottom" and addon_chip_y(addon_num_buf, obj_type_buf, obj_dire_buf) > 1 {
											ry -= 1
										}
										
										before_category = category(mx+rx,my+ry)
										
										map(mx+rx,my+ry) = addon_num_buf
										name(mx+rx,my+ry) = put_addon_name
										category(mx+rx,my+ry) = category_buf
	
										obj_type(mx+rx,my+ry) = obj_type(mx, my)
										obj_dire(mx+rx,my+ry) = obj_dire(mx, my)
			
										obj_serial_num(mx+rx,my+ry) = next_obj_serial_num
										obj_use_tiles_x(mx+rx,my+ry) = addon_chip_x(addon_num_buf, 0, obj_dire(mx+rx,my+ry)) * acx
										obj_use_tiles_y(mx+rx,my+ry) = addon_chip_y(addon_num_buf, 0, obj_dire(mx+rx,my+ry)) * acy
										obj_tiles_x(mx+rx,my+ry) = rx
										obj_tiles_y(mx+rx,my+ry) = ry
	
										reservation(mx+rx,my+ry) = "none"
										
										if before_category = "residential" and done_build(1,mx+rx,my+ry) = 0 {
											Total_Population -= residents(mx+rx,my+ry)
											total_Residential_maximum_capacity -= addon_maximum_capacity(addon_num_buf)
											residents(mx+rx,my+ry) = 0
		
											done_build(1,mx+rx,my+ry) = 1
										}
		
										if before_category = "commercial" and done_build(1,mx+rx,my+ry) = 0 {
											Total_workers_Commercial -= workers_Commercial(mx+rx,my+ry)
											total_Commercial_maximum_capacity -= addon_maximum_capacity(addon_num_buf)
											workers_Commercial(mx+rx,my+ry) = 0
		
											done_build(1,mx+rx,my+ry) = 1
										}
										
										if before_category = "office" and done_build(1,mx+rx,my+ry) = 0 {
											Total_workers_Office -= workers_Office(mx+rx,my+ry)
											total_Office_maximum_capacity -= addon_maximum_capacity(addon_num_buf)
											workers_Office(mx+rx,my+ry) = 0
		
											done_build(1,mx+rx,my+ry) = 1
										}
		
										if before_category = "industrial" and done_build(1,mx+rx,my+ry) = 0 {
											Total_workers_Industrial -= workers_Industrial(mx+rx,my+ry)
											total_Industrial_maximum_capacity -= addon_maximum_capacity(addon_num_buf)
											workers_Industrial(mx+rx,my+ry) = 0
		
											done_build(1,x+rx,my+ry) = 1
										}
		
										if before_category = "public" and done_build(1,mx+rx,my+ry) = 0 {
											Total_workers_Public -= workers_Public(mx+rx,my+ry)
											total_Public_maximum_capacity -= addon_maximum_capacity(addon_num_buf)
											workers_Public(mx+rx,my+ry) = 0
		
											done_build(1,mx+rx,my+ry) = 1
										}
									loop
								loop
	
							//åœ°ä¾¡ã®å¤‰å‹•
								addon_land_price_influence__tmp = addon_land_price_influence(addon_num_buf)
	
								addon_land_price_influence_grid__tmp = addon_land_price_influence_grid(addon_num_buf)
								
								add_value = addon_land_price_influence__tmp / addon_land_price_influence_grid__tmp
								round = 0
								
								for round, 1, addon_land_price_influence_grid__tmp+1, 1
									
									repeat (round*2-1)
										if mx+cnt-(round-1)>0 and mx+cnt-(round-1)<mapx and my+round-1>0 and my+round-1<mapy {
											if done_build(2, mx+cnt-(round-1), my+round-1) = 0 {
												land_price(mx+cnt-(round-1),my+round-1) += int( addon_land_price_influence__tmp - (add_value*(round-1)) )
												done_build(2, mx+cnt-(round-1), my+round-1) = 1
											}
										}
									loop
									
									repeat (round*2-1)
										if mx+cnt-(round-1)>0 and mx+cnt-(round-1)<mapx and my-round+1>0 and my-round+1<mapy {
											if done_build(2, mx+cnt-(round-1), my-round+1) = 0 {
												land_price(mx+cnt-(round-1),my-round+1) += int( addon_land_price_influence__tmp - (add_value*(round-1)) )
												done_build(2, mx+cnt-(round-1), my-round+1) = 1
											}
										}
									loop
	
									repeat (round*2-1)
										if mx+round-1>0 and mx+round-1<mapx and my+cnt-(round-1)>0 and my+cnt-(round-1)<mapy {
											if done_build(2, mx+round-1, my+cnt-(round-1)) = 0 {
												land_price(mx+round-1,my+cnt-(round-1)) += int( addon_land_price_influence__tmp - (add_value*(round-1)) )
												done_build(2, mx+round-1, my+cnt-(round-1)) = 1
											}
										}
									loop
	
									repeat (round*2-1)
										if mx-round+1>0 and mx-round+1<mapx and my+cnt-(round-1)>0 and my+cnt-(round-1)<mapy {
											if done_build(2, mx-round+1, my+cnt-(round-1)) = 0 {
												land_price(mx-round+1,my+cnt-(round-1)) += int( addon_land_price_influence__tmp - (add_value*(round-1)) )
												done_build(2, mx-round+1, my+cnt-(round-1)) = 1
											}
										}
									loop
								next
	
							//çŠ¯ç½ªç‡ã®å¤‰å‹•
								addon_crime_rate_influence__tmp = addon_crime_rate_influence(addon_num_buf)
								
								if addon_crime_rate_influence__tmp != 0 {
	
									addon_crime_rate_influence_grid__tmp = addon_crime_rate_influence_grid(addon_num_buf)
									
									add_value = addon_crime_rate_influence__tmp / addon_crime_rate_influence_grid__tmp
									round = 0
									
									for round, 1, addon_crime_rate_influence_grid__tmp+1, 1
										repeat (round*2-1)
											if (mx+cnt-(round-1)) >= 0 and (mx+cnt-(round-1)) <= mapx and (my+round-1) >= 0 and (my+round-1) <= mapx {
												if done_build(5, mx+cnt-(round-1), my+round-1) = 0 {
													crime_rate(mx+cnt-(round-1),my+round-1) += int( addon_crime_rate_influence__tmp - (add_value*(round-1)) )
													done_build(5, mx+cnt-(round-1), my+round-1) = 1
												}
											}
										loop
										
										repeat (round*2-1)
											if (mx+cnt-(round-1)) >= 0 and (mx+cnt-(round-1)) <= mapx and (my-round+1) >= 0 and (my-round+1) <= mapx {
												if done_build(5, mx+cnt-(round-1), my-round+1) = 0 {
													crime_rate(mx+cnt-(round-1),my-round+1) += int( addon_crime_rate_influence__tmp - (add_value*(round-1)) )
													done_build(5, mx+cnt-(round-1), my-round+1) = 1
												}
											}
										loop
		
										repeat (round*2-1)
											if (mx+round-1) >= 0 and (mx+round-1) <= mapx and (my+cnt-(round-1)) >= 0 and (my+cnt-(round-1)) <= mapy {
												if done_build(5, mx+round-1, my+cnt-(round-1)) = 0 {
													crime_rate(mx+round-1,my+cnt-(round-1)) += int( addon_crime_rate_influence__tmp - (add_value*(round-1)) )
													done_build(5, mx+round-1, my+cnt-(round-1)) = 1
												}
											}
										loop
		
										repeat (round*2-1)
											if (mx-round-1) >= 0 and (mx-round-1) <= mapx and (my+cnt-(round-1)) >= 0 and (my+cnt-(round-1)) <= mapy {
												if done_build(5, mx-round+1, my+cnt-(round-1)) = 0 {
													crime_rate(mx-round+1,my+cnt-(round-1)) += int( addon_crime_rate_influence__tmp - (add_value*(round-1)) )
													done_build(5, mx-round+1, my+cnt-(round-1)) = 1
												}
											}
										loop
									next
	
								}
	
							//æ•™è‚²ç‡ã®å¤‰å‹•
								addon_education_rate_influence__tmp = addon_education_rate_influence(addon_num_buf)
								
								if addon_education_rate_influence__tmp != 0 {
	
									addon_education_rate_influence_grid__tmp = addon_education_rate_influence_grid(addon_num_buf)
									
									add_value = addon_education_rate_influence__tmp / addon_education_rate_influence_grid__tmp
									round = 0
									
									for round, 1, addon_education_rate_influence_grid__tmp+1, 1
										repeat (round*2-1)
											if (mx+cnt-(round-1)) >= 0 and (mx+cnt-(round-1)) <= mapx and (my+round-1) >= 0 and (my+round-1) <= mapx {
												if done_build(5, mx+cnt-(round-1), my+round-1) = 0 {
													education_rate(mx+cnt-(round-1),my+round-1) += int( addon_education_rate_influence__tmp - (add_value*(round-1)) )
													done_build(5, mx+cnt-(round-1), my+round-1) = 1
												}
											}
										loop
										
										repeat (round*2-1)
											if (mx+cnt-(round-1)) >= 0 and (mx+cnt-(round-1)) <= mapx and (my-round+1) >= 0 and (my-round+1) <= mapx {
												if done_build(5, mx+cnt-(round-1), my-round+1) = 0 {
													education_rate(mx+cnt-(round-1),my-round+1) += int( addon_education_rate_influence__tmp - (add_value*(round-1)) )
													done_build(5, mx+cnt-(round-1), my-round+1) = 1
												}
											}
										loop
		
										repeat (round*2-1)
											if (mx+round-1) >= 0 and (mx+round-1) <= mapx and (my+cnt-(round-1)) >= 0 and (my+cnt-(round-1)) <= mapy {
												if done_build(5, mx+round-1, my+cnt-(round-1)) = 0 {
													education_rate(mx+round-1,my+cnt-(round-1)) += int( addon_education_rate_influence__tmp - (add_value*(round-1)) )
													done_build(5, mx+round-1, my+cnt-(round-1)) = 1
												}
											}
										loop
		
										repeat (round*2-1)
											if (mx-round-1) >= 0 and (mx-round-1) <= mapx and (my+cnt-(round-1)) >= 0 and (my+cnt-(round-1)) <= mapy {
												if done_build(5, mx-round+1, my+cnt-(round-1)) = 0 {
													education_rate(mx-round+1,my+cnt-(round-1)) += int( addon_education_rate_influence__tmp - (add_value*(round-1)) )
													done_build(5, mx-round+1, my+cnt-(round-1)) = 1
												}
											}
										loop
									next
	
								}
	
							//éƒ½å¸‚å…¨ä½“ã®åå®¹å¯èƒ½äººæ•°æˆ–ã„ã¯æ±‚äººæ•°ã‚’å¢—ã‚„ã™
								if category_buf = "residential" and done_build(4,mx,my) = 0 {
									total_Residential_maximum_capacity += addon_maximum_capacity(addon_num_buf)
									Vacancies += addon_maximum_capacity(addon_num_buf)
									done_build(4,mx,my) = 1
								}
								if category_buf = "commercial" and done_build(4,mx,my) = 0 {
									total_Commercial_maximum_capacity += addon_maximum_capacity(addon_num_buf)
									Vacancies += addon_maximum_capacity(addon_num_buf)
									done_build(4,mx,my) = 1
								}
								if category_buf = "office" and done_build(4,mx,my) = 0 {
									total_Office_maximum_capacity += addon_maximum_capacity(addon_num_buf)
									Vacancies += addon_maximum_capacity(addon_num_buf)
									done_build(4,mx,my) = 1
								}
								if category_buf = "industrial" and done_build(4,mx,my) = 0 {
									total_Industrial_maximum_capacity += addon_maximum_capacity(addon_num_buf)
									Vacancies += addon_maximum_capacity(addon_num_buf)
									done_build(4,mx,my) = 1
								}
								if category_buf = "public" and done_build(4,mx,my) = 0 {
									total_Public_maximum_capacity += addon_maximum_capacity(addon_num_buf)
									Vacancies += addon_maximum_capacity(addon_num_buf)
									done_build(4,mx,my) = 1
								}
						}
					}	
					
			}
	
			return
	
*delete_obj
		//æ’¤å»
			//ã‚«ãƒ¼ã‚½ãƒ«ãŒãƒãƒƒãƒ—å¤–ã«ã‚ã‚‹å ´åˆã¯return
				if mx < 0 or my < 0 or mx > mapx-1 or my > mapy-1 {
					return
				}
			
			if mouse_right = 1 or (cursor_mode = "bulldozer" and mouse_left = 1) or from_build_obj = 1 {
				//ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å‘ãã‚’å–å¾—
					addon_num_buf = addon_num(name(mx,my))
					tile_addon_num_buf = addon_num("tile_greenfield")
					obj_direction_buf = addon_direction(addon_num_buf, obj_type(mx,my), obj_dire(mx,my))
	
					category_buf = category(mx,my)
	
					p = 0
	
					obj_tiles_x_buf = obj_tiles_x(mx,my)
					obj_tiles_y_buf = obj_tiles_y(mx,my)
	
					obj_use_tiles_x_buf = obj_use_tiles_x(mx,my)
					obj_use_tiles_y_buf = obj_use_tiles_y(mx,my)
	
					if obj_use_tiles_x_buf = 0 {
						px = 1
					} else {
						px = 0
					}
					
					if obj_use_tiles_y_buf = 0 {
						py = 1
					} else {
						py = 0
					}
	
					reservation(mx,my) = "none"
					
					repeat obj_use_tiles_x_buf + px
						rx = cnt
	
						if obj_direction_buf = "right" and obj_use_tiles_x_buf > 1 {
							rx -= 1
						}
								
						repeat obj_use_tiles_y_buf + py
							ry = cnt
	
							if obj_direction_buf = "bottom" and obj_use_tiles_y_buf > 1 {
								ry -= 1
							}
							
							map(mx-obj_tiles_x_buf+rx, my-obj_tiles_y_buf+ry) = tile_addon_num_buf
							name(mx-obj_tiles_x_buf+rx, my-obj_tiles_y_buf+ry) = "tile_greenfield"
							category(mx-obj_tiles_x_buf+rx, my-obj_tiles_y_buf+ry) = "tile"
							obj_type(mx-obj_tiles_x_buf+rx, my-obj_tiles_y_buf+ry) = tile_greenfield_null_type_buf
							obj_dire(mx-obj_tiles_x_buf+rx, my-obj_tiles_y_buf+ry) = tile_greenfield_null_dire_buf
								
							obj_serial_num(mx-obj_tiles_x_buf+rx, my-obj_tiles_y_buf+ry) = 0
							obj_use_tiles_x(mx-obj_tiles_x_buf+rx, my-obj_tiles_y_buf+ry) = 0
							obj_use_tiles_y(mx-obj_tiles_x_buf+rx, my-obj_tiles_y_buf+ry) = 0
							obj_tiles_x(mx-obj_tiles_x_buf+rx, my-obj_tiles_y_buf+ry) = 0
							obj_tiles_y(mx-obj_tiles_x_buf+rx, my-obj_tiles_y_buf+ry) = 0
	
							if category_buf = "residential" {
								Total_Population -= residents(mx-obj_tiles_x_buf+rx, my-obj_tiles_y_buf+ry)
								total_Residential_maximum_capacity -= addon_maximum_capacity(addon_num_buf)
								residents(mx-obj_tiles_x_buf+rx, my-obj_tiles_y_buf+ry) = 0
							}
			
							if category_buf = "commercial" {
								Total_workers_Commercial -= workers_Commercial(mx-obj_tiles_x_buf+rx, my-obj_tiles_y_buf+ry)
								total_Commercial_maximum_capacity -= addon_maximum_capacity(addon_num_buf)
								Vacancies -= addon_maximum_capacity(addon_num_buf)
								workers_Commercial(mx-obj_tiles_x_buf+rx, my-obj_tiles_y_buf+ry) = 0
							}
				
							if category_buf = "office" {
								Total_workers_Office -= workers_Office(mx-obj_tiles_x_buf+rx, my-obj_tiles_y_buf+ry)
								total_Office_maximum_capacity -= addon_maximum_capacity(addon_num_buf)
								Vacancies -= addon_maximum_capacity(addon_num_buf)
								workers_Office(mx-obj_tiles_x_buf+rx, my-obj_tiles_y_buf+ry) = 0
							}
				
							if category_buf = "industrial" {
								Total_workers_Industrial -= workers_Industrial(mx-obj_tiles_x_buf+rx, my-obj_tiles_y_buf+ry)
								total_Industrial_maximum_capacity -= addon_maximum_capacity(addon_num_buf)
								Vacancies -= addon_maximum_capacity(addon_num_buf)
								workers_Industrial(mx-obj_tiles_x_buf+rx, my-obj_tiles_y_buf+ry) = 0
							}
				
							if category_buf = "public" {
								Total_workers_Public -= workers_Public(mx-obj_tiles_x_buf+rx, my-obj_tiles_y_buf+ry)
								total_Public_maximum_capacity -= addon_maximum_capacity(addon_num_buf)
								Vacancies -= addon_maximum_capacity(addon_num_buf)
								workers_Public(mx-obj_tiles_x_buf+rx, my-obj_tiles_y_buf+ry) = 0
							}
	
						loop
	
					loop
			}
	
		from_build_obj = 0
		
		return
	
*set_area
	//åœ°åŒºè¨­å®š
	
	;ä½å±…åœ°åŒºã®è¨­å®š
	if put_addon_name = "Area : low_density_Residential" {
		reservation(mx,my) = "low_density_residential"
	}
	if put_addon_name = "Area : high_density_Residential" {
		reservation(mx,my) = "high_density_residential"
	}
	
	;å•†æ¥­åœ°åŒºã®è¨­å®š
	if put_addon_name = "Area : low_density_Commercial" {
		reservation(mx,my) = "low_density_commercial"
	}
	if put_addon_name = "Area : high_density_Commercial" {
		reservation(mx,my) = "high_density_commercial"
	}
	
	;ã‚ªãƒ•ã‚£ã‚¹åœ°åŒºã®è¨­å®š
	if put_addon_name = "Area : Office" {
		reservation(mx,my) = "office"
	}
	
	;å·¥æ¥­åœ°åŒºã®è¨­å®š
	if put_addon_name = "Area : Industrial" {
		reservation(mx,my) = "industrial"
	}
	
	return
	
*Build_on_Reservation_area
	//äºˆç´„åœ°åŒºã«å»ºç‰©ã‚’å»ºè¨­
	
		//ä»–ã®å»ºç‰©ã‚’å»ºè¨­ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹å ´åˆã¯return
			if put_addon_name != "" {
				return
			}
	
	;ä½å±…åœ°åŒº
		if instr(reservation(x,y), 0, "residential") != -1 and demand_Residential > 0 {
			demand_Residential -= 1
	
			if reservation(x,y) = "low_density_residential" {
				notesel type_low_density_residential
				rnd_num = rnd(notemax)
				noteget put_addon_name, rnd_num
				
				notesel type_number_low_density_residential
				noteget addon_num_buf, rnd_num
				
			} else : if reservation(x,y) = "high_density_residential" {
				notesel type_high_density_residential
				rnd_num = rnd(notemax)
				noteget put_addon_name, rnd_num
				
				notesel type_number_high_density_residential
				noteget addon_num_buf, rnd_num
				
			}
	
			addon_num_buf = int(addon_num_buf)
	
			from_Build_on_Reservation_area = 1
	
			cursor_mode_tmp = cursor_mode
			cursor_mode = "put_Residential"
			mouse_left = 1
		}
	
	;å•†æ¥­åœ°åŒº
		if instr(reservation(x,y), 0, "commercial") != -1 and demand_Commercial > 0 {
			demand_Commercial -= 1
	
			if reservation(x,y) = "low_density_commercial" {
				notesel type_low_density_commercial
				rnd_num = rnd(notemax)
				noteget put_addon_name, rnd_num
				
				notesel type_number_low_density_commercial
				noteget addon_num_buf, rnd_num
				
			} else : if reservation(x,y) = "high_density_commercial" {
				notesel type_high_density_commercial
				rnd_num = rnd(notemax)
				noteget put_addon_name, rnd_num
				
				notesel type_number_high_density_commercial
				noteget addon_num_buf, rnd_num
				
			}
	
			addon_num_buf = int(addon_num_buf)
	
			from_Build_on_Reservation_area = 1
	
			cursor_mode_tmp = cursor_mode
			cursor_mode = "put_Commercial"
			mouse_left = 1
		}
	
	;ã‚ªãƒ•ã‚£ã‚¹åœ°åŒº
		if instr(reservation(x,y), 0, "office") != -1 and demand_Office > 0 {
			demand_Office -= 1
	
			notesel type_office
			rnd_num = rnd(notemax)
			noteget put_addon_name, rnd_num
			
			notesel type_number_office
			noteget addon_num_buf, rnd_num
	
			addon_num_buf = int(addon_num_buf)
	
			from_Build_on_Reservation_area = 1
	
			cursor_mode_tmp = cursor_mode
			cursor_mode = "put_Office"
			mouse_left = 1
		}
	
	;å·¥æ¥­åœ°åŒº
		if instr(reservation(x,y), 0, "industrial") != -1 and demand_Industrial > 0 {
			demand_Industrial -= 1
	
			notesel type_industrial
			rnd_num = rnd(notemax)
			noteget put_addon_name, rnd_num
			
			notesel type_number_industrial
			noteget addon_num_buf, rnd_num
	
			addon_num_buf = int(addon_num_buf)
	
			from_Build_on_Reservation_area = 1
	
			cursor_mode_tmp = cursor_mode
			cursor_mode = "put_Industrial"
			mouse_left = 1
		}
	
	x_tmp = x : y_tmp = y
	mx_tmp = mx : my_tmp = my
	mx = x : my = y
	gosub *build_obj
	
	x = x_tmp : y = y_tmp
	mx = mx_tmp : my = my_tmp
	
	reservation(x,y) = "none"
	cursor_mode = cursor_mode_tmp
	
	put_addon_name = ""
	addon_num_buf = 0
		
	return
	
*open_menu_addon_menu
	color 0,162,232 : gmode 3,,,200 : boxfa 0, windowy-70-titlebar_h-32-40, windowx, windowy-70-titlebar_h
	
	if cursor_mode = "put_Road" {
		notesel type_number_Two_lane_road
	}
	if cursor_mode = "put_Residential" and density = "low" {
		notesel type_number_low_density_residential
	
		color 127,127,127 : gmode 3,,,200 : boxfa 0, windowy-70-titlebar_h-32-40, 16, windowy-70-titlebar_h
		pos 0, windowy-70-titlebar_h-2-32 : gmode 2 : gcopy 8, 0, 16, 16, 16
		pos 0, windowy-70-titlebar_h-2-16 : gmode 2 : gcopy 9, 0, 0, 16, 16 
	}
	if cursor_mode = "put_Residential" and density = "high" {
		notesel type_number_high_density_residential
	
		color 127,127,127 : gmode 3,,,200 : boxfa 0, windowy-70-titlebar_h-32-40, 16, windowy-70-titlebar_h
		pos 0, windowy-70-titlebar_h-2-32 : gmode 2 : gcopy 8, 0, 0, 16, 16
		pos 0, windowy-70-titlebar_h-2-16 : gmode 2 : gcopy 9, 0, 16, 16, 16
	}
	if cursor_mode = "put_Commercial" and density = "low" {
		notesel type_number_low_density_commercial
	
		color 127,127,127 : gmode 3,,,200 : boxfa 0, windowy-70-titlebar_h-32-40, 16, windowy-70-titlebar_h
		pos 0, windowy-70-titlebar_h-2-32 : gmode 2 : gcopy 20, 0, 16, 16, 16
		pos 0, windowy-70-titlebar_h-2-16 : gmode 2 : gcopy 21, 0, 0, 16, 16 
	}
	if cursor_mode = "put_Commercial" and density = "high" {
		notesel type_number_high_density_commercial
	
		color 127,127,127 : gmode 3,,,200 : boxfa 0, windowy-70-titlebar_h-32-40, 16, windowy-70-titlebar_h
		pos 0, windowy-70-titlebar_h-2-32 : gmode 2 : gcopy 20, 0, 0, 16, 16
		pos 0, windowy-70-titlebar_h-2-16 : gmode 2 : gcopy 21, 0, 16, 16, 16
	}
	if cursor_mode = "put_Office" {
		notesel type_number_office
	}
	if cursor_mode = "put_Industrial" {
		notesel type_number_industrial
	}
	if cursor_mode = "put_Public" {
		notesel type_number_public
	}
	if cursor_mode = "put_Park" {
		notesel type_number_park
	}
	
	if cursor_mode != "put_Road" and cursor_mode != "put_Public" and cursor_mode != "put_Park" {
		p = 1
	} else {
		p = 0
	}
	
	repeat notemax + p
		noteget get_addon_number, cnt - p
	
		gmode 2
	
		if p = 0 or (p = 1 and cnt > 0) {
			if clicked_addon_number != cnt {
				pos 30 + (cnt)*35+10, windowy-70-titlebar_h-32 : gcopy (10001000 + int(get_addon_number)), 0, 0, 32, 32
			}
			if clicked_addon_number = cnt {
				color 255,255,255 : font "", 14
				pos 20, (windowy-70-titlebar_h-32-40+5) : mes addon_jp_name(int(get_addon_number))
				
				color 255,255,255 : font "", 10
				pos 23, (windowy-70-titlebar_h-32-20) : mes addon_summary(int(get_addon_number))
				
				pos 30 + (cnt)*35+10, windowy-70-titlebar_h-32 : gcopy (10001000 + int(get_addon_number)), 0, 32, 32, 64
		
				pointer_icon = int(get_addon_number)
			}
		}
	loop
	
	// åœ°åŒºè¨­å®šã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¡¨ç¤º
	if cursor_mode != "put_Road" and cursor_mode != "put_Public" and cursor_mode != "put_Park" {
	
		gmode 2
		
		if cursor_mode = "put_Residential" {
			if clicked_addon_number = 0 {
				if density = "low" {
					color 255,255,255 : font "", 14
					pos 20, (windowy-70-titlebar_h-32-40+5) : mes "ä½å¯†åº¦ãªä½å±…åœ°åŒº"
					
					color 255,255,255 : font "", 10
					pos 23, (windowy-70-titlebar_h-32-20) : mes "å¸‚æ°‘ãŒä½ã‚€å ´æ‰€ã‚’æä¾›ã—ã¾ã™ã€‚ä½å±…åœ°åŒºã‚’è¨­å®šã™ã‚‹ã¨ä½å±…å»ºç¯‰ç‰©ãŒå»ºè¨­ã•ã‚Œã¾ã™ã€‚"
					
					pos 30 + 10, windowy-70-titlebar_h-32 : gcopy 40, 0, 32, 32, 32
					
					put_addon_name = "Area : low_density_Residential"
					
				} else : if density = "high" {
					color 255,255,255 : font "", 14
					pos 20, (windowy-70-titlebar_h-32-40+5) : mes "é«˜å¯†åº¦ãªä½å±…åœ°åŒº"
					
					color 255,255,255 : font "", 10
					pos 23, (windowy-70-titlebar_h-32-20) : mes "å¸‚æ°‘ãŒä½ã‚€å ´æ‰€ã‚’æä¾›ã—ã¾ã™ã€‚ä½å±…åœ°åŒºã‚’è¨­å®šã™ã‚‹ã¨ä½å±…å»ºç¯‰ç‰©ãŒå»ºè¨­ã•ã‚Œã¾ã™ã€‚"
					
					pos 30 + 10, windowy-70-titlebar_h-32 : gcopy 40, 0, 32, 32, 32
					
					put_addon_name = "Area : high_density_Residential"
				}
				pointer_icon = 22
				
			} else {
				pos 30 + 10, windowy-70-titlebar_h-32 : gcopy 40, 0, 0, 32, 32
			}
		}
	
		if cursor_mode = "put_Commercial" {
			if clicked_addon_number = 0 {
				if density = "low" {
					color 255,255,255 : font "", 14
					pos 20, (windowy-70-titlebar_h-32-40+5) : mes "ä½å¯†åº¦ãªå•†æ¥­åœ°åŒº"
					
					color 255,255,255 : font "", 10
					pos 23, (windowy-70-titlebar_h-32-20) : mes "å¸‚æ°‘ãŒå•†æ¥­ã‚’å–¶ã‚€å ´æ‰€ã‚’æä¾›ã—ã¾ã™ã€‚å•†æ¥­åœ°åŒºã‚’è¨­å®šã™ã‚‹ã¨å•†æ¥­å»ºç¯‰ç‰©ãŒå»ºè¨­ã•ã‚Œã¾ã™ã€‚"
					
					pos 30 + 10, windowy-70-titlebar_h-32 : gcopy 41, 0, 32, 32, 32
					
					put_addon_name = "Area : low_density_Commercial"
					
				} else : if density = "high" {
					color 255,255,255 : font "", 14
					pos 20, (windowy-70-titlebar_h-32-40+5) : mes "é«˜å¯†åº¦ãªå•†æ¥­åœ°åŒº"
					
					color 255,255,255 : font "", 10
					pos 23, (windowy-70-titlebar_h-32-20) : mes "å¸‚æ°‘ãŒå•†æ¥­ã‚’å–¶ã‚€å ´æ‰€ã‚’æä¾›ã—ã¾ã™ã€‚å•†æ¥­åœ°åŒºã‚’è¨­å®šã™ã‚‹ã¨å•†æ¥­å»ºç¯‰ç‰©ãŒå»ºè¨­ã•ã‚Œã¾ã™ã€‚"
					
					pos 30 + 10, windowy-70-titlebar_h-32 : gcopy 41, 0, 32, 32, 32
					
					put_addon_name = "Area : high_density_Commercial"
				}
				pointer_icon = 23
				
			} else {
				pos 30 + 10, windowy-70-titlebar_h-32 : gcopy 41, 0, 0, 32, 32
			}
		}
	
		if cursor_mode = "put_Office" {
			if clicked_addon_number = 0 {
				color 255,255,255 : font "", 14
				pos 20, (windowy-70-titlebar_h-32-40+5) : mes "ã‚ªãƒ•ã‚£ã‚¹åœ°åŒº"
				
				color 255,255,255 : font "", 10
				pos 23, (windowy-70-titlebar_h-32-20) : mes "å¸‚æ°‘ãŒä»•äº‹ã™ã‚‹å ´ã‚’æä¾›ã—ã¾ã™ã€‚ã‚ªãƒ•ã‚£ã‚¹åœ°åŒºã‚’è¨­å®šã™ã‚‹ã¨ã‚ªãƒ•ã‚£ã‚¹å»ºç¯‰ç‰©ãŒå»ºè¨­ã•ã‚Œã¾ã™ã€‚"
				
				pos 30 + 10, windowy-70-titlebar_h-32 : gcopy 42, 0, 32, 32, 32
				
				put_addon_name = "Area : office"
				
				pointer_icon = 24
				
			} else {
				pos 30 + 10, windowy-70-titlebar_h-32 : gcopy 42, 0, 0, 32, 32
			}
		}
	
		if cursor_mode = "put_Industrial" {
			if clicked_addon_number = 0 {
				color 255,255,255 : font "", 14
				pos 20, (windowy-70-titlebar_h-32-40+5) : mes "å·¥æ¥­åœ°åŒº"
				
				color 255,255,255 : font "", 10
				pos 23, (windowy-70-titlebar_h-32-20) : mes "å¸‚æ°‘ãŒãƒ¢ãƒã‚’ç”Ÿç”£ã™ã‚‹å ´ã‚’æä¾›ã—ã¾ã™ã€‚å·¥æ¥­åœ°åŒºã‚’è¨­å®šã™ã‚‹ã¨å·¥æ¥­å»ºç¯‰ç‰©ãŒå»ºè¨­ã•ã‚Œã¾ã™ã€‚"
				
				pos 30 + 10, windowy-70-titlebar_h-32 : gcopy 43, 0, 32, 32, 32
	
				put_addon_name = "Area : Industrial"
				pointer_icon = 25
				
			} else {
				pos 30 + 10, windowy-70-titlebar_h-32 : gcopy 43, 0, 0, 32, 32
			}
		}
	
	}
	
	return
		
*adjustment_road
	if instr(put_addon_name, 0, "road") = -1 {
		return
	}
	
	if (category_buf = "road" and (cursor_mode = "put_Road" or cursor_mode = "bulldozer")) or from_build_obj = 1 {
	
		if from_delete_obj = 0 {
			gosub *delete_obj
		}
		
		from_delete_obj = 0
		from_build_obj = 0
		
		//ç¸¦å‘ã
			if left_chip != "road" and top_chip = "road" and bottom_chip = "road" and right_chip != "road" {
				obj_type(x, y) = element2( put_addon_name, use_type, addon_total_use_types, "default")
				obj_dire(x, y) = element3( put_addon_name, use_type, addon_total_use_types, "default", addon_direction, addon_total_addon_direction, "width")
			}
	
		//æ¨ªå‘ã
			if left_chip = "road" and top_chip != "road" and bottom_chip != "road" and right_chip = "road" {
				obj_type(x, y) = element2( put_addon_name, use_type, addon_total_use_types, "default")
				obj_dire(x, y) = element3( put_addon_name, use_type, addon_total_use_types, "default", addon_direction, addon_total_addon_direction, "depth")
			}
	
		//è¡Œãæ­¢ã¾ã‚Š
			if left_chip = "road" and top_chip != "road" and bottom_chip != "road" and right_chip != "road" {
				obj_type(x, y) = element2( put_addon_name, use_type, addon_total_use_types, "dead_end")
				obj_dire(x, y) = element3( put_addon_name, use_type, addon_total_use_types, "dead_end", addon_direction, addon_total_addon_direction, "left")
			}
			if left_chip != "road" and top_chip = "road" and bottom_chip != "road" and right_chip != "road" {
				obj_type(x, y) = element2( put_addon_name, use_type, addon_total_use_types, "dead_end")
				obj_dire(x, y) = element3( put_addon_name, use_type, addon_total_use_types, "dead_end", addon_direction, addon_total_addon_direction, "top")
			}
			if left_chip != "road" and top_chip != "road" and bottom_chip = "road" and right_chip != "road" {
				obj_type(x, y) = element2( put_addon_name, use_type, addon_total_use_types, "dead_end")
				obj_dire(x, y) = element3( put_addon_name, use_type, addon_total_use_types, "dead_end", addon_direction, addon_total_addon_direction, "bottom")
			}
			if left_chip != "road" and top_chip != "road" and bottom_chip != "road" and right_chip = "road" {
				obj_type(x, y) = element2( put_addon_name, use_type, addon_total_use_types, "dead_end")
				obj_dire(x, y) = element3( put_addon_name, use_type, addon_total_use_types, "dead_end", addon_direction, addon_total_addon_direction, "right")
			}
	
		//æ›²ãŒã‚Šè§’
			if left_chip = "road" and top_chip = "road" and bottom_chip != "road" and right_chip != "road" {
				obj_type(x, y) = element2( put_addon_name, use_type, addon_total_use_types, "turn")
				obj_dire(x, y) = element3( put_addon_name, use_type, addon_total_use_types, "turn", addon_direction, addon_total_addon_direction, "left-top")
			}
			if left_chip != "road" and top_chip = "road" and bottom_chip != "road" and right_chip = "road" {
				obj_type(x, y) = element2( put_addon_name, use_type, addon_total_use_types, "turn")
				obj_dire(x, y) = element3( put_addon_name, use_type, addon_total_use_types, "turn", addon_direction, addon_total_addon_direction, "right-top")
			}
			if left_chip = "road" and top_chip != "road" and bottom_chip = "road" and right_chip != "road" {
				obj_type(x, y) = element2( put_addon_name, use_type, addon_total_use_types, "turn")
				obj_dire(x, y) = element3( put_addon_name, use_type, addon_total_use_types, "turn", addon_direction, addon_total_addon_direction, "left-bottom")
			}
			if left_chip != "road" and top_chip != "road" and bottom_chip = "road" and right_chip = "road" {
				obj_type(x, y) = element2( put_addon_name, use_type, addon_total_use_types, "turn")
				obj_dire(x, y) = element3( put_addon_name, use_type, addon_total_use_types, "turn", addon_direction, addon_total_addon_direction, "right-bottom")
			}
	
		//Tå­—å‹äº¤å·®ç‚¹
			if left_chip = "road" and top_chip = "road" and bottom_chip = "road" and right_chip != "road" {
				obj_type(x, y) = element2( put_addon_name, use_type, addon_total_use_types, "intersection_T")
				obj_dire(x, y) = element3( put_addon_name, use_type, addon_total_use_types, "intersection_T", addon_direction, addon_total_addon_direction, "left-top-bottom")
			}
			if left_chip = "road" and top_chip = "road" and bottom_chip != "road" and right_chip = "road" {
				obj_type(x, y) = element2( put_addon_name, use_type, addon_total_use_types, "intersection_T")
				obj_dire(x, y) = element3( put_addon_name, use_type, addon_total_use_types, "intersection_T", addon_direction, addon_total_addon_direction, "left-right-top")
			}
			if left_chip = "road" and top_chip != "road" and bottom_chip = "road" and right_chip = "road" {
				obj_type(x, y) = element2( put_addon_name, use_type, addon_total_use_types, "intersection_T")
				obj_dire(x, y) = element3( put_addon_name, use_type, addon_total_use_types, "intersection_T", addon_direction, addon_total_addon_direction, "left-right-bottom")
			}
			if left_chip != "road" and top_chip = "road" and bottom_chip = "road" and right_chip = "road" {
				obj_type(x, y) = element2( put_addon_name, use_type, addon_total_use_types, "intersection_T")
				obj_dire(x, y) = element3( put_addon_name, use_type, addon_total_use_types, "intersection_T", addon_direction, addon_total_addon_direction, "right-top-bottom")
			}
	
		//åå­—å‹äº¤å·®ç‚¹
			if left_chip = "road" and top_chip = "road" and bottom_chip = "road" and right_chip = "road" {
				obj_type(x, y) = element2( put_addon_name, use_type, addon_total_use_types, "intersection_cross")
				obj_dire(x, y) = element3( put_addon_name, use_type, addon_total_use_types, "intersection_cross", addon_direction, addon_total_addon_direction, "null")
			}
	
		//1ãƒã‚¹ã ã‘å­¤ç«‹ã—ãŸï¼ˆå‘¨ã‚Šã«æ¥ç¶šã™ã‚‹é“è·¯ãŒãªã„ï¼‰é“è·¯ã®å ´åˆã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆã‚¿ã‚¤ãƒ«ã‚’è¡¨ç¤º
			if left_chip != "road" and top_chip != "road" and bottom_chip != "road" and right_chip != "road" {
				obj_type(x, y) = element2( put_addon_name, use_type, addon_total_use_types, "intersection_cross")
				obj_dire(x, y) = element3( put_addon_name, use_type, addon_total_use_types, "intersection_cross", addon_direction, addon_total_addon_direction, "null")
			}
	
	}
	
	return
	
*load_adat
	notesel buf_adat
			
	use_types_buf = get_chapter(buf_adat, "use_types", " = \"", "\"")
	
	//adat_use_typesã‚’æ›´ã«ã‚¿ã‚¤ãƒ—ã”ã¨ã«åˆ†ã‘ã‚‹
		split use_types_buf, ", ", use_type_buf
	
		repeat stat
			use_type(addon_number, cnt) = use_type_buf(cnt)
			await 1
		loop
				
	//ã‚¿ã‚¤ãƒ—ã®æ•°ã‚’å–å¾—
		addon_total_use_types(addon_number) = stat
				
	//å„ã‚¿ã‚¤ãƒ—ã”ã¨ã®æ¦‚è¦ã‚’å–å¾—
	
		//å–å¾—é–‹å§‹
		repeat addon_total_use_types(addon_number)
			use_type_summary = get_chapter(buf_adat, ""+use_type(addon_number, cnt)+" {", " {", ";")
	
			//ä½¿ç”¨ã™ã‚‹ç”»åƒã®å–å¾—ï¼ˆimageï¼‰
				addon_image(addon_number, cnt) = get_chapter(use_type_summary, "image", " = \"", "\"")
						
			//ã‚¿ã‚¤ãƒ—ã®å‘ãã‚’å–å¾—ï¼ˆdirectionï¼‰
				addon_direction_buf = get_chapter(use_type_summary, "direction", " = \"", "\"")
						
				split addon_direction_buf, ", ", addon_direction_buf_2
	
				load_adat_cnt = cnt
	
				addon_total_addon_direction(addon_number, cnt) = stat
	
				repeat addon_total_addon_direction(addon_number, load_adat_cnt)
					addon_direction(addon_number, load_adat_cnt, cnt) = addon_direction_buf_2(cnt)
	
					addon_direction_summary = get_chapter(use_type_summary, ""+addon_direction(addon_number, load_adat_cnt, cnt)+" {", " {", "}")
	
					//ã‚µã‚¤ã‚ºã‚’å–å¾—ï¼ˆsize_x, size_yï¼‰
						addon_size_x_buf(addon_number, load_adat_cnt, cnt) = get_chapter(addon_direction_summary, "size_x", " = \"", "\"")
						addon_size_y_buf(addon_number, load_adat_cnt, cnt) = get_chapter(addon_direction_summary, "size_y", " = \"", "\"")
										
						addon_size_x(addon_number, load_adat_cnt, cnt) = int(addon_size_x_buf(addon_number, load_adat_cnt, cnt))
						addon_size_y(addon_number, load_adat_cnt, cnt) = int(addon_size_y_buf(addon_number, load_adat_cnt, cnt))
	
					//ãƒãƒƒãƒ—ã®ã‚²ãƒ¼ãƒ ä¸Šã®åº§æ¨™ã‚µã‚¤ã‚ºã‚’å–å¾—ï¼ˆchip_x, chip_yï¼‰
						addon_chip_x_buf(addon_number, load_adat_cnt, cnt) = get_chapter(addon_direction_summary, "chip_x", " = \"", "\"")
						addon_chip_y_buf(addon_number, load_adat_cnt, cnt) = get_chapter(addon_direction_summary, "chip_y", " = \"", "\"")
										
						addon_chip_x(addon_number, load_adat_cnt, cnt) = int(addon_chip_x_buf(addon_number, load_adat_cnt, cnt))
						addon_chip_y(addon_number, load_adat_cnt, cnt) = int(addon_chip_y_buf(addon_number, load_adat_cnt, cnt))
	
					//ãƒãƒƒãƒ—ã®å·¦ä¸Šã®åº§æ¨™ã‚’å–å¾—ï¼ˆtop_left_x, top_left_yï¼‰
						addon_top_left_x_buf(addon_number, load_adat_cnt, cnt) = get_chapter(addon_direction_summary, "top_left_x", " = \"", "\"")
						addon_top_left_y_buf(addon_number, load_adat_cnt, cnt) = get_chapter(addon_direction_summary, "top_left_y", " = \"", "\"")
										
						addon_top_left_x(addon_number, load_adat_cnt, cnt) = int(addon_top_left_x_buf(addon_number, load_adat_cnt, cnt))
						addon_top_left_y(addon_number, load_adat_cnt, cnt) = int(addon_top_left_y_buf(addon_number, load_adat_cnt, cnt))
	
					//ãƒãƒƒãƒ—ã®å³ä¸‹ã®åº§æ¨™ã‚’å–å¾—ï¼ˆbottom_right_x, bottom_right_yï¼‰
						addon_bottom_right_x_buf(addon_number, load_adat_cnt, cnt) = get_chapter(addon_direction_summary, "bottom_right_x", " = \"", "\"")
						addon_bottom_right_y_buf(addon_number, load_adat_cnt, cnt) = get_chapter(addon_direction_summary, "bottom_right_y", " = \"", "\"")
										
						addon_bottom_right_x(addon_number, load_adat_cnt, cnt) = int(addon_bottom_right_x_buf(addon_number, load_adat_cnt, cnt))
						addon_bottom_right_y(addon_number, load_adat_cnt, cnt) = int(addon_bottom_right_y_buf(addon_number, load_adat_cnt, cnt))
									
					await 1
				loop
		
			wait 1
		loop
	
	return
	
*play_BGM
	//ç¾åœ¨å†ç”Ÿã—ã¦ã„ã‚‹BGMã®ç¾åœ¨ã®å†ç”Ÿä½ç½®ã¨æ›²ã®é•·ã•ã‚’å–å¾—
		mci"status Cities-Box position"
		BGM_Position = stat		; ç¾åœ¨ã®å†ç”Ÿä½ç½®
			
		mci "status Cities-Box length"
		BGM_Length = stat		; æ›²ã®é•·ã•
	
	//å†ç”Ÿä½ç½®ãŒæ›²ã®é•·ã•ã¨åŒã˜ãªã‚‰æ¬¡ã®BGMã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸å‡º
		if BGM_Position = BGM_Length {	
			chdir directory
			chdir "bgm"
	
			mci "close Cities-Box"
					
			//ãƒ‘ã‚¹åã‚’å«ã‚ãŸãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’å–å¾—
				dirlist2h 1, ','
				dirlist2 buf_BGMs, "*.mp3*", 1, '\\'
					
				sdim BGM_filelist, buf_BGMs
				dirlist2r BGM_filelist
		
				notesel BGM_filelist
				total_BGMs = notemax
			
			chdir directory
			
			//ãƒ©ãƒ³ãƒ€ãƒ ã«é¸å‡º
				randomize
	
				repeat
					BGM_rnd = rnd(total_BGMs)
					
					//ç¾åœ¨å†ç”Ÿã—ã¦ã„ã‚‹BGMã¨åŒã˜æ›²ã§ãªã„ã“ã¨ã¨ã€ç‰¹å®šã®æ¡ä»¶ä¸‹ã®ã¿ã§æµã‚Œã‚‹BGMï¼ˆãƒ•ã‚¡ã‚¤ãƒ«åã«[Sp]ãŒã‚ã‚‹ï¼‰ã§ãªã„ã“ã¨ã‚’ç¢ºèª
						notesel BGM_filelist
						noteget next_BGM_file, BGM_rnd
						
						if next_BGM_file != playing_BGM_file {
							if instr(next_BGM_file, 0, "[Sp]") = -1 {
								playing_BGM_file = next_BGM_file
								break
							}
						}
	
					await 1
				loop
	
			//ã‚‚ã—ãƒãƒƒãƒ—ä½œæˆç›´å¾Œãªã‚‰ã€ãƒãƒƒãƒ—ä½œæˆæ™‚ã®BGMã‚’æµã™
				if Not_Played_NewMap_BGM = 1 {
					Not_Played_NewMap_BGM = 0
					playing_BGM_file = "[Sp]PROKOFIEV-PeterAndTheWolf.mp3"
				}
	
			//å¤©æ°—ãŒé›¨ãªã‚‰ã€1/3ã®ç¢ºç‡ã§ãƒ©ãƒ³ãƒ€ãƒ ã§é›¨ã£ã½ã„æ›²ã‚’æµã™
				if add_rain > 0 {
					if rnd(3) = 2 {
						p = rnd(2)
	
						if p = 0 {
							playing_BGM_file = "[Sp]Satie-Jeteveux.mp3"
						} else : p = 1 {
							playing_BGM_file = "[Sp]Rainy_Day.mp3"
						}
					}
				}
	
			//å†ç”Ÿ
				mci"open \""+directory+"\\bgm\\"+playing_BGM_file+"\" alias Cities-Box"	; é–‹ã
				mci"play Cities-Box"													; å†ç”Ÿ
	
				changed_BGM = 1
		}
	
		; ãƒœãƒªãƒ¥ãƒ¼ãƒ 
		if Set_Play_BGM = 0 {
			mci "setaudio Cities-Box volume to 0"
		} else {
			mci "setaudio Cities-Box volume to 1000"
		}
	
		return
	
*get_windowsize
	//ç¾åœ¨ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºã‚’å–å¾—
		windowx = ginfo_sizex
		windowy = ginfo_sizey
	
	//ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å·¦æ ã®æ¨ªå¹…ã¨ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼ã®é«˜ã•ã‚’å–å¾—
		dim rc, 2
		rc(0) = 0
		rc(1) = 0
		ClientToScreen hwnd, varptr(rc)
		
		window_left_breadth = rc(0) - ginfo_wx1
		titlebar_h = rc(1) - ginfo_wy1
	
	return
	
*fluctuation
	//äººå£ãƒ»åŠ´åƒäººå£ãƒ»éœ€è¦åº¦ãªã©ã‚’å¢—æ¸›
	
		//æ¯æ—¥åˆå‰0æ™‚ã«å¢—æ¸›
			if time_Hour != 0 or time_Minutes != 0 {
				return
			}
	
		//å¤‰æ•°åˆæœŸåŒ–
			before_residents = 0
			before_workers_Commericial = 0
			before_workers_Office = 0
			before_workers_Industrial = 0
			before_workers_Public = 0
	
		//äººå£ã®å¢—æ¸›
			if category(x,y) = "residential" {
				//ä½æ°‘æ•°ã‚’å¢—ã‚„ã™ã‹ãƒ»æ¸›ã‚‰ã™ã‹ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«æ±ºã‚ã‚‹ï¼ˆéœ€è¦åº¦ã«ã‚ˆã£ã¦ç¢ºç‡ãŒå¤‰å‹•ã™ã‚‹ï¼‰
					rndv = 10+(demand_Residential/10)
					f = rnd(rndv)+1		; fã®å€¤ã¯ä½å±…åœ°åŒºã®éœ€è¦åº¦ãŒ100ï¼…ãªã‚‰20ï½0
						
				//å¤‰æ›´å‰ã®ä½å±…åœ°åŒºã®ä½æ°‘æ•°
					before_residents = residents(x,y)
		
				//äººå£ã®å¢—æ¸›å‡¦ç†
					if f < 10+(demand_Residential/10) {
						//å„ä½å±…åœ°åŒºã«ä½•äººå¢—ã‚„ã™ã‹
							if addon_maximum_capacity(map(x,y)) - before_residents > 0 {
								add_residents = rnd(addon_maximum_capacity(map(x,y)) - before_residents)
								residents(x,y) = before_residents + add_residents
							}
					}
				
					if f > 10+(demand_Residential/10) {
						//å„ä½å±…åœ°åŒºã§ä½•äººæ¸›ã‚‰ã™ã‹
							if before_residents > 0 {
								cut_residents = rnd(before_residents)
								residents(x,y) = before_residents - cut_residents
							}
					}
				
					if residents(x,y) < 0 {
						residents(x,y) = 0
					}
		
				//ç·äººå£æ•°ã«ã‚‚åæ˜ 
					Total_Population = Total_Population - before_residents + residents(x,y)
			}
	
		//å•†æ¥­åŒºç”»ã®åŠ´åƒäººå£ã®å¢—æ¸›
			if category(x,y) = "commercial" {
				//åŠ´åƒäººå£ã‚’å¢—ã‚„ã™ã‹ãƒ»æ¸›ã‚‰ã™ã‹ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«æ±ºã‚ã‚‹ï¼ˆéœ€è¦åº¦ã«ã‚ˆã£ã¦ç¢ºç‡ãŒå¤‰å‹•ã™ã‚‹ï¼‰
					rndv = 10+(demand_Commercial/10)
					f = rnd(rndv)+1		; fã®å€¤ã¯å•†æ¥­åœ°åŒºã®éœ€è¦åº¦ãŒ100ï¼…ãªã‚‰20ï½0
					f2 = 0
						
				//å¤‰æ›´å‰ã®å•†æ¥­åŒºç”»ã®åŠ´åƒè€…æ•°
					before_workers_Commercial = workers_Commercial(x,y)
		
				//å¢—æ¸›å‡¦ç†
					if f < 10+(demand_Commercial/10) {
						//å„å•†æ¥­åœ°åŒºã«ä½•äººå¢—ã‚„ã™ã‹
							if addon_maximum_capacity(map(x,y)) - before_workers_Commercial > 0 {
								add_workers = rnd(addon_maximum_capacity(map(x,y)) - before_workers_Commercial)
								//ç·äººå£ã‚’è¶Šã•ãªã„ã“ã¨ã‚’ç¢ºèª
									if Total_workers_Commercial + add_workers < Total_Population {
										workers_Commercial(x,y) = before_workers_Commercial + add_workers
									} else {
										f2 = 1
									}
							}
					}
				
					if f > 10+(demand_Commercial/10) or f2 = 1 {
						//å„å•†æ¥­åœ°åŒºã§ä½•äººæ¸›ã‚‰ã™ã‹
							if before_workers_Commercial > 0 {
								cut_workers = rnd(before_workers_Commercial)
								workers_Commercial(x,y) = before_workers_Commercial - cut_workers
							}
					}
				
					if workers_Commercial(x,y) < 0 {
						workers_Commercial(x,y) = 0
					}
		
				//ç·åŠ´åƒäººå£æ•°ã«ã‚‚åæ˜ 
					Total_workers_Commercial = Total_workers_Commercial - before_workers_Commercial + workers_Commercial(x,y)
			}
	
		//ã‚ªãƒ•ã‚£ã‚¹åŒºç”»ã®åŠ´åƒäººå£ã®å¢—æ¸›
			if category(x,y) = "office" {
				//åŠ´åƒäººå£ã‚’å¢—ã‚„ã™ã‹ãƒ»æ¸›ã‚‰ã™ã‹ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«æ±ºã‚ã‚‹ï¼ˆéœ€è¦åº¦ã«ã‚ˆã£ã¦ç¢ºç‡ãŒå¤‰å‹•ã™ã‚‹ï¼‰
					rndv = 10+(demand_Office/10)
					f = rnd(rndv)+1		; fã®å€¤ã¯ã‚ªãƒ•ã‚£ã‚¹åœ°åŒºã®éœ€è¦åº¦ãŒ100ï¼…ãªã‚‰20ï½0
					f2 = 0
						
				//å¤‰æ›´å‰ã®ã‚ªãƒ•ã‚£ã‚¹åŒºç”»ã®åŠ´åƒè€…æ•°
					before_workers_Office = workers_Office(x,y)
		
				//å¢—æ¸›å‡¦ç†
					if f < 10+(demand_Office/10) {
						//å„ã‚ªãƒ•ã‚£ã‚¹åœ°åŒºã«ä½•äººå¢—ã‚„ã™ã‹
							if addon_maximum_capacity(map(x,y)) - before_workers_Office > 0 {
								add_workers = rnd(addon_maximum_capacity(map(x,y)) - before_workers_Office)
								//ç·äººå£ã‚’è¶Šã•ãªã„ã“ã¨ã‚’ç¢ºèª
									if Total_workers_Office + add_workers < Total_Population {
										workers_Office(x,y) = before_workers_Office + add_workers
									} else {
										f2 = 1
									}
							}
					}
				
					if f > 10+(demand_Office/10) or f2 = 1 {
						//å„ã‚ªãƒ•ã‚£ã‚¹åœ°åŒºã§ä½•äººæ¸›ã‚‰ã™ã‹
							if before_workers_Office > 0 {
								cut_workers = rnd(before_workers_Office)
								workers_Office(x,y) = before_workers_Office - cut_workers
							}
					}
				
					if workers_Office(x,y) < 0 {
						workers_Office(x,y) = 0
					}
		
				//ç·åŠ´åƒäººå£æ•°ã«ã‚‚åæ˜ 
					Total_workers_Office = Total_workers_Office - before_workers_Office + workers_Office(x,y)
			}
	
		//å·¥æ¥­åŒºç”»ã®åŠ´åƒäººå£ã®å¢—æ¸›
			if category(x,y) = "industrial" {
				//åŠ´åƒäººå£ã‚’å¢—ã‚„ã™ã‹ãƒ»æ¸›ã‚‰ã™ã‹ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«æ±ºã‚ã‚‹ï¼ˆéœ€è¦åº¦ã«ã‚ˆã£ã¦ç¢ºç‡ãŒå¤‰å‹•ã™ã‚‹ï¼‰
					rndv = 10+(demand_Industrial/10)
					f = rnd(rndv)+1		; fã®å€¤ã¯å·¥æ¥­åœ°åŒºã®éœ€è¦åº¦ãŒ100ï¼…ãªã‚‰20ï½0
					f2 = 0
						
				//å¤‰æ›´å‰ã®å·¥æ¥­åŒºç”»ã®åŠ´åƒè€…æ•°
					before_workers_Industrial = workers_Industrial(x,y)
		
				//å¢—æ¸›å‡¦ç†
					if f < 10+(demand_Industrial/10) {
						//å„å·¥æ¥­åœ°åŒºã«ä½•äººå¢—ã‚„ã™ã‹
							if addon_maximum_capacity(map(x,y)) - before_workers_Industrial > 0 {
								add_workers = rnd(addon_maximum_capacity(map(x,y)) - before_workers_Industrial)
								//ç·äººå£ã‚’è¶Šã•ãªã„ã“ã¨ã‚’ç¢ºèª
									if Total_workers_Industrial + add_workers < Total_Population {
										workers_Industrial(x,y) = before_workers_Industrial + add_workers
									} else {
										f2 = 1
									}
							}
					}
				
					if f > 10+(demand_Industrial/10) or f2 = 1 {
						//å„å·¥æ¥­åœ°åŒºã§ä½•äººæ¸›ã‚‰ã™ã‹
							if before_workers_Industrial > 0 {
								cut_workers = rnd(before_workers_Industrial)
								workers_Industrial(x,y) = before_workers_Industrial - cut_workers
							}
					}
				
					if workers_Industrial(x,y) < 0 {
						workers_Industrial(x,y) = 0
					}
		
				//ç·åŠ´åƒäººå£æ•°ã«ã‚‚åæ˜ 
					Total_workers_Industrial = Total_workers_Industrial - before_workers_Industrial + workers_Industrial(x,y)
			}
	
		//å…¬å…±æ–½è¨­ã®åŠ´åƒäººå£ã®å¢—æ¸›
			if category(x,y) = "public" {
				//åŠ´åƒäººå£ã‚’å¢—ã‚„ã™ã‹ãƒ»æ¸›ã‚‰ã™ã‹ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«æ±ºã‚ã‚‹ï¼ˆéœ€è¦åº¦ã«ã‚ˆã£ã¦ç¢ºç‡ãŒå¤‰å‹•ã™ã‚‹ï¼‰
					f = rnd(2)
					f2 = 0
						
				//å¤‰æ›´å‰ã®å…¬å…±æ–½è¨­ã®åŠ´åƒè€…æ•°
					before_workers_Public = workers_Public(x,y)
		
				//å¢—æ¸›å‡¦ç†
					if f = 0 {
						//å„å…¬å…±æ–½è¨­ã«ä½•äººå¢—ã‚„ã™ã‹
							if addon_maximum_capacity(map(x,y)) - before_workers_Public > 0 {
								add_workers = rnd(addon_maximum_capacity(map(x,y)) - before_workers_Public)
								//ç·äººå£ã‚’è¶Šã•ãªã„ã“ã¨ã‚’ç¢ºèª
									if Total_workers_Public + add_workers < Total_Population {
										workers_Public(x,y) = before_workers_Public + add_workers
									} else {
										f2 = 1
									}
							}
					}
				
					if f = 1 {
						//å„å…¬å…±æ–½è¨­ã§ä½•äººæ¸›ã‚‰ã™ã‹
							if before_workers_Public > 0 or f2 = 1 {
								cut_workers = rnd(before_workers_Public)
								workers_Public(x,y) = before_workers_Public - cut_workers
							}
					}
				
					if workers_Public(x,y) < 0 {
						workers_Public(x,y) = 0
					}
		
				//ç·åŠ´åƒäººå£æ•°ã«ã‚‚åæ˜ 
					Total_workers_Public = Total_workers_Public - before_workers_Public + workers_Public(x,y)
			}
	
		//éœ€è¦åº¦ã‚’å¢—æ¸›
			//ç·æ±‚äººæ•°ã‚’å–å¾—
				before_Vacancies = Vacancies
				Vacancies = (total_Commercial_maximum_capacity-Total_workers_Commercial) + (total_Office_maximum_capacity-Total_workers_Office) + (total_Industrial_maximum_capacity-Total_workers_Industrial) + (total_Public_maximum_capacity-Total_workers_Public)
				
			//ç·æµ®æµªè€…æ•°ã‚’å–å¾—
				before_Vagrants = Vagrants
				Total_Vagrants = Total_Population - Total_workers_Commercial - Total_workers_Office - Total_workers_Industrial - Total_workers_Public
	
				if Total_Vagrants < 0 {
					Total_Vagrants = 0
				}
				
			//RCOIéœ€è¦ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’å¤‰å‹•
				if Vacancies > 0 and Total_Vagrants >= 0 {
					if Total_Population > 0 {
						demand_Residential 	= 100 - ((Total_Population / Vacancies) * 100) + Special_demand_Residential
					} else {
						demand_Residential 	= 100
					}
					if Total_Commercial_maximum_capacity > 0 {
						demand_Commercial 	-= rnd(20) - 10  + Special_demand_Commercial
						if demand_Commercial > 100 {
							demand_Commercial = 100
						} else : if demand_Commercial < 0 {
							demand_Commercial = 0
						}
					} else {
						demand_Commercial 	= 100
					}
					if Total_Office_maximum_capacity > 0 {
						demand_Office 		-= rnd(20) - 10  + Special_demand_Office
						if demand_Office > 100 {
							demand_Office = 100
						} else : if demand_Office < 0 {
							demand_Office = 0
						}
					} else {
						demand_Office 		= 100
					}
					if Total_Industrial_maximum_capacity > 0 {
						demand_Industrial 	-= rnd(20) - 10  + Special_demand_Industrial
						if demand_Industrial > 100 {
							demand_Industrial = 100
						} else : if demand_Industrial < 0 {
							demand_Industrial = 0
						}
					} else {
						demand_Industrial 	= 100
					}
				}
	
	return
	
*climate
	//å¤©å€™ã®å¤‰å‹•
		randomize
	
		//æ°—æ¸©ã®å¤‰å‹•
			change_temperature = rnd(5)
	
			if change_temperature = 0 {
				
				//æ—¥ä¸­ã¯æ°—æ¸©ãŒä¸ŠãŒã‚Šã‚„ã™ãã€å¤œé–“ã¯ä¸‹ãŒã‚Šã‚„ã™ãã™ã‚‹
					temperature_increase_or_decrease = rnd(8)
			
					//æ—¥ä¸­
						if 8 <= time_Hour and 14 >= time_Hour {
							if 0 <= temperature_increase_or_decrease and 5 >= temperature_increase_or_decrease {
								temperature_increase = 1
								temperature_decrease = 0
							}
							if 6 <= temperature_increase_or_decrease and 7 >= temperature_increase_or_decrease {
								temperature_increase = 0
								temperature_decrease = 1
							}
			
					//å¤œé–“
						} else {
							if 0 <= temperature_increase_or_decrease and 1 >= temperature_increase_or_decrease {
								temperature_increase = 1
								temperature_decrease = 0
							}
							if 2 <= temperature_increase_or_decrease and 7 >= temperature_increase_or_decrease {
								temperature_increase = 0
								temperature_decrease = 1
							}
						}
				
				//12æœˆï½2æœˆï¼š-10â„ƒï½15â„ƒã®ç¯„å›²ã§æ°—æ¸©ã‚’å¤‰å‹•
					if time_Month = 12 or (1 <= time_Month and 2 >= time_Month) {
						
						if temperature_increase = 1 {
							if temperature < 15 {
								temperature ++
							}
						}
						if temperature_decrease = 1 {
							if temperature > -10 {
								temperature --
							}
						}
						
					}
			
				//3æœˆï½5æœˆï¼š10â„ƒï½25â„ƒã®ç¯„å›²ã§æ°—æ¸©ã‚’å¤‰å‹•
					if 3 <= time_Month and 5 >= time_Month {
						
						if temperature_increase = 1 {
							if temperature < 25 {
								temperature ++
							}
						}
						if temperature_decrease = 1 {
							if temperature > 10 {
								temperature --
							}
						}
						
					}
			
				//6æœˆï½8æœˆï¼š20â„ƒï½35â„ƒã®ç¯„å›²ã§æ°—æ¸©ã‚’å¤‰å‹•
					if 6 <= time_Month and 8 >= time_Month {
						
						if temperature_increase = 1 {
							if temperature < 35 {
								temperature ++
							}
						}
						if temperature_decrease = 1 {
							if temperature > 20 {
								temperature --
							}
						}
						
					}
			
				//9æœˆï½11æœˆï¼š10â„ƒï½25â„ƒã®ç¯„å›²ã§æ°—æ¸©ã‚’å¤‰å‹•
					if 9 <= time_Month and 11 >= time_Month {
						
						if temperature_increase = 1 {
							if temperature < 25 {
								temperature ++
							}
						}
						if temperature_decrease = 1 {
							if temperature > 10 {
								temperature --
							}
						}
						
					}
			}
	
		//å¤©æ°—ã®å¤‰å‹•
			//é›¨ãƒ»é›ªã®è¡¨ç¤ºã€æ°—æ¸©ã®å¤‰å‹•
				if Set_Change_Weather = 1 {
					randomize
									
					add_rain_increase_or_decrease = rnd(2)
			
					if add_rain_increase_or_decrease = 0 {
						add_rain --
					} else : add_rain_increase_or_decrease = 1 {
						add_rain ++
					}
						
					repeat 100
						if rain_y(cnt) >= windowy or rain(cnt) = 0 {
							rain_increase_or_decrease = rnd(2)
								
							if rain_increase_or_decrease = 0 and add_rain >= 0 {
								rain(cnt) = 1
								rain_x(cnt) = rnd(windowx)
								rain_y(cnt) = -rnd(windowy)
								snow_size(cnt) = rnd(5)+1
							} else {
								rain(cnt) = 0
								rain_x(cnt) = 0
								rain_y(cnt) = 0
								snow_size(cnt) = 0
							}
						}
			
						if rain(cnt) = 1 {
							color 255, 255, 255
			
							if temperature >= 3 {	; æ°—æ¸©ãŒ3â„ƒä»¥ä¸Šãªã‚‰é›¨
								rain_y(cnt) += 5
								line rain_x(cnt), rain_y(cnt), rain_x(cnt), rain_y(cnt)+20
									
							} else {				; æ°—æ¸©ãŒ2â„ƒä»¥ä¸‹ãªã‚‰é›ª
								rain_x(cnt) += (rnd(3)-1)*2
								rain_y(cnt) += 1
								circle rain_x(cnt), rain_y(cnt), rain_x(cnt)+snow_size(cnt), rain_y(cnt)+snow_size(cnt)
									
							}
						}
		
					loop
				}
		
		return
	
*get_news
	//éƒ½å¸‚ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®å–å¾—
	
		first_loop = 0
		news_content = ""
	
		//ç‰¹æ®Šãƒ‹ãƒ¥ãƒ¼ã‚¹
			notesel news_file
			noteload "data/news/special.news"
			
			; ãƒãƒƒãƒ—ä½œæˆç›´å¾Œ
				if not_displayed_news_new_map = 1 {
					not_displayed_news_new_map = 0
	
					same_news = 0
	
					; åŒã˜å†…å®¹ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’è¤‡æ•°èª­ã¿è¾¼ã‚€
					repeat notemax
						noteget news_tmp, cnt
	
						if instr(news_tmp, 0, "case=\"new_map\"") != -1 {
							split news_tmp, ", ", tmp, news_content_candidate_tmp
							news_content_candidate(same_news) = strmid(news_content_candidate_tmp, 0, instr(news_content_candidate_tmp, 0, "}"))	; è¡¨ç¤ºã™ã‚‹ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®å€™è£œ
							same_news ++	; åŒã˜å†…å®¹ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®æ•°
						}
					loop
					
					if same_news > 0 {
						news_content = news_content_candidate(rnd(same_news))		; å€™è£œã®ä¸­ã‹ã‚‰ã²ã¨ã¤ãƒ©ãƒ³ãƒ€ãƒ ã«é¸ã¶
					}
				}
	
		//ç‰¹ã«å ±ã˜ã‚‹ã“ã¨ãŒãªã„å ´åˆã€ã©ã†ã§ã‚‚ã„ã„ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’è¡¨ç¤º
			notesel news_file
			noteload "data/news/others.news"
			
			if news_content = "" {
				not_displayed_news_new_map = 0

				same_news = 0
	
				; åŒã˜å†…å®¹ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’è¤‡æ•°èª­ã¿è¾¼ã‚€
				repeat notemax
					noteget news_tmp, cnt
	
					if instr(news_tmp, 0, "case=\"others\"") != -1 {
						split news_tmp, ", ", tmp, news_content_candidate_tmp
						news_content_candidate(same_news) = strmid(news_content_candidate_tmp, 0, instr(news_content_candidate_tmp, 0, "}"))	; è¡¨ç¤ºã™ã‚‹ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®å€™è£œ
						same_news ++	; åŒã˜å†…å®¹ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®æ•°
					}
				loop
				
				if same_news > 0 {
					news_content = news_content_candidate(rnd(same_news))		; å€™è£œã®ä¸­ã‹ã‚‰ã²ã¨ã¤ãƒ©ãƒ³ãƒ€ãƒ ã«é¸ã¶
				}
			}
	
	return
					
	
*setting
	screen 1, 300, 400
	gsel 1
	
	title "Cities Box è¨­å®š"
	
	onclick *setting_onclick
	
	color 95, 95, 95 : boxf
	
	if from_setting_onclick = 0 {
		setting_SystemFont = SystemFont
	}
	
	color 255, 255, 255
	font setting_SystemFont, 16
	
	//éƒ½å¸‚å(City_Name)
		pos 10, 10 : mes "éƒ½å¸‚å"
	
		if from_setting_onclick = 0 {
			setting_City_Name = City_Name
		}
		
		objsize 210, 20
		pos 80, 10 : input setting_City_Name
	
	//å¸‚é•·å(Mayor_Name)
		pos 10, 40 : mes "å¸‚é•·å"
	
		if from_setting_onclick = 0 {
			setting_Mayor_Name = Mayor_Name
		}
		
		objsize 210, 20
		pos 80, 40 : input setting_Mayor_Name
	
	//å¤©å€™ã®å¤‰åŒ–(Set_Change_Weather)
		if from_setting_onclick = 0 {
			setting_Set_Change_Weather = Set_Change_Weather
		}
		
		if setting_Set_Change_Weather = 0 {
			pos 10, 73 : gcopy 14, 0, 0, 16, 16
		} else {
			pos 10, 73 : gcopy 14, 0, 16, 16, 16
		}
		
		pos 35, 70 : mes "å¤©å€™ã®å¤‰åŒ–"
	
	//BGMã®å†ç”Ÿã®æœ‰ç„¡(Set_Play_BGM)
		if from_setting_onclick = 0 {
			setting_Set_Play_BGM = Set_Play_BGM
		}
		
		if setting_Set_Play_BGM = 0 {
			pos 10, 103 : gcopy 14, 0, 0, 16, 16
		} else {
			pos 10, 103 : gcopy 14, 0, 16, 16, 16
		}
		
		pos 35, 100 : mes "BGMã®å†ç”Ÿ"
	
	//ãƒ•ã‚©ãƒ³ãƒˆ(SystemFont)
		pos 10, 130 : mes "ãƒ•ã‚©ãƒ³ãƒˆ"
	
		objsize 194, 20
		pos 80, 130 : input setting_SystemFont
	
		gmode 2
		pos 274, 130 : gcopy 16, 0, 0, 16, 16
	
	//OKãƒœã‚¿ãƒ³
		color 255, 255, 255 : boxf 100, 360, 200, 390
		color 95, 95, 95 : boxf 101, 361, 199, 389
	
		color 255, 255, 255 : font setting_SystemFont, 20
		cmes "OK", 100, 360, 200, 390
	
	from_setting_onclick = 0
		
	stop
	
*setting_onclick
	gsel 1
	
	from_setting_onclick = 1
	
	//å¤©å€™ã®å¤‰åŒ–(Set_Change_Weather)
		//ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
			if click_range(10, 73, 10+16, 73+16) = 1 {
				if setting_Set_Change_Weather = 0 {
					setting_Set_Change_Weather = 1
				} else {
					setting_Set_Change_Weather = 0
				}
			}
	
	//BGMã®å†ç”Ÿã®æœ‰ç„¡(Set_Play_BGM)
		//ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
			if click_range(10, 103, 10+16, 103+16) = 1 {
				if setting_Set_Play_BGM = 0 {
					setting_Set_Play_BGM = 1
				} else {
					setting_Set_Play_BGM = 0
				}
			}
	
	//ãƒ•ã‚©ãƒ³ãƒˆ(SystemFont)
		//å‚ç…§ãƒœã‚¿ãƒ³
			if click_range(274, 130, 274+16, 130+16) = 1 {
				gosub *refer_fonts
			}
	
	//OKãƒœã‚¿ãƒ³
		if click_range(100, 360, 200, 390) = 1 {
	
			// ãƒãƒƒãƒ—ä½œæˆæ™‚ã®è¨­å®šã®å ´åˆ
				if from_new_map = 1 {
					City_Name = setting_City_Name
					Mayor_Name = setting_Mayor_Name
					Set_Change_Name = setting_Set_Change_Name
					SystemFont = setting_SystemFont
					
					gosub *save
	
					gsel 1, -1
					gsel 0
	
					load_mapdata_name = save_mapdata_name
	
					from_setting_onclick = 0
	
					onclick 0
					
					goto *load_map
				}
			
			gosub *save_setting
			
			gsel 1, -1
			onclick 0
			from_setting_onclick = 0
	
			gsel 0
			goto *main
		}
	
	clrobj
	
	goto *setting
	
*new_map_setting
	screen 1, 400, 300
	
	gsel 1
	title "æ–°è¦ãƒãƒƒãƒ—ä½œæˆ"
	
	onclick gosub *new_map_setting_onclick
	
	color 95, 95, 95 : boxf
	
	color 255, 255, 255
	font SystemFont, 16
	
	//éƒ½å¸‚å(City_Name)
		pos 10, 10 : mes "éƒ½å¸‚å"
	
		if from_setting_onclick = 0 {
			setting_City_Name = City_Name
		}
		
		objsize 280, 20
		pos 80, 10 : input setting_City_Name
	
	//å¸‚é•·å(Mayor_Name)
		pos 10, 40 : mes "å¸‚é•·å"
	
		if from_setting_onclick = 0 {
			setting_Mayor_Name = Mayor_Name
		}
		
		objsize 280, 20
		pos 80, 40 : input setting_Mayor_Name
	
	//å¤©å€™ã®å¤‰åŒ–(Set_Change_Weather)
		if from_setting_onclick = 0 {
			setting_Set_Change_Weather = Set_Change_Weather
		}
		
		if setting_Set_Change_Weather = 0 {
			pos 10, 73 : gcopy 14, 0, 0, 16, 16
		} else {
			pos 10, 73 : gcopy 14, 0, 16, 16, 16
		}
		
		pos 35, 70 : mes "å¤©å€™ã®å¤‰åŒ–"
	
	//OKãƒœã‚¿ãƒ³
		color 255, 255, 255 : boxf 150, 260, 250, 290
		color 95, 95, 95 : boxf 151, 261, 249, 289
	
		color 255, 255, 255 : font SystemFont, 20
		cmes "OK", 150, 260, 250, 290
		
	stop
	
*new_map_setting_onclick
	gsel 1
	
	from_setting_onclick = 1
	
	//å¤©å€™ã®å¤‰åŒ–(Set_Change_Weather)
		//ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
			if click_range(10, 73, 10+16, 73+16) = 1 {
				if setting_Set_Change_Weather = 0 {
					setting_Set_Change_Weather = 1
				} else {
					setting_Set_Change_Weather = 0
				}
			}
	
	//OKãƒœã‚¿ãƒ³
		if click_range(150, 260, 250, 290) = 1 {
	
		// ãƒãƒƒãƒ—ä½œæˆæ™‚ã®åˆæœŸè¨­å®š
			City_Name = setting_City_Name
			Mayor_Name = setting_Mayor_Name
			Set_Change_Name = setting_Set_Change_Name
			
			gosub *save

			gsel 1, -1
			gsel 0
	
			load_mapdata_name = save_mapdata_name
			
			from_setting_onclick = 0
	
			not_displayed_news_new_map = 1

			onclick 0
			
			goto *load_map
		}
	
	clrobj
	
	goto *new_map_setting
	
*save_setting
	chdir directory
	
	//ã¾ãšã¯æœ¬ä½“è¨­å®š(data/config.dat)ã‚’ä¿å­˜
		noteadd_SystemFont = 0
		noteadd_Set_Play_BGM = 0
		
		notesel config
	
		repeat notemax
			noteget config_buf, cnt
	
			if instr(config_buf, 0, "SystemFont") != -1 {
				SystemFont = setting_SystemFont
				noteadd "SystemFont = \""+SystemFont+"\"", cnt, 1
				noteadd_SystemFont = 1
			}
	
			if instr(config_buf, 0, "Set_Play_BGM") != -1 {
				Set_Play_BGM = setting_Set_Play_BGM
				noteadd "Set_Play_BGM = "+Set_Play_BGM+";", cnt, 1
				noteadd_Set_Play_BGM = 1
			}
		loop
	
		if noteadd_SystemFont = 0 {
			SystemFont = setting_SystemFont
			noteadd "SystemFont = \""+SystemFont+"\"", -1
		}
		if noteadd_Set_Play_BGM = 0 {
			Set_Play_BGM = setting_Set_Play_BGM
			noteadd "Set_Play_BGM = "+Set_Play_BGM+";", -1
		}
	
		notesave "data/config.dat"
	
	//æ¬¡ã«å„ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿(*.cbd)ã®è¨­å®šã‚’ä¿å­˜
		noteadd_City_Name = 0
		noteadd_Mayor_Name = 0
		noteadd_Set_Change_Weather = 0
		
		notesel load_mapdata
	
		repeat notemax
			noteget load_mapdata_buf, cnt
	
			if instr(load_mapdata_buf, 0, "City_Name") != -1 {
				City_Name = setting_City_Name
				noteadd "City_Name = \""+City_Name+"\";", cnt, 1
				noteadd_City_Name = 1
			}
	
			if instr(load_mapdata_buf, 0, "Mayor_Name") != -1 {
				Mayor_Name = setting_Mayor_Name
				noteadd "Mayor_Name = \""+Mayor_Name+"\";", cnt, 1
				noteadd_Mayor_Name = 1
			}
	
			if instr(load_mapdata_buf, 0, "Set_Change_Weather") != -1 {
				Set_Change_Weather = setting_Set_Change_Weather
				noteadd "Set_Change_Weather = "+Set_Change_Weather+";", cnt, 1
				noteadd_Set_Change_Weather = 1
			}
		loop
	
		if noteadd_City_Name = 0 {
			City_Name = setting_City_Name
			noteadd "City_Name = \""+City_Name+"\";", -1
		}
		if noteadd_Mayor_Name = 0 {
			Mayor_Name = setting_Mayor_Name
			noteadd "City_Name = \""+Mayor_Name+"\";", -1
		}
		if noteadd_Set_Change_Weather = 0 {
			Set_Change_Weather = setting_Set_Change_Weather
			noteadd "City_Name = \""+Set_Change_Weather+"\";", -1
		}
	
		if load_mapdata_name = "" {
			gosub *save
			load_mapdata_name = save_mapdata_name
	
			if from_new_map = 0 {
				return
			}
		}
	
		notesave load_mapdata_name
	
	return
	
*refer_fonts
	#uselib "comdlg32.dll"
	#func ChooseFont "ChooseFontA" int
	
	mref bmscr, 67
	dim chfont,16
	dim logfont,16
	sdim setting_SystemFont,32
	
	chfont.0 = 60 
	chfont.1 = bmscr.13
	chfont.3=varptr(logfont)
	chfont.5 = 0x01000141
	
	pm=varptr(chfont)
	ChooseFont pm
	
	if stat = 0 {
		return
	}
	
	style=0
	if (chfont.12 & 0x0100):style=style+1
	if (chfont.12 & 0x0200):style=style+2 
	if (logfont.5 & 0x0000FF00):style=style+4 
	if (logfont.5 & 0x00FF0000):style=style+8
	size=chfont.4/10
	memcpy setting_SystemFont,logfont,32,0,28
	
	return
	
*save
	save_mapdata = ""
	
	//èª¤åå¿œé˜²æ­¢
		if from_new_map = 0 and click_range(0, 0, windowx, windowy) = 1 and click_range(windowx-54, windowy-40-titlebar_h, windowx, windowy) = 0 {
			return
		}
	
	//ãƒãƒƒãƒ—ä¿å­˜
		title "ä¿å­˜ä¸­..."
		
		notesel save_mapdata
		
		//æ¬¡ã«å„ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿(*.cbd)ã®è¨­å®šã‚’ä¿å­˜
			noteadd "City_Name = \""+City_Name+"\";", -1
			noteadd "Mayor_Name = \""+Mayor_Name+"\";", -1
	
			noteadd "Total_Population = "+Total_Population+";", -1
	
			noteadd "Set_Change_Weather = "+Set_Change_Weather+";", -1
			noteadd "Temperature = "+temperature+";", -1
	
		//ç©ºç™½
			noteadd " ", -1
	
		//ãƒãƒƒãƒ—ã‚µã‚¤ã‚º
			noteadd "mapx = "+mapx+";", -1
			noteadd "mapy = "+mapy+";", -1
	
		//ç©ºç™½
			noteadd " ", -1
	
		//æ—¥æ™‚
			noteadd "time_Year = "+time_Year+";", -1
			noteadd "time_Month = "+time_Month+";", -1
			noteadd "time_Date = "+time_Date+";", -1
			noteadd "time_Hour = "+time_Hour+";", -1
			noteadd "time_Minutes = "+time_Minutes+";", -1
	
		//ç©ºç™½
			noteadd " ", -1
	
		//éœ€è¦åº¦
			noteadd "demand_Residential = "+demand_Residential+";", -1
			noteadd "demand_Commercial = "+demand_Commercial+";", -1
			noteadd "demand_Office = "+demand_Office+";", -1
			noteadd "demand_Industrial = "+demand_Industrial+";", -1
	
		//ç©ºç™½
			noteadd " ", -1
	
		//name(x,y)
			noteadd "name(x,y) {", -1
			
			repeat mapy
				y = cnt
			
				map_data_buf = ""
			
				repeat mapx
					x = cnt
					
					if cnt = 0 {
						map_data_buf = name(x,y)
					} else {
						map_data_buf = ""+map_data_buf+", "+name(x,y)+""
					}
				loop
			
				noteadd map_data_buf, -1
			loop
			
			noteadd "}", -1
			
		//category(x,y)
			noteadd "category(x,y) {", -1
			
			repeat mapy
				y = cnt
			
				map_data_buf = ""
			
				repeat mapx
					x = cnt
					
					if cnt = 0 {
						map_data_buf = category(x,y)
					} else {
						map_data_buf = ""+map_data_buf+", "+category(x,y)+""
					}
				loop
			
				noteadd map_data_buf, -1
			loop
			
			noteadd "}", -1
	
		//obj_type(x,y)
			noteadd "obj_type(x,y) {", -1
			
			repeat mapy
				y = cnt
			
				map_data_buf = ""
			
				repeat mapx
					x = cnt
			
					if cnt = 0 {
						map_data_buf = strf("%03d", obj_type(x,y))		; 3æ¡ã«æƒãˆã¦ã„ã‚‹ã®ã¯è¦‹ã‚„ã™ãã™ã‚‹ãŸã‚ãªã®ã§ç‰¹ã«æ„å‘³ã¯ç„¡ã„ã§ã™ã€‚4æ¡ï¼ˆ1000ä»¥ä¸Šï¼‰ã‚‚èª­ã¿è¾¼ã¿å¯
					} else {
						map_data_buf = ""+map_data_buf+", "+strf("%03d", obj_type(x,y))+""
					}
				loop
			
				noteadd map_data_buf, -1
			loop
			
			noteadd "}", -1
	
		//obj_dire(x,y)
			noteadd "obj_dire(x,y) {", -1
			
			repeat mapy
				y = cnt
			
				map_data_buf = ""
			
				repeat mapx
					x = cnt
			
					if cnt = 0 {
						map_data_buf = strf("%03d", obj_dire(x,y))
					} else {
						map_data_buf = ""+map_data_buf+", "+strf("%03d", obj_dire(x,y))+""
					}
				loop
			
				noteadd map_data_buf, -1
			loop
			
			noteadd "}", -1
	
		//obj_serial_num(x,y)
			noteadd "obj_serial_num(x,y) {", -1
			
			repeat mapy
				y = cnt
			
				map_data_buf = ""
			
				repeat mapx
					x = cnt
			
					if cnt = 0 {
						map_data_buf = strf("%03d", obj_serial_num(x,y))
					} else {
						map_data_buf = ""+map_data_buf+", "+strf("%03d", obj_serial_num(x,y))+""
					}
				loop
			
				noteadd map_data_buf, -1
			loop
			
			noteadd "}", -1
	
		//obj_use_tiles_x(x,y)
			noteadd "obj_use_tiles_x(x,y) {", -1
			
			repeat mapy
				y = cnt
			
				map_data_buf = ""
			
				repeat mapx
					x = cnt
			
					if cnt = 0 {
						map_data_buf = strf("%03d", obj_use_tiles_x(x,y))
					} else {
						map_data_buf = ""+map_data_buf+", "+strf("%03d", obj_use_tiles_x(x,y))+""
					}
				loop
			
				noteadd map_data_buf, -1
			loop
			
			noteadd "}", -1
	
		//obj_use_tiles_y(x,y)
			noteadd "obj_use_tiles_y(x,y) {", -1
			
			repeat mapy
				y = cnt
			
				map_data_buf = ""
			
				repeat mapx
					x = cnt
			
					if cnt = 0 {
						map_data_buf = strf("%03d", obj_use_tiles_y(x,y))
					} else {
						map_data_buf = ""+map_data_buf+", "+strf("%03d", obj_use_tiles_y(x,y))+""
					}
				loop
			
				noteadd map_data_buf, -1
			loop
			
			noteadd "}", -1
	
		//obj_tiles_x(x,y)
			noteadd "obj_tiles_x(x,y) {", -1
			
			repeat mapy
				y = cnt
			
				map_data_buf = ""
			
				repeat mapx
					x = cnt
			
					if cnt = 0 {
						map_data_buf = strf("%03d", obj_tiles_x(x,y))
					} else {
						map_data_buf = ""+map_data_buf+", "+strf("%03d", obj_tiles_x(x,y))+""
					}
				loop
			
				noteadd map_data_buf, -1
			loop
			
			noteadd "}", -1
	
		//obj_tiles_y(x,y)
			noteadd "obj_tiles_y(x,y) {", -1
			
			repeat mapy
				y = cnt
			
				map_data_buf = ""
			
				repeat mapx
					x = cnt
			
					if cnt = 0 {
						map_data_buf = strf("%03d", obj_tiles_y(x,y))
					} else {
						map_data_buf = ""+map_data_buf+", "+strf("%03d", obj_tiles_y(x,y))+""
					}
				loop
			
				noteadd map_data_buf, -1
			loop
			
			noteadd "}", -1
	
		//residents(x,y)
			noteadd "residents(x,y) {", -1
			
			repeat mapy
				y = cnt
			
				map_data_buf = ""
			
				repeat mapx
					x = cnt
			
					if cnt = 0 {
						map_data_buf = strf("%03d", residents(x,y))
					} else {
						map_data_buf = ""+map_data_buf+", "+strf("%03d", residents(x,y))+""
					}
				loop
			
				noteadd map_data_buf, -1
			loop
			
			noteadd "}", -1
	
		//workers_Commercial(x,y)
			noteadd "workers_Commercial(x,y) {", -1
			
			repeat mapy
				y = cnt
			
				map_data_buf = ""
			
				repeat mapx
					x = cnt
			
					if cnt = 0 {
						map_data_buf = strf("%03d", workers_Commercial(x,y))
					} else {
						map_data_buf = ""+map_data_buf+", "+strf("%03d", workers_Commercial(x,y))+""
					}
				loop
			
				noteadd map_data_buf, -1
			loop
			
			noteadd "}", -1
	
		//workers_Office(x,y)
			noteadd "workers_Office(x,y) {", -1
			
			repeat mapy
				y = cnt
			
				map_data_buf = ""
			
				repeat mapx
					x = cnt
			
					if cnt = 0 {
						map_data_buf = strf("%03d", workers_Office(x,y))
					} else {
						map_data_buf = ""+map_data_buf+", "+strf("%03d", workers_Office(x,y))+""
					}
				loop
			
				noteadd map_data_buf, -1
			loop
			
			noteadd "}", -1
	
		//workers_Industrial(x,y)
			noteadd "workers_Industrial(x,y) {", -1
			
			repeat mapy
				y = cnt
			
				map_data_buf = ""
			
				repeat mapx
					x = cnt
			
					if cnt = 0 {
						map_data_buf = strf("%03d", workers_Industrial(x,y))
					} else {
						map_data_buf = ""+map_data_buf+", "+strf("%03d", workers_Industrial(x,y))+""
					}
				loop
			
				noteadd map_data_buf, -1
			loop
			
			noteadd "}", -1
	
		//workers_Public(x,y)
			noteadd "workers_Public(x,y) {", -1
			
			repeat mapy
				y = cnt
			
				map_data_buf = ""
			
				repeat mapx
					x = cnt
			
					if cnt = 0 {
						map_data_buf = strf("%03d", workers_Public(x,y))
					} else {
						map_data_buf = ""+map_data_buf+", "+strf("%03d", workers_Public(x,y))+""
					}
				loop
			
				noteadd map_data_buf, -1
			loop
			
			noteadd "}", -1
	
		//land_price(x,y)
			noteadd "land_price(x,y) {", -1
			
			repeat mapy
				y = cnt
			
				map_data_buf = ""
			
				repeat mapx
					x = cnt
			
					if cnt = 0 {
						map_data_buf = strf("%03d", land_price(x,y))
					} else {
						map_data_buf = ""+map_data_buf+", "+strf("%03d", land_price(x,y))+""
					}
				loop
			
				noteadd map_data_buf, -1
			loop
			
			noteadd "}", -1
		
		//crime_rate(x,y)
			noteadd "crime_rate(x,y) {", -1
			
			repeat mapy
				y = cnt
			
				map_data_buf = ""
			
				repeat mapx
					x = cnt
			
					if cnt = 0 {
						map_data_buf = strf("%03d", crime_rate(x,y))
					} else {
						map_data_buf = ""+map_data_buf+", "+strf("%03d", crime_rate(x,y))+""
					}
				loop
			
				noteadd map_data_buf, -1
			loop
			
			noteadd "}", -1
	
		//education_rate(x,y)
			noteadd "education_rate(x,y) {", -1
			
			repeat mapy
				y = cnt
			
				map_data_buf = ""
			
				repeat mapx
					x = cnt
			
					if cnt = 0 {
						map_data_buf = strf("%03d", education_rate(x,y))
					} else {
						map_data_buf = ""+map_data_buf+", "+strf("%03d", education_rate(x,y))+""
					}
				loop
			
				noteadd map_data_buf, -1
			loop
			
			noteadd "}", -1
	
		//reservation(x,y)
			noteadd "reservation(x,y) {", -1
			
			repeat mapy
				y = cnt
			
				map_data_buf = ""
			
				repeat mapx
					x = cnt
			
					if cnt = 0 {
						map_data_buf = reservation(x,y)
					} else {
						map_data_buf = ""+map_data_buf+", "+reservation(x,y)+""
					}
				loop
			
				noteadd map_data_buf, -1
			loop
			
			noteadd "}", -1
	
		//ä¿å­˜å…ˆãƒ•ã‚¡ã‚¤ãƒ«ã®é¸æŠ
			dialog "cbx", 17, "Cities Box ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿"
	
			save_mapdata_name = refstr
			if instr(save_mapdata_name, 0, ".cbx") = -1 and instr(save_mapdata_name, 0, ".cbd") = -1 {
				save_mapdata_name = ""+save_mapdata_name+".cbx"
			}
	
			if stat = 0 {
				return
			}
	
		//æš—å·åŒ–ï¼ˆcbxã§ä¿å­˜ã—ãŸå ´åˆã®ã¿ï¼‰
			if instr(save_mapdata_name, 0, ".cbd") = -1 and stat = 1 {
				notesel save_mapdata
				l = notemax
				
				repeat l
					sdim save_mapdata_buf, 4096
					
					notesel save_mapdata
					noteget save_mapdata_buf, cnt
					
					save_mapdata_buf_strlen = strlen(save_mapdata_buf)
					enc save_mapdata_buf, (strlen(getpath(save_mapdata_name,8+1))/2), save_mapdata_buf_strlen
		
					notesel save_mapdata_Cipher
					noteadd save_mapdata_buf, cnt
				loop
			} else : if instr(save_mapdata_name, 0, ".cbd") != -1 {
				notesel save_mapdata
				notesave save_mapdata_name
	
				return
			}
	
		//ä¿å­˜
			if stat = 1 {
				notesel save_mapdata_Cipher
				notesave save_mapdata_name
			}
	
		return
	
*update
	//ƒAƒbƒvƒf[ƒ^[‹N“®
		latest_version__Updater = get_chapter(latest_version, "Updater", " : ", ";")
		latest_version__Updater_Name = get_chapter(latest_version, "Updater_Name", " : ", ";")
	
		download latest_version__Updater, latest_version__Updater_Name, latest_version__Updater_Name
	
		exist latest_version__Updater_Name
	
		if strsize = -1 {
			dialog "ƒAƒbƒvƒf[ƒg‚É¸”s‚µ‚Ü‚µ‚½"
			return
			
		} else {
			exec latest_version__Updater_Name
			end
		}
	
	stop
			
*exit
	if ginfo_act = 0 {
		//ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
			repeat total_addons
				exist "data/temp/"+addon_name(cnt)+".temp"
				
				if strsize != -1 {
					delete "data/temp/"+addon_name(cnt)+".temp"
				}
			
				wait 1
			loop
	
		gsel 0
		end
		
	} else {
		gsel ginfo_act, -1
		
		onclick 0
	
		from_setting_onclick = 0
	
		gsel 0
	
		if from_new_map = 1 {
			from_new_map = 0
			goto *menu
		}
	
		cursor_mode = "normal"
		
		goto *main
	}
